<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ambari 集成自定义服务方法</title>
    <url>/2021/04/20/Ambari-custom-service/</url>
    <content><![CDATA[<p>本文主要介绍 Ambari 集成自定义服务的详细过程，包括制作 RPM 包、metainfo 文件、配置文件、安装、启动、停止等脚本，以及快速链接。</p>
<a id="more"></a>

<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>本文主要介绍 Ambari 集成自定义服务的方法，这里以自研组件 Ftp-Transport 为例做介绍。</p>
<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><ul>
<li>操作系统：Centos 7.6</li>
<li>Ambari版本：Ambari 2.7.1</li>
<li>HDP版本：HDP 3.0.1</li>
<li>已安装 Ambari 环境，具体可参考：<a href="http://www.erik-ly.com/2020/12/03/ambari-install/" target="_blank" rel="noopener">Ambari 安装详细步骤</a></li>
</ul>
<h1 id="制作-RPM-包"><a href="#制作-RPM-包" class="headerlink" title="制作 RPM 包"></a>制作 RPM 包</h1><p>因为 Ambari 安装 包的时候都是以 RPM 包的形式安装，所以尽量将自研服务制作成 RPM 包，具体制作方法可以参考<a href="http://www.erik-ly.com/2019/12/29/ZooKeeper-rpm/" target="_blank" rel="noopener">ZooKeeper从源码到RPM包制作过程详解</a>， 里面有详细的打包步骤，这里不再赘述，直接看最终 rpm 包。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416142207.png" alt=""></p>
<h1 id="制作本地源"><a href="#制作本地源" class="headerlink" title="制作本地源"></a>制作本地源</h1><ul>
<li>复制 rpm 包</li>
</ul>
<p>在原有源的基础上增加 <code>ftp-transport</code> 源</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;www&#x2F;html&#x2F;ambari&#x2F;HDP&#x2F;centos7&#x2F;3.0.1.0</span><br><span class="line">mkdir ftp-transport</span><br></pre></td></tr></table></figure>
<p>复制rpm包到ftp-transport文件夹<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416142716.png" alt=""></p>
<ul>
<li>更新 repodata</li>
</ul>
<p>在原有 repodata 文件夹的同级目录中执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;www&#x2F;html&#x2F;ambari&#x2F;HDP&#x2F;centos7&#x2F;3.0.1.0</span><br><span class="line">rm -rf repodata&#x2F;</span><br><span class="line">createrepo .&#x2F;</span><br></pre></td></tr></table></figure>

<ul>
<li>更新 yum 源</li>
</ul>
<p>在所有节点执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<ul>
<li>查看软件源</li>
</ul>
<p>在任意节点通过执行 <code>yum search service_name</code> 来查看软件源是否制作好，如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum search ftp-transport</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416143338.png" alt=""></p>
<p>出现类似这样的信息即为制作本地源完成。</p>
<h1 id="创建-stacks-文件"><a href="#创建-stacks-文件" class="headerlink" title="创建 stacks 文件"></a>创建 stacks 文件</h1><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>这里只介绍 Ambari 集成自定义服务所需的最少文件为例，最终的文件目录结构如下：<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416143718.png" alt=""></p>
<p>这些文件在源码中的位置为：<code>ambari-server\src\main\resources\stacks\HDP\3.0\services\FTP_TRANSPORT</code>，现在介绍主要的文件内容。</p>
<h2 id="metainfo-文件"><a href="#metainfo-文件" class="headerlink" title="metainfo 文件"></a>metainfo 文件</h2><p><code>metainfo.xm</code> 文件是非常重要的一个文件，具体介绍可以参考:<a href="http://www.erik-ly.com/2020/11/29/ambari-metainfo/" target="_blank" rel="noopener">Ambari 中 metainfo.xml 文件解析</a></p>
<p>这里的 <code>metainfo.xm</code> 文件全部内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;metainfo&gt;</span><br><span class="line">  &lt;schemaVersion&gt;2.0&lt;&#x2F;schemaVersion&gt;</span><br><span class="line">  &lt;services&gt;</span><br><span class="line">    &lt;service&gt;</span><br><span class="line">      &lt;name&gt;FTP_TRANSPORT&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;displayName&gt;Ftp-Transport&lt;&#x2F;displayName&gt;</span><br><span class="line">      &lt;comment&gt;Ftp-Transport是一种基于FTP协议的文件数据传输增强工具。&lt;&#x2F;comment&gt;</span><br><span class="line">      &lt;version&gt;1.0.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;components&gt;</span><br><span class="line">        &lt;component&gt;</span><br><span class="line">          &lt;name&gt;FTP_TRANSPORT&lt;&#x2F;name&gt;</span><br><span class="line">          &lt;displayName&gt;Ftp-Transport&lt;&#x2F;displayName&gt;</span><br><span class="line">          &lt;category&gt;MASTER&lt;&#x2F;category&gt;</span><br><span class="line">          &lt;cardinality&gt;1&lt;&#x2F;cardinality&gt;</span><br><span class="line">          &lt;versionAdvertised&gt;true&lt;&#x2F;versionAdvertised&gt;</span><br><span class="line">          &lt;commandScript&gt;</span><br><span class="line">            &lt;script&gt;scripts&#x2F;ftp_transport.py&lt;&#x2F;script&gt;</span><br><span class="line">            &lt;scriptType&gt;PYTHON&lt;&#x2F;scriptType&gt;</span><br><span class="line">            &lt;timeout&gt;1200&lt;&#x2F;timeout&gt;</span><br><span class="line">          &lt;&#x2F;commandScript&gt;</span><br><span class="line">          &lt;logs&gt;</span><br><span class="line">            &lt;log&gt;</span><br><span class="line">              &lt;logId&gt;ftp_transport&lt;&#x2F;logId&gt;</span><br><span class="line">              &lt;primary&gt;true&lt;&#x2F;primary&gt;</span><br><span class="line">            &lt;&#x2F;log&gt;</span><br><span class="line">          &lt;&#x2F;logs&gt;</span><br><span class="line">        &lt;&#x2F;component&gt;</span><br><span class="line">      &lt;&#x2F;components&gt;</span><br><span class="line"></span><br><span class="line">      &lt;osSpecifics&gt;</span><br><span class="line">        &lt;osSpecific&gt;</span><br><span class="line">          &lt;osFamily&gt;any&lt;&#x2F;osFamily&gt;</span><br><span class="line">          &lt;packages&gt;</span><br><span class="line">            &lt;package&gt;</span><br><span class="line">              &lt;name&gt;ftp-transport&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;&#x2F;package&gt;</span><br><span class="line">          &lt;&#x2F;packages&gt;</span><br><span class="line">        &lt;&#x2F;osSpecific&gt;</span><br><span class="line">      &lt;&#x2F;osSpecifics&gt;</span><br><span class="line"></span><br><span class="line">      &lt;requiredServices&gt;</span><br><span class="line">        &lt;service&gt;REDIS&lt;&#x2F;service&gt;</span><br><span class="line">      &lt;&#x2F;requiredServices&gt;</span><br><span class="line"></span><br><span class="line">      &lt;configuration-dependencies&gt;</span><br><span class="line">        &lt;config-type&gt;ftp-transport-env&lt;&#x2F;config-type&gt;</span><br><span class="line">      &lt;&#x2F;configuration-dependencies&gt;</span><br><span class="line"></span><br><span class="line">      &lt;quickLinksConfigurations&gt;</span><br><span class="line">        &lt;quickLinksConfiguration&gt;</span><br><span class="line">          &lt;fileName&gt;quicklinks.json&lt;&#x2F;fileName&gt;</span><br><span class="line">          &lt;default&gt;true&lt;&#x2F;default&gt;</span><br><span class="line">        &lt;&#x2F;quickLinksConfiguration&gt;</span><br><span class="line">      &lt;&#x2F;quickLinksConfigurations&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;service&gt;</span><br><span class="line">  &lt;&#x2F;services&gt;</span><br><span class="line">&lt;&#x2F;metainfo&gt;</span><br></pre></td></tr></table></figure>

<p>因为 <code>Ftp-Transport</code> 依赖 <code>Redis</code>，所以这里增加了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;requiredServices&gt;</span><br><span class="line">  &lt;service&gt;REDIS&lt;&#x2F;service&gt;</span><br><span class="line">&lt;&#x2F;requiredServices&gt;</span><br></pre></td></tr></table></figure>

<p>因为有配置文件 <code>ftp-transport-env</code>，所以</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;configuration-dependencies&gt;</span><br><span class="line">  &lt;config-type&gt;ftp-transport-env&lt;&#x2F;config-type&gt;</span><br><span class="line">&lt;&#x2F;configuration-dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>因为有快速链接，所以</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;quickLinksConfigurations&gt;</span><br><span class="line">  &lt;quickLinksConfiguration&gt;</span><br><span class="line">    &lt;fileName&gt;quicklinks.json&lt;&#x2F;fileName&gt;</span><br><span class="line">    &lt;default&gt;true&lt;&#x2F;default&gt;</span><br><span class="line">  &lt;&#x2F;quickLinksConfiguration&gt;</span><br><span class="line">&lt;&#x2F;quickLinksConfigurations&gt;</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>配置文件都在 <code>configuration</code> 文件夹内，在页面的配置参数中展示，值的属性可以作一些简单的约束校验，详情可以参考：<a href="http://www.erik-ly.com/2021/04/16/Ambari-service-configurations-validation-and-recommend/" target="_blank" rel="noopener">Ambari 服务配置校验和配置推荐介绍</a> 文章的 “value-attributes” 部分介绍。</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>脚本都在 <code>scripts</code> 文件夹内，这里有 <code>params.py</code> 和 <code>ftp_transport.py</code> 两个 Python 脚本，<code>params.py</code> 主要是获取参数配置， <code>ftp_transport.py</code> 主要执行服务的安装、启停、状态监控等。</p>
<h3 id="params-py"><a href="#params-py" class="headerlink" title="params.py"></a><code>params.py</code></h3><p><code>params.py</code> 里只列举部分内容，如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">config &#x3D; Script.get_config()</span><br><span class="line"># Logger.info(&quot;config:&#123;0&#125;&quot;.format(config))</span><br><span class="line">Logger.info(&#39;Starting config params ...&#39;)</span><br></pre></td></tr></table></figure>
<p>Confing 中包含几乎所有的配置参数信息，如果想获取哪个参数，可以打印日志看下，比如获取 ftp-transport 的 master 安装节点 hostname，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># master节点hostname或IP</span><br><span class="line">ftp_transport_master_hostname &#x3D; config[&#39;clusterHostInfo&#39;][&#39;ftp_transport_hosts&#39;][0]</span><br></pre></td></tr></table></figure>

<p>日志打印方法为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from resource_management.core.logger import Logger</span><br><span class="line"># 初始化</span><br><span class="line">Logger.initialize_logger()</span><br><span class="line">ftp_transport_env &#x3D; config[&#39;configurations&#39;][&#39;ftp-transport-env&#39;]</span><br><span class="line">Logger.info(&quot;ftp_transport_env:&#123;0&#125;&quot;.format(ftp_transport_env))</span><br></pre></td></tr></table></figure>

<h3 id="ftp-transport-py"><a href="#ftp-transport-py" class="headerlink" title="ftp_transport.py"></a><code>ftp_transport.py</code></h3><p>这里主要介绍加载配置、安装、启动、停止、状态监控等功能。</p>
<ul>
<li>加载配置</li>
</ul>
<p>这一步是必须的，否则无法获取当前的配置信息，之后操作会报错。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Ftp_transport_master(Script):</span><br><span class="line">    def configure(self, env):</span><br><span class="line">        import params</span><br><span class="line">        Logger.info(&#39;Configure Starting Config Params ...&#39;)</span><br><span class="line">        env.set_params(params)</span><br><span class="line">        Logger.info(&#39;Configure Config Params.&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>安装</li>
</ul>
<p>如无特殊需求，可以直接调用 Ambari 分装好的安装组件方法 <code>self.install_packages(env)</code>，如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def install(self, env):</span><br><span class="line">    import params</span><br><span class="line">    env.set_params(params)</span><br><span class="line">    Logger.info(&#39;Starting Install Ftp-Transport ...&#39;)</span><br><span class="line">    self.install_packages(env)</span><br><span class="line">    Logger.info(&#39;Installed Ftp-Transport!&#39;)</span><br></pre></td></tr></table></figure>

<p>安装时会自动执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-08-09 16:42:51,817 - Installing package ftp-transport (&#39;&#x2F;usr&#x2F;bin&#x2F;yum -y install ftp-transport&#39;)</span><br></pre></td></tr></table></figure>

<p>这个 <code>ftp-transport</code> 就是在 <code>metainfo.xml</code>中设置的 <code>packages</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;osSpecifics&gt;</span><br><span class="line">  &lt;osSpecific&gt;</span><br><span class="line">    &lt;osFamily&gt;any&lt;&#x2F;osFamily&gt;</span><br><span class="line">    &lt;packages&gt;</span><br><span class="line">      &lt;package&gt;</span><br><span class="line">        &lt;name&gt;ftp-transport&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;&#x2F;package&gt;</span><br><span class="line">    &lt;&#x2F;packages&gt;</span><br><span class="line">  &lt;&#x2F;osSpecific&gt;</span><br><span class="line">&lt;&#x2F;osSpecifics&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动</li>
</ul>
<p>启动服务命令，这里的启动有点复杂，主要是需要获取各种参数，实际是使用 <code>java -jar</code> 命令启动的，启动后需要写入 pid 文件，否则无法监控到当前服务状态。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def start(self, env):</span><br><span class="line">        import params</span><br><span class="line">        # import redis_params</span><br><span class="line">        env.set_params(params)</span><br><span class="line"></span><br><span class="line">        Logger.info(&#39;Starting Ftp-Transport ...&#39;)</span><br><span class="line"></span><br><span class="line">        # 构建参数值</span><br><span class="line">        master_jar_path &#x3D; os.path.join(params.ftp_transport_base_dir, params.ftp_transport_master_jar)</span><br><span class="line">        database_url &#x3D; params.ftp_transport_database_url</span><br><span class="line">        database_user &#x3D; params.ftp_transport_database_user</span><br><span class="line">        database_pwd &#x3D; params.ftp_transport_database_password</span><br><span class="line"></span><br><span class="line">        # 获取Ftp-Transport master节点的IP</span><br><span class="line">        master_ip &#x3D; socket.gethostbyname(params.ftp_transport_master_hostname)</span><br><span class="line"></span><br><span class="line">        worker_jar_name &#x3D; params.ftp_transport_worker_jar_name</span><br><span class="line">        worker_start_shell_name &#x3D; params.ftp_transport_worker_start_shell_name</span><br><span class="line">        worker_source_path &#x3D; os.path.join(params.ftp_transport_base_dir, params.ftp_transport_worker_source_dir)</span><br><span class="line">        worker_goal_path &#x3D; os.path.join(params.ftp_transport_base_dir, params.ftp_transport_worker_goal_dir)</span><br><span class="line"></span><br><span class="line">        # 获取JAVA_HOME</span><br><span class="line">        java_home &#x3D; params.java64_home</span><br><span class="line">        java_path &#x3D; os.path.join(java_home, &quot;bin&#x2F;java&quot;)</span><br><span class="line"></span><br><span class="line">        ftp_transport_log_path &#x3D; os.path.join(params.ftp_transport_log_dir, params.ftp_transport_log_file)</span><br><span class="line"></span><br><span class="line">        # 获取redis集群信息</span><br><span class="line">        print(&#39;zookeeper_host_port:&#39;+params.zookeeper_host_port)</span><br><span class="line">        print(&#39;redis_instance_znode_dir:&#39;+params.redis_instance_znode_dir)</span><br><span class="line">        redis_node &#x3D; get_redis_instance_znode_list(params.zookeeper_host_port, params.redis_instance_znode_dir)</span><br><span class="line">        redis_instance_ip_port &#x3D; &quot;&quot;</span><br><span class="line">        for i in range(len(redis_node)):</span><br><span class="line">            redis_instance_znode_path &#x3D; os.path.join(params.redis_instance_znode_dir, redis_node[i])</span><br><span class="line">            redis_instance_dictObject &#x3D; get_redis_znode_data(params.zookeeper_host_port, redis_instance_znode_path)</span><br><span class="line">            for j in range(len(redis_instance_dictObject)):</span><br><span class="line">                redis_dir_name &#x3D; redis_instance_dictObject.keys()[j]</span><br><span class="line">                redis_ip &#x3D; redis_instance_dictObject[redis_dir_name][&#39;ip&#39;]</span><br><span class="line">                redis_port &#x3D; redis_instance_dictObject[redis_dir_name][&#39;port&#39;]</span><br><span class="line">                redis_instance_ip_port &#x3D; redis_instance_ip_port + str(redis_ip) + &quot;:&quot; + str(redis_port) + &quot; &quot;</span><br><span class="line"></span><br><span class="line">        print(&#39;redis_instance_ip_port:&#39;+redis_instance_ip_port)</span><br><span class="line"></span><br><span class="line">        # 构建启动master命令</span><br><span class="line">        start_master_cmd &#x3D; &quot;&#123;0&#125; -jar &#123;1&#125; --spring.datasource.url&#x3D;&#123;2&#125; --spring.datasource.username&#x3D;&#123;3&#125; &quot; \</span><br><span class="line">                           &quot;--spring.datasource.password&#x3D;&#123;4&#125; --worker.masterIP&#x3D;&#123;5&#125; --worker.jarGoalName&#x3D;&#123;6&#125; &quot; \</span><br><span class="line">                           &quot;--worker.startShellName&#x3D;&#123;7&#125; --worker.jarSourceFolder&#x3D;&#123;8&#125; --worker.jarGoalFolder&#x3D;&#123;9&#125; &quot; \</span><br><span class="line">                           &quot;--worker.java_home&#x3D;&#123;10&#125; --logging.file&#x3D;&#123;11&#125; --spring.redis.cluster.nodes&#x3D;&#123;12&#125;&quot;.format(</span><br><span class="line">            java_path, master_jar_path, database_url, database_user, database_pwd, master_ip, worker_jar_name,</span><br><span class="line">            worker_start_shell_name, worker_source_path, worker_goal_path, java_home, ftp_transport_log_path,</span><br><span class="line">            redis_instance_ip_port</span><br><span class="line">        )</span><br><span class="line">        Logger.info(&quot;start_master_cmd:&#123;0&#125;&quot;.format(start_master_cmd))</span><br><span class="line"></span><br><span class="line">        # 判断文件夹是否存在</span><br><span class="line">        # log日志文件</span><br><span class="line">        if not os.path.exists(params.ftp_transport_log_dir):</span><br><span class="line">            os.makedirs(params.ftp_transport_log_dir)</span><br><span class="line"></span><br><span class="line">        # pid文件</span><br><span class="line">        if not os.path.exists(params.ftp_transport_pid_dir):</span><br><span class="line">            os.makedirs(params.ftp_transport_pid_dir)</span><br><span class="line"></span><br><span class="line">        ftp_transport_nohup_path &#x3D; os.path.join(params.ftp_transport_log_dir, params.ftp_transport_nohup_file)</span><br><span class="line">        ftp_transport_pid_path &#x3D; os.path.join(params.ftp_transport_pid_dir, params.ftp_transport_pid_file)</span><br><span class="line">        nohup_cmd &#x3D; &#39;nohup &#123;0&#125; &gt; &#123;1&#125; 2&gt;&amp;1 &amp; echo $! &gt; &#123;2&#125;&#39;.format(start_master_cmd, ftp_transport_nohup_path, ftp_transport_pid_path)</span><br><span class="line">        # Execute(nohup_cmd, user&#x3D;params.root_user)</span><br><span class="line">        try:</span><br><span class="line">            Execute(nohup_cmd, user&#x3D;params.root_user)</span><br><span class="line">        except:</span><br><span class="line">            show_logs(ftp_transport_nohup_path, user&#x3D;params.root_user)</span><br><span class="line">            raise</span><br><span class="line"></span><br><span class="line">        Logger.info(&#39;Started Ftp-Transport !&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>停止</li>
</ul>
<p>停止服务，主要使用 <code>kill -9 pid</code> 命令，然后删除 pid 文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def stop(self, env):</span><br><span class="line">    import params</span><br><span class="line">    env.set_params(params)</span><br><span class="line">    Logger.info(&#39;Stopping Ftp-Transport&#39;)</span><br><span class="line"></span><br><span class="line">    # 检测pid内容状态</span><br><span class="line">    ftp_transport_pid_path &#x3D; os.path.join(params.ftp_transport_pid_dir, params.ftp_transport_pid_file)</span><br><span class="line">    # 当 pid 文件存在时，kill 进程</span><br><span class="line">    if os.path.exists(ftp_transport_pid_path):</span><br><span class="line">        kill_cmd &#x3D; &#39;kill -9 &#96;cat &#123;0&#125;&#96;&#39;.format(ftp_transport_pid_path)</span><br><span class="line">        Execute(kill_cmd, user&#x3D;params.root_user)</span><br><span class="line">        File(ftp_transport_pid_path, action&#x3D;&quot;delete&quot;)</span><br><span class="line"></span><br><span class="line">    Logger.info(&#39;Stopped Ftp-Transport&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>状态监控</li>
</ul>
<p>使用 Ambari 自带的检测程序状态方法 <code>check_process_status(os.path.join(params.ftp_transport_pid_dir, params.ftp_transport_pid_file))</code> 即可，它会先检查是否有 pid 文件，如果没有，就判定为服务停止；如果有 pid 文件，它会去尝试 kill 掉，但不会真的去 kill 掉，以此检测这个 pid 是否真的存在。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def status(self, env):</span><br><span class="line">    import params</span><br><span class="line">    env.set_params(params)</span><br><span class="line">    Logger.info(&#39;Checking ftp-transport Status ...&#39;)</span><br><span class="line">    check_process_status(os.path.join(params.ftp_transport_pid_dir, params.ftp_transport_pid_file))</span><br><span class="line">    Logger.info(&#39;Checked ftp-transport Status&#39;)</span><br></pre></td></tr></table></figure>

<h2 id="快速链接"><a href="#快速链接" class="headerlink" title="快速链接"></a>快速链接</h2><p>在 <code>quicklinks</code> 文件夹里存放快速链接文件 <code>quicklinks.json</code>，文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;default&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;Ftp-Transport-webUI default quick links configuration&quot;,</span><br><span class="line">  &quot;configuration&quot;: &#123;</span><br><span class="line">    &quot;protocol&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;:&quot;http&quot;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &quot;links&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;Ftp-Transport-webUI&quot;,</span><br><span class="line">        &quot;label&quot;: &quot;Ftp-Transport webUI&quot;,</span><br><span class="line">        &quot;requires_user_name&quot;: &quot;false&quot;,</span><br><span class="line">        &quot;component_name&quot;: &quot;FTP_TRANSPORT&quot;,</span><br><span class="line">        &quot;url&quot;:&quot;%@:&#x2F;&#x2F;%@:%@&#x2F;ftpTransport&quot;,</span><br><span class="line">        &quot;port&quot;:&#123;</span><br><span class="line">          &quot;http_default_port&quot;: &quot;9800&quot;,</span><br><span class="line">          &quot;regex&quot;: &quot;^(\\d+)$&quot;,</span><br><span class="line">          &quot;site&quot;: &quot;ftp-transport-env&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>metainfo.xm</code> 文件里标注快速链接信息，在<code>metainfo.xm</code>已介绍过，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;quickLinksConfigurations&gt;</span><br><span class="line">  &lt;quickLinksConfiguration&gt;</span><br><span class="line">    &lt;fileName&gt;quicklinks.json&lt;&#x2F;fileName&gt;</span><br><span class="line">    &lt;default&gt;true&lt;&#x2F;default&gt;</span><br><span class="line">  &lt;&#x2F;quickLinksConfiguration&gt;</span><br><span class="line">&lt;&#x2F;quickLinksConfigurations&gt;</span><br></pre></td></tr></table></figure>

<h2 id="重启-Ambari"><a href="#重启-Ambari" class="headerlink" title="重启 Ambari"></a>重启 Ambari</h2><p>编写好 stacks 文件后，可以直接放到 Ambari server 的文件夹 <code>/var/lib/ambari-server/resources/stacks/HDP/3.0/services/</code> 中，放置好后需要重启 Ambari。</p>
<p>重启 Ambari server</p>
<p>Server 节点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server restart</span><br></pre></td></tr></table></figure>

<p>重启 Ambari agent</p>
<p>全部节点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-agent restart</span><br></pre></td></tr></table></figure>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>接下来进行安装流程，</p>
<ul>
<li>添加服务</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416155640.png" alt=""></p>
<ul>
<li>选择服务</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416155735.png" alt=""></p>
<ul>
<li>选择服务的 master 安装节点</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416155801.png" alt=""></p>
<ul>
<li>配置参数</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416155935.png" alt=""></p>
<ul>
<li><p>检查<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210420165905.png" alt=""></p>
</li>
<li><p>安装<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210420165924.png" alt=""></p>
</li>
<li><p>概要<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210420165953.png" alt=""></p>
</li>
<li><p>服务概要<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210420170025.png" alt=""><br>可见服务已经安装成功，并且为启动状态，之后可进一步测试服务。</p>
</li>
</ul>
<p>至此，Ambari 集成服务完成。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 告警相关接口</title>
    <url>/2021/11/14/Ambari-interface-about-alert/</url>
    <content><![CDATA[<p>本文主要介绍一些常用的 Ambari 告警相关接口。</p>
<a id="more"></a>

<h1 id="告警定义"><a href="#告警定义" class="headerlink" title="告警定义"></a>告警定义</h1><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;alert_definitions?fields&#x3D;AlertDefinition&#x2F;component_name,AlertDefinition&#x2F;description,AlertDefinition&#x2F;enabled,AlertDefinition&#x2F;repeat_tolerance,AlertDefinition&#x2F;repeat_tolerance_enabled,AlertDefinition&#x2F;id,AlertDefinition&#x2F;ignore_host,AlertDefinition&#x2F;interval,AlertDefinition&#x2F;label,AlertDefinition&#x2F;name,AlertDefinition&#x2F;scope,AlertDefinition&#x2F;service_name,AlertDefinition&#x2F;source</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions/1"</span>,</span><br><span class="line">      <span class="attr">"AlertDefinition"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"description"</span> : <span class="string">"This alert is triggered if the number of down ZooKeeper servers in the cluster is greater than the configured critical threshold. It aggregates the results of ZooKeeper process checks."</span>,</span><br><span class="line">        <span class="attr">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"interval"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Percent ZooKeeper Servers Available"</span>,</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"zookeeper_server_process_percent"</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_enabled"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"ZOOKEEPER"</span>,</span><br><span class="line">        <span class="attr">"source"</span> : &#123;</span><br><span class="line">          <span class="attr">"alert_name"</span> : <span class="string">"zookeeper_server_process"</span>,</span><br><span class="line">          <span class="attr">"reporting"</span> : &#123;</span><br><span class="line">            <span class="attr">"ok"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"warning"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">35.0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"critical"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">70.0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"PERCENT"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"AGGREGATE"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions/2"</span>,</span><br><span class="line">      <span class="attr">"AlertDefinition"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"ZOOKEEPER_SERVER"</span>,</span><br><span class="line">        <span class="attr">"description"</span> : <span class="string">"This host-level alert is triggered if the ZooKeeper server process cannot be determined to be up and listening on the network."</span>,</span><br><span class="line">        <span class="attr">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"interval"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"ZooKeeper Server Process"</span>,</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"zookeeper_server_process"</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_enabled"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"ANY"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"ZOOKEEPER"</span>,</span><br><span class="line">        <span class="attr">"source"</span> : &#123;</span><br><span class="line">          <span class="attr">"default_port"</span> : <span class="number">2181.0</span>,</span><br><span class="line">          <span class="attr">"parameters"</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"socket.command"</span>,</span><br><span class="line">              <span class="attr">"display_name"</span> : <span class="string">"Socket Command"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="string">"ruok"</span>,</span><br><span class="line">              <span class="attr">"description"</span> : <span class="string">"A socket command which queries ZooKeeper to respond with its state. The expected response is imok."</span>,</span><br><span class="line">              <span class="attr">"type"</span> : <span class="string">"STRING"</span>,</span><br><span class="line">              <span class="attr">"visibility"</span> : <span class="string">"HIDDEN"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"socket.command.response"</span>,</span><br><span class="line">              <span class="attr">"display_name"</span> : <span class="string">"Expected Response"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="string">"imok"</span>,</span><br><span class="line">              <span class="attr">"description"</span> : <span class="string">"The expected response to the socket command."</span>,</span><br><span class="line">              <span class="attr">"type"</span> : <span class="string">"STRING"</span>,</span><br><span class="line">              <span class="attr">"visibility"</span> : <span class="string">"HIDDEN"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"reporting"</span> : &#123;</span><br><span class="line">            <span class="attr">"ok"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"warning"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">1.5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"critical"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"Connection failed: &#123;0&#125; to &#123;1&#125;:&#123;2&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">5.0</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"PORT"</span>,</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"&#123;&#123;zoo.cfg/clientPort&#125;&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cluster_name</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">service_name</td>
<td align="center">String</td>
<td align="center">服务名称</td>
</tr>
<tr>
<td align="center">component_name</td>
<td align="center">String</td>
<td align="center">服务中的组件名称</td>
</tr>
<tr>
<td align="center">id</td>
<td align="center">int</td>
<td align="center">告警定义 ID</td>
</tr>
<tr>
<td align="center">name</td>
<td align="center">String</td>
<td align="center">告警名称</td>
</tr>
<tr>
<td align="center">description</td>
<td align="center">String</td>
<td align="center">告警描述</td>
</tr>
<tr>
<td align="center">label</td>
<td align="center">String</td>
<td align="center">告警标签</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions?fields=AlertDefinition/component_name,AlertDefinition/description,AlertDefinition/enabled,AlertDefinition/repeat_tolerance,AlertDefinition/repeat_tolerance_enabled,AlertDefinition/id,AlertDefinition/ignore_host,AlertDefinition/interval,AlertDefinition/label,AlertDefinition/name,AlertDefinition/scope,AlertDefinition/service_name,AlertDefinition/source</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions?fields=AlertDefinition/component_name,AlertDefinition/description,AlertDefinition/enabled,AlertDefinition/repeat_tolerance,AlertDefinition/repeat_tolerance_enabled,AlertDefinition/id,AlertDefinition/ignore_host,AlertDefinition/interval,AlertDefinition/label,AlertDefinition/name,AlertDefinition/scope,AlertDefinition/service_name,AlertDefinition/source"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions/1"</span>,</span><br><span class="line">      <span class="attr">"AlertDefinition"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"description"</span> : <span class="string">"This alert is triggered if the number of down ZooKeeper servers in the cluster is greater than the configured critical threshold. It aggregates the results of ZooKeeper process checks."</span>,</span><br><span class="line">        <span class="attr">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"interval"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Percent ZooKeeper Servers Available"</span>,</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"zookeeper_server_process_percent"</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_enabled"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"ZOOKEEPER"</span>,</span><br><span class="line">        <span class="attr">"source"</span> : &#123;</span><br><span class="line">          <span class="attr">"alert_name"</span> : <span class="string">"zookeeper_server_process"</span>,</span><br><span class="line">          <span class="attr">"reporting"</span> : &#123;</span><br><span class="line">            <span class="attr">"ok"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"warning"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">35.0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"critical"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"affected: [&#123;1&#125;], total: [&#123;0&#125;]"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">70.0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"units"</span> : <span class="string">"%"</span>,</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"PERCENT"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"AGGREGATE"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions/2"</span>,</span><br><span class="line">      <span class="attr">"AlertDefinition"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"ZOOKEEPER_SERVER"</span>,</span><br><span class="line">        <span class="attr">"description"</span> : <span class="string">"This host-level alert is triggered if the ZooKeeper server process cannot be determined to be up and listening on the network."</span>,</span><br><span class="line">        <span class="attr">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"interval"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"ZooKeeper Server Process"</span>,</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"zookeeper_server_process"</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_enabled"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"ANY"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"ZOOKEEPER"</span>,</span><br><span class="line">        <span class="attr">"source"</span> : &#123;</span><br><span class="line">          <span class="attr">"default_port"</span> : <span class="number">2181.0</span>,</span><br><span class="line">          <span class="attr">"parameters"</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"socket.command"</span>,</span><br><span class="line">              <span class="attr">"display_name"</span> : <span class="string">"Socket Command"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="string">"ruok"</span>,</span><br><span class="line">              <span class="attr">"description"</span> : <span class="string">"A socket command which queries ZooKeeper to respond with its state. The expected response is imok."</span>,</span><br><span class="line">              <span class="attr">"type"</span> : <span class="string">"STRING"</span>,</span><br><span class="line">              <span class="attr">"visibility"</span> : <span class="string">"HIDDEN"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"socket.command.response"</span>,</span><br><span class="line">              <span class="attr">"display_name"</span> : <span class="string">"Expected Response"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="string">"imok"</span>,</span><br><span class="line">              <span class="attr">"description"</span> : <span class="string">"The expected response to the socket command."</span>,</span><br><span class="line">              <span class="attr">"type"</span> : <span class="string">"STRING"</span>,</span><br><span class="line">              <span class="attr">"visibility"</span> : <span class="string">"HIDDEN"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"reporting"</span> : &#123;</span><br><span class="line">            <span class="attr">"ok"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"warning"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">1.5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"critical"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"Connection failed: &#123;0&#125; to &#123;1&#125;:&#123;2&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">5.0</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"PORT"</span>,</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"&#123;&#123;zoo.cfg/clientPort&#125;&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">	&#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alert_definitions/159"</span>,</span><br><span class="line">      <span class="attr">"AlertDefinition"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"ELASTICSEARCH_MASTER"</span>,</span><br><span class="line">        <span class="attr">"description"</span> : <span class="string">"This host-level alert is triggered if the 9200 port is unreachable."</span>,</span><br><span class="line">        <span class="attr">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">159</span>,</span><br><span class="line">        <span class="attr">"ignore_host"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"interval"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Elasticsearch Port"</span>,</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"elasticsearch_port"</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_enabled"</span> : <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"ELASTICSEARCH"</span>,</span><br><span class="line">        <span class="attr">"source"</span> : &#123;</span><br><span class="line">          <span class="attr">"default_port"</span> : <span class="number">9200.0</span>,</span><br><span class="line">          <span class="attr">"reporting"</span> : &#123;</span><br><span class="line">            <span class="attr">"ok"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"warning"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"TCP OK - &#123;0:.3f&#125;s response on port &#123;1&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">15.0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"critical"</span> : &#123;</span><br><span class="line">              <span class="attr">"text"</span> : <span class="string">"Connection failed: &#123;0&#125; to &#123;1&#125;:&#123;2&#125;"</span>,</span><br><span class="line">              <span class="attr">"value"</span> : <span class="number">30.0</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"type"</span> : <span class="string">"PORT"</span>,</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"&#123;&#123;elasticsearch-config/http.port&#125;&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="告警统计"><a href="#告警统计" class="headerlink" title="告警统计"></a>告警统计</h1><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;alerts?format&#x3D;groupedSummary</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"alerts_summary_grouped"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"definition_id"</span> : <span class="number">54</span>,</span><br><span class="line">      <span class="attr">"definition_name"</span> : <span class="string">"sys db status"</span>,</span><br><span class="line">      <span class="attr">"summary"</span> : &#123;</span><br><span class="line">        <span class="attr">"OK"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">1615195966242</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"latest_text"</span> : <span class="string">"OK - Sys DB and Information Schema created"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"WARNING"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"CRITICAL"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"UNKNOWN"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"definition_id"</span> : <span class="number">104</span>,</span><br><span class="line">      <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver5_process_percent"</span>,</span><br><span class="line">      <span class="attr">"summary"</span> : &#123;</span><br><span class="line">        <span class="attr">"OK"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"WARNING"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"CRITICAL"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">1634727929001</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"latest_text"</span> : <span class="string">"affected: [1], total: [1]"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"UNKNOWN"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">definition_id</td>
<td align="center">int</td>
<td align="center">告警定义 ID，对应“告警定义”接口返回值中的 “id” 值</td>
</tr>
<tr>
<td align="center">definition_name</td>
<td align="center">String</td>
<td align="center">告警名称，对应“告警定义”接口返回值中的 “name” 值</td>
</tr>
<tr>
<td align="center">OK</td>
<td align="center">json</td>
<td align="center">告警级别：正常</td>
</tr>
<tr>
<td align="center">WARNING</td>
<td align="center">json</td>
<td align="center">告警级别：警告</td>
</tr>
<tr>
<td align="center">CRITICAL</td>
<td align="center">json</td>
<td align="center">告警级别：严重</td>
</tr>
<tr>
<td align="center">UNKNOWN</td>
<td align="center">json</td>
<td align="center">告警级别：未知</td>
</tr>
<tr>
<td align="center">count</td>
<td align="center">int</td>
<td align="center">对应该告警级别的告警数量</td>
</tr>
<tr>
<td align="center">original_timestamp</td>
<td align="center">long</td>
<td align="center">出现该告警时的时间戳</td>
</tr>
<tr>
<td align="center">maintenance_count</td>
<td align="center">int</td>
<td align="center">服务处于维护模式下的告警数量</td>
</tr>
<tr>
<td align="center">latest_text</td>
<td align="center">String</td>
<td align="center">告警描述信息</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?format=groupedSummary</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?format=groupedSummary"</span>,</span><br><span class="line">  <span class="attr">"alerts_summary_grouped"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"definition_id"</span> : <span class="number">54</span>,</span><br><span class="line">      <span class="attr">"definition_name"</span> : <span class="string">"sys db status"</span>,</span><br><span class="line">      <span class="attr">"summary"</span> : &#123;</span><br><span class="line">        <span class="attr">"OK"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">1615195966242</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"latest_text"</span> : <span class="string">"OK - Sys DB and Information Schema created"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"WARNING"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"CRITICAL"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"UNKNOWN"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"definition_id"</span> : <span class="number">104</span>,</span><br><span class="line">      <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver5_process_percent"</span>,</span><br><span class="line">      <span class="attr">"summary"</span> : &#123;</span><br><span class="line">        <span class="attr">"OK"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"WARNING"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"CRITICAL"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">1</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">1634727929001</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"latest_text"</span> : <span class="string">"affected: [1], total: [1]"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"UNKNOWN"</span> : &#123;</span><br><span class="line">          <span class="attr">"count"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"original_timestamp"</span> : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">"maintenance_count"</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="告警列表"><a href="#告警列表" class="headerlink" title="告警列表"></a>告警列表</h1><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;alerts?fields&#x3D;Alert&#x2F;component_name,Alert&#x2F;definition_id,Alert&#x2F;definition_name,Alert&#x2F;host_name,Alert&#x2F;id,Alert&#x2F;instance,Alert&#x2F;label,Alert&#x2F;latest_timestamp,Alert&#x2F;maintenance_state,Alert&#x2F;original_timestamp,Alert&#x2F;scope,Alert&#x2F;service_name,Alert&#x2F;state,Alert&#x2F;text,Alert&#x2F;repeat_tolerance,Alert&#x2F;repeat_tolerance_remaining&amp;Alert&#x2F;state.in(CRITICAL,WARNING)&amp;Alert&#x2F;maintenance_state.in(OFF)&amp;from&#x3D;&quot;fromIndex&quot;&amp;page_size&#x3D;&quot;PageSize&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">PageSize</td>
<td align="center">int</td>
<td align="center">每页个数</td>
</tr>
<tr>
<td align="center">fromIndex</td>
<td align="center">int</td>
<td align="center">开始的索引号</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"itemTotal"</span> : <span class="string">"0"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/14"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"AMBARI_SERVER"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">8</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"ambari_server_component_version"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">14</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"组件版本"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1635212854190</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634633823462</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"WARNING"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"如下组件的版本和所需版本不一致: \n  worker.bigdata\n    FLUME_HANDLER: UNKNOWN\n"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/163"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">103</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver_process_percent"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">163</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Percent RegionServers Available"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634633605440</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634633605440</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"affected: [1], total: [1]"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ……</span><br><span class="line">    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cluster_name</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">service_name</td>
<td align="center">String</td>
<td align="center">服务名称</td>
</tr>
<tr>
<td align="center">component_name</td>
<td align="center">String</td>
<td align="center">服务中的组件名称</td>
</tr>
<tr>
<td align="center">definition_id</td>
<td align="center">int</td>
<td align="center">告警定义 ID，对应“告警定义”接口返回值中的 “id” 值</td>
</tr>
<tr>
<td align="center">definition_name</td>
<td align="center">String</td>
<td align="center">告警名称，对应“告警定义”接口返回值中的 “name” 值</td>
</tr>
<tr>
<td align="center">id</td>
<td align="center">int</td>
<td align="center">该条告警的 ID 号（数据库告警表自增ID）</td>
</tr>
<tr>
<td align="center">state</td>
<td align="center">String</td>
<td align="center">告警级别：CRITICAL 或 WARNING</td>
</tr>
<tr>
<td align="center">text</td>
<td align="center">String</td>
<td align="center">告警描述</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=Alert/component_name,Alert/definition_id,Alert/definition_name,Alert/host_name,Alert/id,Alert/instance,Alert/label,Alert/latest_timestamp,Alert/maintenance_state,Alert/original_timestamp,Alert/scope,Alert/service_name,Alert/state,Alert/text,Alert/repeat_tolerance,Alert/repeat_tolerance_remaining&amp;Alert/state.in(CRITICAL,WARNING)&amp;Alert/maintenance_state.in(OFF)&amp;from=0&amp;page_size=100</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=Alert/component_name,Alert/definition_id,Alert/definition_name,Alert/host_name,Alert/id,Alert/instance,Alert/label,Alert/latest_timestamp,Alert/maintenance_state,Alert/original_timestamp,Alert/scope,Alert/service_name,Alert/state,Alert/text,Alert/repeat_tolerance,Alert/repeat_tolerance_remaining&amp;Alert/state.in(CRITICAL,WARNING)&amp;Alert/maintenance_state.in(OFF)&amp;from=0&amp;page_size=100"</span>,</span><br><span class="line">  <span class="attr">"itemTotal"</span> : <span class="string">"0"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/14"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"AMBARI_SERVER"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">8</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"ambari_server_component_version"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">14</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"组件版本"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1635212854190</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634633823462</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"WARNING"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"如下组件的版本和所需版本不一致: \n  worker.bigdata\n    FLUME_HANDLER: UNKNOWN\n"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/163"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">103</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver_process_percent"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">163</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Percent RegionServers Available"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634633605440</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634633605440</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"SERVICE"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"affected: [1], total: [1]"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ……</span><br><span class="line">    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="某个主机上的告警"><a href="#某个主机上的告警" class="headerlink" title="某个主机上的告警"></a>某个主机上的告警</h1><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;alerts?fields&#x3D;*&amp;Alert&#x2F;host_name&#x3D;&quot;hostName&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">hostName</td>
<td align="center">String</td>
<td align="center">主机名</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"AMBARI_AGENT"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"ambari_agent_ulimit"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Ulimit for open files"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1633916903489</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1608699076404</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"OK"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Ulimit for open files (-n) is 1024"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"HBASE_REGIONSERVER1"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">110</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver1_process"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">154</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"HBase RegionServer1 Process"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634727803926</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634727803926</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Connection failed: [Errno 111] Connection refused to worker.bigdata:16031"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cluster_name</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">service_name</td>
<td align="center">String</td>
<td align="center">服务名称</td>
</tr>
<tr>
<td align="center">component_name</td>
<td align="center">String</td>
<td align="center">服务中的组件名称</td>
</tr>
<tr>
<td align="center">definition_id</td>
<td align="center">int</td>
<td align="center">告警定义 ID，对应“告警定义”接口返回值中的 “id” 值</td>
</tr>
<tr>
<td align="center">definition_name</td>
<td align="center">String</td>
<td align="center">告警名称，对应“告警定义”接口返回值中的 “name” 值</td>
</tr>
<tr>
<td align="center">id</td>
<td align="center">int</td>
<td align="center">该条告警的 ID 号（数据库告警表自增ID）</td>
</tr>
<tr>
<td align="center">state</td>
<td align="center">String</td>
<td align="center">告警级别：CRITICAL 或 WARNING</td>
</tr>
<tr>
<td align="center">text</td>
<td align="center">String</td>
<td align="center">告警描述</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=*&amp;Alert/host_name=worker.bigdata</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=*&amp;Alert/host_name=worker.bigdata"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/2"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"AMBARI_AGENT"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"ambari_agent_ulimit"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"Ulimit for open files"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1633916903489</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1608699076404</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"AMBARI"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"OK"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Ulimit for open files (-n) is 1024"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/154"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"HBASE_REGIONSERVER1"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">110</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver1_process"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">154</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"HBase RegionServer1 Process"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634727803926</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634727803926</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Connection failed: [Errno 111] Connection refused to worker.bigdata:16031"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="某个告警详情"><a href="#某个告警详情" class="headerlink" title="某个告警详情"></a>某个告警详情</h1><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;alerts?fields&#x3D;*&amp;Alert&#x2F;definition_id&#x3D;&quot;definitionId&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">definitionId</td>
<td align="center">int</td>
<td align="center">告警定义 ID</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"HBASE_REGIONSERVER5"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">106</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver5_process"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">157</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"HBase RegionServer5 Process"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634727923955</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634727923955</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Connection failed: [Errno 111] Connection refused to worker.bigdata:16035"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cluster_name</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">service_name</td>
<td align="center">String</td>
<td align="center">服务名称</td>
</tr>
<tr>
<td align="center">component_name</td>
<td align="center">String</td>
<td align="center">服务中的组件名称</td>
</tr>
<tr>
<td align="center">definition_id</td>
<td align="center">int</td>
<td align="center">告警定义 ID，对应“告警定义”接口返回值中的 “id” 值</td>
</tr>
<tr>
<td align="center">definition_name</td>
<td align="center">String</td>
<td align="center">告警名称，对应“告警定义”接口返回值中的 “name” 值</td>
</tr>
<tr>
<td align="center">id</td>
<td align="center">int</td>
<td align="center">该条告警的 ID 号（数据库告警表自增ID）</td>
</tr>
<tr>
<td align="center">state</td>
<td align="center">String</td>
<td align="center">告警级别：CRITICAL 或 WARNING</td>
</tr>
<tr>
<td align="center">text</td>
<td align="center">String</td>
<td align="center">告警描述</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=*&amp;Alert/definition_id=106</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts?fields=*&amp;Alert/definition_id=106"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/alerts/157"</span>,</span><br><span class="line">      <span class="attr">"Alert"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"HBASE_REGIONSERVER5"</span>,</span><br><span class="line">        <span class="attr">"definition_id"</span> : <span class="number">106</span>,</span><br><span class="line">        <span class="attr">"definition_name"</span> : <span class="string">"hbase_regionserver5_process"</span>,</span><br><span class="line">        <span class="attr">"firmness"</span> : <span class="string">"HARD"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"id"</span> : <span class="number">157</span>,</span><br><span class="line">        <span class="attr">"instance"</span> : <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"label"</span> : <span class="string">"HBase RegionServer5 Process"</span>,</span><br><span class="line">        <span class="attr">"latest_timestamp"</span> : <span class="number">1634727923955</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"occurrences"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"original_timestamp"</span> : <span class="number">1634727923955</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"repeat_tolerance_remaining"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scope"</span> : <span class="string">"HOST"</span>,</span><br><span class="line">        <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"CRITICAL"</span>,</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Connection failed: [Errno 111] Connection refused to worker.bigdata:16035"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 监控相关接口</title>
    <url>/2021/11/14/Ambari-interface-about-metrics/</url>
    <content><![CDATA[<p>本文主要介绍一些常用的 Ambari 告警相关接口。</p>
<a id="more"></a>

<h1 id="Ambari"><a href="#Ambari" class="headerlink" title="Ambari"></a>Ambari</h1><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;users&#x2F;&quot;userName&quot;?fields&#x3D;privileges&#x2F;PrivilegeInfo&#x2F;permission_name</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">userName</td>
<td align="center">String</td>
<td align="center">用户名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;Users&quot; : &#123;</span><br><span class="line">    &quot;user_name&quot; : &quot;admin&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;privileges&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;PrivilegeInfo&quot; : &#123;</span><br><span class="line">        &quot;permission_name&quot; : &quot;AMBARI.ADMINISTRATOR&quot;,</span><br><span class="line">        &quot;privilege_id&quot; : 1,</span><br><span class="line">        &quot;user_name&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>示例：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/users/admin?fields=privileges/PrivilegeInfo/permission_name</span><br><span class="line"></span><br><span class="line">Authorization:</span><br><span class="line">	Type:No Auth</span><br><span class="line">Headers:</span><br><span class="line">	Host:&lt;calculated when request is sent&gt;</span><br><span class="line">	X-Requested-By:X-Requested-By</span><br><span class="line">	X-Requested-With:X-Requested-With</span><br><span class="line">	Authorization:Basic YWRtaW46bGMhQCM0NTY=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回 Body：</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/users/admin?fields=privileges/PrivilegeInfo/permission_name"</span>,</span><br><span class="line">  <span class="attr">"Users"</span> : &#123;</span><br><span class="line">    <span class="attr">"user_name"</span> : <span class="string">"admin"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"privileges"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/users/admin/privileges/1"</span>,</span><br><span class="line">      <span class="attr">"PrivilegeInfo"</span> : &#123;</span><br><span class="line">        <span class="attr">"permission_name"</span> : <span class="string">"AMBARI.ADMINISTRATOR"</span>,</span><br><span class="line">        <span class="attr">"privilege_id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"user_name"</span> : <span class="string">"admin"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">返回 Cookies：</span><br><span class="line">AMBARISESSIONID:node05ynnze2uywiqmdesaq9nffh1772.node0</span><br></pre></td></tr></table></figure>



<h2 id="集群信息"><a href="#集群信息" class="headerlink" title="集群信息"></a>集群信息</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters?fields&#x3D;Clusters&#x2F;provisioning_state,Clusters&#x2F;security_type,Clusters&#x2F;version,Clusters&#x2F;cluster_id</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"items" : [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85"</span>,</span><br><span class="line">    <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">      <span class="attr">"cluster_id"</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">      <span class="attr">"provisioning_state"</span> : <span class="string">"INSTALLED"</span>,</span><br><span class="line">      <span class="attr">"security_type"</span> : <span class="string">"NONE"</span>,</span><br><span class="line">      <span class="attr">"version"</span> : <span class="string">"HDP-3.0"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cluster_name</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">cluster_id</td>
<td align="center">int</td>
<td align="center">集群 ID</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters?fields=Clusters/provisioning_state,Clusters/security_type,Clusters/version,Clusters/cluster_id</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters?fields=Clusters/provisioning_state,Clusters/security_type,Clusters/version,Clusters/cluster_id"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85"</span>,</span><br><span class="line">      <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_id"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"provisioning_state"</span> : <span class="string">"INSTALLED"</span>,</span><br><span class="line">        <span class="attr">"security_type"</span> : <span class="string">"NONE"</span>,</span><br><span class="line">        <span class="attr">"version"</span> : <span class="string">"HDP-3.0"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询主机列表"><a href="#查询主机列表" class="headerlink" title="查询主机列表"></a>查询主机列表</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;hosts?fields&#x3D;Hosts&#x2F;rack_info,Hosts&#x2F;host_name,Hosts&#x2F;maintenance_state,Hosts&#x2F;public_host_name,Hosts&#x2F;cpu_count,Hosts&#x2F;ph_cpu_count,Hosts&#x2F;host_status,Hosts&#x2F;host_state,Hosts&#x2F;last_heartbeat_time,Hosts&#x2F;ip,Hosts&#x2F;total_mem&amp;minimal_response&#x3D;true,host_components&#x2F;logging&amp;page_size&#x3D;PageSize&amp;from&#x3D;fromIndex&amp;sortBy&#x3D;Hosts&#x2F;host_name.asc</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">PageSize</td>
<td align="center">int</td>
<td align="center">每页个数</td>
</tr>
<tr>
<td align="center">fromIndex</td>
<td align="center">int</td>
<td align="center">开始的索引号</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts?fields=Hosts/rack_info,Hosts/host_name,Hosts/maintenance_state,Hosts/public_host_name,Hosts/cpu_count,Hosts/ph_cpu_count,Hosts/host_status,Hosts/host_state,Hosts/last_heartbeat_time,Hosts/ip,Hosts/total_mem&amp;minimal_response=true,host_components/logging&amp;page_size=10&amp;from=0&amp;sortBy=Hosts/host_name.asc"</span>,</span><br><span class="line">  <span class="attr">"itemTotal"</span> : <span class="string">"3"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/manager.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"UNHEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.85"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129021560</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/master.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.86"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129018994</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/worker.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"ALERT"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.87"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129022342</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">host_name</td>
<td align="center">String</td>
<td align="center">主机名称</td>
</tr>
<tr>
<td align="center">ip</td>
<td align="center">String</td>
<td align="center">主机 IP</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts?fields=Hosts/rack_info,Hosts/host_name,Hosts/maintenance_state,Hosts/public_host_name,Hosts/cpu_count,Hosts/ph_cpu_count,Hosts/host_status,Hosts/host_state,Hosts/last_heartbeat_time,Hosts/ip,Hosts/total_mem&amp;minimal_response=true,host_components/logging&amp;page_size=10&amp;from=0&amp;sortBy=Hosts/host_name.asc</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts?fields=Hosts/rack_info,Hosts/host_name,Hosts/maintenance_state,Hosts/public_host_name,Hosts/cpu_count,Hosts/ph_cpu_count,Hosts/host_status,Hosts/host_state,Hosts/last_heartbeat_time,Hosts/ip,Hosts/total_mem&amp;minimal_response=true,host_components/logging&amp;page_size=10&amp;from=0&amp;sortBy=Hosts/host_name.asc"</span>,</span><br><span class="line">  <span class="attr">"itemTotal"</span> : <span class="string">"3"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/manager.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"UNHEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.85"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129021560</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/master.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.86"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129018994</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/worker.bigdata"</span>,</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"ALERT"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.87"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635129022342</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><h2 id="查看各主机监控指标"><a href="#查看各主机监控指标" class="headerlink" title="查看各主机监控指标"></a>查看各主机监控指标</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;hosts?fields&#x3D;Hosts&#x2F;rack_info,Hosts&#x2F;host_name,Hosts&#x2F;maintenance_state,Hosts&#x2F;public_host_name,Hosts&#x2F;cpu_count,Hosts&#x2F;ph_cpu_count,Hosts&#x2F;host_status,Hosts&#x2F;host_state,Hosts&#x2F;last_heartbeat_time,Hosts&#x2F;ip,metrics&#x2F;disk,metrics&#x2F;load&#x2F;load_one,Hosts&#x2F;total_mem,Hosts&#x2F;os_arch,Hosts&#x2F;os_type,metrics&#x2F;cpu&#x2F;cpu_system,metrics&#x2F;cpu&#x2F;cpu_user,metrics&#x2F;memory&#x2F;mem_total,metrics&#x2F;memory&#x2F;mem_free,metrics&#x2F;network&amp;minimal_response&#x3D;true&amp;sortBy&#x3D;Hosts&#x2F;host_name.asc</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"UNHEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.85"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635144518738</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"os_arch"</span> : <span class="string">"x86_64"</span>,</span><br><span class="line">        <span class="attr">"os_type"</span> : <span class="string">"centos7"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">          <span class="attr">"cpu_system"</span> : <span class="number">2.1</span>,</span><br><span class="line">          <span class="attr">"cpu_user"</span> : <span class="number">7.2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"disk"</span> : &#123;</span><br><span class="line">          <span class="attr">"disk_free"</span> : <span class="number">921.04</span>,</span><br><span class="line">          <span class="attr">"disk_total"</span> : <span class="number">1045.12</span>,</span><br><span class="line">          <span class="attr">"read_bytes"</span> : <span class="number">4.0172073472E10</span>,</span><br><span class="line">          <span class="attr">"read_count"</span> : <span class="number">1138709.0</span>,</span><br><span class="line">          <span class="attr">"read_time"</span> : <span class="number">6.4182694E7</span>,</span><br><span class="line">          <span class="attr">"write_bytes"</span> : <span class="number">3.98635586048E11</span>,</span><br><span class="line">          <span class="attr">"write_count"</span> : <span class="number">2.2530265E7</span>,</span><br><span class="line">          <span class="attr">"write_time"</span> : <span class="number">1.761842179E9</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"load"</span> : &#123;</span><br><span class="line">          <span class="attr">"load_one"</span> : <span class="number">0.44</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"memory"</span> : &#123;</span><br><span class="line">          <span class="attr">"mem_free"</span> : <span class="number">4674104.0</span>,</span><br><span class="line">          <span class="attr">"mem_total"</span> : <span class="number">1.6268368E7</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"network"</span> : &#123;</span><br><span class="line">          <span class="attr">"bytes_in"</span> : <span class="number">9653.420100811234</span>,</span><br><span class="line">          <span class="attr">"bytes_out"</span> : <span class="number">9870.084886235956</span>,</span><br><span class="line">          <span class="attr">"pkts_in"</span> : <span class="number">70.32365557353769</span>,</span><br><span class="line">          <span class="attr">"pkts_out"</span> : <span class="number">69.02506534277634</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts?fields=Hosts/rack_info,Hosts/host_name,Hosts/maintenance_state,Hosts/public_host_name,Hosts/cpu_count,Hosts/ph_cpu_count,Hosts/host_status,Hosts/host_state,Hosts/last_heartbeat_time,Hosts/ip,metrics/disk,metrics/load/load_one,Hosts/total_mem,Hosts/os_arch,Hosts/os_type,metrics/cpu/cpu_system,metrics/cpu/cpu_user,metrics/memory/mem_total,metrics/memory/mem_free,metrics/network&amp;minimal_response=true&amp;sortBy=Hosts/host_name.asc</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"UNHEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.85"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635144518738</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"os_arch"</span> : <span class="string">"x86_64"</span>,</span><br><span class="line">        <span class="attr">"os_type"</span> : <span class="string">"centos7"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"manager.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">          <span class="attr">"cpu_system"</span> : <span class="number">2.1</span>,</span><br><span class="line">          <span class="attr">"cpu_user"</span> : <span class="number">7.2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"disk"</span> : &#123;</span><br><span class="line">          <span class="attr">"disk_free"</span> : <span class="number">921.04</span>,</span><br><span class="line">          <span class="attr">"disk_total"</span> : <span class="number">1045.12</span>,</span><br><span class="line">          <span class="attr">"read_bytes"</span> : <span class="number">4.0172073472E10</span>,</span><br><span class="line">          <span class="attr">"read_count"</span> : <span class="number">1138709.0</span>,</span><br><span class="line">          <span class="attr">"read_time"</span> : <span class="number">6.4182694E7</span>,</span><br><span class="line">          <span class="attr">"write_bytes"</span> : <span class="number">3.98635586048E11</span>,</span><br><span class="line">          <span class="attr">"write_count"</span> : <span class="number">2.2530265E7</span>,</span><br><span class="line">          <span class="attr">"write_time"</span> : <span class="number">1.761842179E9</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"load"</span> : &#123;</span><br><span class="line">          <span class="attr">"load_one"</span> : <span class="number">0.44</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"memory"</span> : &#123;</span><br><span class="line">          <span class="attr">"mem_free"</span> : <span class="number">4674104.0</span>,</span><br><span class="line">          <span class="attr">"mem_total"</span> : <span class="number">1.6268368E7</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"network"</span> : &#123;</span><br><span class="line">          <span class="attr">"bytes_in"</span> : <span class="number">9653.420100811234</span>,</span><br><span class="line">          <span class="attr">"bytes_out"</span> : <span class="number">9870.084886235956</span>,</span><br><span class="line">          <span class="attr">"pkts_in"</span> : <span class="number">70.32365557353769</span>,</span><br><span class="line">          <span class="attr">"pkts_out"</span> : <span class="number">69.02506534277634</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.86"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635144516387</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"os_arch"</span> : <span class="string">"x86_64"</span>,</span><br><span class="line">        <span class="attr">"os_type"</span> : <span class="string">"centos7"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"master.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">          <span class="attr">"cpu_system"</span> : <span class="number">1.5</span>,</span><br><span class="line">          <span class="attr">"cpu_user"</span> : <span class="number">7.2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"disk"</span> : &#123;</span><br><span class="line">          <span class="attr">"disk_free"</span> : <span class="number">991.98</span>,</span><br><span class="line">          <span class="attr">"disk_total"</span> : <span class="number">1007.5</span>,</span><br><span class="line">          <span class="attr">"read_bytes"</span> : <span class="number">3.63035904E9</span>,</span><br><span class="line">          <span class="attr">"read_count"</span> : <span class="number">40613.0</span>,</span><br><span class="line">          <span class="attr">"read_time"</span> : <span class="number">1203951.0</span>,</span><br><span class="line">          <span class="attr">"write_bytes"</span> : <span class="number">1.97316283904E11</span>,</span><br><span class="line">          <span class="attr">"write_count"</span> : <span class="number">1.3062845E7</span>,</span><br><span class="line">          <span class="attr">"write_time"</span> : <span class="number">3.22374479E8</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"load"</span> : &#123;</span><br><span class="line">          <span class="attr">"load_one"</span> : <span class="number">0.48</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"memory"</span> : &#123;</span><br><span class="line">          <span class="attr">"mem_free"</span> : <span class="number">5652008.0</span>,</span><br><span class="line">          <span class="attr">"mem_total"</span> : <span class="number">1.6268368E7</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"network"</span> : &#123;</span><br><span class="line">          <span class="attr">"bytes_in"</span> : <span class="number">9290.264862825667</span>,</span><br><span class="line">          <span class="attr">"bytes_out"</span> : <span class="number">10604.78914369175</span>,</span><br><span class="line">          <span class="attr">"pkts_in"</span> : <span class="number">80.59535755195986</span>,</span><br><span class="line">          <span class="attr">"pkts_out"</span> : <span class="number">76.49559370626463</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"Hosts"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"host_state"</span> : <span class="string">"HEALTHY"</span>,</span><br><span class="line">        <span class="attr">"host_status"</span> : <span class="string">"ALERT"</span>,</span><br><span class="line">        <span class="attr">"ip"</span> : <span class="string">"10.180.249.87"</span>,</span><br><span class="line">        <span class="attr">"last_heartbeat_time"</span> : <span class="number">1635144521508</span>,</span><br><span class="line">        <span class="attr">"maintenance_state"</span> : <span class="string">"OFF"</span>,</span><br><span class="line">        <span class="attr">"os_arch"</span> : <span class="string">"x86_64"</span>,</span><br><span class="line">        <span class="attr">"os_type"</span> : <span class="string">"centos7"</span>,</span><br><span class="line">        <span class="attr">"ph_cpu_count"</span> : <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"public_host_name"</span> : <span class="string">"worker.bigdata"</span>,</span><br><span class="line">        <span class="attr">"rack_info"</span> : <span class="string">"/default-rack"</span>,</span><br><span class="line">        <span class="attr">"total_mem"</span> : <span class="number">16268368</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">          <span class="attr">"cpu_system"</span> : <span class="number">1.8</span>,</span><br><span class="line">          <span class="attr">"cpu_user"</span> : <span class="number">10.6</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"disk"</span> : &#123;</span><br><span class="line">          <span class="attr">"disk_free"</span> : <span class="number">985.64</span>,</span><br><span class="line">          <span class="attr">"disk_total"</span> : <span class="number">1007.5</span>,</span><br><span class="line">          <span class="attr">"read_bytes"</span> : <span class="number">1.21029039616E11</span>,</span><br><span class="line">          <span class="attr">"read_count"</span> : <span class="number">6813225.0</span>,</span><br><span class="line">          <span class="attr">"read_time"</span> : <span class="number">1.8589039E8</span>,</span><br><span class="line">          <span class="attr">"write_bytes"</span> : <span class="number">3.75238186496E11</span>,</span><br><span class="line">          <span class="attr">"write_count"</span> : <span class="number">1.6113285E7</span>,</span><br><span class="line">          <span class="attr">"write_time"</span> : <span class="number">1.469239993E9</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"load"</span> : &#123;</span><br><span class="line">          <span class="attr">"load_one"</span> : <span class="number">0.51</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"memory"</span> : &#123;</span><br><span class="line">          <span class="attr">"mem_free"</span> : <span class="number">3197052.0</span>,</span><br><span class="line">          <span class="attr">"mem_total"</span> : <span class="number">1.6268368E7</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"network"</span> : &#123;</span><br><span class="line">          <span class="attr">"bytes_in"</span> : <span class="number">2814.9769795226225</span>,</span><br><span class="line">          <span class="attr">"bytes_out"</span> : <span class="number">2784.778299269138</span>,</span><br><span class="line">          <span class="attr">"pkts_in"</span> : <span class="number">22.199029855210195</span>,</span><br><span class="line">          <span class="attr">"pkts_out"</span> : <span class="number">19.699139105749587</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="集群-CPU-使用情况"><a href="#集群-CPU-使用情况" class="headerlink" title="集群 CPU 使用情况"></a>集群 CPU 使用情况</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;?fields&#x3D;metrics&#x2F;cpu&#x2F;Nice._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;System._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;User._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;Idle._avg[stamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">      <span class="attr">"Idle._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">	  <span class="attr">"Nice._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_nice_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_nice_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_nice_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_nice_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">		……</span><br><span class="line">	  ]</span><br><span class="line">      <span class="string">"System._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_system_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_system_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_system_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"User._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">avg_cpu_idle_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_idle 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_nice_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_nice 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_system_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_system 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_user_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_user 百分比</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85?fields=metrics/cpu/Nice._avg[1635492886,1635496486,15],metrics/cpu/System._avg[1635492886,1635496486,15],metrics/cpu/User._avg[1635492886,1635496486,15],metrics/cpu/Idle._avg[1635492886,1635496486,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85?fields=metrics/cpu/Nice._avg[1635492886,1635496486,15],metrics/cpu/System._avg[1635492886,1635496486,15],metrics/cpu/User._avg[1635492886,1635496486,15],metrics/cpu/Idle._avg[1635492886,1635496486,15]"</span>,</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">      <span class="attr">"Idle._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">12.433333333333332</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">12.433333333333332</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">	  <span class="attr">"Nice._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492960</span></span><br><span class="line">        ],</span><br><span class="line">		……</span><br><span class="line">	  ]</span><br><span class="line">      <span class="string">"System._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.8777777777777778</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.8777777777777778</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"User._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">29.833333333333332</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">29.833333333333332</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="集群内存使用情况"><a href="#集群内存使用情况" class="headerlink" title="集群内存使用情况"></a>集群内存使用情况</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;?fields&#x3D;metrics&#x2F;memory&#x2F;Buffer._avg[stamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;Cache._avg[stamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;Share._avg[stamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;Swap._avg[stamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;Total._avg[stamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;Use._avg[stamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"memory"</span> : &#123;</span><br><span class="line">      <span class="attr">"Buffer._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_buffer_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_buffer_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_buffer_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Cache._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cache_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cache_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cache_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Share._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_share_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_share_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_share_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Swap._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_swap_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_swap_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_swap_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Total._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_total_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_total_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_total_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Use._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_use_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_use_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_use_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">avg_buffer_value</td>
<td align="center">double</td>
<td align="center">平均 buffer 值</td>
</tr>
<tr>
<td align="center">avg_cache_value</td>
<td align="center">double</td>
<td align="center">平均 cache 值</td>
</tr>
<tr>
<td align="center">avg_swap_value</td>
<td align="center">double</td>
<td align="center">平均 swap 值</td>
</tr>
<tr>
<td align="center">avg_total_value</td>
<td align="center">double</td>
<td align="center">平均 total 值</td>
</tr>
<tr>
<td align="center">avg_use_value</td>
<td align="center">double</td>
<td align="center">平均 use 值</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/memory/Buffer._avg[1635492886,1635496486,15],metrics/memory/Cache._avg[1635492886,1635496486,15],metrics/memory/Share._avg[1635492886,1635496486,15],metrics/memory/Swap._avg[1635492886,1635496486,15],metrics/memory/Total._avg[1635492886,1635496486,15],metrics/memory/Use._avg[1635492886,1635496486,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/memory/Buffer._avg[1635492886,1635496486,15],metrics/memory/Cache._avg[1635492886,1635496486,15],metrics/memory/Share._avg[1635492886,1635496486,15],metrics/memory/Swap._avg[1635492886,1635496486,15],metrics/memory/Total._avg[1635492886,1635496486,15],metrics/memory/Use._avg[1635492886,1635496486,15]"</span>,</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"memory"</span> : &#123;</span><br><span class="line">      <span class="attr">"Buffer._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">81.33333333333333</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">81.33333333333333</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Cache._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2255121.7777777775</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2255121.7777777775</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Share._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Swap._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.4637808444444446E7</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.4637808444444446E7</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Total._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.6268368E7</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.6268368E7</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Use._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.0</span>,</span><br><span class="line">          <span class="number">1635492886</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.3765412444444446E7</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.3765412444444446E7</span>,</span><br><span class="line">          <span class="number">1635492930</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="集群网络使用情况"><a href="#集群网络使用情况" class="headerlink" title="集群网络使用情况"></a>集群网络使用情况</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;?fields&#x3D;metrics&#x2F;network&#x2F;In._avg[stamp_start,timestamp_end,step],metrics&#x2F;network&#x2F;Out._avg[stamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"network"</span> : &#123;</span><br><span class="line">      <span class="attr">"In._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Out._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_out_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_out_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_out_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">avg_in_value</td>
<td align="center">double</td>
<td align="center">平均网络接收值</td>
</tr>
<tr>
<td align="center">avg_out_value</td>
<td align="center">double</td>
<td align="center">平均网络发送值</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/network/In._avg[1635492886,1635496486,15],metrics/network/Out._avg[1635492886,1635496486,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/network/In._avg[1635492886,1635496486,15],metrics/network/Out._avg[1635492886,1635496486,15]"</span>,</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"network"</span> : &#123;</span><br><span class="line">      <span class="attr">"In._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">42216.83960870526</span>,</span><br><span class="line">          <span class="number">1635493680</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">32214.112632067132</span>,</span><br><span class="line">          <span class="number">1635493710</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">33326.8445137805</span>,</span><br><span class="line">          <span class="number">1635493740</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Out._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">41526.13471217605</span>,</span><br><span class="line">          <span class="number">1635493800</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">37271.59526417987</span>,</span><br><span class="line">          <span class="number">1635493830</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">39065.415739918695</span>,</span><br><span class="line">          <span class="number">1635493860</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="集群负载使用情况"><a href="#集群负载使用情况" class="headerlink" title="集群负载使用情况"></a>集群负载使用情况</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;?fields&#x3D;metrics&#x2F;load&#x2F;1-min._avg[stamp_start,timestamp_end,step],metrics&#x2F;load&#x2F;CPUs._avg[stamp_start,timestamp_end,step],metrics&#x2F;load&#x2F;Nodes._avg[stamp_start,timestamp_end,step],metrics&#x2F;load&#x2F;Procs._avg[stamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/load/1-min._avg[1635492886,1635496486,15],metrics/load/CPUs._avg[1635492886,1635496486,15],metrics/load/Nodes._avg[1635492886,1635496486,15],metrics/load/Procs._avg[1635492886,1635496486,15]"</span>,</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"load"</span> : &#123;</span><br><span class="line">      <span class="attr">"1-min._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_1_min_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_1_min_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_1_min_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"CPUs._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Nodes._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_node_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_node_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_node_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Procs._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          avg_procs_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_procs_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_procs_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">avg_1_min_value</td>
<td align="center">double</td>
<td align="center">1 分钟平均负载值</td>
</tr>
<tr>
<td align="center">avg_cpu_value</td>
<td align="center">double</td>
<td align="center">平均 CPU 数量</td>
</tr>
<tr>
<td align="center">avg_node_value</td>
<td align="center">double</td>
<td align="center">平均节点数</td>
</tr>
<tr>
<td align="center">avg_procs_value</td>
<td align="center">double</td>
<td align="center">平均进程数量</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/load/1-min._avg[1635492886,1635496486,15],metrics/load/CPUs._avg[1635492886,1635496486,15],metrics/load/Nodes._avg[1635492886,1635496486,15],metrics/load/Procs._avg[1635492886,1635496486,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/?fields=metrics/load/1-min._avg[1635492886,1635496486,15],metrics/load/CPUs._avg[1635492886,1635496486,15],metrics/load/Nodes._avg[1635492886,1635496486,15],metrics/load/Procs._avg[1635492886,1635496486,15]"</span>,</span><br><span class="line">  <span class="attr">"Clusters"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"load"</span> : &#123;</span><br><span class="line">      <span class="attr">"1-min._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.223333333333333</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">5.586666666666667</span>,</span><br><span class="line">          <span class="number">1635493200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">11.863333333333335</span>,</span><br><span class="line">          <span class="number">1635493500</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"CPUs._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.0</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.0</span>,</span><br><span class="line">          <span class="number">1635493200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">2.0</span>,</span><br><span class="line">          <span class="number">1635493500</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Nodes._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3.0</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3.0</span>,</span><br><span class="line">          <span class="number">1635493200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3.0</span>,</span><br><span class="line">          <span class="number">1635493500</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"Procs._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.7333333333333334</span>,</span><br><span class="line">          <span class="number">1635492900</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.57</span>,</span><br><span class="line">          <span class="number">1635493200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">1.2</span>,</span><br><span class="line">          <span class="number">1635493500</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h1><h2 id="HDFS-磁盘使用率"><a href="#HDFS-磁盘使用率" class="headerlink" title="HDFS 磁盘使用率"></a>HDFS 磁盘使用率</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;services&#x2F;HDFS&#x2F;components&#x2F;NAMENODE?fields&#x3D;metrics&#x2F;dfs&#x2F;namenode&#x2F;Free,metrics&#x2F;dfs&#x2F;namenode&#x2F;Used</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"metrics" : &#123;</span><br><span class="line">   "dfs" : &#123;</span><br><span class="line">     "namenode" : &#123;</span><br><span class="line">       "Free" : 941056749412,</span><br><span class="line">       "Used" : 3869090052</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Free</td>
<td align="center">int</td>
<td align="center">DFS 空闲空间，单位：比特</td>
</tr>
<tr>
<td align="center">Used</td>
<td align="center">int</td>
<td align="center">DFS 已使用空间，单位：比特</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/services/HDFS/components/NAMENODE?fields=metrics/dfs/namenode/Free,metrics/dfs/namenode/Used</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/services/HDFS/components/NAMENODE?fields=metrics/dfs/namenode/Free,metrics/dfs/namenode/Used"</span>,</span><br><span class="line">  <span class="attr">"ServiceComponentInfo"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">    <span class="attr">"component_name"</span> : <span class="string">"NAMENODE"</span>,</span><br><span class="line">    <span class="attr">"service_name"</span> : <span class="string">"HDFS"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"dfs"</span> : &#123;</span><br><span class="line">      <span class="attr">"namenode"</span> : &#123;</span><br><span class="line">        <span class="attr">"Free"</span> : <span class="number">941056749412</span>,</span><br><span class="line">        <span class="attr">"Used"</span> : <span class="number">3869090052</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="HDFS-CPU、内存使用率"><a href="#HDFS-CPU、内存使用率" class="headerlink" title="HDFS CPU、内存使用率"></a>HDFS CPU、内存使用率</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;host_components?HostRoles&#x2F;component_name&#x3D;NAMENODE&amp;metrics&#x2F;dfs&#x2F;FSNamesystem&#x2F;HAState&#x3D;active&amp;fields&#x3D;metrics&#x2F;cpu&#x2F;cpu_system[timestamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_user[timestamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_nice[timestamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_idle[timestamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_wio[timestamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;mem_total[timestamp_start,timestamp_end,step],metrics&#x2F;memory&#x2F;mem_free[timestamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"metrics" : &#123;</span><br><span class="line">        "cpu" : &#123;</span><br><span class="line">          "cpu_idle" : [</span><br><span class="line">            [</span><br><span class="line">              cpu_idle_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_idle_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_idle_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            </span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          "cpu_nice" : [</span><br><span class="line">            [</span><br><span class="line">              cpu_nice_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_nice_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_nice_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ]</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          "cpu_user" : [</span><br><span class="line">            [</span><br><span class="line">              cpu_user_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_user_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_user_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          "cpu_wio" : [</span><br><span class="line">            [</span><br><span class="line">              cpu_wio_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_wio_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              cpu_wio_percent,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "memory" : &#123;</span><br><span class="line">          "mem_free" : [</span><br><span class="line">            [</span><br><span class="line">              mem_free_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              mem_free_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              mem_free_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          "mem_total" : [</span><br><span class="line">            [</span><br><span class="line">              mem_total_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              mem_total_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              mem_total_value,</span><br><span class="line">              timestamp</span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cpu_idle_percent</td>
<td align="center">double</td>
<td align="center">cpu_idle 百分比</td>
</tr>
<tr>
<td align="center">cpu_nice_percent</td>
<td align="center">double</td>
<td align="center">cpu_nice 百分比</td>
</tr>
<tr>
<td align="center">cpu_wio_percent</td>
<td align="center">double</td>
<td align="center">cpu_wio 百分比</td>
</tr>
<tr>
<td align="center">mem_free_value</td>
<td align="center">double</td>
<td align="center">mem_free 值，单位：bit</td>
</tr>
<tr>
<td align="center">mem_total_value</td>
<td align="center">double</td>
<td align="center">mem_total 值，单位：bit</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/host_components?HostRoles/component_name=NAMENODE&amp;metrics/dfs/FSNamesystem/HAState=active&amp;fields=metrics/cpu/cpu_system[1634713377,1634716977,15],metrics/cpu/cpu_user[1634713377,1634716977,15],metrics/cpu/cpu_nice[1634713377,1634716977,15],metrics/cpu/cpu_idle[1634713377,1634716977,15],metrics/cpu/cpu_wio[1634713377,1634716977,15],metrics/memory/mem_total[1634713377,1634716977,15],metrics/memory/mem_free[1634713377,1634716977,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/host_components?HostRoles/component_name=NAMENODE&amp;metrics/dfs/FSNamesystem/HAState=active&amp;fields=metrics/cpu/cpu_system[1634713377,1634716977,15],metrics/cpu/cpu_user[1634713377,1634716977,15],metrics/cpu/cpu_nice[1634713377,1634716977,15],metrics/cpu/cpu_idle[1634713377,1634716977,15],metrics/cpu/cpu_wio[1634713377,1634716977,15],metrics/memory/mem_total[1634713377,1634716977,15],metrics/memory/mem_free[1634713377,1634716977,15]"</span>,</span><br><span class="line">  <span class="attr">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/manager.bigdata/host_components/NAMENODE"</span>,</span><br><span class="line">      <span class="attr">"HostRoles"</span> : &#123;</span><br><span class="line">        <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">        <span class="attr">"component_name"</span> : <span class="string">"NAMENODE"</span>,</span><br><span class="line">        <span class="attr">"host_name"</span> : <span class="string">"manager.bigdata"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"host"</span> : &#123;</span><br><span class="line">        <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/hosts/manager.bigdata"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">        <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">          <span class="attr">"cpu_idle"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.0</span>,</span><br><span class="line">              <span class="number">1634713377</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">85.5</span>,</span><br><span class="line">              <span class="number">1634713386</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">68.2</span>,</span><br><span class="line">              <span class="number">1634713396</span></span><br><span class="line">            ],</span><br><span class="line">            </span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"cpu_nice"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">2.2</span>,</span><br><span class="line">              <span class="number">1634716948</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">1.2</span>,</span><br><span class="line">              <span class="number">1634716958</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">7.5</span>,</span><br><span class="line">              <span class="number">1634716968</span></span><br><span class="line">            ]</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"cpu_user"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.0</span>,</span><br><span class="line">              <span class="number">1634713377</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">11.5</span>,</span><br><span class="line">              <span class="number">1634713386</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">26.0</span>,</span><br><span class="line">              <span class="number">1634713396</span></span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"cpu_wio"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.0</span>,</span><br><span class="line">              <span class="number">1634713377</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.2</span>,</span><br><span class="line">              <span class="number">1634713386</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.1</span>,</span><br><span class="line">              <span class="number">1634713396</span></span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"dfs"</span> : &#123;</span><br><span class="line">          <span class="attr">"FSNamesystem"</span> : &#123;</span><br><span class="line">            <span class="attr">"HAState"</span> : <span class="string">"active"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"memory"</span> : &#123;</span><br><span class="line">          <span class="attr">"mem_free"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.0</span>,</span><br><span class="line">              <span class="number">1634713377</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">3456052.0</span>,</span><br><span class="line">              <span class="number">1634713386</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">3458428.0</span>,</span><br><span class="line">              <span class="number">1634713396</span></span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"mem_total"</span> : [</span><br><span class="line">            [</span><br><span class="line">              <span class="number">0.0</span>,</span><br><span class="line">              <span class="number">1634713377</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">1.6268368E7</span>,</span><br><span class="line">              <span class="number">1634713386</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">              <span class="number">1.6268368E7</span>,</span><br><span class="line">              <span class="number">1634713396</span></span><br><span class="line">            ],</span><br><span class="line">            ……</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h1><h2 id="HBase-CPU、网络使用率"><a href="#HBase-CPU、网络使用率" class="headerlink" title="HBase CPU、网络使用率"></a>HBase CPU、网络使用率</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;services&#x2F;HBASE&#x2F;components&#x2F;HBASE_REGIONSERVER?fields&#x3D;metrics&#x2F;hbase&#x2F;regionserver&#x2F;Server&#x2F;Get_num_ops._rate[stamp_start,timestamp_end,step],metrics&#x2F;hbase&#x2F;regionserver&#x2F;Server&#x2F;ScanSize_num_ops._rate[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_system._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_user._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_nice._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_idle._avg[stamp_start,timestamp_end,step],metrics&#x2F;cpu&#x2F;cpu_wio._avg[stamp_start,timestamp_end,step],metrics&#x2F;network&#x2F;pkts_in._avg[stamp_start,timestamp_end,step],metrics&#x2F;network&#x2F;pkts_out._avg[stamp_start,timestamp_end,step],metrics&#x2F;disk&#x2F;read_bps._sum[stamp_start,timestamp_end,step],metrics&#x2F;disk&#x2F;write_bps._sum[stamp_start,timestamp_end,step]</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
<tr>
<td align="center">timestamp_start</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">timestamp_end</td>
<td align="center">long</td>
<td align="center">起始时间戳，单位：秒</td>
</tr>
<tr>
<td align="center">step</td>
<td align="center">int</td>
<td align="center">间隔步长</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"metrics" : &#123;</span><br><span class="line">    "cpu" : &#123;</span><br><span class="line">      "cpu_idle._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_idle_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      "cpu_system._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_system_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_system_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      "cpu_user._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_user_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      "cpu_wio._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_wio_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_wio_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_cpu_wio_percent,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    "network" : &#123;</span><br><span class="line">      "pkts_in._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">       ……</span><br><span class="line">      ],</span><br><span class="line">      "pkts_out._avg" : [</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          avg_pkts_in_value,</span><br><span class="line">          timestamp</span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">avg_cpu_idle_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_idle 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_system_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_system 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_user_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_user 百分比</td>
</tr>
<tr>
<td align="center">avg_cpu_wio_percent</td>
<td align="center">double</td>
<td align="center">平均 cpu_wio 百分比</td>
</tr>
<tr>
<td align="center">avg_pkts_in_value</td>
<td align="center">double</td>
<td align="center">mem_free 值，单位：bit</td>
</tr>
<tr>
<td align="center">avg_pkts_in_value</td>
<td align="center">double</td>
<td align="center">mem_total 值，单位：bit</td>
</tr>
<tr>
<td align="center">timestamp</td>
<td align="center">long</td>
<td align="center">时间戳，单位：秒</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/services/HBASE/components/HBASE_REGIONSERVER?fields=metrics/hbase/regionserver/Server/Get_num_ops._rate[1634716159,1634719759,15],metrics/hbase/regionserver/Server/ScanSize_num_ops._rate[1634716159,1634719759,15],metrics/cpu/cpu_system._avg[1634716159,1634719759,15],metrics/cpu/cpu_user._avg[1634716159,1634719759,15],metrics/cpu/cpu_nice._avg[1634716159,1634719759,15],metrics/cpu/cpu_idle._avg[1634716159,1634719759,15],metrics/cpu/cpu_wio._avg[1634716159,1634719759,15],metrics/network/pkts_in._avg[1634716159,1634719759,15],metrics/network/pkts_out._avg[1634716159,1634719759,15],metrics/disk/read_bps._sum[1634716159,1634719759,15],metrics/disk/write_bps._sum[1634716159,1634719759,15]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"href"</span> : <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/services/HBASE/components/HBASE_REGIONSERVER?fields=metrics/hbase/regionserver/Server/Get_num_ops._rate[1634716159,1634719759,15],metrics/hbase/regionserver/Server/ScanSize_num_ops._rate[1634716159,1634719759,15],metrics/cpu/cpu_system._avg[1634716159,1634719759,15],metrics/cpu/cpu_user._avg[1634716159,1634719759,15],metrics/cpu/cpu_nice._avg[1634716159,1634719759,15],metrics/cpu/cpu_idle._avg[1634716159,1634719759,15],metrics/cpu/cpu_wio._avg[1634716159,1634719759,15],metrics/network/pkts_in._avg[1634716159,1634719759,15],metrics/network/pkts_out._avg[1634716159,1634719759,15],metrics/disk/read_bps._sum[1634716159,1634719759,15],metrics/disk/write_bps._sum[1634716159,1634719759,15]"</span>,</span><br><span class="line">  <span class="attr">"ServiceComponentInfo"</span> : &#123;</span><br><span class="line">    <span class="attr">"cluster_name"</span> : <span class="string">"cluster_85"</span>,</span><br><span class="line">    <span class="attr">"component_name"</span> : <span class="string">"HBASE_REGIONSERVER"</span>,</span><br><span class="line">    <span class="attr">"service_name"</span> : <span class="string">"HBASE"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"metrics"</span> : &#123;</span><br><span class="line">    <span class="attr">"cpu"</span> : &#123;</span><br><span class="line">      <span class="attr">"cpu_idle._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">80.61666666666667</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">76.35</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">80.55</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"cpu_system._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3.3666666666666667</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3.4833333333333334</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"cpu_user._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">15.816666666666666</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">19.916666666666668</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">15.8</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"cpu_wio._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.18333333333333335</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.13333333333333333</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">0.20833333333333334</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"disk"</span> : &#123;</span><br><span class="line">      <span class="attr">"read_bps._sum"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">817.8653225961747</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3275.9546133765416</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">3271.6184408805548</span>,</span><br><span class="line">          <span class="number">1634716260</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"write_bps._sum"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">648362.5362561946</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">283359.98861003027</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">897984.5417469091</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"network"</span> : &#123;</span><br><span class="line">      <span class="attr">"pkts_in._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">36.871528602614</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">41.99892128602031</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">49.99695693170576</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">       ……</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"pkts_out._avg"</span> : [</span><br><span class="line">        [</span><br><span class="line">          <span class="number">29.373641001955054</span>,</span><br><span class="line">          <span class="number">1634716170</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">33.62299985023638</span>,</span><br><span class="line">          <span class="number">1634716200</span></span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">          <span class="number">42.00411973306949</span>,</span><br><span class="line">          <span class="number">1634716230</span></span><br><span class="line">        ],</span><br><span class="line">        ……</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><h2 id="Kafka-输入输出流量"><a href="#Kafka-输入输出流量" class="headerlink" title="Kafka 输入输出流量"></a>Kafka 输入输出流量</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&quot;kafkaWebUIIp&quot;:&quot;port&quot;&#x2F;ke&#x2F;metrics&#x2F;brokers&#x2F;mbean&#x2F;ajax</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">kafkaWebUIIp</td>
<td align="center">String</td>
<td align="center">Kafka webUI IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为:10095</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"ins"</span>: &#123;</span><br><span class="line">        <span class="attr">"fifteenMinute"</span>: <span class="string">"fifteen_minute_value"</span>,</span><br><span class="line">        <span class="attr">"fiveMinute"</span>: <span class="string">"five_minute_value"</span>,</span><br><span class="line">        <span class="attr">"meanRate"</span>: <span class="string">"mean_rate_value"</span>,</span><br><span class="line">        <span class="attr">"oneMinute"</span>: <span class="string">"one_minute_value"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"out"</span>: &#123;</span><br><span class="line">        <span class="attr">"fifteenMinute"</span>: <span class="string">"fifteen_minute_value"</span>,</span><br><span class="line">        <span class="attr">"fiveMinute"</span>: <span class="string">"five_minute_value"</span>,</span><br><span class="line">        <span class="attr">"meanRate"</span>: <span class="string">"mean_rate_value"</span>,</span><br><span class="line">        <span class="attr">"oneMinute"</span>: <span class="string">"one_minute_value"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">fifteen_minute_value</td>
<td align="center">double</td>
<td align="center">15 分钟值，单位：B</td>
</tr>
<tr>
<td align="center">five_minute_value</td>
<td align="center">double</td>
<td align="center">5 分钟值，单位：B</td>
</tr>
<tr>
<td align="center">mean_rate_value</td>
<td align="center">double</td>
<td align="center">平均值，单位：B</td>
</tr>
<tr>
<td align="center">one_minute_value</td>
<td align="center">double</td>
<td align="center">1分钟值，单位：B</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">http://10.180.249.85:10095/ke/metrics/brokers/mbean/ajax</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"ins"</span>: &#123;</span><br><span class="line">        <span class="attr">"fifteenMinute"</span>: <span class="string">"135B"</span>,</span><br><span class="line">        <span class="attr">"fiveMinute"</span>: <span class="string">"107B"</span>,</span><br><span class="line">        <span class="attr">"meanRate"</span>: <span class="string">"98B"</span>,</span><br><span class="line">        <span class="attr">"oneMinute"</span>: <span class="string">"129B"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"out"</span>: &#123;</span><br><span class="line">        <span class="attr">"fifteenMinute"</span>: <span class="string">"147B"</span>,</span><br><span class="line">        <span class="attr">"fiveMinute"</span>: <span class="string">"128B"</span>,</span><br><span class="line">        <span class="attr">"meanRate"</span>: <span class="string">"97B"</span>,</span><br><span class="line">        <span class="attr">"oneMinute"</span>: <span class="string">"125B"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h1><h2 id="Spark-分配内存"><a href="#Spark-分配内存" class="headerlink" title="Spark 分配内存"></a>Spark 分配内存</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;&quot;managerHostIp&quot;:&quot;port&quot;&#x2F;api&#x2F;v1&#x2F;clusters&#x2F;&quot;clusterName&quot;&#x2F;configurations&#x2F;service_config_versions?service_name&#x3D;SPARK2&amp;is_current&#x3D;true</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">managerHostIp</td>
<td align="center">String</td>
<td align="center">管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为8080</td>
</tr>
<tr>
<td align="center">clusterName</td>
<td align="center">String</td>
<td align="center">集群名称</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                        <span class="attr">"hive_kerberos_keytab"</span>: <span class="string">"&#123;&#123;hive_kerberos_keytab&#125;&#125;"</span>,</span><br><span class="line">                        <span class="attr">"hive_kerberos_principal"</span>: <span class="string">"&#123;&#123;hive_kerberos_principal&#125;&#125;"</span>,</span><br><span class="line">                        <span class="attr">"spark_daemon_memory"</span>: <span class="string">"2048"</span>,</span><br><span class="line">                        <span class="attr">"spark_group"</span>: <span class="string">"spark"</span>,</span><br><span class="line">                        <span class="attr">"spark_log_dir"</span>: <span class="string">"/var/log/spark2"</span>,</span><br><span class="line">                        <span class="attr">"spark_pid_dir"</span>: <span class="string">"/var/run/spark2"</span>,</span><br><span class="line">                        <span class="attr">"spark_thrift_cmd_opts"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="attr">"spark_user"</span>: <span class="string">"spark"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">spark_daemon_memory</td>
<td align="center">string</td>
<td align="center">Spark 分配内存，单位：MB</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https://10.180.249.85:8080/api/v1/clusters/cluster_85/configurations/service_config_versions?service_name=SPARK2&amp;is_current=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"href"</span>: <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/configurations/service_config_versions?service_name=SPARK2&amp;is_current=true"</span>,</span><br><span class="line">    <span class="attr">"items"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"https://10.180.249.85:8080/api/v1/clusters/cluster_85/configurations/service_config_versions?service_name=SPARK2&amp;service_config_version=2"</span>,</span><br><span class="line">            <span class="attr">"cluster_name"</span>: <span class="string">"cluster_85"</span>,</span><br><span class="line">            <span class="attr">"configurations"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"Config"</span>: &#123;</span><br><span class="line">                        <span class="attr">"cluster_name"</span>: <span class="string">"cluster_85"</span>,</span><br><span class="line">                        <span class="attr">"stack_id"</span>: <span class="string">"HDP-3.0"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"type"</span>: <span class="string">"livy2-client-conf"</span>,</span><br><span class="line">                    <span class="attr">"tag"</span>: <span class="string">"1c82b935-1a1f-49bb-ac7d-923e8680a988"</span>,</span><br><span class="line">                    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                        <span class="attr">"livy.rsc.launcher.address"</span>: <span class="string">" "</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"properties_attributes"</span>: &#123;&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">				……</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                        <span class="attr">"hive_kerberos_keytab"</span>: <span class="string">"&#123;&#123;hive_kerberos_keytab&#125;&#125;"</span>,</span><br><span class="line">                        <span class="attr">"hive_kerberos_principal"</span>: <span class="string">"&#123;&#123;hive_kerberos_principal&#125;&#125;"</span>,</span><br><span class="line">                        <span class="attr">"spark_daemon_memory"</span>: <span class="string">"2048"</span>,</span><br><span class="line">                        <span class="attr">"spark_group"</span>: <span class="string">"spark"</span>,</span><br><span class="line">                        <span class="attr">"spark_log_dir"</span>: <span class="string">"/var/log/spark2"</span>,</span><br><span class="line">                        <span class="attr">"spark_pid_dir"</span>: <span class="string">"/var/run/spark2"</span>,</span><br><span class="line">                        <span class="attr">"spark_thrift_cmd_opts"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="attr">"spark_user"</span>: <span class="string">"spark"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"createtime"</span>: <span class="number">1615374599431</span>,</span><br><span class="line">            <span class="attr">"group_id"</span>: <span class="number">-1</span>,</span><br><span class="line">            <span class="attr">"group_name"</span>: <span class="string">"Default"</span>,</span><br><span class="line">            <span class="attr">"is_cluster_compatible"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"is_current"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"service_config_version"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"service_name"</span>: <span class="string">"SPARK2"</span>,</span><br><span class="line">            <span class="attr">"stack_id"</span>: <span class="string">"HDP-3.0"</span>,</span><br><span class="line">            <span class="attr">"user"</span>: <span class="string">"admin"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><h2 id="ES-CPU、内存使用率"><a href="#ES-CPU、内存使用率" class="headerlink" title="ES CPU、内存使用率"></a>ES CPU、内存使用率</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&quot;elasticSearchMasterIp&quot;:&quot;port&quot;&#x2F;_cat&#x2F;nodes?v&amp;pretty</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">elasticSearchMasterIp</td>
<td align="center">String</td>
<td align="center">ElasticSearch 管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为:9200</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">10.180.249.86           14          96  20    0.50    0.42     0.41 im        *      master.bigdata-master</span><br><span class="line">10.180.249.87            7          98  50    4.09    1.83     1.22 di        -      worker.bigdata-slave</span><br><span class="line">10.180.249.85            9          99  17    0.93    1.20     1.06 im        -      manager.bigdata-master</span><br><span class="line">10.180.249.87            8          98  50    4.09    1.83     1.22 im        -      worker.bigdata-master</span><br><span class="line">10.180.249.85            7          99  17    0.93    1.20     1.06 di        -      manager.bigdata-slave</span><br><span class="line">10.180.249.86            9          96  20    0.50    0.42     0.41 di        -      master.bigdata-slave</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">cpu</td>
<td align="center">int</td>
<td align="center">CPU 使用百分比</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# curl -XGET -K -u 'admin':'pwd' 'http://10.180.249.85:9200/_cat/nodes?v&amp;pretty'</span><br><span class="line">ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">10.180.249.86           14          96  20    0.50    0.42     0.41 im        *      master.bigdata-master</span><br><span class="line">10.180.249.87            7          98  50    4.09    1.83     1.22 di        -      worker.bigdata-slave</span><br><span class="line">10.180.249.85            9          99  17    0.93    1.20     1.06 im        -      manager.bigdata-master</span><br><span class="line">10.180.249.87            8          98  50    4.09    1.83     1.22 im        -      worker.bigdata-master</span><br><span class="line">10.180.249.85            7          99  17    0.93    1.20     1.06 di        -      manager.bigdata-slave</span><br><span class="line">10.180.249.86            9          96  20    0.50    0.42     0.41 di        -      master.bigdata-slave</span><br></pre></td></tr></table></figure>



<h2 id="ES-磁盘使用率"><a href="#ES-磁盘使用率" class="headerlink" title="ES 磁盘使用率"></a>ES 磁盘使用率</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&quot;elasticSearchMasterIp&quot;:&quot;port&quot;&#x2F;_cat&#x2F;allocation?v&amp;pretty</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">elasticSearchMasterIp</td>
<td align="center">String</td>
<td align="center">ElasticSearch 管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为:9200</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shards disk.indices disk.used disk.avail disk.total disk.percent host          ip            node</span><br><span class="line">     0           0b    21.6gb    985.3gb     1007gb            2 10.180.249.87 10.180.249.87 worker.bigdata-slave</span><br><span class="line">     0           0b    84.9gb      922gb     1007gb            8 10.180.249.85 10.180.249.85 manager.bigdata-slave</span><br><span class="line">     0           0b    15.2gb    991.7gb     1007gb            1 10.180.249.86 10.180.249.86 master.bigdata-slave</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">disk.avail</td>
<td align="center">string</td>
<td align="center">磁盘可使用空间</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# curl -XGET -K -u 'admin':'pwd' 'http://10.180.249.85:9200/_cat/allocation?v&amp;pretty'</span><br><span class="line">shards disk.indices disk.used disk.avail disk.total disk.percent host          ip            node</span><br><span class="line">     0           0b    21.6gb    985.3gb     1007gb            2 10.180.249.87 10.180.249.87 worker.bigdata-slave</span><br><span class="line">     0           0b    84.9gb      922gb     1007gb            8 10.180.249.85 10.180.249.85 manager.bigdata-slave</span><br><span class="line">     0           0b    15.2gb    991.7gb     1007gb            1 10.180.249.86 10.180.249.86 master.bigdata-slave</span><br></pre></td></tr></table></figure>



<h2 id="ES-文档总条数"><a href="#ES-文档总条数" class="headerlink" title="ES 文档总条数"></a>ES 文档总条数</h2><p><strong>Request URL:</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&quot;elasticSearchMasterIp&quot;:&quot;port&quot;&#x2F;_cat&#x2F;count?v&amp;pretty</span><br></pre></td></tr></table></figure>

<p><strong>Request Method:</strong> GET</p>
<p><strong>参数解析：</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">elasticSearchMasterIp</td>
<td align="center">String</td>
<td align="center">ElasticSearch 管理节点主机 IP</td>
</tr>
<tr>
<td align="center">port</td>
<td align="center">String</td>
<td align="center">端口号，默认为:9200</td>
</tr>
</tbody></table>
<p><strong>返回格式：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">epoch      timestamp count</span><br><span class="line">1634781017 01:50:17  11</span><br></pre></td></tr></table></figure>

<p><strong>返回字段说明：</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">count</td>
<td align="center">int</td>
<td align="center">文档条数</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# curl -XGET -K -u 'admin':'pwd' 'http://10.180.249.85:9200/_cat/count?v&amp;pretty'</span><br><span class="line">epoch      timestamp count</span><br><span class="line">1634781017 01:50:17  10</span><br></pre></td></tr></table></figure>



<h2 id="ES-查看文档容量"><a href="#ES-查看文档容量" class="headerlink" title="ES 查看文档容量"></a>ES 查看文档容量</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XGET -K -u 'admin':'pwd' 'http://10.180.249.85:9200/_stats?&amp;pretty'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_all"</span>: &#123;</span><br><span class="line">        <span class="attr">"primaries"</span>: &#123;</span><br><span class="line">            <span class="attr">"docs"</span>: &#123;</span><br><span class="line">                <span class="attr">"count"</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">"deleted"</span>: <span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"store"</span>: &#123;</span><br><span class="line">                <span class="attr">"size_in_bytes"</span>: <span class="number">72930</span></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">		……</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">	……</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


















]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 角色权限列表</title>
    <url>/2021/06/16/Ambari-role-permissions/</url>
    <content><![CDATA[<p>本文主要从服务级别、主机级别、集群级别和 Ambari 级别，介绍 Ambari 的角色权限列表，</p>
<a id="more"></a>

<h2 id="服务级别权限"><a href="#服务级别权限" class="headerlink" title="服务级别权限"></a>服务级别权限</h2><table>
<thead>
<tr>
<th align="left"></th>
<th align="center">Cluster User</th>
<th align="center">Service     Operator</th>
<th align="center">Service     Administrator</th>
<th align="center">Clutser     Operator</th>
<th align="center">Cluster     Administrator</th>
<th align="center">Ambari     Administrator</th>
</tr>
</thead>
<tbody><tr>
<td align="left">比较配置版本</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看服务级别的告警</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看配置</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看度量图表</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看状态信息</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">移除、添加服务实例</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">执行具体服务的任务</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">运行服务检查</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">启动、停止、重启服务</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">开启、关闭维护模式</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理服务自启动</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理配置组</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">修改配置</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看服务运行日志</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">启用HA</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">移动到其他主机</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">添加、删除服务</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理服务级别的告警</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">设置服务的用户和用户组</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">启动、禁用服务级别告警</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<h2 id="主机级别权限"><a href="#主机级别权限" class="headerlink" title="主机级别权限"></a>主机级别权限</h2><table>
<thead>
<tr>
<th align="left"></th>
<th align="center">Cluster User</th>
<th align="center">Service     Operator</th>
<th align="center">Service     Administrator</th>
<th align="center">Clutser     Operator</th>
<th align="center">Cluster     Administrator</th>
<th align="center">Ambari     Administrator</th>
</tr>
</thead>
<tbody><tr>
<td align="left">查看配置</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看度量图表</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">查看状态信息</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">安装组件</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">添加、删除主机</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">开启、关闭维护模式</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<h2 id="集群级别权限"><a href="#集群级别权限" class="headerlink" title="集群级别权限"></a>集群级别权限</h2><table>
<thead>
<tr>
<th></th>
<th align="center">Cluster User</th>
<th align="center">Service     Operator</th>
<th align="center">Service     Administrator</th>
<th align="center">Clutser     Operator</th>
<th align="center">Cluster     Administrator</th>
<th align="center">Ambari     Administrator</th>
</tr>
</thead>
<tbody><tr>
<td>管理集群级别用户的持久化数据</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>查看集群级别的告警</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>查看配置</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>查看度量图表</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>查看服务版本栈详情</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>查看状态信息</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>管理集群的配置组</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>管理服务自启动配置</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>管理KDC证书</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>管理集群级别的告警</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>管理告警通知配置</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>修改集群配置</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>操作特定的集群级别的命令</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>启用、禁用集群级别告警</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>启用、停用Kerberos</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>升级、降级服务版本栈</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<h2 id="Ambari-级别权限"><a href="#Ambari-级别权限" class="headerlink" title="Ambari 级别权限"></a>Ambari 级别权限</h2><table>
<thead>
<tr>
<th align="left"></th>
<th>Cluster User</th>
<th>Service     Operator</th>
<th>Service     Administrator</th>
<th>Clutser     Operator</th>
<th>Cluster     Administrator</th>
<th align="center">Ambari     Administrator</th>
</tr>
</thead>
<tbody><tr>
<td align="left">创建新集群</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">分配角色</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">编辑服务版本栈和仓库URL</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理用户组</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理管理员级别的设置</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理服务栈的版本</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理用户组</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">管理Ambari的页面</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">重命名集群</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
<tr>
<td align="left">操作特定的管理员级别操作</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="center">√</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 管理 Docker 方法</title>
    <url>/2021/04/16/Ambari-manage-docker/</url>
    <content><![CDATA[<p>本文主要介绍在不改变 Ambari 现有整体框架逻辑的情况下，管理 Docker 镜像的方法，可以像普通服务一样进行安装、启停、状态监控等功能。</p>
<a id="more"></a>

<h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><ul>
<li>Centos 7.4</li>
<li>Ambari 2.7.1</li>
<li>HDP 3.0.1.0</li>
</ul>
<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><h2 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h2><ul>
<li>卸载旧版本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum remove docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>

<ul>
<li><p>设置 yum 源<br>以下二选一，均可用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo（中央仓库）</span><br><span class="line"></span><br><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo（阿里仓库）</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看可用版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<br>使用 <code>yum install docker-ce-版本号</code> 进行安装，这里安装 <code>18.03.1.ce</code> 版本。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install docker-ce-18.03.1.ce</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 Docker 并设置开机自启</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<h2 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h2><ul>
<li>修改配置文件<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br></pre></td></tr></table></figure>
配置如下内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     &quot;registry-mirrors&quot;: [&quot;http:&#x2F;&#x2F;10.180.XXX.XXX:9090&quot;],</span><br><span class="line">     &quot;insecure-registries&quot;: [&quot;10.180.XXX.XXX:9090&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启docker</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<ul>
<li>测试登录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker login 10.180.XXX.XXX:9090</span><br></pre></td></tr></table></figure>
<p>保证输入账号密码后能正常登录。</p>
<h1 id="制作镜像"><a href="#制作镜像" class="headerlink" title="制作镜像"></a>制作镜像</h1><p>这里以 ZooKeeper server 为例制作 Docker 镜像。</p>
<h2 id="解压-rpm-包"><a href="#解压-rpm-包" class="headerlink" title="解压 rpm 包"></a>解压 rpm 包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm2cpio zookeeper_3_0_1_0_187-3.4.6.3.0.1.0-187.noarch.rpm |cpio -idv</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210412180418.png" alt=""></p>
<h2 id="编写-Dockerfile"><a href="#编写-Dockerfile" class="headerlink" title="编写 Dockerfile"></a>编写 Dockerfile</h2><p>Dockerfile 内容如下，这里使用 openjdk 8 作为基础镜像，这里的镜像源为：<code>insight/openjdk:8-jre</code>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM insight&#x2F;openjdk:8-jre</span><br><span class="line"></span><br><span class="line">COPY usr &#x2F;usr</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;&#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;zookeeper&#x2F;bin&#x2F;zkServer.sh&quot;,&quot;start-foreground&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="拉取-openjdk-镜像"><a href="#拉取-openjdk-镜像" class="headerlink" title="拉取 openjdk 镜像"></a>拉取 openjdk 镜像</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull insight&#x2F;openjdk:8-jre</span><br></pre></td></tr></table></figure>

<p>查看镜像</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210412180734.png" alt=""></p>
<h2 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker build -t insight&#x2F;zookeeper:3.4.6 .</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210412180830.png" alt=""></p>
<h2 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210412180902.png" alt=""></p>
<h1 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h1><p>通过 docker tag 重命名镜像，使之与 registry 匹配</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker tag insight&#x2F;zookeeper:3.4.6 10.180.210.148:9090&#x2F;insight&#x2F;zookeeper:3.4.6</span><br></pre></td></tr></table></figure>

<p>登录（只需一次）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker login 10.180.xxx.xxx:9090</span><br></pre></td></tr></table></figure>

<p>push镜像</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker push 10.180.xxx.xxx:9090&#x2F;insight&#x2F;zookeeper:3.4.6</span><br></pre></td></tr></table></figure>

<h1 id="修改-Stacks-文件"><a href="#修改-Stacks-文件" class="headerlink" title="修改 Stacks 文件"></a>修改 Stacks 文件</h1><p>Ambari 管理 Docker 的关键在于 Stacks 文件，通过修改服务响应安装、启动、停止等脚本达到管理效果。</p>
<p>这里修改<code>ambari-server\src\main\resources\stacks\HDP\3.0\services\ZOOKEEPER\package\scripts\params_linux.py</code> 和  <code>ambari-server\src\main\resources\stacks\HDP\3.0\services\ZOOKEEPER\package\scripts\zookeeper_server.py</code> 中两个文件。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p><code>params_linux.py</code> 中添加 docker 相关配置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># docker parameters</span><br><span class="line">zk_server_docker_name &#x3D; &quot;zkName&quot;</span><br><span class="line">zk_server_host_port &#x3D; &quot;2181&quot;</span><br><span class="line">zk_server_container_port &#x3D; &quot;2181&quot;</span><br><span class="line">zk_server_host_conf_dir &#x3D; &quot;&#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;zookeeper&#x2F;conf&quot;</span><br><span class="line">zk_server_docker_conf_dir &#x3D; &quot;&#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;zookeeper&#x2F;conf&quot;</span><br><span class="line">zk_server_image_name &#x3D; &quot;insight&#x2F;zookeeper&quot;</span><br><span class="line">zk_server_image_version &#x3D; &quot;3.4.6&quot;</span><br><span class="line">root_user &#x3D; &quot;root&quot;</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>在 <code>zookeeper_server.py</code> 中修改 <code>install</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def install(self, env):</span><br><span class="line">  # self.install_packages(env)</span><br><span class="line">  self.configure(env)</span><br><span class="line"></span><br><span class="line">  Logger.info(&quot;Starting pull ZooKeeper image ...&quot;)</span><br><span class="line"></span><br><span class="line">  import params</span><br><span class="line"></span><br><span class="line">  image_name &#x3D; params.zk_server_image_name</span><br><span class="line">  image_version &#x3D; params.zk_server_image_version</span><br><span class="line">  install_cmd &#x3D; format(&quot;docker pull &#123;image_name&#125;:&#123;image_version&#125;&quot;)</span><br><span class="line">  Execute(install_cmd, user&#x3D;params.root_user)</span><br><span class="line">  Logger.info(&quot;Pull ZooKeeper image success !&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>在 <code>zookeeper_server.py</code> 中修改 <code>start</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def start(self, env, upgrade_type&#x3D;None):</span><br><span class="line">  import params</span><br><span class="line">  env.set_params(params)</span><br><span class="line">  self.configure(env, upgrade_type&#x3D;upgrade_type)</span><br><span class="line">  # zookeeper_service(action&#x3D;&#39;start&#39;, upgrade_type&#x3D;upgrade_type)</span><br><span class="line"></span><br><span class="line">  Logger.info(&quot;Starting ZooKeeper ...&quot;)</span><br><span class="line">  zkName &#x3D; params.zk_server_docker_name</span><br><span class="line">  hport &#x3D; params.zk_server_host_port</span><br><span class="line">  cport &#x3D; params.zk_server_container_port</span><br><span class="line">  image_name &#x3D; params.zk_server_image_name</span><br><span class="line">  image_version &#x3D; params.zk_server_image_version</span><br><span class="line">  hconf &#x3D; params.zk_server_host_conf_dir</span><br><span class="line">  cconf &#x3D; params.zk_server_docker_conf_dir</span><br><span class="line">  hdata &#x3D; params.zk_data_dir</span><br><span class="line">  cpu &#x3D; params.zk_server_cpu_value</span><br><span class="line">  memory &#x3D; params.zk_server_heapsize_value</span><br><span class="line"></span><br><span class="line">  try:</span><br><span class="line">    stop_cmd &#x3D; format(&quot;docker stop &#123;zkName&#125; &amp;&amp; docker rm &#123;zkName&#125;&quot;)</span><br><span class="line">    Execute(stop_cmd, user&#x3D;params.root_user)</span><br><span class="line">  except:</span><br><span class="line">    Logger.info(&quot;ZooKeeper is not running .&quot;)</span><br><span class="line"></span><br><span class="line">  start_cmd &#x3D; format(&quot;docker run -d --name &#123;zkName&#125; &quot;</span><br><span class="line">                     &quot;--network host &quot;</span><br><span class="line">                     &quot;-v &#123;hconf&#125;:&#123;cconf&#125; &quot;</span><br><span class="line">                     &quot;-v &#123;hdata&#125;:&#123;hdata&#125; &quot;</span><br><span class="line">                     &quot;--cpus &#123;cpu&#125; -m &#123;memory&#125; &quot;</span><br><span class="line">                     &quot;&#123;image_name&#125;:&#123;image_version&#125;&quot;)</span><br><span class="line"></span><br><span class="line">  if params.kerberos_security_enabled:</span><br><span class="line">    start_cmd &#x3D; format(&quot;docker run -d --name &#123;zkName&#125; &quot;</span><br><span class="line">                       &quot;--network host &quot;</span><br><span class="line">                       &quot;-p &#123;hport&#125;:&#123;cport&#125; &quot;</span><br><span class="line">                       &quot;-v &#123;hconf&#125;:&#123;cconf&#125; &quot;</span><br><span class="line">                       &quot;-v &#123;hdata&#125;:&#123;hdata&#125; &quot;</span><br><span class="line">                       &quot;-v &#123;keytabs_dir&#125;:&#123;keytabs_dir&#125; &quot;</span><br><span class="line">                       &quot;-v &#123;krb5_conf_dir&#125;:&#123;krb5_conf_dir&#125; &quot;</span><br><span class="line">                       &quot;--cpus &#123;cpu&#125; -m &#123;memory&#125; &quot;</span><br><span class="line">                       &quot;&#123;image_name&#125;:&#123;image_version&#125;&quot;)</span><br><span class="line"></span><br><span class="line">  Execute(start_cmd, user&#x3D;params.root_user)</span><br><span class="line">  Logger.info(&quot;Started ZooKeeper success !&quot;)</span><br><span class="line"></span><br><span class="line">  Logger.info(&quot;Starting write pid ...&quot;)</span><br><span class="line">  pid_file &#x3D; params.zk_pid_file</span><br><span class="line">  get_pid &#x3D; &quot;docker top &quot; + zkName + &quot; | awk &#39;&#123;print $2&#125;&#39; | sed -n &#39;2p&#39; &gt; &quot; + pid_file</span><br><span class="line">  Execute(get_pid, user&#x3D;params.root_user)</span><br><span class="line">  Logger.info(&quot;Write pid success !&quot;)</span><br></pre></td></tr></table></figure>

<p>这里主要涉及获取参数，拼接启动命令(包括 kerberos 环境)，写入 pid 文件等步骤。</p>
<h2 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h2><p>在 <code>zookeeper_server.py</code> 中修改 <code>stop</code> 方法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def stop(self, env, upgrade_type&#x3D;None):</span><br><span class="line">  import params</span><br><span class="line">  env.set_params(params)</span><br><span class="line">  # zookeeper_service(action&#x3D;&#39;stop&#39;, upgrade_type&#x3D;upgrade_type)</span><br><span class="line"></span><br><span class="line">  Logger.info(&quot;Start stop ZooKeeper ...&quot;)</span><br><span class="line">  zkName &#x3D; params.zk_server_docker_name</span><br><span class="line"></span><br><span class="line">  status &#x3D; 1</span><br><span class="line">  try:</span><br><span class="line">    status_cmd &#x3D; format(&quot;docker ps -a | grep &#123;zkName&#125;&quot;)</span><br><span class="line">    Execute(status_cmd, user&#x3D;params.root_user)</span><br><span class="line">  except:</span><br><span class="line">    status &#x3D; 0</span><br><span class="line"></span><br><span class="line">  if status:</span><br><span class="line">    stop_cmd &#x3D; format(&quot;docker stop &#123;zkName&#125; &amp;&amp; docker rm &#123;zkName&#125;&quot;)</span><br><span class="line">    Execute(stop_cmd, user&#x3D;params.root_user)</span><br><span class="line">  Logger.info(&quot;Stopped ZooKeeper ...&quot;)</span><br><span class="line"></span><br><span class="line">  # delete pid file</span><br><span class="line">  Logger.info(&quot;Start delete pid file ...&quot;)</span><br><span class="line">  File(params.zk_pid_file, action&#x3D;&quot;delete&quot;)</span><br><span class="line">  Logger.info(&quot;Delete pid file success ...&quot;)</span><br></pre></td></tr></table></figure>

<p>主要包括检测 docker 镜像是否存在，如果存在就停掉并删除，并且删除 pid 文件。</p>
<h2 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h2><p>这里的状态检测可完全使用之前的方法，不必修改。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def status(self, env):</span><br><span class="line">  import status_params</span><br><span class="line">  env.set_params(status_params)</span><br><span class="line">  check_process_status(status_params.zk_pid_file)</span><br></pre></td></tr></table></figure>

<h1 id="安装测试"><a href="#安装测试" class="headerlink" title="安装测试"></a>安装测试</h1><h2 id="替换脚本"><a href="#替换脚本" class="headerlink" title="替换脚本"></a>替换脚本</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;lib&#x2F;ambari-server&#x2F;resources&#x2F;stacks&#x2F;HDP&#x2F;3.0&#x2F;services&#x2F;ZOOKEEPER</span><br><span class="line">cd package&#x2F;scripts&#x2F;</span><br><span class="line"></span><br><span class="line">rm -rf params_linux.py*</span><br><span class="line">rm -rf zookeeper_server.py*</span><br><span class="line"></span><br><span class="line"># 上传修改后的脚本</span><br><span class="line"></span><br><span class="line">chmod 755 params_linux.py</span><br><span class="line">chmod 755 zookeeper_server.py</span><br></pre></td></tr></table></figure>

<h2 id="重启-ambari"><a href="#重启-ambari" class="headerlink" title="重启 ambari"></a>重启 ambari</h2><p>全部节点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## 清除缓存</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;ambari-agent&#x2F;cache&#x2F;*</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;ambari-agent&#x2F;tmp&#x2F;*</span><br></pre></td></tr></table></figure>

<p>重启 Ambari server</p>
<p>Server 节点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server restart</span><br></pre></td></tr></table></figure>

<p>重启 Ambari agent</p>
<p>全部节点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-agent restart</span><br></pre></td></tr></table></figure>

<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>安装步骤与普通版本一样，然后可以进行相应的测试使用。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>centos7安装Docker详细步骤（无坑版教程） - 云+社区 - 腾讯云<br><a href="https://cloud.tencent.com/developer/article/1701451" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1701451</a></li>
</ul>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 滚动升级方法</title>
    <url>/2021/04/16/Ambari-rolling-upgrade/</url>
    <content><![CDATA[<p>本文主要演示通过 Ambari 滚动升级的方法，将 <code>HDP 3.0.1.0</code> 版本升级到自定义的 <code>HDP 3.0.2.0</code> 版本，将 ZooKeeper 3.4.6 版本升级到 3.4.14 版本。</p>
<a id="more"></a>

<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><ul>
<li>Centos 7.4</li>
<li>Ambari 2.7.1</li>
<li>HDP 3.0.1.0</li>
<li>已正常安装 Ambari 及集群，并且只安装 ZooKeeper 一个服务。</li>
</ul>
<h2 id="准备升级的yum源"><a href="#准备升级的yum源" class="headerlink" title="准备升级的yum源"></a>准备升级的yum源</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/www/html/Insight_upgrade/insight</span><br><span class="line">cd /var/www/html/Insight_upgrade/insight</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416103734.png" alt=""></p>
<ul>
<li>注意 rpm 包的命名方式，<code>zookeeper_3_0_2_0_187</code> 与 <code>3.4.14.3.0.2.0-187</code> 以 “-” 相连，且 rpm 打包时的 “name” 为 <code>zookeeper_3_0_2_0_187</code>,”version” 为 <code>3.4.14.3.0.2.0-187</code>。升级包可以在原有的 rpm 包基础上通过更新文件的方式重新打包而成，详细资料可以参考 ：<br><a href="http://www.erik-ly.com/2020/11/25/rpm2rpm/" target="_blank" rel="noopener">rpm2rpm 打包步骤</a></li>
</ul>
<p>可以在页面查看 <code>http://10.180.xxx.xxx/Insight_upgrade/insight/</code> 进行查看<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416103943.png" alt=""></p>
<h2 id="准备版本xml文件"><a href="#准备版本xml文件" class="headerlink" title="准备版本xml文件"></a>准备版本xml文件</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /var/lib/ambari-server/resources/stacks/HDP/3.0/repos</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416104041.png" alt=""></p>
<p>在 <code>hdp_urlinfo.json</code> 中添加 <code>3.0.2.0</code> 版本，添加好的文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;HDP-3.0&quot;:&#123;</span><br><span class="line">        &quot;latest&quot;:&#123;</span><br><span class="line">            &quot;centos7&quot;:&quot;http:&#x2F;&#x2F;public-repo-1.inspur.com&#x2F;HDP&#x2F;centos7&#x2F;3.x&#x2F;updates&#x2F;3.0.1.0&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;latest-vdf&quot;:&#123;</span><br><span class="line">            &quot;centos7&quot;:&quot;.&#x2F;hdxml&#x2F;HDP-3.0.1.0-187.xml&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;maintenance&quot;:&#123;</span><br><span class="line">		    &quot;3.0.2.0&quot;:&#123;</span><br><span class="line">                &quot;centos7&quot;:&quot;.&#x2F;hdxml&#x2F;HDP-3.0.2.0-187-MAINT.xml&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;3.0.1.0&quot;:&#123;</span><br><span class="line">                &quot;centos7&quot;:&quot;.&#x2F;hdxml&#x2F;HDP-3.0.1.0-187-MAINT.xml&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;manifests&quot;:&#123;</span><br><span class="line">		    &quot;3.0.2.0&quot;:&#123;</span><br><span class="line">                &quot;centos7&quot;:&quot;.&#x2F;hdxml&#x2F;HDP-3.0.2.0-187.xml&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;3.0.1.0&quot;:&#123;</span><br><span class="line">                &quot;centos7&quot;:&quot;.&#x2F;hdxml&#x2F;HDP-3.0.1.0-187.xml&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别复制 <code>HDP-3.0.1.0-187.xml</code> 和 <code>HDP-3.0.1.0-187-MAINT.xml</code> 为  <code>HDP-3.0.2.0-187.xml</code> 和  <code>HDP-3.0.2.0-187-MAINT.xml</code> 。</p>
<p>在 <code>HDP-3.0.2.0-187.xml</code> 中主要添加 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;manifest&gt;</span><br><span class="line">  &lt;service id&#x3D;&quot;ZOOKEEPER-346&quot; name&#x3D;&quot;ZOOKEEPER&quot; version&#x3D;&quot;3.4.14&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>
<p>完整的文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;repository-version xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation&#x3D;&quot;version_definition.xsd&quot;&gt;</span><br><span class="line">  &lt;release&gt;</span><br><span class="line">    &lt;type&gt;STANDARD&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;stack-id&gt;HDP-3.0&lt;&#x2F;stack-id&gt;</span><br><span class="line">    &lt;version&gt;3.0.2.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;build&gt;187&lt;&#x2F;build&gt;</span><br><span class="line">    &lt;compatible-with&gt;3\.\d+\.\d+\.\d+&lt;&#x2F;compatible-with&gt;</span><br><span class="line">    &lt;release-notes&gt;http:&#x2F;&#x2F;example.com&lt;&#x2F;release-notes&gt;</span><br><span class="line">    &lt;display&gt;HDP-3.0.2.0&lt;&#x2F;display&gt;</span><br><span class="line">  &lt;&#x2F;release&gt;</span><br><span class="line">  &lt;manifest&gt;</span><br><span class="line">    &lt;service id&#x3D;&quot;ZOOKEEPER-346&quot; name&#x3D;&quot;ZOOKEEPER&quot; version&#x3D;&quot;3.4.14&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;manifest&gt;</span><br><span class="line">  &lt;available-services&#x2F;&gt;</span><br><span class="line">  &lt;repository-info&gt;</span><br><span class="line">    &lt;os family&#x3D;&quot;redhat7&quot;&gt;</span><br><span class="line">      &lt;package-version&gt;3_0_1_0_*&lt;&#x2F;package-version&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP&#x2F;centos7&#x2F;3.x&#x2F;updates&#x2F;3.0.1.0&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-3.0&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;true&lt;&#x2F;unique&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP-GPL&#x2F;centos7&#x2F;3.x&#x2F;updates&#x2F;3.0.1.0&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-3.0-GPL&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP-GPL&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;true&lt;&#x2F;unique&gt;</span><br><span class="line">        &lt;tags&gt;</span><br><span class="line">          &lt;tag&gt;GPL&lt;&#x2F;tag&gt;</span><br><span class="line">        &lt;&#x2F;tags&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP-UTILS-1.1.0.22&#x2F;repos&#x2F;centos7&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-UTILS-1.1.0.22&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP-UTILS&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;false&lt;&#x2F;unique&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">    &lt;&#x2F;os&gt;</span><br><span class="line">  &lt;&#x2F;repository-info&gt;</span><br><span class="line">&lt;&#x2F;repository-version&gt;</span><br></pre></td></tr></table></figure>

<p>在 <code>HDP-3.0.2.0-187-MAINT.xml</code> 中主要添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;manifest&gt;</span><br><span class="line">  &lt;service id&#x3D;&quot;ZOOKEEPER-346&quot; name&#x3D;&quot;ZOOKEEPER&quot; release-version&#x3D;&quot;3.0.2.0&quot; version&#x3D;&quot;3.4.14&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>

<p>完整的文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;repository-version xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation&#x3D;&quot;version_definition.xsd&quot;&gt;</span><br><span class="line">  &lt;release&gt;</span><br><span class="line">    &lt;type&gt;MAINT&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;stack-id&gt;HDP-3.0&lt;&#x2F;stack-id&gt;</span><br><span class="line">    &lt;version&gt;3.0.2.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;build&gt;187&lt;&#x2F;build&gt;</span><br><span class="line">    &lt;compatible-with&gt;3\.0\.[0-0]\.\d+&lt;&#x2F;compatible-with&gt;</span><br><span class="line">    &lt;release-notes&gt;http:&#x2F;&#x2F;example.com&lt;&#x2F;release-notes&gt;</span><br><span class="line">    &lt;display&gt;HDP-3.0.2.0&lt;&#x2F;display&gt;</span><br><span class="line">  &lt;&#x2F;release&gt;</span><br><span class="line">  &lt;manifest&gt;</span><br><span class="line">    &lt;service id&#x3D;&quot;ZOOKEEPER-346&quot; name&#x3D;&quot;ZOOKEEPER&quot; release-version&#x3D;&quot;3.0.2.0&quot; version&#x3D;&quot;3.4.14&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;manifest&gt;</span><br><span class="line">  &lt;available-services&#x2F;&gt;</span><br><span class="line">  &lt;repository-info&gt;</span><br><span class="line">    &lt;os family&#x3D;&quot;redhat7&quot;&gt;</span><br><span class="line">      &lt;package-version&gt;3_0_1_0_*&lt;&#x2F;package-version&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP&#x2F;centos7&#x2F;3.x&#x2F;updates&#x2F;3.0.1.0&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-3.0&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;true&lt;&#x2F;unique&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP-GPL&#x2F;centos7&#x2F;3.x&#x2F;updates&#x2F;3.0.1.0&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-3.0-GPL&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP-GPL&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;true&lt;&#x2F;unique&gt;</span><br><span class="line">        &lt;tags&gt;</span><br><span class="line">          &lt;tag&gt;GPL&lt;&#x2F;tag&gt;</span><br><span class="line">        &lt;&#x2F;tags&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">      &lt;repo&gt;</span><br><span class="line">        &lt;baseurl&gt;http:&#x2F;&#x2F;public-repo-1.hortonworks.com&#x2F;HDP-UTILS-1.1.0.22&#x2F;repos&#x2F;centos7&lt;&#x2F;baseurl&gt;</span><br><span class="line">        &lt;repoid&gt;HDP-UTILS-1.1.0.22&lt;&#x2F;repoid&gt;</span><br><span class="line">        &lt;reponame&gt;HDP-UTILS&lt;&#x2F;reponame&gt;</span><br><span class="line">        &lt;unique&gt;false&lt;&#x2F;unique&gt;</span><br><span class="line">      &lt;&#x2F;repo&gt;</span><br><span class="line">    &lt;&#x2F;os&gt;</span><br><span class="line">  &lt;&#x2F;repository-info&gt;</span><br><span class="line">&lt;&#x2F;repository-version&gt;</span><br></pre></td></tr></table></figure>

<h2 id="重启ambari-server"><a href="#重启ambari-server" class="headerlink" title="重启ambari server"></a>重启ambari server</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server restart</span><br></pre></td></tr></table></figure>


<h1 id="注册版本"><a href="#注册版本" class="headerlink" title="注册版本"></a>注册版本</h1><h2 id="注册版本-1"><a href="#注册版本-1" class="headerlink" title="注册版本"></a>注册版本</h2><p>使用 <code>admin</code> 用户登录，依次点击右上角 <code>admin</code> 旁的倒立小三角 —— 管理 Ambari —— 版本，点击右上角的”注册版本”，<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416112006.png" alt=""></p>
<p>然后可以看到 <code>HDP-3.0.2.0</code> 版本，且 ZooKeeper 版本已经为 3.4.14。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416112057.png" alt=""></p>
<p>将软件源设置为本地软件源<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416112436.png" alt=""></p>
<ul>
<li><code>HDP-3.0</code>的源即为刚设置的升级源，<code>HDP-UTILS-1.1.0.22</code> 设置成与原来正常安装 Ambari 中的一样。 </li>
<li>要勾选“跳过资源库基本URL验证”选项。</li>
</ul>
<p>保存后就会出现下面一行版本信息。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416112732.png" alt=""></p>
<h2 id="添加-gpl-repo-源"><a href="#添加-gpl-repo-源" class="headerlink" title="添加 gpl repo 源"></a>添加 gpl repo 源</h2><p>升级过程中需要有 gpl 源，在文件夹 <code>/etc/yum.repos.d/</code> 中添加 <code>hdp_gpl.repo</code>, <code>hdp_gpl.repo</code> 内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[HDP-3.0-GPL-repo-51]</span><br><span class="line">name&#x3D;HDP-3.0-GPL-repo-51</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;10.180.xxx.xxx&#x2F;InsightHD&#x2F;hdp_gpl&#x2F;</span><br><span class="line"></span><br><span class="line">path&#x3D;&#x2F;</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;0</span><br></pre></td></tr></table></figure>

<p>这里的 <code>baseurl=http://10.180.xxx.xxx/InsightHD/hdp_gpl/</code> 是之前正常安装 Ambari 时的 <code>hdp_gpl</code> 源地址，需要将 “name” 换成 <code>name=HDP-3.0-GPL-repo-51</code>,这里的名称是根据当前版本的 ID 来的，第二个源的 ID 是 51，可根据实际情况修改，如果这里设置不对，之前安装服务过程中会报错，根据提示做相应修改即可。</p>
<p>将 <code>hdp_gpl.repo</code> 文件拷贝至<strong>所有节点</strong>的 <code>/etc/yum.repos.d/</code> 目录中，然后<strong>所有节点</strong>执行如下命令更新 yum 源：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h1 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h1><h2 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h2><p>如下图所示，将 <code>HDP-3.0.2.0</code> 版本安装在当前集群，<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416113902.png" alt=""></p>
<p>然后点击 “安装软件包”，<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114027.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114122.png" alt=""><br>弹出确认提示，确定即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114200.png" alt=""><br>等待安装完成即可。</p>
<p>这时可以通过后台查看安装内容<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114315.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114432.png" alt=""></p>
<p>可以看到 <code>3.0.2.0-187</code> 版本已经安装了，但是 <code>current</code> 版本还是之前的版本。</p>
<h2 id="关闭服务自动启动"><a href="#关闭服务自动启动" class="headerlink" title="关闭服务自动启动"></a>关闭服务自动启动</h2><p>升级前需要关闭服务自动启动，否则升级校验不过</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114641.png" alt=""></p>
<h2 id="升级-1"><a href="#升级-1" class="headerlink" title="升级"></a>升级</h2><p>现在开始升级过程</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114801.png" alt=""></p>
<p>点击 “升级” 按钮，这是会进行升级前的检查工作。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416114925.png" alt=""></p>
<p>显示 “Rolling” 和 “Express” 检查都通过，这里选择 “Rolling” 滚动升级。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416115120.png" alt=""></p>
<p>此时已经升级完成，需要测试下是否正常。</p>
<p>可以点击查看下 ZooKeeper 的操作过程，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416133817.png" alt=""></p>
<p>这里可以看到，ZooKeeper 是分批滚动重启的。</p>
<p>进入后台查看下 ZooKeeper 的版本<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416134139.png" alt=""><br>这里可以看到，”current” 中的 zookeeper 版本已经指向 <code>3.0.2.0-187</code>版本了。</p>
<p>进入 <code>bin</code> 文件夹，执行 <code>./zkCli.sh</code>，<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416134421.png" alt=""><br>可以看到，当前版本已经是 <code>3.4.14</code> 版本了，可以查看下之前的数据还在。</p>
<p>点击”我执行了上面的手动操作步骤”，如下图所示<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416115145.png" alt=""></p>
<p>然后进度条会到 100%<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416115200.png" alt=""><br>点击 “取消” 按钮，完成，这里应该是“完成”，应该是开源 bug。</p>
<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><p>回来在查看版本<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416134847.png" alt=""><br>当前使用的 ZooKeeper 已经是 3.4.14 了。</p>
<p>可以查看下“更新历史”<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416135044.png" alt=""><br>这里的“类型”有翻译错误，实际上是 “Rolling”。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416135116.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210416135246.png" alt=""><br>查看 ZooKeeper 状态，一切正常，升级完毕。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 服务配置校验和配置推荐介绍</title>
    <url>/2021/04/16/Ambari-service-configurations-validation-and-recommend/</url>
    <content><![CDATA[<p>本文主要介绍 Ambari 服务配置参数的校验和配置推荐方法，主要根据 value-attributes 和 service_advisor 实现，分析其原理逻辑，并举例说明自定义方法。</p>
<a id="more"></a>

<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><code>Ambari</code> 的配置校验有两种：一种是在 <code>xml</code> 配置文件中，通过值的属性（value-attributes）做约束，在前端做校验；另一种是通过每个服务的 <code>service_advisor.py</code> 中的 <code>getServiceConfigurationsValidationItems</code> 方法做自定义校验。</p>
<p><code>Ambari</code> 的推荐配置是通过每个服务的  <code>service_advisor.py</code> 中的 <code>getServiceConfigurationRecommendations</code> 方法实现，有些推荐配置会直接将原有的值修改为推荐配置，有些推荐配置则会弹出警告或错误提示框。</p>
<h1 id="value-attributes"><a href="#value-attributes" class="headerlink" title="value-attributes"></a>value-attributes</h1><p>stacks 中，每个服务的 <code>conffiguration</code> 文件夹内都会有 xml 格式的配置文件，在这些配置文件中，规定了 <code>name</code> （名称，Ambari 中做标识）、<code>display-name</code>（显示名，界面显示的配置 key 值）、<code>value</code>（默认值）、<code>description</code>（描述，鼠标悬停时显示的提示内容）等基本属性。</p>
<p>另外，还有值的属性 <code>value-attributes</code> 可以对输入值做约束校验，下表列举了常用的值属性及说明。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
<th align="center">样例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">type</td>
<td align="center">值的类型。</td>
<td align="center">boolean / int / float / directory /  directories / content/value-list / user / password</td>
</tr>
<tr>
<td align="center">overridable</td>
<td align="center">可覆盖的，即可以修改的值</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">empty-value-valid</td>
<td align="center">空值是否有效。</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">ui_only_property</td>
<td align="center">只是UI属性。（未见使用该属性）</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">read-only</td>
<td align="center">只读</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">editable_only_at_install</td>
<td align="center">只在安装时可以编辑，安装后就不能修改。</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">show-property-name</td>
<td align="center">显示属性名，如果为false，则不显示属性名，只有value</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">increment_step</td>
<td align="center">增量步长，用于滑动设置。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">selection_cardinality</td>
<td align="center">选择基数，用于是否启用某项配置，常用于1，不开启。</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">property-file-name</td>
<td align="center">属性值是某个文件中的内容。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">property-file-type</td>
<td align="center">文件类型属性，值property-file-name值的文件格式</td>
<td align="center">json / xml / text</td>
</tr>
<tr>
<td align="center">entries</td>
<td align="center">多条数据，包含多个entry，一般为多选，比如Hive Database 参数</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">hidden</td>
<td align="center">隐藏，不在界面展示</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">entries_editable</td>
<td align="center">实体是否可以编辑，如果false，则选择后展示，不可修改，如Hive Database 参数</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">user-groups</td>
<td align="center">用户组，type为user时使用</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">keystore</td>
<td align="center">是否启用秘钥库，tpye为password时使用，常为true</td>
<td align="center">true / false</td>
</tr>
<tr>
<td align="center">maximum</td>
<td align="center">允许的最大值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">minimum</td>
<td align="center">允许的最小值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">unit</td>
<td align="center">值的单位</td>
<td align="center">B / MB / ms / Bytes / milliseconds</td>
</tr>
<tr>
<td align="center">visible</td>
<td align="center">页面是否可见，常为false</td>
<td align="center">true / false</td>
</tr>
</tbody></table>
<p>参考资料：Configuration support in Ambari - Apache Ambari - Apache Software Foundation</p>
<p><a href="https://cwiki.apache.org/confluence/display/AMBARI/Configuration+support+in+Ambari" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/AMBARI/Configuration+support+in+Ambari</a></p>
<h1 id="service-advisor"><a href="#service-advisor" class="headerlink" title="service_advisor"></a>service_advisor</h1><p>每个服务的 <code>service_advisor</code> 主要有配置校验、配置推荐、组件个数校验等方法，一般在 <code>ambari-server\src\main\resources\stacks\HDP\3.0\services\Service_name\service_advisor.py</code>, <code>service_advisor.py</code> 中有相应服务的 <code>XxxServiceAdvisor</code>，它继承于 <code>ambari-server\src\main\resources\stacks\service_advisor.py</code> 中的 <code>ServiceAdvisor</code> 类，而 <code>ServiceAdvisor</code> 又继承于 <code>ambari-server\src\main\resources\stacks\stack_advisor.py</code> 中的 <code>DefaultStackAdvisor</code> 类。</p>
<h2 id="整体逻辑"><a href="#整体逻辑" class="headerlink" title="整体逻辑"></a>整体逻辑</h2><p>接下来将介绍从页面请求到后台处理，再到执行脚本等整体逻辑。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413160511.png" alt=""></p>
<p>页面请求时，会调用 <code>/api/v1/stacks/HDP/versions/3.0/validations</code> 或 <code>/api/v1/stacks/HDP/versions/3.0/recommendations</code> POST 接口，通过 Body 的 recommend 值区分不同命令类型 。请求会发送到相应的 service 类，如 <code>ValidationService</code> 、<code>RecommendationService</code>， 然后调用相应的 <code>ResourceProvider</code>， 如 <code>ValidationResourceProvider</code> 、 <code>RecommendationResourceProvider</code>。在 <code>ResourceProvider</code> 中会通过 <code>StackAdvisorHelper</code> 调用不同的命令，如 <code>ConfigurationValidationCommand</code> 、<code>ConfigurationRecommendationCommand</code>， 而这些命令的类都继承 <code>StackAdvisorCommand</code>。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413162404.png" alt=""></p>
<p><code>StackAdvisorCommand</code> 中的 <code>invoke</code> 方法会获取 host 信息和 service 信息，并将其写入到 <code>hosts.json</code> 和 <code>services.json</code> 两个文件中，如可在 <code>/var/run/ambari-server/stack-recommendations/{requestId}</code>目录中查看这两个文件, 然后调用 <code>org.apache.ambari.server.api.services.stackadvisor.StackAdvisorRunner#runScript</code> 方法执行脚本，最后读取脚本的执行结果，并构建 <code>response</code> 返回值。<code>runScript</code>方法中主要是设置 <code>stackadvisor.out</code> 和 <code>stackadvisor.err</code> 输出文件路径，然后根据 <code>serviceAdvisorType</code> 类型是 <code>JAVA</code> 或 <code>Python</code> 选择相应的执行方式，这里一般都是 <code>Python</code>，调用 <code>prepareShellCommand</code> 方法执行 <code>Python</code> 脚本。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413163527.png" alt=""></p>
<p>执行 <code>ambari-server\src\main\resources\scripts\stack_advisor.py</code> 脚本，在 <code>main</code> 方法中会先加载 <code>hostsFile</code> 和 <code>servicesFile</code>，解析为 <code>hosts</code> 和 <code>services</code>，获取<code>stackName</code>、<code>stackVersion</code>、<code>parentVersions</code> 等 stack 信息，然后根据这些 stack 信息实例化 <code>stackAdvisor</code>。通过判断 <code>action</code> 的类型调用不同的方法，<code>action</code> 类型与请求 <code>Body</code> 体中的 <code>recommend</code> 相对应（不是完全一样，中间有转换）。</p>
<ul>
<li><code>RECOMMEND_COMPONENT_LAYOUT_ACTION</code> ：推荐服务组件布局。</li>
<li><code>VALIDATE_COMPONENT_LAYOUT_ACTION</code> ： 校验服务组件布局，在安装服务时校验组件安装节点个数，每选中或取消一个节点，就会发送一个校验请求。</li>
<li><code>RECOMMEND_CONFIGURATIONS</code> ： 推荐配置，在安装服务的过程中，加载自定义之前调用。</li>
<li><code>RECOMMEND_CONFIGURATIONS_FOR_SSO</code> ： 推荐配置单点登录（？）。</li>
<li><code>RECOMMEND_CONFIGURATIONS_FOR_KERBEROS</code> ： 开 <code>kerberos</code> 时的推荐配置。</li>
<li><code>RECOMMEND_CONFIGURATION_DEPENDENCIES</code> ： 推荐配置依赖，在安装服务之后，修改配置参数时调用。</li>
<li><code>VALIDATE_CONFIGURATIONS</code> ： 校验配置，在安装过程中，设置好自定义配置点击“下一步”时调用。</li>
</ul>
<p>根据不同的 <code>action</code> 类型，调用 <code>stackAdvisor</code> 中相应的方法，然后将结果写入到 <code>json</code> 文件中，如 <code>configurations.json</code>， 和 <code>hosts.json</code>、<code>services.json</code>在同一目录中。</p>
<p>调用 <code>stackAdvisor</code> 中相应的方法时，会实例化各服务的 <code>serviceAdvisor</code>，然后调用相应的方法，这些方法都是可以自定义的。</p>
<h2 id="配置校验"><a href="#配置校验" class="headerlink" title="配置校验"></a>配置校验</h2><p>在安装服务过程中，自定义配置后点击 “下一步” 时会调用校验接口， Ambari server 接收到请求后，执行 <code>ambari-server\src\main\resources\scripts\stack_advisor.py</code>， Python 脚本执行流程如下：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413100455.png" alt=""></p>
<p>在 <code>main</code> 方法中，通过判断 <code>action</code> 类型为 <code>VALIDATE_CONFIGURATIONS</code>，执行 <code>result = stackAdvisor.validateConfigurations(services, hosts)</code>， 调用 <code>ambari-server\src\main\resources\stacks\stack_advisor.py</code> 中的 <code>validateConfigurations</code> 方法，执行 <code>validationItems = self.getConfigurationsValidationItems(services, hosts)</code>, 调用 <code>getConfigurationsValidationItems</code> 方法。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413102530.png" alt=""></p>
<p>在 <code>getConfigurationsValidationItems</code> 方法中，通过 <code>for</code> 循环遍历 <code>services</code> 中的服务，调用 <code>self.getConfigurationsValidationItemsForService</code> 方法，在 <code>getConfigurationsValidationItemsForService</code> 方法中，获取 <code>serviceAdvisor</code>，然后调用 <code>serviceAdvisor</code> 中的 <code>getServiceConfigurationsValidationItems</code> 方法。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413103038.png" alt=""></p>
<p>以 Yarn 服务为例，在 <code>ambari-server\src\main\resources\stacks\HDP\3.0\services\YARN\service_advisor.py</code> 脚本中，调用 <code>getServiceConfigurationsValidationItems</code> 方法，然后执行 <code>validator = YARNValidator()</code>，会依次执行 <code>validateYARNSiteConfigurationsFromHDP206</code>、<code>validateYARNSiteConfigurationsFromHDP25</code>、<code>validateYARNSiteConfigurationsFromHDP26</code>、<code>validateYARNEnvConfigurationsFromHDP206</code>、<code>validateYARNEnvConfigurationsFromHDP22</code>、<code>validateYARNRangerPluginConfigurationsFromHDP22</code>方法，方法中的 self.method_name 是在 <code>ambari-server\src\main\resources\stacks\stack_advisor.py</code> 中。</p>
<h2 id="推荐配置"><a href="#推荐配置" class="headerlink" title="推荐配置"></a>推荐配置</h2><h3 id="触发推荐配置"><a href="#触发推荐配置" class="headerlink" title="触发推荐配置"></a>触发推荐配置</h3><ul>
<li>在安装服务时，加载自定义配置之前会先请求推荐配置，如果有推荐配置，会弹出提示，如下图所示：</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413110048.png" alt=""></p>
<ul>
<li>安装服务后，修改配置参数时，也会调用推荐配置接口，如果有推荐配置，则会如下图所示：</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413110547.png" alt=""></p>
<p>点击“详细信息”后弹出如下对话框：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413110611.png" alt=""></p>
<h3 id="脚本执行逻辑"><a href="#脚本执行逻辑" class="headerlink" title="脚本执行逻辑"></a>脚本执行逻辑</h3><p>当触发推荐配置后，会调用 <code>ambari-server\src\main\resources\scripts\stack_advisor.py</code> 脚本，逻辑如下图所示：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413111221.png" alt=""></p>
<p>通过 <code>action</code> 类型调用不同的方法，安装时的 <code>action</code> 是 <code>recommend-configurations</code>， 安装后的 <code>action</code> 是 <code>recommend-configuration-dependencies</code>, 但最终都会到 <code>ambari-server\src\main\resources\stacks\stack_advisor.py</code> 的 <code>recommendConfigurations</code> 方法。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413112512.png" alt=""></p>
<p>在 <code>recommendConfigurations</code> 方法中，获取 <code>stackName</code>、<code>stackVersion</code>、<code>hostsList</code>、<code>serviceList</code>、<code>componentsList</code>、<code>clusterSummary</code> 等信息， 然后定义 <code>recommendations</code> 格式，接着会判断 <code>config-groups</code> 是否在 <code>services</code> 中，如果在，则调用 <code>recommendConfigGroupsConfigurations</code> 方法（目前没看到哪种情况会走这个逻辑），如果不在，则会走之后的逻辑，这也是推荐配置的主要逻辑。先 <code>for</code> 循环遍历 <code>services</code>，实例化 <code>serviceAdvisor</code>，并将 <code>serviceAdvisor</code> 加入到 <code>serviceAdvisors</code>，然后再 <code>for</code> 循环遍历 <code>serviceAdvisors</code>， 调用 <code>serviceAdvisor.getServiceConfigurationRecommendations(configurations, clusterSummary, services, hosts)</code>, 这就调用了每个服务的 <code>service_advisor</code> 中的 <code>getServiceConfigurationRecommendations</code> 方法。</p>
<p>以 Yarn 为例，在 <code>ambari-server\src\main\resources\stacks\HDP\3.0\services\YARN\service_advisor.py</code> 中的 <code>YARNServiceAdvisor</code>（这个文件中还有 <code>MAPREDUCE2Validator</code>）的 <code>getServiceConfigurationRecommendations</code> 中，有 <code>recommendYARNConfigurationsFromHDP206</code>、<code>recommendYARNConfigurationsFromHDP22</code>、<code>recommendYARNConfigurationsFromHDP23</code>、<code>recommendYARNConfigurationsFromHDP25</code>、<code>recommendYARNConfigurationsFromHDP26</code>、<code>recommendYARNConfigurationsFromHDP30</code>、<code>recommendConfigurationsForSSO</code> 多个方法，会依次执行。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210413113848.png" alt=""></p>
<p>执行完推荐配置脚本后，会有两种处理方法，一种是直接修改原有的配置，通过 <code>putxxxProperty</code> 的方法将值修改为推荐配置；另一种是通过 <code>self.getWarnItem</code> 或 <code>self.getErrorItem</code> 将推荐配置弹出警告或错误提示框。</p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="配置校验-1"><a href="#配置校验-1" class="headerlink" title="配置校验"></a>配置校验</h2><p>以 <code>ZooKeeper</code> 为例做配置校验，原有的 <code>ZookeeperServiceAdvisor</code>类中的  <code>getServiceConfigurationsValidationItems</code> 方法没有校验逻辑，现增加 <code>zookeeper-env</code> 中的 <code>Zookeeper Server Maximum Memory</code> 不能超过可用内存的 10%，如果超过，则弹出警告窗。</p>
<h3 id="创建-Validator"><a href="#创建-Validator" class="headerlink" title="创建 Validator"></a>创建 Validator</h3><p>首先创建 <code>ZOOKEEPERValidator</code> 类，在这个类中实现具体的校验逻辑，需在  <code>getServiceConfigurationsValidationItems</code> 方法中引用，示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getServiceConfigurationsValidationItems</span><span class="params">(self, configurations, recommendedDefaults, services, hosts)</span>:</span></span><br><span class="line"></span><br><span class="line">  self.logger.info(<span class="string">"Class: %s, Method: %s. Validating Configurations."</span> %</span><br><span class="line">              (self.__class__.__name__, inspect.stack()[<span class="number">0</span>][<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: getServiceConfigurationsValidationItems ..."</span>)</span><br><span class="line">  </span><br><span class="line">  validator = ZOOKEEPERValidator()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> validator.validateListOfConfigUsingMethod(configurations, recommendedDefaults, services, hosts, validator.validators)</span><br></pre></td></tr></table></figure>

<p> <code>ZOOKEEPERValidator</code> 类代码示例如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZOOKEEPERValidator</span><span class="params">(service_advisor.ServiceAdvisor)</span>:</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">    self.as_super = super(ZOOKEEPERValidator, self)</span><br><span class="line">    self.as_super.__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    self.logger.info(<span class="string">"ZooKeeper: ZookeeperValidator ..."</span>)</span><br><span class="line">    self.validators = [(<span class="string">"zookeeper-env"</span>, self.validateZookeeperEnvConfigurations)]</span><br></pre></td></tr></table></figure>

<h3 id="具体校验逻辑"><a href="#具体校验逻辑" class="headerlink" title="具体校验逻辑"></a>具体校验逻辑</h3><p>因为校验的参数在 <code>zookeeper-env</code>中，这里单独写一个 <code>validateZookeeperEnvConfigurations</code> 方法，在 <code>validateZookeeperEnvConfigurations</code> 方法中实现校验  <code>zookeeper-env</code> 中参数的具体逻辑。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validateZookeeperEnvConfigurations</span><span class="params">(self, properties, recommendedDefaults, configurations, services, hosts)</span>:</span></span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: validateZookeeperEnvConfigurations ..."</span>)</span><br><span class="line"></span><br><span class="line">  validationItems = []</span><br><span class="line"></span><br><span class="line">  <span class="comment"># get clusterSummary</span></span><br><span class="line">  servicesList, componentsList = self.get_service_and_component_lists(services[<span class="string">"services"</span>])</span><br><span class="line">  clusterSummary = self.getConfigurationClusterSummary(servicesList, hosts, componentsList, services)</span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: clusterSummary: &#123;0&#125;"</span>.format(clusterSummary))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># get totalAvailableRam</span></span><br><span class="line">  totalAvailableRam = int(clusterSummary[<span class="string">'totalAvailableRam'</span>])</span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: totalAvailableRam:&#123;0&#125; "</span>.format(totalAvailableRam))</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># get zk_server_heapsize</span></span><br><span class="line">  zk_server_heapsize = int(services[<span class="string">"configurations"</span>][<span class="string">"zookeeper-env"</span>][<span class="string">"properties"</span>][<span class="string">"zk_server_heapsize"</span>])</span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: zk_server_heapsize:&#123;0&#125;"</span>.format(zk_server_heapsize))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># set ram limit</span></span><br><span class="line">  ramLimit = <span class="number">0.1</span></span><br><span class="line">  </span><br><span class="line">  self.logger.info(<span class="string">"ZooKeeper: start if ..."</span>)</span><br><span class="line">  <span class="keyword">if</span> zk_server_heapsize <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> zk_server_heapsize &gt; totalAvailableRam * ramLimit:</span><br><span class="line">    validationItems.append(&#123;<span class="string">"config-name"</span>: <span class="string">'zk_server_heapsize'</span>,</span><br><span class="line">                            <span class="string">"item"</span>: self.getWarnItem(</span><br><span class="line">                              <span class="string">"zk_server_heapsize cat't exceed 10% of the total memory"</span>)&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> self.toConfigurationValidationProblems(validationItems, <span class="string">"zookeeper-env"</span>)</span><br></pre></td></tr></table></figure>

<p>这里以校验 <code>zookeeper-env</code> 中的 <code>Zookeeper Server Maximum Memory</code> 的值不能超过可用内存的 10% 为例。首先获取 <code>clusterSummary</code>，接着获取 <code>totalAvailableRam</code>，然后获取 <code>zk_server_heapsize</code>（注意，这里获取的值要使用 <code>int</code>  强转下），</p>
<p>因为 <code>Zookeeper Server Maximum Memory</code>对应的 <code>name</code> 为 <code>zk_server_heapsize</code>，需要从 <code>services</code>中获取，可以查看 <code>service.json</code> 中的结构关系。设置内存限制比例 <code>ramLimit</code> 为 0.1，然后就可以判断，如果超过可用内存的 10% 后，通过 <code>getWarnItem</code> 设置告警信息，并加入 <code>validationItems</code>，然后返回相应信息。</p>
<h3 id="替换-service-advisor"><a href="#替换-service-advisor" class="headerlink" title="替换 service_advisor"></a>替换 service_advisor</h3><p>进入 <code>ZooKeeper</code> 的 <code>service_advisor.py</code> 所在目录，然后连同编译的文件（<code>service_advisor.pyo</code>，<code>service_advisor.pyc</code>）一并删除。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /var/lib/ambari-server/resources/stacks/HDP/3.0/services/ZOOKEEPER</span><br><span class="line">rm -rf service_advisor.py*</span><br></pre></td></tr></table></figure>

<p>然后上传新的 <code>service_advisor.py</code> 文件（注意文件编码格式必须为：Unix）。</p>
<p>无需重启 Ambari server 或 agent，可以在界面直接修改配置测试。</p>
<h3 id="修改配置测试"><a href="#修改配置测试" class="headerlink" title="修改配置测试"></a>修改配置测试</h3><p>将 <code>Zookeeper Server Maximum Memory</code> 修改为 <code>3072</code>。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210414155633.png" alt=""></p>
<p>点击”保存”按钮，会弹出如下警告框。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210414151423.png" alt=""></p>
<p>通过 <code>ambari-server.log</code> 中的日志可以查看到：</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line"><span class="number">2021</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">22</span>,<span class="number">141</span> INFO DefaultStackAdvisor validateZookeeperEnvConfigurations: - ZooKeeper: totalAvailableRam:<span class="number">11264</span></span><br><span class="line"><span class="number">2021</span>-<span class="number">04</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">22</span>,<span class="number">141</span> INFO DefaultStackAdvisor validateZookeeperEnvConfigurations: - ZooKeeper: zk_server_heapsize:<span class="number">3072</span></span><br></pre></td></tr></table></figure>

<p>显然 3072 &gt; 11264 *0.1，校验不通过。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker 常用基本命令</title>
    <url>/2021/06/14/Docker-basic-commands/</url>
    <content><![CDATA[<p>本文主要介绍 Docker 常用的基本命令。</p>
<a id="more"></a>

<h1 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h1><ul>
<li>安装 Docker</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Ubuntu</span></span><br><span class="line">apt install docker docker.io</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Docker 版本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Docker 状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>

<ul>
<li>启动 Docker</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<ul>
<li>重启docker</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<ul>
<li>查看本地已有镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<ul>
<li>设置仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   &quot;registry-mirrors&quot;: [&quot;http:&#x2F;&#x2F;10.180.210.xxx:9090&quot;],</span><br><span class="line"></span><br><span class="line">   &quot;insecure-registries&quot;: [&quot;10.180.210.xxx:9090&quot;]</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>登录测试</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker login 10.180.210.xxx:9090</span><br></pre></td></tr></table></figure>

<ul>
<li>搜索镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search zookeeper</span><br></pre></td></tr></table></figure>

<ul>
<li>拉取镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull insight.harbor:30010/insight/zookeeper:3.4.6</span><br></pre></td></tr></table></figure>

<ul>
<li>启动镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name zkName insight.harbor:30010/insight/zookeeper:3.4.6</span><br></pre></td></tr></table></figure>

<ul>
<li>查看镜像状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<ul>
<li>获取镜像进程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看进程</span></span><br><span class="line">docker top zkName</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取第二列，第二行的值，该值为 进程 pid</span></span><br><span class="line">docker top zkName | awk '&#123;print $2&#125;' | sed -n '2p'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 pid 写入到特定文件中</span></span><br><span class="line">docker top zkName | awk '&#123;print $2&#125;' | sed -n '2p' &gt; /var/run/zookeeper/zookeeper_server.pid</span><br></pre></td></tr></table></figure>

<ul>
<li>进入容器中操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it zkName /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出容器</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<ul>
<li>复制文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将宿主机文件复制到容器中</span></span><br><span class="line">docker cp /tmp/test.txt zkName:/tmp/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将容器中的文件复制到宿主机</span></span><br><span class="line">docker cp zkName:/tmp/test.txt /tmp/</span><br></pre></td></tr></table></figure>



<ul>
<li>镜像保存导入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 保存镜像</span></span><br><span class="line">docker save -o zk-2.4.6.tar insight.harbor:30010/insight/zookeeper:3.4.6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导入镜像</span></span><br><span class="line">docker load -i zk-2.4.6.tar</span><br></pre></td></tr></table></figure>



<ul>
<li>停止镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker stop zkName &amp;&amp; docker rm zkName</span><br></pre></td></tr></table></figure>

<ul>
<li>删除镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rmi insight.harbor:30010/insight/zookeeper:3.4.6</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>Docker 基本命令 - 简书：<a href="https://www.jianshu.com/p/4ab37ad30bd2" target="_blank" rel="noopener">https://www.jianshu.com/p/4ab37ad30bd2</a></p>
</li>
<li><p>Docker 命令大全 | 菜鸟教程：<a href="https://www.runoob.com/docker/docker-command-manual.html" target="_blank" rel="noopener">https://www.runoob.com/docker/docker-command-manual.html</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>GitBucket 安装部署</title>
    <url>/2019/11/05/GitBucket-introduction/</url>
    <content><![CDATA[<p>本文主要介绍了一款 GitHub 的私有版代码管理工具—— GitBucket，相较于 GitLab 更小巧精悍，适合小团队协作开发使用。</p>
<a id="more"></a>

<h1 id="GitBucket-介绍"><a href="#GitBucket-介绍" class="headerlink" title="GitBucket 介绍"></a>GitBucket 介绍</h1><p>GitBucket 可以看做一款是GitHub的私有版，小巧精悍，几乎具有GitHub的所有功能，而且部署简单。</p>
<ul>
<li>GitHub 地址<br>gitbucket/gitbucket: A Git platform powered by Scala with easy installation, high extensibility &amp; GitHub API compatibility<br><a href="https://github.com/gitbucket/gitbucket" target="_blank" rel="noopener">https://github.com/gitbucket/gitbucket</a> </li>
</ul>
<p>可以直接下载 war 包进行安装：<a href="https://github.com/gitbucket/gitbucket/releases" target="_blank" rel="noopener">https://github.com/gitbucket/gitbucket/releases</a></p>
<h1 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h1><p>因为是 war 包，可以直接使用 <code>java -jar</code>启动，为了后台启动，可以运行脚本<code>start_gitbucket.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">nohup java -jar /opt/gitbucket/gitbucket.war &gt; /opt/gitbucket/gitbucket.log &amp;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>GitBucket</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git 常用基本命令</title>
    <url>/2021/06/06/Git-basic-commands/</url>
    <content><![CDATA[<p>本文主要介绍 Git 常用的基本命令。</p>
<a id="more"></a>

<h1 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h1><h2 id="仓库相关命令"><a href="#仓库相关命令" class="headerlink" title="仓库相关命令"></a>仓库相关命令</h2><ul>
<li>创建新仓库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<ul>
<li>克隆项目</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Erik-ly/git-test.git</span><br></pre></td></tr></table></figure>

<ul>
<li>查看当前配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure>

<ul>
<li>配置用户名</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name "xxx"</span><br></pre></td></tr></table></figure>

<ul>
<li>配置邮箱</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.email "xxx@xxx.com"</span><br></pre></td></tr></table></figure>


<h2 id="提交相关命令"><a href="#提交相关命令" class="headerlink" title="提交相关命令"></a>提交相关命令</h2><ul>
<li>添加某个文件到暂存区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add test.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>添加所有文件到暂存区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>

<ul>
<li>查看仓库当前状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<ul>
<li>显示变更信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>

<ul>
<li>提交暂存区到本地仓库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit -m "add test file"</span><br></pre></td></tr></table></figure>

<ul>
<li>下载远程代码并合并</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure>

<ul>
<li>上传远程代码并合并</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure>

<ul>
<li>查看历史提交记录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>



<h2 id="分支相关命令"><a href="#分支相关命令" class="headerlink" title="分支相关命令"></a>分支相关命令</h2><ul>
<li>显示本地分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure>

<ul>
<li>显示所有分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>

<ul>
<li>获取所有远程分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch</span><br></pre></td></tr></table></figure>

<ul>
<li>切换远程分支到本地</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b dev origin/dev</span><br></pre></td></tr></table></figure>

<ul>
<li>切换分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout release</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个分支，并切换到该新分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b dev</span><br></pre></td></tr></table></figure>

<ul>
<li>基于当前 HEAD 创建新分支</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch release</span><br></pre></td></tr></table></figure>

<ul>
<li>将本地分支上传到远程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>

<ul>
<li>删除本地分支（删除其他分支，不能删除当前分支， -D 是强制删除）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -d dev2</span><br></pre></td></tr></table></figure>

<ul>
<li>合并特定 commit 到另一个分支</li>
</ul>
<p>比如我在 dev 分支修改了一个bug，提交为 “fix bug-7”，现在需要把 dev 分支的这个代码合并到 release 分支。</p>
<p>首先在需要合并的 commit 所在的分支下使用 <code>git log</code> 查看，找到 “fix bug-7” 的 commit 为 “072a2e524c9fe3d082dfce37762e4a43e200484c”，按 Q 键退出日志查看。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Erik@DESKTOP-M3B942V MINGW64 ~/IdeaProjects/git-test (dev)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span></span></span><br><span class="line">commit 072a2e524c9fe3d082dfce37762e4a43e200484c (HEAD -&gt; dev, origin/release-1.0, origin/dev, release-1.0)</span><br><span class="line">Author: “liuyang” &lt;liuyangerik@gmail.com&gt;</span><br><span class="line">Date:   Sun Jun 13 11:00:36 2021 +0800</span><br><span class="line"></span><br><span class="line">    fix bug-7</span><br></pre></td></tr></table></figure>

<p>然后切换到 release 分支。</p>
<p>在 release 分支上执行执行 pick 操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout release</span><br><span class="line">git cherry-pick 072a2e524c9fe3d082dfce37762e4a43e200484c</span><br></pre></td></tr></table></figure>



<h2 id="tag-相关命令"><a href="#tag-相关命令" class="headerlink" title="tag 相关命令"></a>tag 相关命令</h2><ul>
<li>显示已存在的 tag</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure>

<ul>
<li>创建 tag</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git tag -a v1.0 -m "v1.0 tag"</span><br></pre></td></tr></table></figure>

<ul>
<li>删除本地 tag</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git tag -d v1.0</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 tag 信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git show v1.0</span><br></pre></td></tr></table></figure>

<ul>
<li>推送所有 tag 到远程仓库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push --tags</span><br></pre></td></tr></table></figure>



<h2 id="撤销相关命令"><a href="#撤销相关命令" class="headerlink" title="撤销相关命令"></a>撤销相关命令</h2><ul>
<li>恢复暂存区的指定文件到工作区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout file_name</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复暂存区的所有文件到工作区</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout .</span><br></pre></td></tr></table></figure>

<ul>
<li>重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset [file]</span><br></pre></td></tr></table></figure>

<ul>
<li>重置暂存区与工作区，与上一次commit保持一致</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard</span><br></pre></td></tr></table></figure>

<ul>
<li>重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致，<strong>commit 之后的版本都会丢失</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard [commit]</span><br></pre></td></tr></table></figure>

<ul>
<li>撤销某次操作，此次操作之前和之后的 commit 都会保留</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git revert [commit]</span><br></pre></td></tr></table></figure>



<h1 id="IDEA-Git-相关操作"><a href="#IDEA-Git-相关操作" class="headerlink" title="IDEA Git 相关操作"></a>IDEA Git 相关操作</h1><h2 id="仓库相关操作"><a href="#仓库相关操作" class="headerlink" title="仓库相关操作"></a>仓库相关操作</h2><ul>
<li>原有项目引入 Git 管理</li>
</ul>
<p>原有项目使用 IDEA 打开，依次点击 VCS — Import into Version Control — Create Git Repository…</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614095503728.png" alt="image-20210614095503728"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614095529290.png" alt="image-20210614095529290"></p>
<p>在弹出的对话框中选择这个项目，点击 “OK” 即可。</p>
<p>下面以项目放到 GitHub 为例，首先在 GitHub 上创建项目，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614095959894.png" alt="image-20210614095959894"></p>
<p>然后添加源端仓库，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614094523563.png" alt="image-20210614094523563"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614100255144.png" alt="image-20210614100255144"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614100315234.png" alt="image-20210614100315234"></p>
<p>commit 代码后，提交到远程仓库。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614100358673.png" alt="image-20210614100358673"></p>
<ul>
<li>添加其它远端仓库</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614094523563.png" alt="image-20210614094523563"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614094629934.png" alt="image-20210614094629934"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614094927469.png" alt="image-20210614094927469"></p>
<p>Name 写为 非 “origin” 的名字，可根据 Git 仓库工具，比如：GitBucket。之后提交代码的时候可选择改仓库提交。</p>
<h2 id="提交相关操作"><a href="#提交相关操作" class="headerlink" title="提交相关操作"></a>提交相关操作</h2><ul>
<li>更新代码</li>
</ul>
<p>推荐使用下图红框中标注的按钮拉取更新代码，快捷键 <code>Ctrl + T</code> ，这种会更新全部，拉取新的分支，自动 merge 等，不容易出错。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210613112929011.png" alt="image-20210613112929011"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210613113545159.png" alt="image-20210613113545159"></p>
<ul>
<li>commit 提交代码</li>
</ul>
<p>使用快捷键 <code>Ctrl + K</code>， 提交代码</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614084716254.png" alt="image-20210614084716254"></p>
<ul>
<li>Push 代码</li>
</ul>
<p>使用快捷键 <code>Ctrl + Shift + K</code> push 代码</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210614084820056.png" alt="image-20210614084820056"></p>
<h3 id="提交代码步骤"><a href="#提交代码步骤" class="headerlink" title="提交代码步骤"></a>提交代码步骤</h3><ol>
<li>更新最新代码（快捷键：<code>Ctrl + T</code>），将代码更新到最新。</li>
<li>修改代码。</li>
<li>更新最新代码（快捷键：<code>Ctrl + T</code>），提交代码之前要先更新代码，在修改代码这段时间内，如果有其他人修改了代码，需要更新，否则可能会覆盖别人的代码，另外这时更新，如果有 Merge 的情况，会自动 Merge，或让自己来 Merge 代码，在提交记录里不会出现大量的 Merge 记录。</li>
<li>Add 代码，无特殊情况，在项目上执行下 ADD 操作，将自己新加的或之前 Merge 的一些文件 add 进来；</li>
<li>Commit 代码（快捷键：<code>Ctrl + K</code>），注意写清楚修改了哪些内容，尽量一个功能一个 commit，可以在 commit 对话框中选择本次要提交的文件；</li>
<li>Push 代码（快捷键：<code>Ctrl + Shift + K</code>），提交代码时注意将要提交到哪个分支，这里 push 所有 commit，无法选择某个 commit push。</li>
</ol>
<h2 id="分支相关操作"><a href="#分支相关操作" class="headerlink" title="分支相关操作"></a>分支相关操作</h2><ul>
<li>checkout 新分支</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210613113936478.png" alt="image-20210613113936478"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210613114018124.png" alt="image-20210613114018124"></p>
<ul>
<li>切换分支</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210613114155693.png" alt="image-20210613114155693"></p>
<ul>
<li>删除本地分支</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614084321087.png" alt="image-20210614084321087"></p>
<ul>
<li>将本地分支推送到远端</li>
</ul>
<p>如在本地 checkout 出一个 “release-1.0” 分支，需要将这个分支推送到远端，则可以使用 <code>Ctrl + Shift + K</code> 进行 Push，在弹出框中看到 ”release-1.0 → origin：release-1.0“，如果不是这样，则可点击分支进行手动修改（红框中带有下划线部分均可点击后修改），点击 ”Push“ 按钮进行提交即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210613110545114.png" alt="image-20210613110545114"></p>
<ul>
<li>查看提交记录</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614085024101.png" alt="image-20210614085024101"></p>
<ul>
<li>查看某个分支的提交记录</li>
</ul>
<p>可以选择本地的分支</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614085124801.png" alt="image-20210614085124801"></p>
<p>也可以通过 “Select…” 手动输入特定分支，按 <code>Ctrl + Enter</code> 确定</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614090900079.png" alt="image-20210614090900079"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614091026594.png" alt="image-20210614091026594"></p>
<ul>
<li>Pick 合并 commit 到其它分支</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614091514290.png" alt="image-20210614091514290"></p>
<p>如果需要 Merge</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614091819551.png" alt="image-20210614091819551"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614091935163.png" alt="image-20210614091935163"></p>
<h2 id="tag-相关操作"><a href="#tag-相关操作" class="headerlink" title="tag 相关操作"></a>tag 相关操作</h2><ul>
<li>创建 tag</li>
</ul>
<p>在某个 commit 又键，选择 “New Tag …”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614144459410.png" alt="image-20210614144459410"></p>
<p>然后输入 tag 名称</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614144526764.png" alt="image-20210614144526764"></p>
<p>最后推送到远端，注意要勾选 “Push Tags”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614144644304.png" alt="image-20210614144644304"></p>
<h2 id="撤销相关操作"><a href="#撤销相关操作" class="headerlink" title="撤销相关操作"></a>撤销相关操作</h2><ul>
<li>reset 操作</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614094123232.png" alt="image-20210614094123232"></p>
<ul>
<li>revert 操作</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/raw/master/img/2021/06/image-20210614094148822.png" alt="image-20210614094148822"></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Git 基本操作 | 菜鸟教程：<a href="https://www.runoob.com/git/git-basic-operations.html" target="_blank" rel="noopener">https://www.runoob.com/git/git-basic-operations.html</a></li>
<li>git命令大全：<a href="https://gist.github.com/Erik-ly/d68cc402fade0ef6b960ca8fc5603949" target="_blank" rel="noopener">https://gist.github.com/Erik-ly/d68cc402fade0ef6b960ca8fc5603949</a></li>
<li>常用 Git 命令清单 - 阮一峰的网络日志：<a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a></li>
<li>Git恢复之前版本的两种方法reset、revert（图文详解）：<a href="https://blog.csdn.net/yxlshk/article/details/79944535" target="_blank" rel="noopener">https://blog.csdn.net/yxlshk/article/details/79944535</a></li>
<li>git revert 用法 - demoblog - 博客园：<a href="https://www.cnblogs.com/0616--ataozhijia/p/3709917.html" target="_blank" rel="noopener">https://www.cnblogs.com/0616--ataozhijia/p/3709917.html</a></li>
<li>Git合并特定commits 到另一个分支：<a href="https://blog.csdn.net/ybdesire/article/details/42145597" target="_blank" rel="noopener">https://blog.csdn.net/ybdesire/article/details/42145597</a></li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 GitHub 和 Hexo 搭建个人博客</title>
    <url>/2019/11/03/GitHub-and-Hexo-create-blogs/</url>
    <content><![CDATA[<p>本文主要介绍使用 GitHub 和 Hexo 搭建个人博客的详细方法步骤，包括安装配置 Hexo、配置个人域名、编写并发布博客的详细步骤，最后介绍 Next 主题及设置，最终效果：</p>
<p>Erik-ly<br><a href="http://www.erik-ly.com/" target="_blank" rel="noopener">http://www.erik-ly.com/</a></p>
<a id="more"></a>

<h1 id="Hexo-简介"><a href="#Hexo-简介" class="headerlink" title="Hexo 简介"></a>Hexo 简介</h1><ul>
<li><p>Hexo 官网：<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">https://hexo.io/zh-cn/</a></p>
</li>
<li><p>Hexo 文档：<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></p>
</li>
<li><p>Hexo 视频教程</p>
<p>  YouTube：<a href="https://www.youtube.com/playlist?list=PLD5dyQmlN6xPqBV0cxO7zAe1C8OmDPqfX" target="_blank" rel="noopener">https://www.youtube.com/playlist?list=PLD5dyQmlN6xPqBV0cxO7zAe1C8OmDPqfX</a><br>  Bilibili：<a href="https://space.bilibili.com/362224537/channel/detail?cid=61636" target="_blank" rel="noopener">https://space.bilibili.com/362224537/channel/detail?cid=61636</a></p>
<!-- more -->

</li>
</ul>
<h1 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h1><p>首先，本地需要有<code>node.js</code>和<code>git</code>，我的软件版本为：</p>
<p><img src="https://img-blog.csdnimg.cn/20191105215005614.png" alt=""></p>
<p>然后安装<code>Hexo</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line">hexo -v</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191105215115643.png" alt=""></p>
<h1 id="创建博客"><a href="#创建博客" class="headerlink" title="创建博客"></a>创建博客</h1><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>首先创建一个文件夹，用于存放博客项目，我的博客项目文件夹名为<code>erik-ly-blog</code>，因此</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init erik-ly-blog</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191105215144543.png" alt=""></p>
<p>创建完项目后可以切换到目录并查看目录结构</p>
<p><img src="https://img-blog.csdnimg.cn/20191105215321256.png" alt=""></p>
<h2 id="生成静态文件"><a href="#生成静态文件" class="headerlink" title="生成静态文件"></a>生成静态文件</h2><p>因为初始化项目后，项目中已经包含了一篇<code>hello world</code>的博客，所以先看下效果，可以使用以下命令生成静态文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191105215411634.png" alt=""></p>
<h2 id="本地部署"><a href="#本地部署" class="headerlink" title="本地部署"></a>本地部署</h2><p>使用以下命令进行本地部署，查看效果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191105215507467.png" alt=""></p>
<p>然后打开网页 <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> ，显示效果为：</p>
<p><img src="https://img-blog.csdnimg.cn/20191105215541604.png" alt=""></p>
<h1 id="写作"><a href="#写作" class="headerlink" title="写作"></a>写作</h1><p>现在开始写第一篇文章，我这里为了方便使用，暂时使用 IDEA 打开项目并编辑文章，准备写第一篇文章，可以使用如下命令:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new &quot;GitHub and Hexo create blogs&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20191105215738167.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>然后使用 Markdown 语法编辑文章</p>
<p><img src="https://img-blog.csdnimg.cn/20191105215928579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>编辑好后依次执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p>查看网页显示效果</p>
<p><img src="https://img-blog.csdnimg.cn/20191105215945833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>现在对博客进行一些简单的设置，打开设置文件<code>_config.yml</code>，然后依据自己情况进行设置</p>
<p><img src="https://img-blog.csdnimg.cn/20191105220029159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>更多配置参数说明可以查看：<a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/configuration</a></p>
<p>修改好后可以使用<code>hexo g</code>和<code>hexo s</code>命令查看效果</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="创建-GitHub-仓库"><a href="#创建-GitHub-仓库" class="headerlink" title="创建 GitHub 仓库"></a>创建 GitHub 仓库</h2><p>在 GitHub 上创建一个<code>用户名.github.io</code>的仓库，这个是固定写法，比如我的 GitHub 用户名为<code>Erik-ly</code>，那么我就要新建一个名为<code>Erik-ly.github.io</code>的仓库。</p>
<p><img src="https://img-blog.csdnimg.cn/20191105221954833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="安装-Hexo-插件"><a href="#安装-Hexo-插件" class="headerlink" title="安装 Hexo 插件"></a>安装 Hexo 插件</h2><p>安装插件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>然后配置<code>_config.yml</code>，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: &#39;git&#39;</span><br><span class="line">  repo: https:&#x2F;&#x2F;github.com&#x2F;Erik-ly&#x2F;Erik-ly.github.io.git</span><br></pre></td></tr></table></figure>

<h2 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h2><p>使用下面命令部署到 GitHub 上</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>部署完成后，打开 <a href="https://erik-ly.github.io/" target="_blank" rel="noopener">https://erik-ly.github.io/</a> 查看效果，这个是和你自己的仓库名称一致的，网页效果为</p>
<p><img src="https://img-blog.csdnimg.cn/20191105222016249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h1><h2 id="查看仓库-IP"><a href="#查看仓库-IP" class="headerlink" title="查看仓库 IP"></a>查看仓库 IP</h2><p>如果想要一个自己的域名，可以在阿里云或腾讯云上购买域名，这里以阿里云为例示范域名解析过程。<br>首先使用<code>ping</code>查看自己 GitHub 上<code>用户名.github.io</code>的 IP 地址，</p>
<p><img src="https://img-blog.csdnimg.cn/20191105222033945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="设置域名解析"><a href="#设置域名解析" class="headerlink" title="设置域名解析"></a>设置域名解析</h2><p>然后在阿里云上进行域名解析</p>
<p><img src="https://img-blog.csdnimg.cn/20191105223355405.png" alt=""><br><img src="https://img-blog.csdnimg.cn/20191105222045758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>分别添加如下两条记录</p>
<p><img src="https://img-blog.csdnimg.cn/20191105222126549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p><img src="https://img-blog.csdnimg.cn/2019110522213891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>查看域名解析效果</p>
<p><img src="https://img-blog.csdnimg.cn/20191105222152698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="配置-CNAME"><a href="#配置-CNAME" class="headerlink" title="配置 CNAME"></a>配置 CNAME</h2><p>在 Hexo 文件夹的<code>source</code>目录下创建一个名为<code>CNAME</code>的文件，然后输入你的域名</p>
<p><img src="https://img-blog.csdnimg.cn/20191105222222584.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="部署-2"><a href="#部署-2" class="headerlink" title="部署"></a>部署</h2><p>使用<code>hexo d</code>部署，然后访问网页查看效果，我这里是 <a href="http://www.erik-ly.com/" target="_blank" rel="noopener">http://www.erik-ly.com/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20191105222239293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="Next-主题及设置"><a href="#Next-主题及设置" class="headerlink" title="Next 主题及设置"></a>Next 主题及设置</h1><h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><p>这里选择的是 <a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener">Next主题</a> ，简洁方便，更换主题步骤为：</p>
<p>由于我在 Windows 系统中编辑的博客，无法使用官方的命令安装，因此我直接下载的 <a href="https://github.com/theme-next/hexo-theme-next/releases/tag/v7.5.0" target="_blank" rel="noopener">Next V7.5.0</a> 版本的源码，放到<code>themes</code>目录中，在配置文件<code>_config.yml</code>中配置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https:&#x2F;&#x2F;hexo.io&#x2F;plugins&#x2F;</span><br><span class="line">## Themes: https:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;</span><br><span class="line">theme: next</span><br></pre></td></tr></table></figure>

<h2 id="设置布局"><a href="#设置布局" class="headerlink" title="设置布局"></a>设置布局</h2><p>在 <code>themes\next\_config.yml</code> 的配置文件中设置 Next 主题的布局，有四种布局，可以分别尝试下，这里选择的是“Pisces”。<br><img src="https://img-blog.csdnimg.cn/20191120205556346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9lcmlrLWx5LmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="设置左边栏"><a href="#设置左边栏" class="headerlink" title="设置左边栏"></a>设置左边栏</h2><p>Next 主题的详细设置可以参考 <a href="https://theme-next.org/docs/theme-settings/" target="_blank" rel="noopener">Next官方设置</a> 。<br>我这里主要根据自己的需要对左侧边栏内容进行设置，最终效果为：<br><img src="https://img-blog.csdnimg.cn/20191120205039140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""><br>首先在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: &#x2F; || home</span><br><span class="line">  categories: &#x2F;categories&#x2F; || th</span><br><span class="line">  tags: &#x2F;tags&#x2F; || tags</span><br><span class="line">  archives: &#x2F;archives&#x2F; || archive</span><br><span class="line">  #schedule: &#x2F;schedule&#x2F; || calendar</span><br><span class="line">  #sitemap: &#x2F;sitemap.xml || sitemap</span><br><span class="line">  #commonweal: &#x2F;404&#x2F; || heartbeat</span><br><span class="line">  about: &#x2F;about&#x2F; || user</span><br></pre></td></tr></table></figure>

<h2 id="设置分类"><a href="#设置分类" class="headerlink" title="设置分类"></a>设置分类</h2><p>新建分类页面</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page categories</span><br></pre></td></tr></table></figure>
<h2 id="在-source-categories-index-md-中设置"><a href="#在-source-categories-index-md-中设置" class="headerlink" title="在 source\categories\index.md 中设置"></a>在 <code>source\categories\index.md</code> 中设置</h2><p>   title: 分类<br>   date: 2019-11-09 09:50:39<br>   type: “categories”</p>
<hr>
<p>以后在文章开头设置分类，如这篇文章为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 使用 GitHub 和 Hexo 搭建个人博客</span><br><span class="line">date: 2019-11-03 10:39:21</span><br><span class="line">tags:</span><br><span class="line">categories: 软件工具</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<h2 id="设置标签"><a href="#设置标签" class="headerlink" title="设置标签"></a>设置标签</h2><p>新建标签页面</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>
<p>在 <code>source\tags\index.md</code> 中设置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">date: 2019-12-01 10:35:08</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>之后在文章开头设置 tags ，如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: IDEA 常用快捷键和设置</span><br><span class="line">date: 2019-11-25 20:37:44</span><br><span class="line">tags: IDEA</span><br><span class="line">categories: 软件工具</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>如果需要设置多个标签可以使用<code>tats:[标签1，标签2，标签3]</code>，如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tags: [Hexo,GitHub]</span><br></pre></td></tr></table></figure>


<h2 id="设置关于"><a href="#设置关于" class="headerlink" title="设置关于"></a>设置关于</h2><p>“关于”页面与“分类”差相似，都需要新建页面，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page about</span><br></pre></td></tr></table></figure>
<p>然后在 <code>\source\about\index.md</code> 中写“关于”页面的内容。</p>
<h2 id="设置搜索"><a href="#设置搜索" class="headerlink" title="设置搜索"></a>设置搜索</h2><p>搜索使用的是 Next 自带的搜索工具 <a href="https://github.com/theme-next/hexo-generator-searchdb" target="_blank" rel="noopener">hexo-generator-searchdb</a> ，首先下载安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb</span><br></pre></td></tr></table></figure>

<p>然后在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Local Search</span><br><span class="line"># Dependencies: https:&#x2F;&#x2F;github.com&#x2F;theme-next&#x2F;hexo-generator-searchdb</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line">  # If auto, trigger search by changing input.</span><br><span class="line">  # If manual, trigger search by pressing enter key or search button.</span><br><span class="line">  trigger: auto</span><br><span class="line">  # Show top n results per article, show all results by setting to -1</span><br><span class="line">  top_n_per_article: 1</span><br><span class="line">  # Unescape html strings to the readable one.</span><br><span class="line">  unescape: false</span><br><span class="line">  # Preload the search data when the page loads.</span><br><span class="line">  preload: true</span><br></pre></td></tr></table></figure>

<h2 id="设置访问量"><a href="#设置访问量" class="headerlink" title="设置访问量"></a>设置访问量</h2><p>在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">busuanzi_count:</span><br><span class="line">  enable: true</span><br><span class="line">  total_visitors: true</span><br><span class="line">  total_visitors_icon: user</span><br><span class="line">  total_views: true</span><br><span class="line">  total_views_icon: eye</span><br><span class="line">  post_views: true</span><br><span class="line">  post_views_icon: eye</span><br></pre></td></tr></table></figure>
<h2 id="设置头像"><a href="#设置头像" class="headerlink" title="设置头像"></a>设置头像</h2><p>将头像图片放到 <code>images</code> 文件夹中，然后在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Sidebar Avatar</span><br><span class="line">avatar:</span><br><span class="line">  # Replace the default image and set the url here.</span><br><span class="line">  url: &#x2F;images&#x2F;avatar.png</span><br><span class="line">  # If true, the avatar would be dispalyed in circle.</span><br><span class="line">  rounded: true</span><br><span class="line">  # If true, the avatar would be rotated with the cursor.</span><br><span class="line">  rotated: false</span><br></pre></td></tr></table></figure>

<h2 id="设置社交"><a href="#设置社交" class="headerlink" title="设置社交"></a>设置社交</h2><p>在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">social:</span><br><span class="line">  GitHub: https:&#x2F;&#x2F;github.com&#x2F;Erik-ly || github</span><br><span class="line">  #E-Mail: mailto:Erik_ly@163.com || envelope</span><br><span class="line">  CSDN: https:&#x2F;&#x2F;erik-ly.blog.csdn.net || heartbeat</span><br></pre></td></tr></table></figure>

<p>“||”后面的名称是图标名，图标可以去 <a href="https://fontawesome.com/icons?from=io" target="_blank" rel="noopener">Font Awesome Icon</a> 网站上找，填写相应的名字即可。</p>
<h2 id="设置-Logo"><a href="#设置-Logo" class="headerlink" title="设置 Logo"></a>设置 Logo</h2><p>网站 logo 默认是 “N”,可以自定义，可以将自己的图片放到 <code>images</code> 中，然后在<code>\themes\next\_config.yml</code>中设置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">favicon:</span><br><span class="line">  small: &#x2F;images&#x2F;favicon-16x16-erik-ly.png</span><br><span class="line">  medium: &#x2F;images&#x2F;favicon-32x32-erik-ly.png</span><br><span class="line">  apple_touch_icon: &#x2F;images&#x2F;favicon-32x32-erik-ly.png</span><br><span class="line">  safari_pinned_tab: &#x2F;images&#x2F;favicon-32x32-erik-ly.png</span><br></pre></td></tr></table></figure>

<p>至此，个人博客网站搭建设置完毕，后续增加相应的文章即可。<br>欢迎访问我的个人博客网站：<a href="http://www.erik-ly.com/" target="_blank" rel="noopener">http://www.erik-ly.com/</a> </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>文档 | Hexo<br><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></p>
</li>
<li><p>Hexo教程 - YouTube<br><a href="https://www.youtube.com/watch?v=PsXWbI2Mqu0&amp;list=PLD5dyQmlN6xPqBV0cxO7zAe1C8OmDPqfX&amp;index=7" target="_blank" rel="noopener">https://www.youtube.com/watch?v=PsXWbI2Mqu0&amp;list=PLD5dyQmlN6xPqBV0cxO7zAe1C8OmDPqfX&amp;index=7</a></p>
</li>
<li><p>GitHub+Hexo 搭建个人网站详细教程 - 知乎<br><a href="https://zhuanlan.zhihu.com/p/26625249" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26625249</a></p>
</li>
<li><p>Hexo-NexT配置超炫网页效果 - 简书<br><a href="https://www.jianshu.com/p/9f0e90cc32c2" target="_blank" rel="noopener">https://www.jianshu.com/p/9f0e90cc32c2</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>HiBench 性能测试工具使用方法</title>
    <url>/2020/11/06/HiBench-Introduction/</url>
    <content><![CDATA[<p>本文主要介绍了大数据性能测试工具 HiBench 的基本概念，配置文件，介绍了 Spark 的 Teasort 和 WordCount 性能测试，并提供了测试脚本。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>HiBench是一个大数据基准套件，可帮助评估速度、吞吐量和系统资源利用率方面的不同大数据框架。 它包含一组Hadoop，Spark和streaming测试模式，包括Sort，WordCount，TeraSort，Repartition，Sleep，SQL，PageRank，Nutch indexing，Bayes，Kmeans，NWeight和增强的DFSIO等。它还包含一些用于Spark流的流工作负载 ，Flink，Storm和Gearpump。</p>
<h1 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h1><p>Intel-bigdata/HiBench: HiBench is a big data benchmark suite.<br><a href="https://github.com/Intel-bigdata/HiBench" target="_blank" rel="noopener">https://github.com/Intel-bigdata/HiBench</a> </p>
<h1 id="编译文件"><a href="#编译文件" class="headerlink" title="编译文件"></a>编译文件</h1><p>这里提供编译好的文件，下载地址：<br><a href="https://pan.baidu.com/s/11X_SxFyQLxrT45wm6XMoXg" target="_blank" rel="noopener">https://pan.baidu.com/s/11X_SxFyQLxrT45wm6XMoXg</a><br>提取码：zz75 </p>
<h1 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h1><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104194801.png" alt=""></p>
<ul>
<li>autogen：主要用于生成测试数据的源码目录</li>
<li>bin：测试脚本放置目录</li>
<li>common：公共依赖源码目录</li>
<li>conf：配置文件目录（Hibench/Hadoop/Spark等配置文件存放目录）</li>
<li>docker：HiBench的docker镜像</li>
<li>flinkbench：Flink框架源码目录</li>
<li>gearpumpbench：gearpumpbench框架源码目录</li>
<li>hadoopbench：hadoop框架源码目录</li>
<li>sparkbench：spark框架的源码目录</li>
<li>stormbench：storm框架的源码目录</li>
</ul>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><h2 id="hibench-conf"><a href="#hibench-conf" class="headerlink" title="hibench.conf"></a>hibench.conf</h2><p>主要配置HiBench的运行参数及HiBench各个模块的home环境配置。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104194935.png" alt=""><br>其中需要注意的参数为：</p>
<ul>
<li>hibench.scale.profile：主要配置HiBench测试的数据规模，有tiny, small, large, huge, gigantic 和bigdata六个级别；</li>
<li>hibench.default.map.parallelism：测试MapReduce时是Mapper数量，测试Spark时是分区数；</li>
<li>hibench.default.shuffle.parallelism：测试MapReduce时是Reduce数量测试Spark时是shuffle分区数。</li>
</ul>
<h3 id="数据规模"><a href="#数据规模" class="headerlink" title="数据规模"></a>数据规模</h3><p>数据规模对应的数据量在HiBench-master/conf/workloads/micro目录中设置<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104195049.png" alt=""></p>
<p><strong>dfsioe.conf</strong><br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104195124.png" alt=""></p>
<table>
<thead>
<tr>
<th>数据规模</th>
<th>读文件数</th>
<th>读文件单个大小(MB)</th>
<th>写文件数</th>
<th>写文件单个大小(MB)</th>
</tr>
</thead>
<tbody><tr>
<td>tiny</td>
<td>16</td>
<td>1</td>
<td>16</td>
<td>1</td>
</tr>
<tr>
<td>small</td>
<td>32</td>
<td>10</td>
<td>32</td>
<td>10</td>
</tr>
<tr>
<td>large</td>
<td>64</td>
<td>10</td>
<td>64</td>
<td>10</td>
</tr>
<tr>
<td>huge</td>
<td>256</td>
<td>100</td>
<td>256</td>
<td>100</td>
</tr>
<tr>
<td>gigantic</td>
<td>512</td>
<td>400</td>
<td>512</td>
<td>400</td>
</tr>
<tr>
<td>bigdata</td>
<td>2048</td>
<td>1000</td>
<td>2048</td>
<td>1000</td>
</tr>
</tbody></table>
<p>DFSIOE测试用例通过定义读或写的文件数和文件的大小来指定测试数据量的规模，如果需要自定义测试规模则修改文件数和文件的大小即可，文件大小以MB为单位。</p>
<p><strong>terasort.conf</strong></p>
<p>数据量配置<strong>以条数为单位，每条数据约100byte</strong><br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104195721.png" alt=""><br>比如，定义100G数据，则应设置为100<em>1024</em>1024*1024/100=1073741824<br>设置数据，既可修改原来的数据，也可以自定义数据规模</p>
<p><strong>wordcount.conf</strong><br>数据量配置以byte为单位<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104195756.png" alt=""><br>比如，要设置100G数据量，为100<em>1024</em>1024*1024=107374182400</p>
<h4 id="hadoop-conf-template"><a href="#hadoop-conf-template" class="headerlink" title="hadoop.conf.template"></a>hadoop.conf.template</h4><p>hadoop.conf.template为测试Hadoop时的配置模板，测试Hadoop时需要重命名为hadoop.conf</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp hadoop.conf.template hadoop.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104195852.png" alt=""><br>主要修改hibench.hadoop.home、hibench.hdfs.master和hibench.hadoop.release三个参数，过HDFS启用HA模式，则hibench.hdfs.master设置为HA对应的访问方式。</p>
<h4 id="spark-conf-template"><a href="#spark-conf-template" class="headerlink" title="spark.conf.template"></a>spark.conf.template</h4><p>spark.conf.template为Spark测试时的配置文件，测试Spark时需要重命名为spark.conf</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp spark.conf.template spark.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200012.png" alt=""><br>根据实际情况设置hibench.spark.home，hibench.spark.master为根据spark是standalone模式还是Yarn模式进行设置。当hibench.spark.master为yarn-client时，通过Yarn的ResourceManager的UI界面查看资源信息，然后设置hibench.yarn.executor.num、hibench.yarn.executor.cores、spark.executor.memory、spark.driver.memory进行性能调优。</p>
<h1 id="Spark-性能测试"><a href="#Spark-性能测试" class="headerlink" title="Spark 性能测试"></a>Spark 性能测试</h1><h2 id="Teasort"><a href="#Teasort" class="headerlink" title="Teasort"></a>Teasort</h2><p>这里以最小的数据量 tiny 为例介绍 Spark  的 Teasort 性能测试步骤。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200107.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;</span><br><span class="line">unzip HiBench-master.zip</span><br><span class="line">chmod -R 777 HiBench-master</span><br></pre></td></tr></table></figure>
<p><strong>修改配置文件</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd HiBench-master&#x2F;conf&#x2F;</span><br><span class="line">cp hadoop.conf.template hadoop.conf</span><br><span class="line"></span><br><span class="line">vim hadoop.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200201.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp spark.conf.template spark.conf</span><br><span class="line">vim spark.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200245.png" alt=""></p>
<p><strong>修改数据量</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim hibench.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200314.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd workloads&#x2F;micro&#x2F;</span><br><span class="line">vim terasort.conf</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201114161924.png" alt=""></p>
<p><strong>生成数据</strong></p>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 我的 HiBench 存放目录为：&#x2F;home&#x2F;erik&#x2F;hibench，根据自己情况修改切换路径</span><br><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;terasort&#x2F;prepare</span><br><span class="line">sh prepare.sh</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200420.png" alt=""></p>
<p><strong>查询数据</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls &#x2F;HiBench&#x2F;Terasort&#x2F;Input</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200451.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -du -h &#x2F;HiBench&#x2F;Terasort&#x2F;Input</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200516.png" alt=""></p>
<p><strong>测试性能</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 我的 HiBench 存放目录为：&#x2F;home&#x2F;erik&#x2F;hibench，根据自己情况修改切换路径</span><br><span class="line">su spark</span><br><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;terasort&#x2F;spark</span><br><span class="line">sh run.sh</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200547.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200646.png" alt=""></p>
<p><strong>查看测试报告</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master&#x2F;report</span><br><span class="line">cat hibench.report</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200721.png" alt=""><br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200733.png" alt=""><br>持续时间（s）    吞吐量（b/s）    吞吐量/节点</p>
<h2 id="WordCount"><a href="#WordCount" class="headerlink" title="WordCount"></a>WordCount</h2><p>Spark 的 WordCount 性能测试步骤与 Terasort 步骤类似，都需要修改配置、修改数据量、生成数据、执行测试。</p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>与 Terasort 测试时一样。</p>
<h3 id="修改数据量"><a href="#修改数据量" class="headerlink" title="修改数据量"></a>修改数据量</h3><p>如果需要修改数据量，可以到<code>workloads/micro/wordcount.conf</code> 中修改成自己想要的数据量。</p>
<h3 id="生成数据"><a href="#生成数据" class="headerlink" title="生成数据"></a>生成数据</h3><p>生成 WordCount 的测试数据，需要执在 <code>bin/workloads/micro/wordcount/prepare</code> 目录中执行 <code>sh prepare.sh</code>。</p>
<h3 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h3><p>在 <code>bin/workloads/micro/terasort/spark</code> 目录中执行 <code>sh run.sh</code>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;wordcount&#x2F;spark</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200832.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104200846.png" alt=""></p>
<p>查看报告</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master&#x2F;report</span><br><span class="line">cat hibench.report</span><br></pre></td></tr></table></figure>

<h2 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h2><p>这里提供一键测试脚本，仅供参考，主要测试 Spark 和 MR 的 Trasort 和 WordCount 在不同数据量下的测试，每种数据量执行三次。</p>
<p>需要提前设置好配置文件，主要包括 conf 文件夹的 spark.conf 和 hadoop.conf，以及 <code>conf/workloads/micro/</code>文件夹中的 terasort.conf 和 wordcount.conf 的数据量大小。脚本中的 <code>hibench_home</code> 根据自己的目录位置进行修改。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># HiBench 目录</span><br><span class="line">hibench_home&#x3D;&#x2F;home&#x2F;erik&#x2F;hibench&#x2F;HiBench-master</span><br><span class="line"></span><br><span class="line"># 数据量类型</span><br><span class="line">datasize_type&#x3D;(&quot;tiny&quot; &quot;small&quot; &quot;large&quot; &quot;huge&quot; &quot;gigantic&quot; &quot;bigdata&quot;)</span><br><span class="line">#datasize_type&#x3D;(&quot;tiny&quot;)</span><br><span class="line"></span><br><span class="line">echo &#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Start execute hibench test &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class="line"></span><br><span class="line">for datasize in $&#123;datasize_type[*]&#125;</span><br><span class="line">do</span><br><span class="line">	</span><br><span class="line">	# chance datasize</span><br><span class="line">	echo &#39;Start change datasize ...&#39;</span><br><span class="line">	hibench_conf_path&#x3D;$hibench_home&#x2F;conf&#x2F;hibench.conf</span><br><span class="line">	text&#x3D;&quot;hibench.scale.profile                $datasize&quot;</span><br><span class="line">	sed -i &quot;3c $text&quot; $hibench_conf_path</span><br><span class="line">	</span><br><span class="line">	echo &#39;Start clean teasort data ...&#39;</span><br><span class="line">	hadoop fs -rm -r &#x2F;HiBench&#x2F;Terasort&#x2F;Input</span><br><span class="line"></span><br><span class="line">	echo &#39;Create teasort data ...&#39;</span><br><span class="line">	sh $hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;terasort&#x2F;prepare&#x2F;prepare.sh</span><br><span class="line">	</span><br><span class="line">	echo &#39;Start clean wordcount data ...&#39;</span><br><span class="line">	hadoop fs -rm -r &#x2F;HiBench&#x2F;Wordcount&#x2F;Input</span><br><span class="line"></span><br><span class="line">	echo &#39;Create Wordcount data ...&#39;</span><br><span class="line">	sh $hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;wordcount&#x2F;prepare&#x2F;prepare.sh</span><br><span class="line"></span><br><span class="line">	for j in &#123;1..3&#125;</span><br><span class="line">	do</span><br><span class="line">		echo &#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Start execute hibench datasize: $datasize, time:$j &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class="line">		echo &#39;Run sprak teasort test ...&#39;</span><br><span class="line">		sh &#x2F;$hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;terasort&#x2F;spark&#x2F;run.sh</span><br><span class="line"></span><br><span class="line">		sleep 10</span><br><span class="line">		echo &#39;Run MR teasort test ...&#39;</span><br><span class="line">		sh &#x2F;$hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;terasort&#x2F;hadoop&#x2F;run.sh</span><br><span class="line"></span><br><span class="line">		echo &#39;Run sprak wordcount test ...&#39;</span><br><span class="line">		sh &#x2F;$hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;wordcount&#x2F;spark&#x2F;run.sh</span><br><span class="line"></span><br><span class="line">		sleep 10</span><br><span class="line">		echo &#39;Run MR wordcount test ...&#39;</span><br><span class="line">		sh &#x2F;$hibench_home&#x2F;bin&#x2F;workloads&#x2F;micro&#x2F;wordcount&#x2F;hadoop&#x2F;run.sh</span><br><span class="line">	done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[Hadoop] 使用DFSIO测试集群I/O性能_mryqu_新浪博客<br><a href="http://blog.sina.com.cn/s/blog_72ef7bea0102vr44.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_72ef7bea0102vr44.html</a> </p>
<p>linux下的缓存机制buffer、cache、swap - 运维总结  - 散尽浮华 - 博客园<br><a href="https://www.cnblogs.com/kevingrace/p/5991604.html" target="_blank" rel="noopener">https://www.cnblogs.com/kevingrace/p/5991604.html</a> </p>
<p>TestDFSIO基准测试方法介绍_湖南频道_凤凰网<br><a href="http://hunan.ifeng.com/a/20190613/7496675_0.shtml" target="_blank" rel="noopener">http://hunan.ifeng.com/a/20190613/7496675_0.shtml</a> </p>
<p>如何使用HiBench进行基准测试 - 云+社区 - 腾讯云<br><a href="https://cloud.tencent.com/developer/article/1158310" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1158310</a> </p>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7 安装 MySQL 5.7 详细步骤</title>
    <url>/2019/12/03/Install-MySQL-5-7-on-CentOS-7/</url>
    <content><![CDATA[<p>本文详细介绍了 CentOS 7 系统中安装 MySQL 5.7 的详细步骤，并配置远程连接。</p>
<a id="more"></a>

<h2 id="查看当前安装-MySQL-情况"><a href="#查看当前安装-MySQL-情况" class="headerlink" title="查看当前安装 MySQL 情况"></a>查看当前安装 MySQL 情况</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qa|grep -i mysql</span><br></pre></td></tr></table></figure>

<p>如果有，全部删除所列的内容，直至<code>rpm -qa|grep -i mysql</code>时没有内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -ev mysql-community-libs-5.6.37-2.el7.x86_64</span><br></pre></td></tr></table></figure>
<!-- more -->

<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><ul>
<li><p>下载mysql的repo源</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;repo.mysql.com&#x2F;mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>升级 GPG</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm --import https:&#x2F;&#x2F;repo.mysql.com&#x2F;RPM-GPG-KEY-mysql-2022</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装rpm包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -ivh mysql57-community-release-el7-8.noarch.rpm  --nodeps --force</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装mysql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install mysql-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看状态</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mysqld status</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="重置root密码"><a href="#重置root密码" class="headerlink" title="重置root密码"></a>重置root密码</h2><p>查看默认密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep &#39;temporary password&#39; &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; Enter password: （输入刚才查询到的随机密码）</span><br><span class="line">mysql&gt; SET PASSWORD FOR &#39;root&#39;@&#39;localhost&#39;&#x3D; &quot;Root-123&quot;;</span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure>
<p>用root新密码登录：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -u root -pRoot-123</span><br></pre></td></tr></table></figure>

<h2 id="开启远程访问"><a href="#开启远程访问" class="headerlink" title="开启远程访问"></a>开启远程访问</h2><p>允许使用用户名<code>root</code>密码<code>Root-123456</code>从任何主机连接到mysql服务器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;Root-123456&#39; WITH GRANT OPTION;</span><br><span class="line">mysql&gt;FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt;exit;</span><br></pre></td></tr></table></figure>
<p>开启防火墙 MySQL 3306 端口的外部访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;3306&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><p>CentOS 7.2 安装 MySQL 5.7.13_数据库技术_Linux公社-Linux系统门户网站<br><a href="https://www.linuxidc.com/Linux/2017-03/141300.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2017-03/141300.htm</a></p>
</li>
<li><p>Linux下干净卸载mysql - 简书<br><a href="https://www.jianshu.com/p/3f263c3c3d63" target="_blank" rel="noopener">https://www.jianshu.com/p/3f263c3c3d63</a></p>
</li>
<li><p>centos安装mysql遇到的问题 - 点击领取<br><a href="https://www.dianjilingqu.com/31015.html" target="_blank" rel="noopener">https://www.dianjilingqu.com/31015.html</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>在线协同电子表格 EtherCalc 安装部署详细步骤</title>
    <url>/2019/11/04/EtherCalc-introduction/</url>
    <content><![CDATA[<p>本文详细介绍了在线协作电子表格 EtherCalc 在 CentOS 中的安装配置方法。</p>
<a id="more"></a>

<h1 id="EtherCalc-介绍"><a href="#EtherCalc-介绍" class="headerlink" title="EtherCalc 介绍"></a>EtherCalc 介绍</h1><p>EtherCalc 可以满足多人在线协同编辑表格的需求，安装简单，使用方便。<br>本文主要是介绍在 CentOS 7 中安装 EtherCalc 的详细步骤</p>
<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p>EtherCalc: 多人即时协作电子表格<br><a href="http://cn.ethercalc.net/" target="_blank" rel="noopener">http://cn.ethercalc.net/</a> </p>
<!-- more -->

<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>audreyt/ethercalc: Node.js port of Multi-user SocialCalc<br><a href="https://github.com/audreyt/ethercalc" target="_blank" rel="noopener">https://github.com/audreyt/ethercalc</a> </p>
<h1 id="安装-node-js"><a href="#安装-node-js" class="headerlink" title="安装 node.js"></a>安装 node.js</h1><p>EtherCalc 使用 <code>npm</code>直接安装，所以需要先安装 node.js</p>
<ul>
<li>下载<br>node.js 下载地址：<br>Node.js 中文网：<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">http://nodejs.cn/download/</a></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191105212020245.png" alt=""></p>
<ul>
<li>上传文件<br>创建 node.js 的存放路径</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/app/</span><br><span class="line">mkdir nodejs</span><br></pre></td></tr></table></figure>
<p>然后上传刚下载的文件到 <code>/home/app/nodejs</code>目录中</p>
<ul>
<li>解压</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -xvf node-v10.16.0-linux-x64.tar.xz</span><br></pre></td></tr></table></figure>

<ul>
<li>创建软链接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ln -s /home/app/nodejs/node-v10.16.0-linux-x64/bin/npm /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">ln -s /home/app/nodejs/node-v10.16.0-linux-x64/bin/node /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>

<ul>
<li>查看版本信息<br><img src="https://img-blog.csdnimg.cn/20191105212919381.png" alt=""></li>
</ul>
<h1 id="安装-EtherCalc"><a href="#安装-EtherCalc" class="headerlink" title="安装 EtherCalc"></a>安装 EtherCalc</h1><ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g ethercalc</span><br></pre></td></tr></table></figure>

<p>创建软连接</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ln -s /home/app/nodejs/node-v10.16.0-linux-x64/bin/ethercalc /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>

<ul>
<li>启动<br>创建启动脚本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/app/</span><br><span class="line">mkdir ethercalc</span><br><span class="line">vim start_ethercalc.sh</span><br></pre></td></tr></table></figure>

<p>在 shell 脚本中加入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nohup ethercalc &gt; /home/app/ethercalc/ethercalc.log &amp;</span><br></pre></td></tr></table></figure>

<p>设置权限并启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod 777 start_ethercalc.sh</span><br><span class="line">./start_ethercalc.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>Web 页面<br>启动后可以在 web 页面中查看，网址为：<a href="http://yourIP:8000/" target="_blank" rel="noopener">http://yourIP:8000/</a></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20191105213456996.png" alt=""><br>点击“Create Spreadsheet”即可创建在线表格。</p>
<p><img src="https://img-blog.csdnimg.cn/20191203210335588.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="数据信息"><a href="#数据信息" class="headerlink" title="数据信息"></a>数据信息</h1><p>表格数据信息存放在<code>ethercalc/dump</code>目录中。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>在Linux系统安装Nodejs 最简单步骤 - liuqiceshi - 博客园<br><a href="https://www.cnblogs.com/liuqi/p/6483317.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuqi/p/6483317.html</a> </p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>EtherCalc</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows 安装 MySQL 5.7详细步骤</title>
    <url>/2019/12/03/Install-MySQL-5-7-on-Windows/</url>
    <content><![CDATA[<p>本文主要介绍了 Windows 系统中安装 MySQL 5.7 的详细步骤，以及环境变量配置和文件配置。</p>
<a id="more"></a>

<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>MySQL :: Download MySQL Community Server (Archived Versions)<br><a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener">https://downloads.mysql.com/archives/community/</a><br>选择 5.7.* 版本，然后选择 zip 文件进行下载</p>
<!-- more -->

<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><p>将下载的文件解压到自己安装软件的目录，我这里是<code>C:\Software\mysql-5.7.28</code><br><img src="https://img-blog.csdnimg.cn/20191203215208716.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><p>依次点击 此电脑 — 属性 — 高级系统设置 — 环境变量，然后新建系统变量<br><img src="https://img-blog.csdnimg.cn/20191203215603211.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MYSQL_HOME</span><br><span class="line">C:\Software\mysql-5.7.28</span><br></pre></td></tr></table></figure>
<p>在 “Path”变量中添加<code>%MYSQL_HOME%\bin</code><br><img src="https://img-blog.csdnimg.cn/20191203215746366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="创建数据目录"><a href="#创建数据目录" class="headerlink" title="创建数据目录"></a>创建数据目录</h2><p>在<code>C:\Software\mysql-5.7.28\</code>目录中分别创建<code>data</code>和<code>uploads</code>文件夹，分别存放MySQL数据和导入导出文件。<br><img src="https://img-blog.csdnimg.cn/20191203220151594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>在<code>C:\Software\mysql-5.7.28\</code>目录中创建<code>my.ini</code>文件，涉及到目录文件的跟进自己情况做修改。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">character_set_server=utf8</span><br><span class="line">basedir=C:\Software\mysql-5.7.28</span><br><span class="line">datadir=C:\Software\mysql-5.7.28\data</span><br><span class="line">server-id=1</span><br><span class="line">sql_mode=NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span>-error   = error.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = slow.log</span><br><span class="line">long_query_time = 5</span><br><span class="line"><span class="built_in">log</span>-bin = binlog</span><br><span class="line">binlog_format = row</span><br><span class="line">expire_logs_days = 15</span><br><span class="line">log_bin_trust_function_creators = 1</span><br><span class="line">secure-file-priv=C:\Software\mysql-5.7.28\uploads</span><br><span class="line"></span><br><span class="line">[client]   </span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure>
<p>整体目录结构为<br><img src="https://img-blog.csdnimg.cn/20191203220433705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><p>以管理员的身份运行 CMD<br><img src="https://img-blog.csdnimg.cn/20191203220552315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""><br>切换到 MySQL 的HOME 目录，然后执行<code>mysqld --initialize-insecure</code><br><img src="https://img-blog.csdnimg.cn/2019120322090666.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> c:\Software\mysql-5.7.28</span><br><span class="line">mysqld --initialize-insecure</span><br></pre></td></tr></table></figure>
<h2 id="安装并启动"><a href="#安装并启动" class="headerlink" title="安装并启动"></a>安装并启动</h2><p>切换到<code>bin</code>目录中，执行<code>mysqld –install MySQL57</code>安装，然后再执行<code>net start MySQL57</code>启动 MySQL<br><img src="https://img-blog.csdnimg.cn/20191203221147764.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> bin</span><br><span class="line">mysqld –install MySQL57</span><br><span class="line">net start MySQL57</span><br></pre></td></tr></table></figure>

<h2 id="设置登录密码"><a href="#设置登录密码" class="headerlink" title="设置登录密码"></a>设置登录密码</h2><p>先使用<code>mysql -uroot</code>登录 MySQL<br><img src="https://img-blog.csdnimg.cn/20191203221340429.png" alt=""><br>设置本地登录密码为“Root-123”和远程登录密码“Root-123456”<br><img src="https://img-blog.csdnimg.cn/20191203221547471.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -uroot</span><br><span class="line">SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span>= <span class="string">"Root-123"</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'Root-123456'</span> WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>Windows安装MySQL5.7教程 - 简书<br><a href="https://www.jianshu.com/p/a41d45890ab2" target="_blank" rel="noopener">https://www.jianshu.com/p/a41d45890ab2</a></p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>IDEA 常用快捷键和设置</title>
    <url>/2019/11/25/Idea-common-shortcuts-and-settings/</url>
    <content><![CDATA[<p>本文主要介绍 IDEA 的常用快捷键、常用配置以及常用的插件。</p>
<a id="more"></a>

<h1 id="IDEA-常用快捷键"><a href="#IDEA-常用快捷键" class="headerlink" title="IDEA 常用快捷键"></a>IDEA 常用快捷键</h1><ul>
<li>alt + Insert ：生成 get/set 方法</li>
<li>Ctrl + Alt + t ：    使用 try/catch </li>
<li>Ctrl+Alt+Left/Right ：光标定位到上一个/下一个浏览位置处</li>
<li>Ctrl+Shift+Backspace：光标定位到上次修改的地方</li>
<li>Ctrl+Alt+L：格式化代码</li>
<li>Ctrl+Alt+O：去除未使用的 import 包或类</li>
<li>Ctrl+ +/-：当前方法展开、折叠</li>
<li>Ctrl+Shift+ +/-：全部方法展开、折叠</li>
<li>Ctrl + D：复制当前行到下一行</li>
</ul>
<h1 id="IDEA-常用设置"><a href="#IDEA-常用设置" class="headerlink" title="IDEA 常用设置"></a>IDEA 常用设置</h1><h2 id="设置字体大小"><a href="#设置字体大小" class="headerlink" title="设置字体大小"></a>设置字体大小</h2><p><img src="https://img-blog.csdnimg.cn/20191125212156656.png" alt=""><br><img src="https://img-blog.csdnimg.cn/20191125212209817.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="取消默认打开项目"><a href="#取消默认打开项目" class="headerlink" title="取消默认打开项目"></a>取消默认打开项目</h2><p><img src="https://img-blog.csdnimg.cn/20191125212249153.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="设置头文件"><a href="#设置头文件" class="headerlink" title="设置头文件"></a>设置头文件</h2><p><img src="https://img-blog.csdnimg.cn/2019112521252345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date $&#123;DATE&#125;</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="设置内存大小"><a href="#设置内存大小" class="headerlink" title="设置内存大小"></a>设置内存大小</h2><p>我现在了解到的情况是，修改 IDEA 的默认内存大小方式有两种，一种是通过设置<code>Edit Custom VM Options</code>，另一种是通过修改安装目录中<code>bin</code>文件夹下的<code>idea64.exe.vmoptions</code>或<code>idea.exe.vmoptions</code>，这个根据是否是64位选择。两种方式修改的内容都是一样的。<br><strong>如果设置过<code>Edit Custom VM Options</code>，再设置<code>bin</code>文件夹下的<code>idea64.exe.vmoptions</code>或<code>idea.exe.vmoptions</code>是无效的。</strong></p>
<ul>
<li>修改<code>idea64.exe.vmoptions</code><br><code>idea64.exe.vmoptions</code>或<code>idea.exe.vmoptions</code>存放位置<br><img src="https://img-blog.csdnimg.cn/20191201100900181.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></li>
</ul>
<ul>
<li>设置<code>Edit Custom VM Options</code><br>依次点击<code>Help</code> — <code>Edit Custom VM Options</code>，然后按提示点击确认即可。<br>通过<code>Edit Custom VM Options</code>实际上也是生成一个<code>idea64.exe.vmoptions</code>，我的这个文件存放位置是<code>C:\Users\Erik\.IntelliJIdea2019.1\config\idea64.exe.vmoptions</code>。<br><img src="https://img-blog.csdnimg.cn/20191201095304868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""><br>具体修改内容<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># custom IntelliJ IDEA VM options</span><br><span class="line"></span><br><span class="line">-Xms1024m</span><br><span class="line">-Xmx2048m</span><br><span class="line">-XX:ReservedCodeCacheSize&#x3D;1024m</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:SoftRefLRUPolicyMSPerMB&#x3D;50</span><br><span class="line">-ea</span><br><span class="line">-Dsun.io.useCanonCaches&#x3D;false</span><br><span class="line">-Djava.net.preferIPv4Stack&#x3D;true</span><br><span class="line">-Djdk.http.auth.tunneling.disabledSchemes&#x3D;&quot;&quot;</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:-OmitStackTraceInFastThrow</span><br></pre></td></tr></table></figure>
只修改</li>
<li><code>-Xms1024m</code>，最小内存</li>
<li><code>-Xmx2048m</code>,最大内存</li>
<li><code>-XX:ReservedCodeCacheSize=1024m</code>，预留代码缓存的大小</li>
</ul>
<p>设置保存，重启 IDEA 生效。</p>
<p>设置在 IDEA 右下角显示内存使用情况<br><img src="https://img-blog.csdnimg.cn/2019120110215481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="字体滚轮放大缩小"><a href="#字体滚轮放大缩小" class="headerlink" title="字体滚轮放大缩小"></a>字体滚轮放大缩小</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/20210614171454.png" alt=""><br>设置后，可以按住 Ctrl 键，使用鼠标滚轮放大缩小字体。</p>
<h1 id="IDEA-常用插件"><a href="#IDEA-常用插件" class="headerlink" title="IDEA 常用插件"></a>IDEA 常用插件</h1><h2 id="Alibaba-Java-Coding-Guidelines"><a href="#Alibaba-Java-Coding-Guidelines" class="headerlink" title="Alibaba Java Coding Guidelines"></a>Alibaba Java Coding Guidelines</h2><p>Alibaba Java Coding Guidelines 插件由阿里巴巴 P3C 项目组研发的代码检测插件，可针对语法做出修改建议。<br><img src="https://img-blog.csdnimg.cn/20191201102814833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="ignore"><a href="#ignore" class="headerlink" title=".ignore"></a>.ignore</h2><p>.ignore 可以生成各种 .gitignore 文件<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/20210614171204.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/20210614171911.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/20210614172000.png" alt=""></p>
<h2 id="GitToolBox"><a href="#GitToolBox" class="headerlink" title="GitToolBox"></a>GitToolBox</h2><p>GitToolBox 可以在代码里显示每一行的提交记录，包括提交者，日期，commit 信息。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/20210614172714.png" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>IntelliJ IDEA修改内存大小,使得idea运行更流畅_java_脚本之家<br><a href="https://www.jb51.net/article/149273.htm" target="_blank" rel="noopener">https://www.jb51.net/article/149273.htm</a></li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7 设置 MySQL 主备同步</title>
    <url>/2021/06/16/MySQL-master-and-slave-synchronization/</url>
    <content><![CDATA[<p>本文主要介绍在 MySQL 的主备同步设置方法。</p>
<a id="more"></a>

<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><ul>
<li><p>Linux：Centos 7</p>
</li>
<li><p>MySQL：5.7</p>
</li>
<li><p>主节点：192.168.210.18</p>
</li>
<li><p>备节点：192.168.210.19</p>
</li>
<li><p>主备节点 MySQL 均支持远程登录</p>
</li>
<li><p>MySQL 安装设置详见： <a href="http://www.erik-ly.com/2019/12/03/Install-MySQL-5-7-on-CentOS-7/" target="_blank" rel="noopener">CentOS 7 安装 MySQL 5.7 详细步骤</a></p>
</li>
</ul>
<h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><ul>
<li>主节点</li>
</ul>
<p>备份配置文件，并添加要同步的数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/</span><br><span class="line">cp my.cnf my.cnf.bak</span><br></pre></td></tr></table></figure>

<p>在 <code>my.cnf</code> 中添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sync</span><br><span class="line">server-id&#x3D;1	# 服务器 ID，要唯一</span><br><span class="line">log-bin&#x3D;master-bin</span><br><span class="line">log_bin_index &#x3D;master-bin.index</span><br><span class="line">binlog_do_db&#x3D;mindoc_db # mindoc_db 是要同步的数据库的名称，后面验证数据同步时，就是同步该库的数据</span><br><span class="line">user&#x3D;mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>备节点</li>
</ul>
<p>同样备份配置文件，</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/</span><br><span class="line">cp my.cnf my.cnf.bak</span><br></pre></td></tr></table></figure>

<p>在 <code>my.cnf</code> 中添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sync</span><br><span class="line">server-id&#x3D;2 # 服务ID</span><br><span class="line">log-bin&#x3D;salve-bin</span><br><span class="line">relay-log &#x3D;slave-relay-bin</span><br><span class="line">relay-log-index&#x3D;slave-relay-bin.index</span><br></pre></td></tr></table></figure>

<h1 id="创建同步数据账户"><a href="#创建同步数据账户" class="headerlink" title="创建同步数据账户"></a>创建同步数据账户</h1><ul>
<li>主节点</li>
</ul>
<p>创建用于数据同步的用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录 MySQL</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create user <span class="string">'sync'</span>@<span class="string">'10.180.210.19'</span> identified by <span class="string">'Sync-123456'</span>; <span class="comment"># 创建用户 sync，设置密码 Sync-123456，并允许备库 10.180.210.19 登录</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges; <span class="comment"># 刷新权限</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant replication slave on *.* to <span class="string">'sync'</span>@<span class="string">'10.180.210.19'</span> identified by <span class="string">'Sync-123456'</span> with grant option; <span class="comment"># 赋予用户 sync 进行 replication slave 到备库 10.180.210.19 的权限</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询 master 状态</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show master status;</span></span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| master-bin.000001 |   121040 | mindoc_db    | mysql            |                   |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="设置主库信息"><a href="#设置主库信息" class="headerlink" title="设置主库信息"></a>设置主库信息</h1><ul>
<li>备节点</li>
</ul>
<p>在备节点上设置主库信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> change master to master_host=<span class="string">'10.180.249.18'</span>, master_port=3306, master_user=<span class="string">'sync'</span>, master_password=<span class="string">'Sync-123456'</span>, master_log_file=<span class="string">'master-bin.000001'</span>, master_log_pos=121040;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询 slave 状态</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/06/image-20210616170441065.png" alt="image-20210616170441065"></p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>在主节点的数据库中添加数据，观察备节点是否能同步，如果能同步，则主备同步设置成功。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>centos7 mysql主备模式（读写分离） - 丶鹏 - 博客园：<a href="https://www.cnblogs.com/high520/p/13546338.html" target="_blank" rel="noopener">https://www.cnblogs.com/high520/p/13546338.html</a></li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Kerberos 配置及基本操作</title>
    <url>/2021/10/11/Kerberos-configuration-and-use/</url>
    <content><![CDATA[<p>本文主要介绍了 Kerberos 的单机模式和主备模式的配置方式，以及一些常用的操作命令。</p>
<a id="more"></a>

<h1 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h1><h2 id="集群信息"><a href="#集群信息" class="headerlink" title="集群信息"></a>集群信息</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">10.180.249.80 manager80.bigdata</span><br><span class="line">10.180.249.81 master81.bigdata</span><br><span class="line">10.180.249.82 worker82.bigdata</span><br></pre></td></tr></table></figure>

<h2 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# cat /etc/*-release</span><br><span class="line">CentOS Linux release 7.4.1708 (Core) </span><br><span class="line">NAME="CentOS Linux"</span><br><span class="line">VERSION="7 (Core)"</span><br><span class="line">ID="centos"</span><br><span class="line">ID_LIKE="rhel fedora"</span><br><span class="line">VERSION_ID="7"</span><br><span class="line">PRETTY_NAME="CentOS Linux 7 (Core)"</span><br><span class="line">ANSI_COLOR="0;31"</span><br><span class="line">CPE_NAME="cpe:/o:centos:centos:7"</span><br><span class="line">HOME_URL="https://www.centos.org/"</span><br><span class="line">BUG_REPORT_URL="https://bugs.centos.org/"</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT="CentOS-7"</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION="7"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT="centos"</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION="7"</span><br><span class="line"></span><br><span class="line">CentOS Linux release 7.4.1708 (Core) </span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure>

<h2 id="KDC-节点"><a href="#KDC-节点" class="headerlink" title="KDC 节点"></a>KDC 节点</h2><p>KDC 主节点：manager80.bigdata<br>KDC 备节点：master81.bigdata</p>
<p>单机模式只有 KDC 主节点，主备模式有 KDC 主节点和 KDC 备节点。</p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="Principal"><a href="#Principal" class="headerlink" title="Principal"></a>Principal</h2><p>认证的主体，可以认为等效于用户名。</p>
<p>principal 的名称格式为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">name&#x2F;role@realm</span><br></pre></td></tr></table></figure>



<h2 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h2><p>类似于编程语言中的 namespace，一个 realm 包含多个 principal，一个 principal 属于一个特定的 realm。</p>
<h2 id="Keytab"><a href="#Keytab" class="headerlink" title="Keytab"></a>Keytab</h2><p>二进制文件，包含了 principal 和加密的 principal 秘钥信息，可以用来认证 principal。</p>
<h2 id="Kadmin"><a href="#Kadmin" class="headerlink" title="Kadmin"></a>Kadmin</h2><p>kadmin 即 Kerberos administration server，运行在主 Kerberos 节点，负责存储 KDC 数据库，管理 principal 信息。</p>
<h1 id="单机模式配置"><a href="#单机模式配置" class="headerlink" title="单机模式配置"></a>单机模式配置</h1><p>单机模式安装在 KDC 主节点：manager80.bigdata，以下简称 KDC 节点。</p>
<h2 id="安装-Kerberos-服务"><a href="#安装-Kerberos-服务" class="headerlink" title="安装 Kerberos 服务"></a>安装 Kerberos 服务</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install krb5-server krb5-libs krb5-workstation</span><br></pre></td></tr></table></figure>



<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><h3 id="krb5-conf"><a href="#krb5-conf" class="headerlink" title="krb5.conf"></a>krb5.conf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/krb5.conf</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">includedir /etc/krb5.conf.d/</span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line">  default = FILE:/var/<span class="built_in">log</span>/krb5kdc.log</span><br><span class="line">  admin_server = FILE:/var/<span class="built_in">log</span>/kadmind.log</span><br><span class="line">  kdc = FILE:/var/<span class="built_in">log</span>/krb5kdc.log</span><br><span class="line"></span><br><span class="line">[libdefaults]</span><br><span class="line">  default_realm = BIGDATA</span><br><span class="line">  ticket_lifetime = 1d</span><br><span class="line">  renew_lifetime = 7d</span><br><span class="line">  forwardable = <span class="literal">true</span></span><br><span class="line">  dns_lookup_realm = <span class="literal">false</span></span><br><span class="line">  dns_lookup_kdc = <span class="literal">false</span></span><br><span class="line">  default_ccache_name = /tmp/krb5cc_%&#123;uid&#125;</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line"> BIGDATA = &#123;</span><br><span class="line">    admin_server = manager80.bigdata</span><br><span class="line">    kdc = manager80.bigdata</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong> <code>admin_server = manager80.bigdata</code> 和 <code>kdc = manager80.bigdata</code> 要换成对应的 KDC 节点 hostname</p>
<p>配置说明</p>
<p>[logging]：日志配置模块。</p>
<p>[libdefaults]：Kerberos 库使用设置。</p>
<ul>
<li>default_realm：默认安全域。</li>
<li>ticket_lifetime：设置初始票证请求的默认生命周期。 默认值为 1 天。</li>
<li>renew_lifetime：为初始票证请求设置默认的可更新生命周期。 默认值为 0。</li>
<li>forwardable：如果此标志为 true，则默认情况下，如果 KDC 允许，初始票证将是可转发的。 默认值为 false。</li>
<li>dns_lookup_realm、dns_lookup_kdc：通过 DNS 查找 realm 或 kdc。</li>
<li>default_ccache_name：默认票据缓存名称。</li>
</ul>
<p>[realms]：安全域相关设置</p>
<ul>
<li>admin_server：主 KDC 服务器，必须设置。</li>
<li>kdc：运行 KDC 的主机，可加端口号。</li>
</ul>
<p>官方配置说明：krb5.conf — MIT Kerberos Documentation<br><a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/krb5_conf.html" target="_blank" rel="noopener">http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/krb5_conf.html</a></p>
<h3 id="kdc-conf"><a href="#kdc-conf" class="headerlink" title="kdc.conf"></a>kdc.conf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/kerberos/krb5kdc/kdc.conf</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[kdcdefaults]</span><br><span class="line"> kdc_ports = 88</span><br><span class="line"> kdc_tcp_ports = 88</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line">BIGDATA = &#123;</span><br><span class="line">  acl_file = /var/kerberos/krb5kdc/kadm5.acl</span><br><span class="line">  dict_file = /usr/share/dict/words</span><br><span class="line">  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab</span><br><span class="line">  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal</span><br><span class="line">  max_life = 1d</span><br><span class="line">  max_renewable_life = 7d </span><br><span class="line">  default_principal_flags = +renewable, +forwardable</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>配置说明：</p>
<p>[kdcdefaults]：KDC 默认值</p>
<ul>
<li>kdc_ports：KDC UDP 默认端口 88。</li>
<li>kdc_tcp_ports：KDC tpc 默认端口 88。</li>
</ul>
<p>[realms]：安全域相关设置</p>
<ul>
<li>acl_file：访问控制列表文件。</li>
<li>dict_file：包含不允许作为密码的字符串的字典文件的位置。</li>
<li>admin_keytab：admin keytab 文件位置。</li>
<li>supported_enctypes：支持的加密算法类型。</li>
<li>max_life：票证生命周期，定义了票据的有效期。默认值为24小时。</li>
<li>max_renewable_life：票据可再生周期，票据超过有效期后可以更新票据以延长票据的使用周期。默认为 0 。</li>
<li>default_principal_flags：默认认证主体的标志。启用标注前有“+”，禁用标志前有“-”。+renewable 允许 principal 获得可更新的票据。+forwardable 允许 principal 获得可转发的票据。</li>
</ul>
<p>官方配置说明：kdc.conf — MIT Kerberos Documentation<br><a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/kdc_conf.html" target="_blank" rel="noopener">http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/kdc_conf.html</a></p>
<h3 id="kadm5-acl"><a href="#kadm5-acl" class="headerlink" title="kadm5.acl"></a>kadm5.acl</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/kerberos/krb5kdc/kadm5.acl</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*/admin@BIGDATA *</span><br></pre></td></tr></table></figure>

<p>ACL 文件用于控制 kadmin数据库的访问权限，以及哪些 principal 可以操作其他的 principal。  </p>
<p>设置为 <code>*/admin@BIGDATA *</code> 表示所有后缀为 /admin@BIGDATA 的 principal 具有所有权限，充当管理员角色。  </p>
<p>官方配置说明：kadm5.acl — MIT Kerberos Documentation<br><a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/kadm5_acl.html" target="_blank" rel="noopener">http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/kadm5_acl.html</a></p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kdb5_util create -s -r BIGDATA</span><br><span class="line">Loading random data</span><br><span class="line">Initializing database '/var/kerberos/krb5kdc/principal' for realm 'BIGDATA',</span><br><span class="line">master key name 'K/M@BIGDATA'</span><br><span class="line">You will be prompted for the database Master Password.</span><br><span class="line">It is important that you NOT FORGET this password.</span><br><span class="line">Enter KDC database master key: -- 输入密码，可与 MySQL 数据库密码相同</span><br><span class="line">Re-enter KDC database master key to verify: -- 再次输入密码</span><br></pre></td></tr></table></figure>

<p>检查生成的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# cd /var/kerberos/krb5kdc/</span><br><span class="line">[root@manager80 krb5kdc]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-------. 1 root root   18 Sep 28 14:02 kadm5.acl</span><br><span class="line">-rw-------. 1 root root  478 Sep 28 14:01 kdc.conf</span><br><span class="line">-rw-------. 1 root root 8192 Sep 28 14:06 principal</span><br><span class="line">-rw-------. 1 root root 8192 Sep 28 14:06 principal.kadm5</span><br><span class="line">-rw-------. 1 root root    0 Sep 28 14:06 principal.kadm5.lock</span><br><span class="line">-rw-------. 1 root root    0 Sep 28 14:06 principal.ok</span><br></pre></td></tr></table></figure>



<h2 id="创建-KDC-超级管理员"><a href="#创建-KDC-超级管理员" class="headerlink" title="创建 KDC 超级管理员"></a>创建 KDC 超级管理员</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 krb5kdc]# kadmin.local -q "addprinc admin/admin@BIGDATA"</span><br><span class="line">Authenticating as principal root/admin@BIGDATA with password.</span><br><span class="line">WARNING: no policy specified for admin/admin@BIGDATA; defaulting to no policy</span><br><span class="line">Enter password for principal "admin/admin@BIGDATA":  -- 输入密码，可与 root 密码一致</span><br><span class="line">Re-enter password for principal "admin/admin@BIGDATA":  -- 再次输入密码</span><br><span class="line">Principal "admin/admin@BIGDATA" created.</span><br></pre></td></tr></table></figure>


<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start krb5kdc.service</span><br><span class="line">systemctl start kadmin.service</span><br></pre></td></tr></table></figure>

<p>正常情况下，没有任何输出</p>
<p>设置开机自启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable krb5kdc.service </span><br><span class="line">systemctl enable kadmin.service</span><br></pre></td></tr></table></figure>

<p>查看启动状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status krb5kdc.service</span><br><span class="line">systemctl status kadmin.service</span><br></pre></td></tr></table></figure>

<p>查看开机自启状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl is-enabled krb5kdc.service</span><br><span class="line">systemctl is-enabled kadmin.service</span><br></pre></td></tr></table></figure>

<p>以上操作命令及正常输出为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 krb5kdc]# systemctl start krb5kdc.service</span><br><span class="line">[root@manager80 krb5kdc]# systemctl start kadmin.service</span><br><span class="line">[root@manager80 krb5kdc]# systemctl enable krb5kdc.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/krb5kdc.service to /usr/lib/systemd/system/krb5kdc.service.</span><br><span class="line">[root@manager80 krb5kdc]# systemctl enable kadmin.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kadmin.service to /usr/lib/systemd/system/kadmin.service.</span><br><span class="line">[root@manager80 krb5kdc]# systemctl is-enabled krb5kdc.service</span><br><span class="line">enabled</span><br><span class="line">[root@manager80 krb5kdc]# systemctl is-enabled kadmin.service</span><br><span class="line">enabled</span><br><span class="line">[root@manager80 krb5kdc]#</span><br></pre></td></tr></table></figure>



<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>简单测试下是否可用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 krb5kdc]# kinit admin/admin</span><br><span class="line">Password for admin/admin@BIGDATA: </span><br><span class="line">[root@manager80 krb5kdc]# klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_0</span><br><span class="line">Default principal: admin/admin@BIGDATA</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">09/28/2021 14:21:34  09/29/2021 14:21:34  krbtgt/BIGDATA@BIGDATA</span><br><span class="line">	renew until 10/05/2021 14:21:34</span><br></pre></td></tr></table></figure>



<h2 id="服务端口"><a href="#服务端口" class="headerlink" title="服务端口"></a>服务端口</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# netstat -ntlp | grep kdc</span><br><span class="line">tcp        0      0 0.0.0.0:88              0.0.0.0:*               LISTEN      1338/krb5kdc        </span><br><span class="line">tcp6       0      0 :::88                   :::*                    LISTEN      1338/krb5kdc        </span><br><span class="line">[root@manager ~]# </span><br><span class="line">[root@manager ~]# netstat -ntlp | grep kadmin</span><br><span class="line">tcp        0      0 0.0.0.0:749             0.0.0.0:*               LISTEN      1498/kadmind        </span><br><span class="line">tcp        0      0 0.0.0.0:464             0.0.0.0:*               LISTEN      1498/kadmind        </span><br><span class="line">tcp6       0      0 :::749                  :::*                    LISTEN      1498/kadmind        </span><br><span class="line">tcp6       0      0 :::464                  :::*                    LISTEN      1498/kadmind</span><br></pre></td></tr></table></figure>



<h1 id="主备模式配置"><a href="#主备模式配置" class="headerlink" title="主备模式配置"></a>主备模式配置</h1><p>KDC 主节点：manager80.bigdata<br>KDC 备节点：master81.bigdata</p>
<h2 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h2><p><strong>在 KDC 主节点：manager80.bigdata 和 KDC 备节点：master81.bigdata 都要执行</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install krb5-server krb5-libs krb5-workstation</span><br></pre></td></tr></table></figure>



<h2 id="修改配置-1"><a href="#修改配置-1" class="headerlink" title="修改配置"></a>修改配置</h2><p><strong>以下修改配置操作都在 KDC 主节点：manager80.bigdata 执行</strong></p>
<h3 id="krb5-conf-1"><a href="#krb5-conf-1" class="headerlink" title="krb5.conf"></a>krb5.conf</h3><p>修改 <code>krb5.conf</code> </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/krb5.conf</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">includedir /etc/krb5.conf.d/</span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line">  default = FILE:/var/<span class="built_in">log</span>/krb5kdc.log</span><br><span class="line">  admin_server = FILE:/var/<span class="built_in">log</span>/kadmind.log</span><br><span class="line">  kdc = FILE:/var/<span class="built_in">log</span>/krb5kdc.log</span><br><span class="line"></span><br><span class="line">[libdefaults]</span><br><span class="line">  default_realm = BIGDATA</span><br><span class="line">  ticket_lifetime = 1d</span><br><span class="line">  renew_lifetime = 7d</span><br><span class="line">  forwardable = <span class="literal">true</span></span><br><span class="line">  dns_lookup_realm = <span class="literal">false</span></span><br><span class="line">  dns_lookup_kdc = <span class="literal">false</span></span><br><span class="line">  default_ccache_name = /tmp/krb5cc_%&#123;uid&#125;</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line"> BIGDATA = &#123;</span><br><span class="line">    admin_server = manager80.bigdata</span><br><span class="line">    kdc = manager80.bigdata</span><br><span class="line">    kdc = master81.bigdata</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong> <code>admin_server = manager80.bigdata</code> 、 <code>kdc = manager80.bigdata</code> 和 <code>kdc = master81.bigdata</code> 要换成对应的 KDC 主节点和备节点的 hostname，而且主的 hostname 在前，备的 hostname 在后。</p>
<h3 id="kdc-conf-1"><a href="#kdc-conf-1" class="headerlink" title="kdc.conf"></a>kdc.conf</h3><p>修改 <code>kdc.conf</code> </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/kerberos/krb5kdc/kdc.conf</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[kdcdefaults]</span><br><span class="line"> kdc_ports = 88</span><br><span class="line"> kdc_tcp_ports = 88</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line">BIGDATA = &#123;</span><br><span class="line">  acl_file = /var/kerberos/krb5kdc/kadm5.acl</span><br><span class="line">  dict_file = /usr/share/dict/words</span><br><span class="line">  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab</span><br><span class="line">  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal</span><br><span class="line">  max_life = 1d</span><br><span class="line">  max_renewable_life = 7d </span><br><span class="line">  default_principal_flags = +renewable, +forwardable</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="kadm5-acl-1"><a href="#kadm5-acl-1" class="headerlink" title="kadm5.acl"></a>kadm5.acl</h3><p>修改 <code>kadm5.acl</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/kerberos/krb5kdc/kadm5.acl</span><br></pre></td></tr></table></figure>

<p>完整内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*/admin@BIGDATA *</span><br></pre></td></tr></table></figure>



<h3 id="复制配置文件"><a href="#复制配置文件" class="headerlink" title="复制配置文件"></a>复制配置文件</h3><p>将上述修改的 KDC 主节点的配置复制到 KDC 备节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp /etc/krb5.conf root@master81.bigdata:/etc/</span><br><span class="line">scp /var/kerberos/krb5kdc/kdc.conf  root@master81.bigdata:/var/kerberos/krb5kdc/</span><br><span class="line">scp /var/kerberos/krb5kdc/kadm5.acl root@master81.bigdata:/var/kerberos/krb5kdc/</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> <code>master81.bigdata</code> 要换成对应的 KDC 备节点的 hostname。</p>
<h2 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h2><p><strong>在 KDC 主节点：manager80.bigdata 和 KDC 备节点：master81.bigdata 都要执行</strong>，数据库密码要一样。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kdb5_util create -s -r BIGDATA</span><br><span class="line">Loading random data</span><br><span class="line">Initializing database '/var/kerberos/krb5kdc/principal' for realm 'BIGDATA',</span><br><span class="line">master key name 'K/M@BIGDATA'</span><br><span class="line">You will be prompted for the database Master Password.</span><br><span class="line">It is important that you NOT FORGET this password.</span><br><span class="line">Enter KDC database master key: -- 输入密码</span><br><span class="line">Re-enter KDC database master key to verify: -- 再次输入密码</span><br></pre></td></tr></table></figure>


<p>查看生成的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# cd /var/kerberos/krb5kdc/</span><br><span class="line">[root@manager80 krb5kdc]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-------. 1 root root   18 Oct  3 14:27 kadm5.acl</span><br><span class="line">-rw-------. 1 root root  512 Oct  3 14:26 kdc.conf</span><br><span class="line">-rw-------. 1 root root 8192 Oct  3 14:38 principal</span><br><span class="line">-rw-------. 1 root root 8192 Oct  3 14:38 principal.kadm5</span><br><span class="line">-rw-------. 1 root root    0 Oct  3 14:38 principal.kadm5.lock</span><br><span class="line">-rw-------. 1 root root    0 Oct  3 14:38 principal.ok</span><br></pre></td></tr></table></figure>



<p>也可以直接使用 <code>-P</code> 加密码的方式创建数据库。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master81 ~]# kdb5_util create -s -r BIGDATA -P Bigdata123</span><br><span class="line">Loading random data</span><br><span class="line">Initializing database '/var/kerberos/krb5kdc/principal' for realm 'BIGDATA',</span><br><span class="line">master key name 'K/M@BIGDATA'</span><br></pre></td></tr></table></figure>

<p>此命令中 <code>Bigdata123</code> 为密码。</p>
<p>查看 KDC 备节点生成的文件。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master81 ~]# cd /var/kerberos/krb5kdc/</span><br><span class="line">[root@master81 krb5kdc]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-------. 1 root root   18 Oct  3 14:32 kadm5.acl</span><br><span class="line">-rw-------. 1 root root  512 Oct  3 14:32 kdc.conf</span><br><span class="line">-rw-------. 1 root root 8192 Oct  3 14:41 principal</span><br><span class="line">-rw-------. 1 root root 8192 Oct  3 14:41 principal.kadm5</span><br><span class="line">-rw-------. 1 root root    0 Oct  3 14:41 principal.kadm5.lock</span><br><span class="line">-rw-------. 1 root root    0 Oct  3 14:41 principal.ok</span><br></pre></td></tr></table></figure>



<h2 id="设置同步"><a href="#设置同步" class="headerlink" title="设置同步"></a>设置同步</h2><h3 id="安装服务-1"><a href="#安装服务-1" class="headerlink" title="安装服务"></a>安装服务</h3><p><strong>在 KDC 主节点：manager80.bigdata 和 KDC 备节点：master81.bigdata 都要执行</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install crontabs cronie -y</span><br></pre></td></tr></table></figure>



<h3 id="设置定时任务"><a href="#设置定时任务" class="headerlink" title="设置定时任务"></a>设置定时任务</h3><p><strong>在 KDC 主节点：manager80.bigdata 执行</strong></p>
<p>使用 <code>root</code> 用户编辑定时任务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>添加以下内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*/2 * * * * /usr/sbin/kdb5_util dump /var/kerberos/krb5kdc/dump</span><br><span class="line">*/2 * * * * scp /var/kerberos/krb5kdc/dump root@master81.bigdata:/var/kerberos/krb5kdc/</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> <code>master81.bigdata</code> 要换成对应的 KDC 备节点的 hostname。</p>
<p><strong>在 KDC 备节点：master81.bigdata 执行</strong></p>
<p>使用 <code>root</code> 用户编辑定时任务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>添加以下内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*/2 * * * * /usr/sbin/kdb5_util load /var/kerberos/krb5kdc/dump</span><br></pre></td></tr></table></figure>



<h2 id="启动及自启"><a href="#启动及自启" class="headerlink" title="启动及自启"></a>启动及自启</h2><p><strong>在 KDC 主节点：manager80.bigdata 和 KDC 备节点：master81.bigdata 都要执行</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start krb5kdc.service</span><br><span class="line">systemctl start kadmin.service</span><br><span class="line">systemctl enable krb5kdc.service </span><br><span class="line">systemctl enable kadmin.service</span><br></pre></td></tr></table></figure>



<h2 id="创建超级管理员"><a href="#创建超级管理员" class="headerlink" title="创建超级管理员"></a>创建超级管理员</h2><p><strong>在 KDC 主节点：manager80.bigdata 执行</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 krb5kdc]# kadmin.local -q "addprinc -pw admin admin/admin"</span><br><span class="line">Authenticating as principal root/admin@BIGDATA with password.</span><br><span class="line">WARNING: no policy specified for admin/admin@BIGDATA; defaulting to no policy</span><br><span class="line">Principal "admin/admin@BIGDATA" created.</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>此命令中，密码为：admin（可自行配置），用户为：admin/admin</p>
<p>登录验证</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 krb5kdc]# kinit admin/admin</span><br><span class="line">Password for admin/admin@BIGDATA: -- 输入上步设置的密码</span><br><span class="line">[root@manager80 krb5kdc]# klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_0</span><br><span class="line">Default principal: admin/admin@BIGDATA</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">10/03/2021 15:09:34  10/04/2021 15:09:34  krbtgt/BIGDATA@BIGDATA</span><br><span class="line">	renew until 10/10/2021 15:09:34</span><br></pre></td></tr></table></figure>



<h2 id="验证主备同步"><a href="#验证主备同步" class="headerlink" title="验证主备同步"></a>验证主备同步</h2><p>等待一段时间（大于 2 分钟，约 5 分钟），在 KDC 备节点验证</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master81 krb5kdc]# kinit admin/admin</span><br><span class="line">Password for admin/admin@BIGDATA: </span><br><span class="line">[root@master81 krb5kdc]# klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_0</span><br><span class="line">Default principal: admin/admin@BIGDATA</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">10/03/2021 15:09:49  10/04/2021 15:09:49  krbtgt/BIGDATA@BIGDATA</span><br><span class="line">	renew until 10/10/2021 15:09:49</span><br></pre></td></tr></table></figure>

<p>如果出现以上信息，说明主备同步正常。</p>
<h1 id="Kerberos-基本操作"><a href="#Kerberos-基本操作" class="headerlink" title="Kerberos 基本操作"></a>Kerberos 基本操作</h1><h2 id="kadmin-数据库操作"><a href="#kadmin-数据库操作" class="headerlink" title="kadmin 数据库操作"></a>kadmin 数据库操作</h2><p>在运行 kadmin 的节点上执行 <code>kadmin.local</code> 命令进入 kadmin 操作模式，输入 “？” 可查看所有的命令及解释。</p>
<p>如果有访问 KDC 服务器的 root 权限，但没有 kerberos admin 账户，使用 <code>kadmin.local</code> ；</p>
<p>如果没有访问 KDC 服务器的 root 权限，但有 kerberos admin 账户，使用 <code>kadmin</code> 。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kadmin.local </span><br><span class="line">Authenticating as principal admin/admin@BIGDATA with password.</span><br><span class="line">kadmin.local:  ?</span><br><span class="line">Available kadmin.local requests:</span><br><span class="line"></span><br><span class="line">add_principal, addprinc, ank</span><br><span class="line">                         Add principal</span><br><span class="line">delete_principal, delprinc</span><br><span class="line">                         Delete principal</span><br><span class="line">modify_principal, modprinc</span><br><span class="line">                         Modify principal</span><br><span class="line">rename_principal, renprinc</span><br><span class="line">                         Rename principal</span><br><span class="line">change_password, cpw     Change password</span><br><span class="line">get_principal, getprinc  Get principal</span><br><span class="line">list_principals, listprincs, get_principals, getprincs</span><br><span class="line">                         List principals</span><br><span class="line">add_policy, addpol       Add policy</span><br><span class="line">modify_policy, modpol    Modify policy</span><br><span class="line">delete_policy, delpol    Delete policy</span><br><span class="line">get_policy, getpol       Get policy</span><br><span class="line">list_policies, listpols, get_policies, getpols</span><br><span class="line">                         List policies</span><br><span class="line">get_privs, getprivs      Get privileges</span><br><span class="line">ktadd, xst               Add entry(s) to a keytab</span><br><span class="line">ktremove, ktrem          Remove entry(s) from a keytab</span><br><span class="line">lock                     Lock database exclusively (use with extreme caution!)</span><br><span class="line">unlock                   Release exclusive database lock</span><br><span class="line">purgekeys                Purge previously retained old keys from a principal</span><br><span class="line">get_strings, getstrs     Show string attributes on a principal</span><br><span class="line">set_string, setstr       Set a string attribute on a principal</span><br><span class="line">del_string, delstr       Delete a string attribute on a principal</span><br><span class="line">list_requests, lr, ?     List available requests.</span><br><span class="line">quit, exit, q            Exit program.</span><br></pre></td></tr></table></figure>



<h3 id="listprincs"><a href="#listprincs" class="headerlink" title="listprincs"></a>listprincs</h3><p>列出所有的 principal。</p>
<p>以下为在大数据集群中的部分 principal。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kadmin.local:  listprincs </span><br><span class="line">admin/admin@BIGDATA</span><br><span class="line">ambari-qa-cluster_80@BIGDATA</span><br><span class="line">ambari-server-cluster_80@BIGDATA</span><br><span class="line">dn/manager80.bigdata@BIGDATA</span><br><span class="line">dn/master81.bigdata@BIGDATA</span><br><span class="line">dn/worker82.bigdata@BIGDATA</span><br><span class="line">hbase-cluster_80@BIGDATA</span><br><span class="line">hbase/manager80.bigdata@BIGDATA</span><br><span class="line">hbase/worker82.bigdata@BIGDATA</span><br><span class="line">hdfs-cluster_80@BIGDATA</span><br><span class="line">kadmin/admin@BIGDATA</span><br><span class="line">kadmin/changepw@BIGDATA</span><br><span class="line">kadmin/manager80.bigdata@BIGDATA</span><br><span class="line">nm/manager80.bigdata@BIGDATA</span><br><span class="line">nm/master81.bigdata@BIGDATA</span><br><span class="line">nm/worker82.bigdata@BIGDATA</span><br><span class="line">nn/manager80.bigdata@BIGDATA</span><br><span class="line">nn/master81.bigdata@BIGDATA</span><br><span class="line">rm/manager80.bigdata@BIGDATA</span><br><span class="line">yarn-ats-cluster_80@BIGDATA</span><br><span class="line">yarn-ats-hbase/manager80.bigdata@BIGDATA</span><br><span class="line">yarn-ats-hbase/master81.bigdata@BIGDATA</span><br><span class="line">yarn-ats-hbase/worker82.bigdata@BIGDATA</span><br><span class="line">yarn/manager80.bigdata@BIGDATA</span><br><span class="line">yarn/master81.bigdata@BIGDATA</span><br><span class="line">zookeeper/manager80.bigdata@BIGDATA</span><br><span class="line">zookeeper/master81.bigdata@BIGDATA</span><br><span class="line">zookeeper/worker82.bigdata@BIGDATA</span><br></pre></td></tr></table></figure>



<h3 id="addprinc"><a href="#addprinc" class="headerlink" title="addprinc"></a>addprinc</h3><p>添加一个 principal。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kadmin.local:  addprinc test/localhost</span><br><span class="line">WARNING: no policy specified for test/localhost@BIGDATA; defaulting to no policy</span><br><span class="line">Enter password for principal "test/localhost@BIGDATA":  -- 输入密码</span><br><span class="line">Re-enter password for principal "test/localhost@BIGDATA": -- 再次输入密码</span><br><span class="line">Principal "test/localhost@BIGDATA" created.</span><br></pre></td></tr></table></figure>



<p>查看新增 principal</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kinit test/localhost@BIGDATA</span><br><span class="line">Password for test/localhost@BIGDATA: -- 输入刚才输入的密码</span><br><span class="line">[root@manager80 ~]# klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_0</span><br><span class="line">Default principal: test/localhost@BIGDATA</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">10/04/2021 10:24:44  10/05/2021 10:24:44  krbtgt/BIGDATA@BIGDATA</span><br><span class="line">	renew until 10/11/2021 10:24:44</span><br></pre></td></tr></table></figure>



<h3 id="change-password"><a href="#change-password" class="headerlink" title="change_password"></a>change_password</h3><p>修改 principal 的密码。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kadmin.local:  change_password test/localhost@BIGDATA</span><br><span class="line">Enter password for principal "test/localhost@BIGDATA":  -- 输入新的密码</span><br><span class="line">Re-enter password for principal "test/localhost@BIGDATA":  -- 重新输入新的密码</span><br><span class="line">Password for "test/localhost@BIGDATA" changed.</span><br></pre></td></tr></table></figure>



<h3 id="delprinc"><a href="#delprinc" class="headerlink" title="delprinc"></a>delprinc</h3><p>删除 principal。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kadmin.local:  delprinc test/localhost</span><br><span class="line">Are you sure you want to delete the principal "test/localhost@BIGDATA"? (yes/no): yes</span><br><span class="line">Principal "test/localhost@BIGDATA" deleted.</span><br><span class="line">Make sure that you have removed this principal from all ACLs before reusing.</span><br></pre></td></tr></table></figure>



<h2 id="Kerberos-基本操作-1"><a href="#Kerberos-基本操作-1" class="headerlink" title="Kerberos 基本操作"></a>Kerberos 基本操作</h2><h3 id="kinit"><a href="#kinit" class="headerlink" title="kinit"></a>kinit</h3><p>获取并缓存一个初始票据。</p>
<p>通过 <code>kinit -h</code> 命令查看帮助信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kinit -h</span><br><span class="line">kinit: invalid option -- 'h'</span><br><span class="line">Usage: kinit [-V] [-l lifetime] [-s start_time] </span><br><span class="line">	[-r renewable_life] [-f | -F | --forwardable | --noforwardable] </span><br><span class="line">	[-p | -P | --proxiable | --noproxiable] </span><br><span class="line">	-n [-a | -A | --addresses | --noaddresses] </span><br><span class="line">	[--request-pac | --no-request-pac] </span><br><span class="line">	[-C | --canonicalize] </span><br><span class="line">	[-E | --enterprise] </span><br><span class="line">	[-v] [-R] [-k [-i|-t keytab_file]] [-c cachename] </span><br><span class="line">	[-S service_name] [-T ticket_armor_cache]</span><br><span class="line">	[-X &lt;attribute&gt;[=&lt;value&gt;]] [principal]</span><br><span class="line"></span><br><span class="line">    options:</span><br><span class="line">	-V verbose</span><br><span class="line">	-l lifetime</span><br><span class="line">	-s start time</span><br><span class="line">	-r renewable lifetime</span><br><span class="line">	-f forwardable</span><br><span class="line">	-F not forwardable</span><br><span class="line">	-p proxiable</span><br><span class="line">	-P not proxiable</span><br><span class="line">	-n anonymous</span><br><span class="line">	-a include addresses</span><br><span class="line">	-A do not include addresses</span><br><span class="line">	-v validate</span><br><span class="line">	-R renew</span><br><span class="line">	-C canonicalize</span><br><span class="line">	-E client is enterprise principal name</span><br><span class="line">	-k use keytab</span><br><span class="line">	-i use default client keytab (with -k)</span><br><span class="line">	-t filename of keytab to use</span><br><span class="line">	-c Kerberos 5 cache name</span><br><span class="line">	-S service</span><br><span class="line">	-T armor credential cache</span><br><span class="line">	-X &lt;attribute&gt;[=&lt;value&gt;]</span><br></pre></td></tr></table></figure>



<h4 id="使用密码认证"><a href="#使用密码认证" class="headerlink" title="使用密码认证"></a>使用密码认证</h4><p>直接输入 <code>kinit  principal</code>，然后根据提示输入密码进行认证。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# kinit admin/admin</span><br><span class="line">Password for admin/admin@BIGDATA: -- 输入密码</span><br></pre></td></tr></table></figure>



<h4 id="使用-keytab-认证"><a href="#使用-keytab-认证" class="headerlink" title="使用 keytab 认证"></a>使用 keytab 认证</h4><ul>
<li>查看 keytab</li>
</ul>
<p>一般通过 keytab 文件进行认证，首先切换到 keytab 所在文件夹，默认为 <code>/etc/security/keytabs/</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# cd /etc/security/keytabs/</span><br><span class="line">[root@manager80 keytabs]# ll</span><br><span class="line">total 72</span><br><span class="line">-r--------. 1 infra-solr hadoop 393 Oct  3 15:19 ambari-infra-solr.service.keytab</span><br><span class="line">-r--------. 1 root       root   368 Oct  3 15:19 ambari.server.keytab</span><br><span class="line">-r--------. 1 ams        hadoop 373 Oct  3 15:19 ams-monitor.keytab</span><br><span class="line">-r--------. 1 hdfs       hadoop 353 Oct  3 15:19 dn.service.keytab</span><br><span class="line">-r--r-----. 1 hbase      hadoop 328 Oct  3 15:19 hbase.headless.keytab</span><br><span class="line">-r--------. 1 hbase      hadoop 368 Oct  3 15:19 hbase.service.keytab</span><br><span class="line">-r--------. 1 hdfs       hadoop 323 Oct  3 15:19 hdfs.headless.keytab</span><br><span class="line">-rw-r-----. 1 ambari-qa  hadoop 333 Oct  3 15:16 kerberos.service_check.100321.keytab</span><br><span class="line">-r--------. 1 yarn       hadoop 353 Oct  3 15:19 nm.service.keytab</span><br><span class="line">-r--------. 1 hdfs       hadoop 353 Oct  3 15:19 nn.service.keytab</span><br><span class="line">-r--------. 1 yarn       hadoop 353 Oct  3 15:19 rm.service.keytab</span><br><span class="line">-r--r-----. 1 ambari-qa  hadoop 348 Oct  3 15:19 smokeuser.headless.keytab</span><br><span class="line">-r--r-----. 1 root       hadoop 363 Oct  3 15:19 spnego.service.keytab</span><br><span class="line">-r--------. 1 yarn-ats   hadoop 343 Oct  3 15:19 yarn-ats.hbase-client.headless.keytab</span><br><span class="line">-r--------. 1 yarn-ats   hadoop 413 Oct  3 15:19 yarn-ats.hbase-master.service.keytab</span><br><span class="line">-r--------. 1 yarn-ats   hadoop 413 Oct  3 15:19 yarn-ats.hbase-regionserver.service.keytab</span><br><span class="line">-r--------. 1 yarn       hadoop 363 Oct  3 15:19 yarn.service.keytab</span><br><span class="line">-r--------. 1 zookeeper  hadoop 388 Oct  3 15:19 zk.service.keytab</span><br></pre></td></tr></table></figure>

<p>这里有所有可用的 keytab，<strong>注意所用用户要有使用该 keytab 的权限</strong>。</p>
<ul>
<li>查看 principal</li>
</ul>
<p>这里以 <code>hdfs</code> 用户使用 <code>hdfs.headless.keytab</code> 为例。</p>
<p>首先切换到  <code>hdfs</code> 用户，并查看 keytab 的 principal。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 keytabs]# su hdfs</span><br><span class="line">[hdfs@manager80 keytabs]$ klist -ket hdfs.headless.keytab</span><br><span class="line">Keytab name: FILE:hdfs.headless.keytab</span><br><span class="line">KVNO Timestamp           Principal</span><br><span class="line">---- ------------------- ------------------------------------------------------</span><br><span class="line">   2 10/03/2021 15:19:03 hdfs-cluster_80@BIGDATA (aes128-cts-hmac-sha1-96) </span><br><span class="line">   2 10/03/2021 15:19:03 hdfs-cluster_80@BIGDATA (aes256-cts-hmac-sha1-96) </span><br><span class="line">   2 10/03/2021 15:19:03 hdfs-cluster_80@BIGDATA (des3-cbc-sha1) </span><br><span class="line">   2 10/03/2021 15:19:03 hdfs-cluster_80@BIGDATA (des-cbc-md5) </span><br><span class="line">   2 10/03/2021 15:19:03 hdfs-cluster_80@BIGDATA (arcfour-hmac)</span><br></pre></td></tr></table></figure>

<ul>
<li>认证并查看当前票据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[hdfs@manager80 keytabs]$ kinit -kt hdfs.headless.keytab hdfs-cluster_80@BIGDATA</span><br><span class="line">[hdfs@manager80 keytabs]$ klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_1007</span><br><span class="line">Default principal: hdfs-cluster_80@BIGDATA</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">10/04/2021 15:04:54  10/05/2021 15:04:54  krbtgt/BIGDATA@BIGDATA</span><br><span class="line">	renew until 10/11/2021 15:04:54</span><br></pre></td></tr></table></figure>

<p>可以看到已经通过 keytab 进行认证。</p>
<ul>
<li>查看 HDFS 文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[hdfs@manager80 keytabs]$ hadoop fs -ls /tmp</span><br><span class="line">Found 3 items</span><br><span class="line">drwxr-xr-x   - hdfs hdfs          0 2021-03-31 15:29 /tmp/entity-file-history</span><br><span class="line">-rw-r--r--   3 hdfs hdfs       1024 2021-03-31 15:28 /tmp/idb40a50f9_date283121</span><br><span class="line">-rw-r--r--   3 hdfs hdfs       1024 2021-10-03 15:26 /tmp/idb40a52f9_date260321</span><br></pre></td></tr></table></figure>

<p>可以查看 HDFS 数据，说明已认证成功。</p>
<h3 id="kdestroy"><a href="#kdestroy" class="headerlink" title="kdestroy"></a>kdestroy</h3><p>销毁当前认证票据，删除凭据缓存。使用 <code>kdestroy -A</code> 清除所有缓存凭据。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[hdfs@manager80 keytabs]$ kdestroy</span><br><span class="line">[hdfs@manager80 keytabs]$ klist</span><br><span class="line">klist: No credentials cache found (filename: /tmp/krb5cc_1007)</span><br></pre></td></tr></table></figure>



<h3 id="ktutil"><a href="#ktutil" class="headerlink" title="ktutil"></a>ktutil</h3><p><code>ktutil</code> 是操作 keytab 文件的工具集。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# ktutil</span><br><span class="line">ktutil:  ?</span><br><span class="line">Available ktutil requests:</span><br><span class="line"></span><br><span class="line">clear_list, clear        Clear the current keylist.</span><br><span class="line">read_kt, rkt             Read a krb5 keytab into the current keylist.</span><br><span class="line">read_st, rst             Read a krb4 srvtab into the current keylist.</span><br><span class="line">write_kt, wkt            Write the current keylist to a krb5 keytab.</span><br><span class="line">write_st, wst            Write the current keylist to a krb4 srvtab.</span><br><span class="line">add_entry, addent        Add an entry to the current keylist.</span><br><span class="line">delete_entry, delent     Delete an entry from the current keylist.</span><br><span class="line">list, l                  List the current keylist.</span><br><span class="line">list_requests, lr, ?     List available requests.</span><br><span class="line">quit, exit, q            Exit program.</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>MIT Kerberos Documentation (1.19.2) — MIT Kerberos Documentation<br><a href="https://web.mit.edu/kerberos/krb5-latest/doc/" target="_blank" rel="noopener">https://web.mit.edu/kerberos/krb5-latest/doc/</a></li>
</ul>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title>Sed 常用基本命令</title>
    <url>/2021/10/04/Sed-common-basic-commands/</url>
    <content><![CDATA[<p>本文主要介绍了 Sed 常用的基本命令。</p>
<a id="more"></a>

<p>Linux sed 命令主要用来处理、编辑文本文件。</p>
<p><code>sed -i</code> 命令可直接修改文件</p>
<h2 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h2><ul>
<li>替换某个字符串</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "s/旧字符串/新字符串/g" 文件名</span><br></pre></td></tr></table></figure>

<p>例如：要将 test.txt 文件中的 AAA 全部替换为 BBB，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "s/BBB/AAA/g" test.txt</span><br></pre></td></tr></table></figure>

<p>带 g —— 全部替代<br>无 g —— 只替代每行第一个</p>
<ul>
<li>只替换第 N 行的某些字符</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> sed -i &quot;Ns&#x2F;旧字符串&#x2F;新字符串&#x2F;g&quot; 文件名</span><br></pre></td></tr></table></figure>

<p>例如：将 test.txt 第 3 行的 bb  换为 BB，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "3s/bb/BB/g" test.txt</span><br></pre></td></tr></table></figure>



<ul>
<li>替换两个字符之间的内容</li>
</ul>
<p>可以使用正则表达是 .* 代替两个字符串之间的任意内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "s/开始字符串.*结束字符串/开始字符串修改后的字符串结束字符串/g" 文件名</span><br></pre></td></tr></table></figure>

<p>例如：要将 test.txt 文件中 &gt; 和 = 之间的内容都替换为 CCC，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "s/&gt;.*=/&gt;CCC=/g" test.txt</span><br></pre></td></tr></table></figure>



<h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><ul>
<li>在第 N 行之后插入一行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "Na\新增内容" 文件名</span><br></pre></td></tr></table></figure>

<p>例如：在 test.txt 文件的第 2 行之后增加一行 ddd，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "2a\dddd" test.txt</span><br></pre></td></tr></table></figure>



<ul>
<li>在最后一行之后插入一行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i '$a 新增内容' 文件名</span><br></pre></td></tr></table></figure>

<p>$ 代表最后一行，<strong>注意要使用单引号</strong></p>
<p>例如：在 test.txt 的末尾插入一行 DDD，即</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i '$a DDD' test.txt</span><br></pre></td></tr></table></figure>



<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><ul>
<li>在文件第 N 行插入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "Ni\插入内容" 文件名</span><br></pre></td></tr></table></figure>

<p>例如：在 test.txt 文件的第 2 行 插入 AAA，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "2i\AAA" test.txt</span><br></pre></td></tr></table></figure>



<ul>
<li>在文件第一行插入内容</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "1i\插入内容" 文件名</span><br></pre></td></tr></table></figure>

<p>例如：在 test.txt 中的第一行插入 BBB，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i "1i\BBB" test.txt</span><br></pre></td></tr></table></figure>



<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul>
<li>删除第 N 行内容</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i 'Nd' 文件名</span><br></pre></td></tr></table></figure>

<p>例如：删除 test.txt 文件的第 2 行，即</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i '2d' test.txt</span><br></pre></td></tr></table></figure>



<ul>
<li>删除从的 M 行到第 N 行的内容</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i 'M,Nd' 文件名</span><br></pre></td></tr></table></figure>

<p>例如：删除 test.txt 文件的从第 2 行，到第 5 行，即：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i '2,5d' test.txt</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>Linux sed 命令 | 菜鸟教程 <a href="https://www.runoob.com/linux/linux-comm-sed.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-sed.html</a></p>
</li>
<li><p>使用sed -i对文本字符串进行增删改查 - 纯捡垃圾吃的 - 博客园 <a href="https://www.cnblogs.com/zhangrui153169/p/11506334.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhangrui153169/p/11506334.html</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>使用rpmrebuild从rpm包中提取spec文件</title>
    <url>/2019/12/29/Rpm-extract-spec/</url>
    <content><![CDATA[<p>本文主要介绍使用 rpmrebuild 工具，从 rpm 包中提取 spec 文件的方法。</p>
<a id="more"></a>

<h2 id="rpmrebuild-官网"><a href="#rpmrebuild-官网" class="headerlink" title="rpmrebuild 官网"></a>rpmrebuild 官网</h2><p>rpmrebuild<br><a href="http://rpmrebuild.sourceforge.net/" target="_blank" rel="noopener">http://rpmrebuild.sourceforge.net/</a></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>RPM resource rpmrebuild<br><a href="http://rpmfind.net/linux/rpm2html/search.php?query=rpmrebuild" target="_blank" rel="noopener">http://rpmfind.net/linux/rpm2html/search.php?query=rpmrebuild</a> </p>
<p>百度云下载：</p>
<p>链接：<a href="https://pan.baidu.com/s/16_QY2aYSF4__BiqVCOG0kg" target="_blank" rel="noopener">https://pan.baidu.com/s/16_QY2aYSF4__BiqVCOG0kg</a> </p>
<p>提取码：8mov </p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>rpmrebuild 依赖 rpm-built，所以首先执行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install rpm-built</span><br></pre></td></tr></table></figure>
<p>然后安装 rpmrebuild</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -Uvh rpmrebuild-2.14-1.2.noarch.rpm</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2019122917413936.png" alt=""></p>
<h2 id="提取-spec-文件"><a href="#提取-spec-文件" class="headerlink" title="提取 spec 文件"></a>提取 spec 文件</h2><p>这里以提取 MySQL 的 rpm 包的 spec文件为例</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpmrebuild --package --notest-install --spec-only&#x3D;mysql.spec mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<ul>
<li>–spec-only=mysql.spec<br>这里的<code>mysql.spec</code>即为要保存的 spec 文件名</li>
</ul>
<h2 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># rpmrebuild -h</span><br><span class="line">rpmrebuild is a tool to rebuild an rpm file from the rpm database</span><br><span class="line">Usage: rpmrebuild [options] package</span><br><span class="line">options:</span><br><span class="line">   -5  --md5-compat-digest      use rpm 4.4 compatible digest (md5)</span><br><span class="line">   -a, --additional&#x3D;&lt;flags&gt;	additional flags to be passed to the rpmbuild</span><br><span class="line">   -b, --batch			batch mode (ask no questions)</span><br><span class="line">   -c, --comment-missing&#x3D;&lt;y|n&gt;	comment missing files in the specfile. default : no.</span><br><span class="line">   -d, --directory&#x3D;&lt;dir&gt;        specify the working directory</span><br><span class="line">   -D, --define&#x3D;&lt;define&gt;        defines to be passed to the rpmbuild</span><br><span class="line">   -e, --edit-spec              alias for --edit-whole</span><br><span class="line">   -f, --filter&#x3D;&lt;command&gt;       alias for --change-spec-whole</span><br><span class="line">   -i, --includes&#x3D;&lt;file&gt;        read options from the file &lt;file&gt;</span><br><span class="line">   -I, --install                install the created rpm</span><br><span class="line">   -k, --keep-perm              alias for --pug-from-fs</span><br><span class="line">       --pug-from-fs            keep installed files permission, uid and gid</span><br><span class="line">       --pug-from-db (default)  use files permission, uid and gid from rpm db</span><br><span class="line">       --cap-from-fs            use files posix capabilities from installed files</span><br><span class="line">       --cap-from-db (default)  use files posix capabilities from rpm database</span><br><span class="line">   -l, --list-plugin		list installed plugins</span><br><span class="line">   -m, --modify&#x3D;&lt;command&gt;       alias for --change-files</span><br><span class="line">   -n, --notest-install		do not perform a test install</span><br><span class="line">   -p, --package                use package file, not installed rpm</span><br><span class="line">   -P, --autoprovide            force rpm to auto generate &quot;Provide:&quot;</span><br><span class="line">   -r, --release&#x3D;N              force release to N</span><br><span class="line">   -R, --autorequire            force rpm to auto generate &quot;Require:&quot;</span><br><span class="line">   -s, --spec-only&#x3D;&lt;specfile&gt;   generate specfile only. (If &lt;specfile&gt; &quot;-&quot; stdout will be used)</span><br><span class="line">   -v, --verbose                verbose</span><br><span class="line">       --debug                  debug mode (do not remove temporary working files)</span><br><span class="line">   -V, --version                print rpmrebuild version</span><br><span class="line">   -w, --warning                print warning if detect filenames with globbing characters (default : no).</span><br><span class="line">   -y, --verify&#x3D;&lt;y|n&gt;           verify package (rpm -V) before processing (default : yes).</span><br><span class="line">   -h, --help                   print this help</span><br><span class="line">       --help-plugins           print help about plugins options</span><br><span class="line"></span><br><span class="line">Copyright (C) 2002-2007 by Eric Gerbier (&lt;gerbier@users.sourceforge.net&gt;)</span><br><span class="line">this program is distributed under GNU General Public License</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>linux – 从rpm包中提取spec文件 - 代码日志<br><a href="https://codeday.me/bug/20180226/137445.html" target="_blank" rel="noopener">https://codeday.me/bug/20180226/137445.html</a> </li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title>Typora 设置标题自动编号</title>
    <url>/2021/10/04/Typora-title-auto-numbering/</url>
    <content><![CDATA[<p>本文主要介绍 Typora 正文标题、侧边大纲、TOC 标题自动编号的方法。</p>
<a id="more"></a>

<ol>
<li>依次点击 文件 —— 偏好设置 —— 外观 —— 打开主题文件，</li>
</ol>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/10/20211004163115.png" alt=""></p>
<ol start="2">
<li>在打开的文件夹中增加文件 <code>github.user.css</code></li>
</ol>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/10/20211004163255.png" alt=""></p>
<p>完整内容如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 正文标题自动序号 */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h4</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h5</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h5;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h6</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: body;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h1;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">"."</span> <span class="built_in">counter</span>(h1) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h2;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">"."</span> <span class="built_in">counter</span>(h1)<span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h3;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">"."</span> <span class="built_in">counter</span>(h1)<span class="string">"."</span> <span class="built_in">counter</span>(h2)<span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h4;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">"."</span> <span class="built_in">counter</span>(h1)<span class="string">"."</span> <span class="built_in">counter</span>(h2)<span class="string">"."</span> <span class="built_in">counter</span>(h3)<span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h5;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(body) <span class="string">"."</span> <span class="built_in">counter</span>(h1)<span class="string">"."</span> <span class="built_in">counter</span>(h2)<span class="string">"."</span> <span class="built_in">counter</span>(h3)<span class="string">"."</span> <span class="built_in">counter</span>(h4)<span class="string">"."</span> <span class="built_in">counter</span>(h5) <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 侧边大纲自动序号 */</span></span><br><span class="line"><span class="selector-class">.sidebar-content</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h1</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h1</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h2</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h2</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h3</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h3</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h4</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h4</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h5</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h5</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h6</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h1</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h1;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h2</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h2;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h3</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h3;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h4</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h4;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h5</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h5;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">"."</span> <span class="built_in">counter</span>(h5) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.outline-h6</span>&gt;<span class="selector-class">.outline-item</span>&gt;<span class="selector-class">.outline-label</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h6;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1) <span class="string">"."</span> <span class="built_in">counter</span>(h2) <span class="string">"."</span> <span class="built_in">counter</span>(h3) <span class="string">"."</span> <span class="built_in">counter</span>(h4) <span class="string">"."</span> <span class="built_in">counter</span>(h5) <span class="string">"."</span> <span class="built_in">counter</span>(h6) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* TOC 自动序号 */</span></span><br><span class="line"><span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-content</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h1toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h1</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h2toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h2</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h3toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h4toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h4</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">3rem</span>;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h5toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h5</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">4rem</span>;</span><br><span class="line">    <span class="attribute">counter-reset</span>: h6toc</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h6</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h1</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h1toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h1</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h2</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h2toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">". "</span> <span class="built_in">counter</span>(h2toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h2</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h3</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h3toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">". "</span> <span class="built_in">counter</span>(h2toc) <span class="string">". "</span> <span class="built_in">counter</span>(h3toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h3</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h4</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h4toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">". "</span> <span class="built_in">counter</span>(h2toc) <span class="string">". "</span> <span class="built_in">counter</span>(h3toc) <span class="string">". "</span> <span class="built_in">counter</span>(h4toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h4</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h5</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h5toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">". "</span> <span class="built_in">counter</span>(h2toc) <span class="string">". "</span> <span class="built_in">counter</span>(h3toc) <span class="string">". "</span> <span class="built_in">counter</span>(h4toc) <span class="string">". "</span> <span class="built_in">counter</span>(h5toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h5</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h6</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-increment</span>: h6toc;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(h1toc) <span class="string">". "</span> <span class="built_in">counter</span>(h2toc) <span class="string">". "</span> <span class="built_in">counter</span>(h3toc) <span class="string">". "</span> <span class="built_in">counter</span>(h4toc) <span class="string">". "</span> <span class="built_in">counter</span>(h5toc) <span class="string">". "</span> <span class="built_in">counter</span>(h6toc) <span class="string">" "</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.md-toc-h6</span> <span class="selector-class">.md-toc-inner</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上内容包含了正文标题、侧边大纲、TOC 标题自动编号。</p>
<ol start="3">
<li><p>保存后重启 Typora。</p>
</li>
<li><p>效果如下：</p>
</li>
</ol>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/10/20211004163632.png" alt=""></p>
<ol start="5">
<li>参考资料</li>
</ol>
<ul>
<li><p>Typora设置标题自动添加序号 - 简书<br><a href="https://www.jianshu.com/p/89ba39c95af4" target="_blank" rel="noopener">https://www.jianshu.com/p/89ba39c95af4</a></p>
</li>
<li><p>Typora 标题自动编号 - 知乎<br><a href="https://zhuanlan.zhihu.com/p/110257979" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/110257979</a></p>
</li>
<li><p>Auto Numbering for Headings<br><a href="https://support.typora.io/Auto-Numbering/" target="_blank" rel="noopener">https://support.typora.io/Auto-Numbering/</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>TestDFSIO性能测试工具使用方法</title>
    <url>/2020/11/04/TestDFSIO-Introduction/</url>
    <content><![CDATA[<p>本文主要介绍 HDFS 性能测试工具的功能、参数说明、读写性能测试使用方法及结果分析。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>TestDFSIO是Hadoop系统自带的基准测试组件，用于测试Hadoop文件系统通过MapReduce方式处理作业的IO 属性。TestDFSIO调用一个MapReduce作业来并发地执行读写操作，每个map任务用于读或写每个文件，reduce 用于累积统计信息，并产生统计总结。</p>
<h1 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h1><p>hadoop/TestDFSIO.java at trunk · apache/hadoop<br><a href="https://github.com/apache/hadoop/blob/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/fs/TestDFSIO.java" target="_blank" rel="noopener">https://github.com/apache/hadoop/blob/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/fs/TestDFSIO.java</a> </p>
<h1 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# hadoop jar &#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar TestDFSIO</span><br><span class="line">20&#x2F;11&#x2F;04 19:31:31 INFO fs.TestDFSIO: TestDFSIO.1.8</span><br><span class="line">Missing arguments.</span><br><span class="line">Usage: TestDFSIO [genericOptions] -read [-random | -backward | -skip [-skipSize Size]] | -write | -append | -truncate | -clean [-compression codecClassName] [-nrFiles N] [-size Size[B|KB|MB|GB|TB]] [-resFile resultFileName] [-bufferSize Bytes] [-storagePolicy storagePolicyName] [-erasureCodePolicy erasureCodePolicyName]</span><br></pre></td></tr></table></figure>

<ul>
<li>read：读测试，对每个文件读-size指定的字节数</li>
<li>write：写测试，对每个文件写-size指定的字节数</li>
<li>append：追加测试，对每个文件追加-size指定的字节数</li>
<li>truncate：截断测试，对每个文件截断至-size指定的字节数</li>
<li>clean：清除TestDFSIO在HDFS上生成数据</li>
<li>n：文件个数</li>
<li>size：每个文件的大小，必须加单位，单位可为B、KB、MB、GB、TB</li>
<li>resFile：生成测试报告的本地文件路径，多次测试可使用同一个文件，结果会追加</li>
<li>bufferSize：每个mapper任务读写文件所用到的缓存区大小，默认为1000000字节。</li>
</ul>
<h1 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h1><h2 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h2><p>在每个DataNode节点执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sync</span><br><span class="line">echo 3 &gt; &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;drop_caches</span><br></pre></td></tr></table></figure>

<p>这里主要是清理<code>cache/buffer</code>，可以通过<code>free -h</code>命令查看。缓存（cached）是把读取过的数据保存起来，重新读取时若命中（找到需要的数据）就不要去读硬盘了，若没有命中就读硬盘。缓冲（buffers）是根据磁盘的读写设计的，把分散的写操作集中进行，减少磁盘碎片和硬盘的反复寻道，从而提高系统性能。</p>
<p><code>sync</code>是将<code>cache/buffer</code>持久化至磁盘<br><code>echo 3 &gt; /proc/sys/vm/drop_caches</code>是清理<code>cache/buffer</code>区。</p>
<h2 id="清除测试数据"><a href="#清除测试数据" class="headerlink" title="清除测试数据"></a>清除测试数据</h2><p>以下命令均使用hdfs用户执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">su hdfs</span><br><span class="line">hadoop jar &#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar TestDFSIO -clean</span><br></pre></td></tr></table></figure>

<h2 id="写文件测试"><a href="#写文件测试" class="headerlink" title="写文件测试"></a>写文件测试</h2><p>写10个100M的文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop jar &#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar TestDFSIO -write -nrFiles 10 -size 100MB -resFile &#x2F;tmp&#x2F;DFSIO-write.out</span><br></pre></td></tr></table></figure>
<p>查看结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;tmp&#x2F;DFSIO-write.out</span><br><span class="line">----- TestDFSIO ----- : write</span><br><span class="line">            Date &amp; time: Tue Sep 29 16:36:44 CST 2020</span><br><span class="line">        Number of files: 10</span><br><span class="line"> Total MBytes processed: 1000</span><br><span class="line">      Throughput mb&#x2F;sec: 1.56</span><br><span class="line"> Average IO rate mb&#x2F;sec: 3.33</span><br><span class="line">  IO rate std deviation: 3.67</span><br><span class="line">     Test exec time sec: 290.91</span><br></pre></td></tr></table></figure>
<p>结果解析：</p>
<ul>
<li>Date &amp; time：结果输出时间；</li>
<li>Number of files：文件数量，本次执写10个文件，也是task数量，即任务数；</li>
<li>Total MBytes processed：总共处理的文件大小，即数据总量，以MB为单位，因为本次写10个文件，每个文件100M，所以这里是10*100=1000；</li>
<li>Throughput mb/sec：吞吐量，以MB/s为单位，计算方法是：（数据总量）/（每个map任务实际写入数据的执行时间之和）；</li>
<li>Average IO rate mb/sec：平均IO速率，单位MB/s，计算方法是：（每个map需要写入的数据量/每个map任务实际写入数据的执行时间）之和/任务数；</li>
<li>IO rate std deviation：IO速率标准差；</li>
<li>Test exec time sec：测试执行时间，单位：s。</li>
</ul>
<p>查看数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -du -h &#x2F;benchmarks&#x2F;TestDFSIO&#x2F;io_data</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201104194603.png" alt=""></p>
<h2 id="读文件测试"><a href="#读文件测试" class="headerlink" title="读文件测试"></a>读文件测试</h2><p>执行读测试时，首先需要有文件，因此可在写文件测试之后执行相应的读文件测试，这里读取10个文件，每个文件100M。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop jar &#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar TestDFSIO -read -nrFiles 10 -size 100MB -resFile &#x2F;tmp&#x2F;DFSIO-read.out</span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;tmp&#x2F;DFSIO-read.out</span><br><span class="line">----- TestDFSIO ----- : read</span><br><span class="line">            Date &amp; time: Tue Sep 29 16:41:20 CST 2020</span><br><span class="line">        Number of files: 10</span><br><span class="line"> Total MBytes processed: 1000</span><br><span class="line">      Throughput mb&#x2F;sec: 376.51</span><br><span class="line"> Average IO rate mb&#x2F;sec: 644.25</span><br><span class="line">  IO rate std deviation: 445.27</span><br><span class="line">     Test exec time sec: 135.63</span><br></pre></td></tr></table></figure>

<p>清除测试数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop jar &#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar TestDFSIO -clean</span><br></pre></td></tr></table></figure>

<h1 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h1><p>为了方便测试，可使用脚本执行，如下是执行数据文件数分别为10个、100个、1000个和10000个，每个文件为128M的读写测试，且执行三遍，这样可以求取平均值，更准确。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># jar 包路径</span><br><span class="line">hdf_test_jar_home&#x3D;&#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187&#x2F;hadoop-mapreduce&#x2F;hadoop-mapreduce-client-jobclient-tests.jar</span><br><span class="line"></span><br><span class="line"># 文件数量</span><br><span class="line">file_num&#x3D;(10 100 1000 10000)</span><br><span class="line"></span><br><span class="line"># 每个文件的大小</span><br><span class="line">file_size&#x3D;128MB</span><br><span class="line"></span><br><span class="line">echo &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Start execute HDFS I&#x2F;O test &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;</span><br><span class="line">for i in &#123;1..3&#125;</span><br><span class="line">do</span><br><span class="line"></span><br><span class="line">	for num in $&#123;file_num[*]&#125;</span><br><span class="line">		do</span><br><span class="line">		</span><br><span class="line">			# 清除数据</span><br><span class="line">			echo &quot;Start clean data ... &quot; </span><br><span class="line">			hadoop jar $hdf_test_jar_home TestDFSIO -clean</span><br><span class="line"></span><br><span class="line">			# 写性能测试</span><br><span class="line">			echo &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Start execute write test, &#39; $i &#39; time, file_num:&#39; $num &#39;, file_size:&#39; $file_size &#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;</span><br><span class="line">			hadoop jar $hdf_test_jar_home TestDFSIO -write -nrFiles $num -fileSize $file_size -resFile &#x2F;tmp&#x2F;DFSIO-write.out</span><br><span class="line">			</span><br><span class="line">			# 读性能测试</span><br><span class="line">			echo &quot;Start execute read test, &#39; $i &#39; time, file_num:&#39; $num &#39;, file_size:&#39; $file_size&#39; &quot;</span><br><span class="line">			hadoop jar $hdf_test_jar_home TestDFSIO -read -nrFiles $num -fileSize $file_size -resFile &#x2F;tmp&#x2F;DFSIO-read.out</span><br><span class="line">			</span><br><span class="line">			# 睡眠10s</span><br><span class="line">			sleep 10</span><br><span class="line">		done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[Hadoop] 使用DFSIO测试集群I/O性能_mryqu_新浪博客<br><a href="http://blog.sina.com.cn/s/blog_72ef7bea0102vr44.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_72ef7bea0102vr44.html</a> </p>
<p>linux下的缓存机制buffer、cache、swap - 运维总结  - 散尽浮华 - 博客园<br><a href="https://www.cnblogs.com/kevingrace/p/5991604.html" target="_blank" rel="noopener">https://www.cnblogs.com/kevingrace/p/5991604.html</a> </p>
<p>TestDFSIO基准测试方法介绍_湖南频道_凤凰网<br><a href="http://hunan.ifeng.com/a/20190613/7496675_0.shtml" target="_blank" rel="noopener">http://hunan.ifeng.com/a/20190613/7496675_0.shtml</a> </p>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title>Writage: Word 转 markdown 工具</title>
    <url>/2021/04/16/Writage-Word-to-markdown-tool/</url>
    <content><![CDATA[<p>本文主要介绍一款简单好用的 word 转 markdown 工具：Writage。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Writage 是一款非常简单好用的 word 与 markdown 之间转换工具。</p>
<p><strong>注：Writage 只可免费使用 14 天，本文只做介绍，无利益关系。</strong></p>
<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p>Writage - Markdown plugin for Microsoft Word</p>
<p><a href="https://www.writage.com/" target="_blank" rel="noopener">https://www.writage.com/</a></p>
<h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201201183620.png" alt=""></p>
<p>下载后是 msi 格式文件，直接双击安装即可。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Writage 使用非常简单，将 word 文档另存为时选择 markdown 格式即可，并且会自动打开 markdown 格式的文档，然后就可以像 word 一样编辑 markdown 文件了。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201201183819.png" alt=""></p>
<p>保存后会将 word 中的图片全部放在 media 文件夹中。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201201184032.png" alt=""></p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Writage</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeper 介绍</title>
    <url>/2020/10/31/ZooKeeper-Introduction/</url>
    <content><![CDATA[<p>本文主要介绍 ZooKeeper 的定义，Leader、Follower 和 Observer 三种角色概念，znode 模型和 Watcher 机制，并介绍了 8 中典型的 ZooKeeper 使用场景，最后介绍了其实现原理。</p>
<a id="more"></a>

<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>ZooKeeper是一个高性能、高可靠的分布式协调服务，分布式应用可以基于ZooKeeper实现Master选举、负载均衡、集群管理、命名服务、数据发布/订阅、分布式协调/通知、分布式锁、分布式队列等功能。</p>
<h1 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h1><ol>
<li>集群角色</li>
</ol>
<p>ZooKeeper集群中的节点分为三种角色：Leader、Follower和Observer。<br>Leader：在ZooKeeper集群中只有一个节点作为集群的领导者，由各Follower通过ZooKeeper Atomic Broadcast(ZAB)协议选举产生，主要负责接收和协调所有写请求，并把写入的信息同步到Follower和Observer。<br>Follower：Follower主要负责处理客户端的读请求，将写请求转发给Leader。每个Follower都作为Leader的储备，当Leader发生故障时参与投票重新选举Leader，避免单点故障。<br>Observer: Observer只负责处理读请求、并向Leader转发写请求，不参与Leader选举。</p>
<!-- more -->

<ol start="2">
<li>数据模型</li>
</ol>
<p><strong>znode模型</strong><br>ZooKeeper提供了类似于文件系统的层级命名空间，所有分布式协调功能均可以借助作用在该命名空间上的原语实现。<br>每个ZNode拥有一个数据域，记录了用户数据，该域的数据类型为字节数组。ZooKeeper通过多副本方式保证数据的可靠存储。<br>znode分为persistent，ephemeral，persistent_sequential和ephemeral_sequential四种类型。<br>persistent：持久性节点，能够一直可靠地保存该节点，除非用户执行删除操作。<br>ephemeral：临时节点，该节点的生命周期与客户端相关，只要客户端保持与ZooKeeper server的session不断开，该节点会一直存在，反之，一旦两者之间断开连接，则该节点会被自动删除。<br>sequential：自动在文件名默认追加一个增量的唯一数字，以记录文件创建顺序，通常与persistent和ephemeral连用，产生persistent_sequential和ephemeral_sequential两种类型。</p>
<p><strong>Watcher</strong><br>Watcher（事件监听器）是ZooKeeper提供的发布/订阅机制，用户可在某个znode上注册watcher以监听它的变化，一旦对应的znode被特定事件触发（包括删除、数据域被修改、子节点发生变化等），ZooKeeper将以事件的形式将变化内容发送给监听者。</p>
<p><strong>Session</strong><br>Session是客户端与ZooKeeper服务端之间的通信通道。同一个session中的消息是有序的。Session具有容错性：如果客户端连接的ZooKeeper服务器宕机，客户端会自动连接到其他活着的服务器上。</p>
<h1 id="使用场景与规格"><a href="#使用场景与规格" class="headerlink" title="使用场景与规格"></a>使用场景与规格</h1><p>ZooKeeper是一个高可用的分布式数据管理与协调框架。基于对ZAB算法的实现，该框架能够很好地保证分布式环境中的数据一致性。也正是基于这样的特性，使得ZooKeeper适用于数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理等多种场景。</p>
<ol>
<li>数据发布/订阅</li>
</ol>
<p>数据发布/订阅系统，即配置中心，发布者将数据发布到ZooKeeper的一个或系列节点上，供订阅者进行数据订阅，进而达到动态获取数据的目的，实现配置信息的集中式管理和数据的动态更新。<br>ZooKeeper采用推拉结合方式：客户端向服务端注册自己需要关注的节点，一旦节点的数据发生变更，服务端会向相应的客户端发送Watcher事件通知，客户端接收到这个消息通知后，需要主动到服务端获取最新的数据。<br>如果将配置信息存放到ZooKeeper上进行集中管理，通常情况下，应用在启动的时候都会主动到ZooKeeper服务器上进行一次配置信息的获取，同时，在指定节点上注册一个Watcher监听，从而达到实时获取最新配置信息的目的。</p>
<ol start="2">
<li>负载均衡</li>
</ol>
<p>在分布式系统中，负载均衡是一种普遍的技术，基本上每一个分布式系统都需要使用负载均衡。分布式系统具有对等性，为了保证系统的高可用性，通常采用副本的方式来对数据和服务进行部署。而对于消费者而言，则需要在这些对等的服务提供方中选择一个来执行相关的业务逻辑，ZooKeeper可以很好的解决该问题。</p>
<ol start="3">
<li>命名服务</li>
</ol>
<p>命名服务也是分布式系统中比较常见的一类场景，在分布式系统中，被命名的实体通常可以是集群中机器、提供的服务地址或远程对象等，通过使用命名服务，客户端应用能够根据指定名字来获取资源的实体、服务地址和提供者的信息等。<br>ZooKeeper提供的命名服务功能帮助应用通过一个资源引用的方式来实现对资源的定位与使用，并且能够使用ZooKeeper实现一套分布式全局唯一ID的分配机制。</p>
<ol start="4">
<li>分布式协调/通知</li>
</ol>
<p>分布式协调/通知服务是分布式系统中不可缺少的一个环节，是将不同的分布式组件有机结合起来的关键所在。对于一个在多台机器上部署运行的应用而言，通常需要一个协调者来控制整个系统的运行流程。<br>ZooKeeper中特有的Watcher注册与异步通知机制，能够很好地实现分布式环境下不同机器，甚至是不同系统之间的协调与通知，通常的做法是在不同客户端都对ZooKeeper上同一个数据节点进行Watcher注册，监听数据节点的变化，如果数据节点发生变化，那么所有订阅的客户端都能接收到相应的Watcher通知，并做出相应的处理。</p>
<ol start="5">
<li>集群管理</li>
</ol>
<p>随着分布式系统规模的日益扩大，集群中的机器规模也随之变大，集群管理也越来越重要。客户端如果对ZooKeeper的一个数据节点注册Watcher监听，那么当该数据节点的内容或其子节点的列表发生变更时，ZooKeeper服务器就会向订阅的客户端发送变更通知。对在ZooKeeper上创建的临时节点，一旦客户端与服务器之间的会话失效，那么该临时节点也就被自动清除。</p>
<ol start="6">
<li>Master选举</li>
</ol>
<p>Master选举是一个在分布式系统中非常常见的应用场景。分布式最核心的特性就是能够将具有独立计算能力的系统单元部署在不同的机器上，构成一个完整的分布式系统。在分布式系统中，Master往往用来协调集群中其他系统单元，具有对分布式系统变更的决定权。<br>利用Zookeeper的强一致性，能够很好地保证在分布式高并发情况下节点的创建一定能够保证全局唯一性，即ZooKeeper将会保证客户端无法重复创建一个已经存在的数据节点。也就是说，如果同时有多个客户端请求创建同一个节点，那么最终一定只有一个客户端请求能够创建成功。利用这个特性，就能够很容易地在分布式环境中进行Master选举了。</p>
<ol start="7">
<li>分布式锁</li>
</ol>
<p>分布式锁是控制分布式系统之间同步访问共享资源的一种方式。如果不同的系统或是同一个系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，往往需要通过一些互斥手段来防止彼此之间的干扰，以保证一致性，在这种情况下，就需要使用分布式锁了。排他锁可以通过ZooKeeper上的数据节点来表示一个锁，ZooKeeper会保证在所有的客户端中，最终只有一个客户端能够创建成功，那么就可以认为该客户端获取了锁。正常执行完业务逻辑后，客户端就会主动将自己创建的临时节点删除，此时即认为是客户端释放锁。</p>
<ol start="8">
<li>分布式队列</li>
</ol>
<p>分布式队列可以分为两大类，一种是常规的先入先出队列，另一种则是需要等到队列元素集聚之后才统一安排执行的Barrier模型。<br>先入先出队列：所有客户端都到特定节点下面创建一个临时有序节点，创建完节点之后，客户端通过获取队列中的所有子节点，即获取队列中所有的元素，然后判断自己是否是队列中的最小元素，如果是则执行，如果不是则进入等待，同时向比自己序号小的最后一个节点注册Watcher监听，当收到Watcher通知后执行，从而实现一个分布式先入先出队列。<br>Barrier模型：在分布式系统中，Barrier特指系统之间的一个协调条件，规定了一个队列的元素必须都聚集后才能统一进行安排，否则一直等待。这往往出现在大规模分布式并行计算的应用场景上：最终的合并计算需要基于很多并行计算的子结果来进行。通过在ZooKeeper中创建一个节点作为默认节点，并将其节点的数据内容赋值为一个数字n代表Barrier值，只有默认节点下的子节点个数达到n后，才会打开Barrier。之后，所有客户端都会在默认节点下创建一个临时节点，当节点个数为n后，满足执行条件。</p>
<h1 id="价值"><a href="#价值" class="headerlink" title="价值"></a>价值</h1><p>在分布式系统中，服务或组件之间的协调非常重要，它构成了分布式系统基础。然而，由于分布式环境的复杂性，尤其是在网络故障、死锁、竞争等已变为常见现象的情况下，实现一个鲁棒的协调服务是极其困难的事情。为了实现一个通用的分布式协调服务，避免每个分布式系统从头实现造成不必要的工作冗余，ZooKeeper应运而生。<br>ZooKeeper通过引入类似于文件系统的层级命名空间，并在此基础上提供了一套简单易用的原语，能够帮助用户轻易实现Leader选举、分布式锁、分布式队列等功能，ZooKeeper已被大量开源系统采用。</p>
<h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>在Insight HD平台中，ZooKeeper为系统提供分布式协调服务，为其他组件提供诸如Leader选举、数据发布/订阅、分布式锁、元数据存储等服务。</p>
<p><img src="https://img-blog.csdnimg.cn/20201031154214335.jpeg" alt="ZooKeeper 基本架构"></p>
<p>ZooKeeper服务通常由奇数个ZooKeeper实例构成，其中一个实例为leader角色，其他为follower角色，它们同时维护了层级目录结构的一个副本，并通过ZAB（ZooKeeper Atomic Broadcast）协议维持副本之间的一致性。ZooKeeper将所有数据保存到内存中，具有吞吐率高、延迟低等优点。<br>读路径：任意一个Zookeeper实例均可为客户端提供读服务。Zookeeper实例数目越多，读吞吐率越高。<br>写路径：任意一个Zookeeper实例均可接受客户端的写请求，但需进一步转发给leader协调完成分布式写。因为Zookeeper使用ZAB协议，只要多数Zookeeper实例写成功即为成功，所以2N+1和2N+2个实例都是N+1个实例成功即可，所以最大容忍失败实例数均为N，这也是部署奇数个实例的最主要原因，而且Zookeeper实例数目越多，写延迟越高。</p>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
        <tag>ZooKeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeper从源码到RPM包制作过程详解</title>
    <url>/2019/12/29/ZooKeeper-rpm/</url>
    <content><![CDATA[<p>本文以 ZooKeeper 为例详细介绍了一种通用的从源码到 RPM 包的详细制作过程。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在使用 Ambari 安装或集成大数据组件时， CentOS 系统下，需要将组件格式制作成 rpm 格式，这里总结一种通用简便的从大数据组件源码制作 rpm 格式文件的方法：<strong>将源码编译成<code>tar</code>包，然后再将<code>tar</code>包打成 <code>rpm</code> 包</strong>。</p>
<p>这里以HDP版本的 ZooKeeper 为例介绍这种方法，其实 ZooKeeper 是可以直接从源码制作成rpm包的，这里为了介绍通用的做法，采用先将 ZooKeeper 的源码编译成 <code>tar.gz</code> 包，然后再制作成 <code>rpm</code>的方式。</p>
<h1 id="源码编译"><a href="#源码编译" class="headerlink" title="源码编译"></a>源码编译</h1><h2 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h2><p>Release HDP-2.6.4.91-3-tag: Modify HDP-CHANGES.txt to include ZOOKEEPER-2146 · hortonworks/zookeeper-release<br><a href="https://github.com/hortonworks/zookeeper-release/releases/tag/HDP-2.6.4.91-3-tag" target="_blank" rel="noopener">https://github.com/hortonworks/zookeeper-release/releases/tag/HDP-2.6.4.91-3-tag</a> </p>
<!-- more -->

<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar -zxvf zookeeper-release-HDP-2.6.4.91-3-tag.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="制作-tar-包"><a href="#制作-tar-包" class="headerlink" title="制作 tar 包"></a>制作 tar 包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install ant -y</span><br><span class="line">yum install cppunit-devel -y</span><br><span class="line">yum install libtool</span><br></pre></td></tr></table></figure>

<h2 id="ant-打包"><a href="#ant-打包" class="headerlink" title="ant 打包"></a>ant 打包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd zookeeper-release-HDP-2.6.5.148-3-tag&#x2F;</span><br><span class="line">ant tar</span><br></pre></td></tr></table></figure>

<h2 id="查看-tar-包"><a href="#查看-tar-包" class="headerlink" title="查看 tar 包"></a>查看 tar 包</h2><p>打包后的tar.gz位于zookeeper下的build目录<br><img src="https://img-blog.csdnimg.cn/20191229125039319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><p>所用命名未特殊说明的情况下均为使用root用户执行</p>
<h2 id="安装-rpm-build-包"><a href="#安装-rpm-build-包" class="headerlink" title="安装 rpm-build 包"></a>安装 rpm-build 包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install rpm-build</span><br></pre></td></tr></table></figure>

<h2 id="安装-rpmdevtools"><a href="#安装-rpmdevtools" class="headerlink" title="安装 rpmdevtools"></a>安装 rpmdevtools</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install rpmdevtools</span><br></pre></td></tr></table></figure>

<h2 id="创建工作空间"><a href="#创建工作空间" class="headerlink" title="创建工作空间"></a>创建工作空间</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpmdev-setuptree</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20191229125221940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""></p>
<h1 id="制作-rpm-包"><a href="#制作-rpm-包" class="headerlink" title="制作 rpm 包"></a>制作 rpm 包</h1><h2 id="编辑-spec-文件"><a href="#编辑-spec-文件" class="headerlink" title="编辑 spec 文件"></a>编辑 spec 文件</h2><p>制作 rpm 包需要用到一个 <code>spec</code> 格式的文件，这里使用<code>zookeeper.spec</code> 文件的内容为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Name: 		zookeeper</span><br><span class="line">Version: 	3.4.6</span><br><span class="line"># Avoid some silly dependencies and allow</span><br><span class="line"># symlink in the init.d folder</span><br><span class="line">AutoReqProv: 	no</span><br><span class="line">Release: 	0</span><br><span class="line">Summary: 	Zookeeper is a highly reliable distributed coordination service.</span><br><span class="line">License: 	Apache 2.0</span><br><span class="line">Group: 		Applications&#x2F;Internet</span><br><span class="line">Source0: 	zookeeper-3.4.6.tar.gz</span><br><span class="line">Prefix:		&#x2F;opt</span><br><span class="line">BuildArch: 	noarch</span><br><span class="line">BuildRoot: 	%&#123;_tmppath&#125;&#x2F;%&#123;name&#125;-root</span><br><span class="line">Provides: 	zookeeper</span><br><span class="line">Requires(post): &#x2F;sbin&#x2F;chkconfig, &#x2F;sbin&#x2F;service</span><br><span class="line">Requires(preun): &#x2F;sbin&#x2F;chkconfig, &#x2F;sbin&#x2F;service</span><br><span class="line">%description</span><br><span class="line">ZooKeeper is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services. All of these kinds of services are used in some form or another by distributed applications. Each time they are implemented there is a lot of work that goes into fixing the bugs and race conditions that are inevitable. Because of the difficulty of implementing these kinds of services, applications initially usually skimp on them ,which make them brittle in the presence of change and difficult to manage. Even when done correctly, different implementations of these services lead to management complexity when the applications are deployed.</span><br><span class="line"></span><br><span class="line">%prep</span><br><span class="line"></span><br><span class="line">%build</span><br><span class="line"></span><br><span class="line">%install</span><br><span class="line">rm -rf $RPM_BUILD_ROOT</span><br><span class="line">mkdir -p $RPM_BUILD_ROOT&#x2F;opt&#x2F;zookeeper</span><br><span class="line">mkdir -p $RPM_BUILD_ROOT&#x2F;etc&#x2F;init.d</span><br><span class="line">mkdir -p %&#123;_localstatedir&#125;&#x2F;lib&#x2F;zookeeper</span><br><span class="line">tar xfz $RPM_SOURCE_DIR&#x2F;zookeeper-%&#123;version&#125;.tar.gz</span><br><span class="line">cp -r $RPM_BUILD_DIR&#x2F;zookeeper-%&#123;version&#125;&#x2F;* $RPM_BUILD_ROOT&#x2F;opt&#x2F;zookeeper</span><br><span class="line"></span><br><span class="line">#cp &#x2F;opt&#x2F;zookeeper&#x2F;bin&#x2F;zkEnv.sh %&#123;_sysconfdir&#125;&#x2F;init.d&#x2F;zkEnv.sh</span><br><span class="line">cp $RPM_BUILD_ROOT&#x2F;opt&#x2F;zookeeper&#x2F;conf&#x2F;zoo_sample.cfg $RPM_BUILD_ROOT&#x2F;opt&#x2F;zookeeper&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line"></span><br><span class="line">#%pre</span><br><span class="line">#%preun</span><br><span class="line">#&#x2F;sbin&#x2F;service zookeeper stop &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">#&#x2F;sbin&#x2F;chkconfig --del zookeeper</span><br><span class="line"></span><br><span class="line">#%clean</span><br><span class="line">rm -rf $RPM_BUILD_ROOT</span><br><span class="line"></span><br><span class="line">%post</span><br><span class="line">cp &#x2F;opt&#x2F;zookeeper&#x2F;bin&#x2F;zkEnv.sh %&#123;_sysconfdir&#125;&#x2F;init.d&#x2F;zkEnv.sh</span><br><span class="line">ln -sf &#x2F;opt&#x2F;zookeeper&#x2F;bin&#x2F;zkServer.sh %&#123;_sysconfdir&#125;&#x2F;init.d&#x2F;zookeeper</span><br><span class="line">&#x2F;sbin&#x2F;chkconfig zookeeper on</span><br><span class="line">#&#x2F;sbin&#x2F;service zookeeper start</span><br><span class="line"></span><br><span class="line">%files</span><br><span class="line">%defattr(-,root,root,-)</span><br><span class="line">&#x2F;opt&#x2F;zookeeper</span><br><span class="line"></span><br><span class="line">%changelog</span><br><span class="line">* Tue Aug 19 2014 - daniel.beneyto at abiquo dot com</span><br><span class="line">- Initial release.</span><br></pre></td></tr></table></figure>

<h2 id="放置文件"><a href="#放置文件" class="headerlink" title="放置文件"></a>放置文件</h2><p>将<code>zookeeper.spec</code>文件放到<code>/root/rpmbuild/SPECS</code> 文件夹中，将编译好的<code>zookeeper-3.4.6.tar.gz</code>放在<code>/root/rpmbuild/SOURCES</code> 文件夹中</p>
<h2 id="执行打-rpm-包命令"><a href="#执行打-rpm-包命令" class="headerlink" title="执行打 rpm 包命令"></a>执行打 rpm 包命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;SPECS</span><br><span class="line">rpmbuild -ba zookeeper.spec</span><br></pre></td></tr></table></figure>

<h2 id="查看-rpm-包"><a href="#查看-rpm-包" class="headerlink" title="查看 rpm 包"></a>查看 rpm 包</h2><p>打包好的rpm包在<code>/root/rpmbuild/RPMS</code>文件夹中<br><img src="https://img-blog.csdnimg.cn/20191229164729376.png" alt=""></p>
<h1 id="安装测试"><a href="#安装测试" class="headerlink" title="安装测试"></a>安装测试</h1><p>现在将制作出来的 rpm 包安装测试。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -Uvh zookeeper-3.4.6-0.noarch.rpm</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;zookeeper&#x2F;bin&#x2F;</span><br><span class="line">.&#x2F;zkServer.sh start</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20191229164842155.png" alt=""></p>
<h2 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h2><p><img src="https://img-blog.csdnimg.cn/20191229164903476.png" alt=""></p>
<p>至此，说明制作的 rpm 包是可用的。</p>
<h1 id="spec-文件解析"><a href="#spec-文件解析" class="headerlink" title="spec 文件解析"></a>spec 文件解析</h1><p>这个方法的关键在于先后步骤及 spec 文件，现在来看下 spec 文件的几点注意事项</p>
<p><img src="https://img-blog.csdnimg.cn/20191229165008256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cDovL3d3dy5lcmlrLWx5LmNvbQ==,size_16,color_FFFFFF,t_70" alt=""><br>Version中不能出现“-”等字符<br>Source0需要与SOURCES中的文件名一致</p>
<p><img src="https://img-blog.csdnimg.cn/20191229165235914.png" alt=""><br>创建打包过程中文件存放位置，解压并复制文件</p>
<p><img src="https://img-blog.csdnimg.cn/2019122916525678.png" alt=""><br>复制zookeeper配置文件，也可不在此设置，启动之前手动配置</p>
<p><img src="https://img-blog.csdnimg.cn/20191229165320611.png" alt=""><br>创建软连接</p>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><p>实际上使用”下载源码”中的链接下载的源码包在编译成 tar 包的过程中是会报错的，为了不打乱步骤介绍，特在这里说明。<br>在执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpmbuild -ba zookeeper.spec</span><br></pre></td></tr></table></figure>
<p>后，会出现如下错误：<br><img src="https://img-blog.csdnimg.cn/20191229165933932.png" alt=""><br>可以看出是源码中的加注释时格式出错了，解决办法为修改源码后重新打包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;SOURCES</span><br><span class="line">mv zookeeper-3.4.6.tar.gz zookeeper-3.4.6.tar.gz.bak</span><br><span class="line">tar -xvf zookeeper-3.4.6.tar.gz</span><br><span class="line">cd zookeeper-3.4.6&#x2F;</span><br></pre></td></tr></table></figure>
<p>修改文件<code>/root/rpmbuild/SOURCES/zookeeper-3.4.6/contrib/zkpython/src/python/zk.py</code>和<code>/root/rpmbuild/SOURCES/zookeeper-3.4.6/src/contrib/zkpython/src/python/zk.py</code>两个文件,<br><img src="https://img-blog.csdnimg.cn/20191229170055623.png" alt=""><br><img src="https://img-blog.csdnimg.cn/20191229170058838.png" alt=""><br>将两个zk.py文件中去掉如下图红框中的一行代码<br><img src="https://img-blog.csdnimg.cn/20191229170122791.png" alt=""><br>重新打成 tar 包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;SOURCES&#x2F;</span><br><span class="line">tar zcvf zookeeper-2.6.4.tar.gz zookeeper-2.6.4</span><br></pre></td></tr></table></figure>
<p>这时重新打包rpm<br>首先清空BUILD、BUILDROOT、RPMS、SRPMS文件夹，重新执行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;SPECS</span><br><span class="line">rpmbuild -ba zookeeper.spec</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>RPM打包原理、示例、详解及备查 - 刘康的专栏 - CSDN博客<br><a href="https://blog.csdn.net/get_set/article/details/53453320" target="_blank" rel="noopener">https://blog.csdn.net/get_set/article/details/53453320</a> </p>
</li>
<li><p>[ZOOKEEPER-2777] There is a typo in zk.py which prevents from using/compiling it. - ASF JIRA<br><a href="https://issues.apache.org/jira/browse/ZOOKEEPER-2777" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/ZOOKEEPER-2777</a> </p>
</li>
<li><p>CentOS7环境下zookeeper-release-HDP-2.6.5.148-3-tag编译打RPM包 - 汤昕的博客 - CSDN博客<br><a href="https://blog.csdn.net/Happy_Sunshine_Boy/article/details/90479508" target="_blank" rel="noopener">https://blog.csdn.net/Happy_Sunshine_Boy/article/details/90479508</a> </p>
</li>
</ul>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
        <tag>ZooKeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 自定义资源类型</title>
    <url>/2020/12/13/ambari-custom-resource-type/</url>
    <content><![CDATA[<p>Ambari 里将集群、主机、服务、组件、用户等视为资源，通过自定义资源即可实现类似 Ambari 风格的增删改查功能。</p>
<a id="more"></a>

<p>本文以在 Ambari 中添加 Yarn 资源，实现查询 Yarn 全部任务和查询某个任务的日志信息。</p>
<h1 id="添加资源类型"><a href="#添加资源类型" class="headerlink" title="添加资源类型"></a>添加资源类型</h1><p>在 <code>org.apache.ambari.server.controller.spi.Resource</code> 接口中添加资源类型枚举类 Yarn。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &#x2F;**</span><br><span class="line">  * Enum of internal types.</span><br><span class="line">  *&#x2F;</span><br><span class="line"> enum InternalType &#123;</span><br><span class="line">   Cluster,</span><br><span class="line">   Service,</span><br><span class="line">   Setting,</span><br><span class="line">  </span><br><span class="line">   ……</span><br><span class="line">  </span><br><span class="line">   RemoteCluster,</span><br><span class="line">   Yarn;</span><br><span class="line">   </span><br><span class="line">   ……</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">   &#x2F;**</span><br><span class="line">  * Resource types.  Allows for the addition of external types.</span><br><span class="line">  *&#x2F;</span><br><span class="line"> final class Type implements Comparable&lt;Type&gt;&#123;</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * Internal types.  See &#123;@link InternalType&#125;.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   public static final Type Cluster &#x3D; InternalType.Cluster.getType();</span><br><span class="line">   public static final Type Service &#x3D; InternalType.Service.getType();</span><br><span class="line">   public static final Type Setting &#x3D; InternalType.Setting.getType();</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">   public static final Type LoggingQuery &#x3D; InternalType.LoggingQuery.getType();</span><br><span class="line">   public static final Type RemoteCluster &#x3D; InternalType.RemoteCluster.getType();</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * Yarn</span><br><span class="line">    *&#x2F;</span><br><span class="line">   public static final Type Yarn &#x3D; InternalType.Yarn.getType();</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h1 id="新建控制器层"><a href="#新建控制器层" class="headerlink" title="新建控制器层"></a>新建控制器层</h1><p>新建 <code>org.apache.ambari.server.api.services.YarnService</code> 类，注意请求方式和资源类型。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.api.services;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.Api;</span><br><span class="line">import org.apache.ambari.server.api.resources.ResourceInstance;</span><br><span class="line">import org.apache.ambari.server.controller.spi.Resource;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import javax.ws.rs.GET;</span><br><span class="line">import javax.ws.rs.Path;</span><br><span class="line">import javax.ws.rs.PathParam;</span><br><span class="line">import javax.ws.rs.Produces;</span><br><span class="line">import javax.ws.rs.core.Context;</span><br><span class="line">import javax.ws.rs.core.HttpHeaders;</span><br><span class="line">import javax.ws.rs.core.Response;</span><br><span class="line">import javax.ws.rs.core.UriInfo;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn 相关服务</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Path(&quot;&#x2F;yarn&#x2F;&quot;)</span><br><span class="line">@Api(value &#x3D; &quot;yarn&quot;)</span><br><span class="line">public class YarnService extends BaseService &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(YarnService.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Gets all yarn info.</span><br><span class="line">     * Handles: GET &#x2F;yarn requests.</span><br><span class="line">     *</span><br><span class="line">     * @param headers http headers</span><br><span class="line">     * @param ui      uri info</span><br><span class="line">     *</span><br><span class="line">     * @return information regarding all yarn</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GET</span><br><span class="line">    @Produces(&quot;text&#x2F;plain&quot;)</span><br><span class="line">    public Response getYarnApplications(String body, @Context HttpHeaders headers, @Context UriInfo ui) &#123;</span><br><span class="line">        LOG.info(&quot;Into get all Yarn applications.&quot;);</span><br><span class="line">        return handleRequest(headers, body, ui, Request.Type.GET, createResource(null));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Handles: GET &#x2F;yarn&#x2F;&#123;applicationId&#125;</span><br><span class="line">     * Get a specific applicationId info.</span><br><span class="line">     *</span><br><span class="line">     * @param headers        http headers</span><br><span class="line">     * @param ui             uri info</span><br><span class="line">     * @param applicationId   applicationId</span><br><span class="line">     *</span><br><span class="line">     * @return yan instance representation</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @GET</span><br><span class="line">    @Path(&quot;&#123;applicationId&#125;&quot;)</span><br><span class="line">    @Produces(&quot;text&#x2F;plain&quot;)</span><br><span class="line">    public Response getClusterUser(@Context HttpHeaders headers, @Context UriInfo ui,</span><br><span class="line">                                 @PathParam(&quot;applicationId&quot;) String applicationId) &#123;</span><br><span class="line"></span><br><span class="line">        return handleRequest(headers, null, ui, Request.Type.GET, createResource(applicationId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Create a yarn instance.</span><br><span class="line">     *</span><br><span class="line">     * @param applicationId applicationId</span><br><span class="line">     *</span><br><span class="line">     * @return a yarn resource instance</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private ResourceInstance createResource(String applicationId) &#123;</span><br><span class="line">        final Map&lt;Resource.Type, String&gt; mapIds &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        mapIds.put(Resource.Type.Yarn, applicationId);</span><br><span class="line">        return createResource(Resource.Type.Yarn, mapIds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="新建资源-Provider"><a href="#新建资源-Provider" class="headerlink" title="新建资源 Provider"></a>新建资源 Provider</h1><p>新建 <code>org.apache.ambari.server.controller.internal.YarnResourceProvider</code>，这是具体的增删改查实现逻辑，先搭建整体框架，稍后具体实现这块逻辑。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.controller.internal;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn资源</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">@StaticallyInject</span><br><span class="line">public class YarnResourceProvider extends AbstractControllerResourceProvider &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(YarnResourceProvider.class);</span><br><span class="line">    </span><br><span class="line">    public YarnResourceProvider(AmbariManagementController managementController) &#123;</span><br><span class="line">    super(Resource.Type.Yarn, propertyIds, keyPropertyIds, managementController);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为 <code>YarnResourceProvider</code> 是继承 <code>AbstractControllerResourceProvider</code>，所以要在 <code>org.apache.ambari.server.controller.internal.AbstractControllerResourceProvider</code> 中添加 <code>YarnResourceProvider</code>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Factory method for obtaining a resource provider based on a given type and management controller.</span><br><span class="line"> *</span><br><span class="line"> * @param type                  the resource type</span><br><span class="line"> * @param managementController  the management controller</span><br><span class="line"> *</span><br><span class="line"> * @return a new resource provider</span><br><span class="line"> *&#x2F;</span><br><span class="line">public static ResourceProvider getResourceProvider(Resource.Type type,</span><br><span class="line">                                                   AmbariManagementController managementController) &#123;</span><br><span class="line"></span><br><span class="line">  switch (type.getInternalType()) &#123;</span><br><span class="line">    case Cluster:</span><br><span class="line">      return new ClusterResourceProvider(managementController);</span><br><span class="line">    case Service:</span><br><span class="line">      return resourceProviderFactory.getServiceResourceProvider(managementController);</span><br><span class="line">    case Component:</span><br><span class="line">      return resourceProviderFactory.getComponentResourceProvider(managementController);</span><br><span class="line">    </span><br><span class="line"> ……</span><br><span class="line"> </span><br><span class="line">    case ViewInstance:</span><br><span class="line">      return resourceProviderFactory.getViewInstanceResourceProvider();</span><br><span class="line"></span><br><span class="line">    case Yarn:</span><br><span class="line">      return new YarnResourceProvider(managementController);</span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line">      throw new IllegalArgumentException(&quot;Unknown type &quot; + type);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="新建资源定义"><a href="#新建资源定义" class="headerlink" title="新建资源定义"></a>新建资源定义</h1><p>新建 Yarn 资源的定义类 <code>org.apache.ambari.server.api.resources.YarnResourceDefinition</code>，在 <code>getSubResourceDefinitions</code> 中可定义子资源查询，实现方法可参考 <code>UserResourceDefinition</code>类。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.api.resources;</span><br><span class="line"></span><br><span class="line">import org.apache.ambari.server.controller.spi.Resource;</span><br><span class="line"></span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn 资源定义</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class YarnResourceDefinition extends BaseResourceDefinition &#123;</span><br><span class="line"></span><br><span class="line">    public YarnResourceDefinition() &#123;</span><br><span class="line">        super(Resource.Type.Yarn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getPluralName() &#123;</span><br><span class="line">        return &quot;yarns&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getSingularName() &#123;</span><br><span class="line">        return &quot;yarn&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Set&lt;SubResourceDefinition&gt; getSubResourceDefinitions() &#123;</span><br><span class="line">        return Collections.emptySet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="添加新的资源实例"><a href="#添加新的资源实例" class="headerlink" title="添加新的资源实例"></a>添加新的资源实例</h1><p>在 <code>org.apache.ambari.server.api.resources.ResourceInstanceFactoryImpl</code> 中添加上一步的资源定义。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  switch (type.getInternalType()) &#123;</span><br><span class="line">    case Cluster:</span><br><span class="line">      resourceDefinition &#x3D; new ClusterResourceDefinition();</span><br><span class="line">      break;</span><br><span class="line"></span><br><span class="line">    case Service:</span><br><span class="line">      resourceDefinition &#x3D; new ServiceResourceDefinition();</span><br><span class="line">      break;</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">    case RemoteCluster:</span><br><span class="line">      resourceDefinition &#x3D; new RemoteClusterResourceDefinition();</span><br><span class="line">      break;</span><br><span class="line"></span><br><span class="line">    case Yarn:</span><br><span class="line">      resourceDefinition &#x3D; new YarnResourceDefinition();</span><br><span class="line">      break;</span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line">      throw new IllegalArgumentException(&quot;Unsupported resource type: &quot; + type);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="新建-request-和-response"><a href="#新建-request-和-response" class="headerlink" title="新建 request 和 response"></a>新建 request 和 response</h1><p>创建相应的 request 和 response 方法，这里新建 <code>org.apache.ambari.server.controller.YarnRequest</code> 和 <code>org.apache.ambari.server.controller.YarnResponse</code>。</p>
<p><code>YarnRequest</code> 示例代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.controller;</span><br><span class="line"></span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line"></span><br><span class="line">import java.util.Objects;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn request</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">@ApiModel</span><br><span class="line">public class YarnRequest &#123;</span><br><span class="line"></span><br><span class="line">    private String applicationId;</span><br><span class="line">    private String applicationName;</span><br><span class="line"></span><br><span class="line">    public YarnRequest(String applicationId) &#123;</span><br><span class="line">        this.applicationId &#x3D; applicationId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getApplicationId() &#123;</span><br><span class="line">        return applicationId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationId(String applicationId) &#123;</span><br><span class="line">        this.applicationId &#x3D; applicationId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getApplicationName() &#123;</span><br><span class="line">        return applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationName(String applicationName) &#123;</span><br><span class="line">        this.applicationName &#x3D; applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (this &#x3D;&#x3D; o) return true;</span><br><span class="line">        if (o &#x3D;&#x3D; null || getClass() !&#x3D; o.getClass()) return false;</span><br><span class="line">        YarnRequest that &#x3D; (YarnRequest) o;</span><br><span class="line">        return Objects.equals(applicationId, that.applicationId) &amp;&amp;</span><br><span class="line">                Objects.equals(applicationName, that.applicationName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        return Objects.hash(applicationId, applicationName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;YarnRequest&#123;&quot; +</span><br><span class="line">                &quot;applicationId&#x3D;&#39;&quot; + applicationId + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, applicationName&#x3D;&#39;&quot; + applicationName + &#39;\&#39;&#39; +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>YarnResponse</code> 示例代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.controller;</span><br><span class="line"></span><br><span class="line">import java.util.Objects;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn response</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class YarnResponse implements ApiModel &#123;</span><br><span class="line"></span><br><span class="line">    private String applicationId;</span><br><span class="line">    private String applicationName;</span><br><span class="line">    private String applicationType;</span><br><span class="line">    private String user;</span><br><span class="line">    private String queue;</span><br><span class="line">    private String state;</span><br><span class="line">    private String finalState;</span><br><span class="line">    private String progress;</span><br><span class="line">    private String trackingUrl;</span><br><span class="line"></span><br><span class="line">    private String logInfo;</span><br><span class="line"></span><br><span class="line">    public YarnResponse() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getApplicationId() &#123;</span><br><span class="line">        return applicationId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationId(String applicationId) &#123;</span><br><span class="line">        this.applicationId &#x3D; applicationId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getApplicationName() &#123;</span><br><span class="line">        return applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationName(String applicationName) &#123;</span><br><span class="line">        this.applicationName &#x3D; applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getApplicationType() &#123;</span><br><span class="line">        return applicationType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setApplicationType(String applicationType) &#123;</span><br><span class="line">        this.applicationType &#x3D; applicationType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUser() &#123;</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUser(String user) &#123;</span><br><span class="line">        this.user &#x3D; user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getQueue() &#123;</span><br><span class="line">        return queue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setQueue(String queue) &#123;</span><br><span class="line">        this.queue &#x3D; queue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getState() &#123;</span><br><span class="line">        return state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(String state) &#123;</span><br><span class="line">        this.state &#x3D; state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFinalState() &#123;</span><br><span class="line">        return finalState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFinalState(String finalState) &#123;</span><br><span class="line">        this.finalState &#x3D; finalState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getProgress() &#123;</span><br><span class="line">        return progress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProgress(String progress) &#123;</span><br><span class="line">        this.progress &#x3D; progress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTrackingUrl() &#123;</span><br><span class="line">        return trackingUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTrackingUrl(String trackingUrl) &#123;</span><br><span class="line">        this.trackingUrl &#x3D; trackingUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getLogInfo() &#123;</span><br><span class="line">        return logInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setLogInfo(String logInfo) &#123;</span><br><span class="line">        this.logInfo &#x3D; logInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (this &#x3D;&#x3D; o) return true;</span><br><span class="line">        if (o &#x3D;&#x3D; null || getClass() !&#x3D; o.getClass()) return false;</span><br><span class="line">        YarnResponse that &#x3D; (YarnResponse) o;</span><br><span class="line">        return Objects.equals(applicationId, that.applicationId) &amp;&amp;</span><br><span class="line">                Objects.equals(applicationName, that.applicationName) &amp;&amp;</span><br><span class="line">                Objects.equals(applicationType, that.applicationType) &amp;&amp;</span><br><span class="line">                Objects.equals(user, that.user) &amp;&amp;</span><br><span class="line">                Objects.equals(queue, that.queue) &amp;&amp;</span><br><span class="line">                Objects.equals(state, that.state) &amp;&amp;</span><br><span class="line">                Objects.equals(finalState, that.finalState) &amp;&amp;</span><br><span class="line">                Objects.equals(progress, that.progress) &amp;&amp;</span><br><span class="line">                Objects.equals(trackingUrl, that.trackingUrl) &amp;&amp;</span><br><span class="line">                Objects.equals(logInfo, that.logInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        return Objects.hash(applicationId, applicationName, applicationType, user, queue, state, finalState, progress, trackingUrl, logInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;YarnResponse&#123;&quot; +</span><br><span class="line">                &quot;applicationId&#x3D;&#39;&quot; + applicationId + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, applicationName&#x3D;&#39;&quot; + applicationName + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, applicationType&#x3D;&#39;&quot; + applicationType + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, user&#x3D;&#39;&quot; + user + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, queue&#x3D;&#39;&quot; + queue + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, state&#x3D;&#39;&quot; + state + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, finalState&#x3D;&#39;&quot; + finalState + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, progress&#x3D;&#39;&quot; + progress + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, trackingUrl&#x3D;&#39;&quot; + trackingUrl + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, logInfo&#x3D;&#39;&quot; + logInfo + &#39;\&#39;&#39; +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="新建数据库相关类"><a href="#新建数据库相关类" class="headerlink" title="新建数据库相关类"></a>新建数据库相关类</h1><p>涉及到新增数据库表的情况，需要在 <code>org.apache.ambari.server.orm.dao</code> 包中新建相应的 DAO 层，在 <code>org.apache.ambari.server.orm.entities</code> 包中新建相应的实体类，并将实体类加入到 <code>ambari-server\src\main\resources\META-INF\persistence.xml</code> 中，这个例子中不涉及到新建数据表的情况。</p>
<h1 id="实现具体逻辑"><a href="#实现具体逻辑" class="headerlink" title="实现具体逻辑"></a>实现具体逻辑</h1><p>整体框架搭建好后，具体的实现逻辑在 <code>YarnResourceProvider</code> 类中。</p>
<h2 id="定义资源属性"><a href="#定义资源属性" class="headerlink" title="定义资源属性"></a>定义资源属性</h2><p>需要定义 Yarn 资源的属性，并组合成 yarn/属性 的方式，这样可以控制返回属性。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static final String YARN_RESOURCE_CATEGORY &#x3D; &quot;yarn&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn application info</span><br><span class="line"> *&#x2F;</span><br><span class="line">public static final String APPLICATION_ID_PROPERTY_ID &#x3D; &quot;applicationId&quot;;</span><br><span class="line">public static final String APPLICATION_NAME_PROPERTY_ID &#x3D; &quot;applicationName&quot;;</span><br><span class="line">public static final String APPLICATION_TYPE_PROPERTY_ID &#x3D; &quot;applicationType&quot;;</span><br><span class="line">public static final String USER_PROPERTY_ID &#x3D; &quot;user&quot;;</span><br><span class="line">public static final String QUEUE_PROPERTY_ID &#x3D; &quot;queue&quot;;</span><br><span class="line">public static final String STATE_PROPERTY_ID &#x3D; &quot;state&quot;;</span><br><span class="line">public static final String FINAL_STATE_PROPERTY_ID &#x3D; &quot;finalState&quot;;</span><br><span class="line">public static final String PROGRESS_PROPERTY_ID &#x3D; &quot;progress&quot;;</span><br><span class="line">public static final String TRACKINGURL_PROPERTY_ID &#x3D; &quot;trackingUrl&quot;;</span><br><span class="line">public static final String LOG_INFO_PROPERTY_ID &#x3D; &quot;logInfo&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public static final String YARN_APPLICATION_ID_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_ID_PROPERTY_ID;</span><br><span class="line">public static final String YARN_APPLICATION_NAME_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_NAME_PROPERTY_ID;</span><br><span class="line">public static final String YARN_APPLICATION_TYPE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_TYPE_PROPERTY_ID;</span><br><span class="line">public static final String YARN_USER_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + USER_PROPERTY_ID;</span><br><span class="line">public static final String YARN_QUEUE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + QUEUE_PROPERTY_ID;</span><br><span class="line">public static final String YARN_STATE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + STATE_PROPERTY_ID;</span><br><span class="line">public static final String YARN_FINAL_STATE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + FINAL_STATE_PROPERTY_ID;</span><br><span class="line">public static final String YARN_PROGRESS_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + PROGRESS_PROPERTY_ID;</span><br><span class="line">public static final String YARN_TRACKINGURL_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + TRACKINGURL_PROPERTY_ID;</span><br><span class="line">public static final String YARN_LOG_INFO_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + LOG_INFO_PROPERTY_ID;</span><br></pre></td></tr></table></figure>

<h2 id="设置资源属性"><a href="#设置资源属性" class="headerlink" title="设置资源属性"></a>设置资源属性</h2><p>定义好资源属性后需要添加设置属性。</p>
<p>首先是 <code>keyPropertyIds</code>， 这个可认为是 key 值，根据这个值寻找 Yarn 资源，且返回的时候必须要返回这个属性值，否则请求获取不到值。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * The key property ids for a Yarn resource.</span><br><span class="line"> *&#x2F;</span><br><span class="line">private static Map&lt;Resource.Type, String&gt; keyPropertyIds &#x3D; ImmutableMap.&lt;Resource.Type, String&gt;builder()</span><br><span class="line">        .put(Resource.Type.Yarn, YARN_APPLICATION_ID_PROPERTY_ID)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>然后是 <code>propertyIds</code>，这里必须包含 <code>keyPropertyIds</code> 中的值，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * The property ids for a Yarn resource.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public static Set&lt;String&gt; propertyIds &#x3D; Sets.newHashSet(</span><br><span class="line">        YARN_APPLICATION_ID_PROPERTY_ID,</span><br><span class="line">        YARN_APPLICATION_NAME_PROPERTY_ID,</span><br><span class="line">        YARN_APPLICATION_TYPE_PROPERTY_ID,</span><br><span class="line">        YARN_USER_PROPERTY_ID,</span><br><span class="line">        YARN_QUEUE_PROPERTY_ID,</span><br><span class="line">        YARN_STATE_PROPERTY_ID,</span><br><span class="line">        YARN_FINAL_STATE_PROPERTY_ID,</span><br><span class="line">        YARN_PROGRESS_PROPERTY_ID,</span><br><span class="line">        YARN_TRACKINGURL_PROPERTY_ID,</span><br><span class="line">        YARN_LOG_INFO_PROPERTY_ID);</span><br></pre></td></tr></table></figure>

<p>最后是 <code>getPKPropertyIds</code>，这个是固定写法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected Set&lt;String&gt; getPKPropertyIds() &#123;</span><br><span class="line">    return new HashSet&lt;&gt;(keyPropertyIds.values());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加注解"><a href="#添加注解" class="headerlink" title="添加注解"></a>添加注解</h2><p>Ambari 使用 Guice 进行注解，这里需要使用 <code>HostComponentStateDAO</code> 查询组件所在主机名，所有需要使用 <code>@Inject</code> 注解引入 <code>HostComponentStateDAO</code>，并且需要在类前加上 <code>@StaticallyInject</code>。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@StaticallyInject</span><br><span class="line">public class YarnResourceProvider extends AbstractControllerResourceProvider &#123;</span><br><span class="line">    </span><br><span class="line">    ……</span><br><span class="line">    </span><br><span class="line">    @Inject</span><br><span class="line">    protected static HostComponentStateDAO hostComponentStateDAO;</span><br><span class="line">    </span><br><span class="line">    ……</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询逻辑"><a href="#查询逻辑" class="headerlink" title="查询逻辑"></a>查询逻辑</h2><p>在 <code>getResources</code> 方法中实现具体的查询逻辑，主要是通过 <code>getRequest</code> 方法解析请求参数，如果 applicationId 为空，则返回所有 application 信息；如果 applicationId 不为空，则查询改任务的日志信息。主要使用执行 shell 命令获取返回值，解析返回值获取相应信息。</p>
<p>完整 <code>YarnResourceProvider</code> 示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package org.apache.ambari.server.controller.internal;</span><br><span class="line"></span><br><span class="line">import com.google.common.collect.ImmutableMap;</span><br><span class="line">import com.google.common.collect.Sets;</span><br><span class="line">import com.google.inject.Inject;</span><br><span class="line">import org.apache.ambari.server.StaticallyInject;</span><br><span class="line">import org.apache.ambari.server.controller.AmbariManagementController;</span><br><span class="line">import org.apache.ambari.server.controller.YarnRequest;</span><br><span class="line">import org.apache.ambari.server.controller.YarnResponse;</span><br><span class="line">import org.apache.ambari.server.controller.spi.*;</span><br><span class="line">import org.apache.ambari.server.orm.dao.HostComponentStateDAO;</span><br><span class="line">import org.apache.ambari.server.orm.entities.HostComponentStateEntity;</span><br><span class="line">import org.apache.ambari.server.utils.ShellCommandUtil;</span><br><span class="line">import org.apache.commons.io.FileUtils;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Yarn资源</span><br><span class="line"> *</span><br><span class="line"> * @author Erik</span><br><span class="line"> * @date 2020&#x2F;12&#x2F;7</span><br><span class="line"> *&#x2F;</span><br><span class="line">@StaticallyInject</span><br><span class="line">public class YarnResourceProvider extends AbstractControllerResourceProvider &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(YarnResourceProvider.class);</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    protected static HostComponentStateDAO hostComponentStateDAO;</span><br><span class="line"></span><br><span class="line">    public static final String YARN_RESOURCE_CATEGORY &#x3D; &quot;yarn&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Yarn application info</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static final String APPLICATION_ID_PROPERTY_ID &#x3D; &quot;applicationId&quot;;</span><br><span class="line">    public static final String APPLICATION_NAME_PROPERTY_ID &#x3D; &quot;applicationName&quot;;</span><br><span class="line">    public static final String APPLICATION_TYPE_PROPERTY_ID &#x3D; &quot;applicationType&quot;;</span><br><span class="line">    public static final String USER_PROPERTY_ID &#x3D; &quot;user&quot;;</span><br><span class="line">    public static final String QUEUE_PROPERTY_ID &#x3D; &quot;queue&quot;;</span><br><span class="line">    public static final String STATE_PROPERTY_ID &#x3D; &quot;state&quot;;</span><br><span class="line">    public static final String FINAL_STATE_PROPERTY_ID &#x3D; &quot;finalState&quot;;</span><br><span class="line">    public static final String PROGRESS_PROPERTY_ID &#x3D; &quot;progress&quot;;</span><br><span class="line">    public static final String TRACKINGURL_PROPERTY_ID &#x3D; &quot;trackingUrl&quot;;</span><br><span class="line">    public static final String LOG_INFO_PROPERTY_ID &#x3D; &quot;logInfo&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static final String YARN_APPLICATION_ID_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_ID_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_APPLICATION_NAME_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_NAME_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_APPLICATION_TYPE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + APPLICATION_TYPE_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_USER_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + USER_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_QUEUE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + QUEUE_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_STATE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + STATE_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_FINAL_STATE_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + FINAL_STATE_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_PROGRESS_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + PROGRESS_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_TRACKINGURL_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + TRACKINGURL_PROPERTY_ID;</span><br><span class="line">    public static final String YARN_LOG_INFO_PROPERTY_ID &#x3D; YARN_RESOURCE_CATEGORY + &quot;&#x2F;&quot; + LOG_INFO_PROPERTY_ID;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * The key property ids for a Yarn resource.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;Resource.Type, String&gt; keyPropertyIds &#x3D; ImmutableMap.&lt;Resource.Type, String&gt;builder()</span><br><span class="line">            .put(Resource.Type.Yarn, YARN_APPLICATION_ID_PROPERTY_ID)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * The property ids for a Yarn resource.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Set&lt;String&gt; propertyIds &#x3D; Sets.newHashSet(</span><br><span class="line">            YARN_APPLICATION_ID_PROPERTY_ID,</span><br><span class="line">            YARN_APPLICATION_NAME_PROPERTY_ID,</span><br><span class="line">            YARN_APPLICATION_TYPE_PROPERTY_ID,</span><br><span class="line">            YARN_USER_PROPERTY_ID,</span><br><span class="line">            YARN_QUEUE_PROPERTY_ID,</span><br><span class="line">            YARN_STATE_PROPERTY_ID,</span><br><span class="line">            YARN_FINAL_STATE_PROPERTY_ID,</span><br><span class="line">            YARN_PROGRESS_PROPERTY_ID,</span><br><span class="line">            YARN_TRACKINGURL_PROPERTY_ID,</span><br><span class="line">            YARN_LOG_INFO_PROPERTY_ID);</span><br><span class="line"></span><br><span class="line">    public YarnResourceProvider(AmbariManagementController managementController) &#123;</span><br><span class="line">        super(Resource.Type.Yarn, propertyIds, keyPropertyIds, managementController);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Set&lt;String&gt; getPKPropertyIds() &#123;</span><br><span class="line">        return new HashSet&lt;&gt;(keyPropertyIds.values());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Set&lt;Resource&gt; getResources(Request request, Predicate predicate)</span><br><span class="line">            throws SystemException, UnsupportedPropertyException, NoSuchResourceException, NoSuchParentResourceException &#123;</span><br><span class="line"></span><br><span class="line">        LOG.info(&quot;Into YarnResourceProvider:getResource.&quot;);</span><br><span class="line">        final Set&lt;YarnRequest&gt; requests &#x3D; new HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        if (predicate &#x3D;&#x3D; null) &#123;</span><br><span class="line">            LOG.info(&quot;Predicate is null.&quot;);</span><br><span class="line">            requests.add(getRequest(null));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            LOG.info(&quot;Predicate not null.&quot;);</span><br><span class="line">            for (Map&lt;String, Object&gt; propertyMap : getPropertyMaps(predicate)) &#123;</span><br><span class="line">                YarnRequest req &#x3D; getRequest(propertyMap);</span><br><span class="line">                requests.add(req);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 获取 Yarn 资源</span><br><span class="line">        Set&lt;YarnResponse&gt; responses &#x3D; getYarnResources(requests);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 构建返回数据</span><br><span class="line">        Set&lt;String&gt; requestedIds &#x3D; getRequestPropertyIds(request, predicate);</span><br><span class="line">        Set&lt;Resource&gt; resources &#x3D; new HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        for (YarnResponse yarnResponse : responses) &#123;</span><br><span class="line">            ResourceImpl resource &#x3D; new ResourceImpl(Resource.Type.Yarn);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_APPLICATION_ID_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getApplicationId(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_APPLICATION_NAME_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getApplicationName(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_APPLICATION_TYPE_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getApplicationType(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_USER_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getUser(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_QUEUE_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getQueue(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_STATE_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getState(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_FINAL_STATE_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getFinalState(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_PROGRESS_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getProgress(), requestedIds);</span><br><span class="line"></span><br><span class="line">            setResourceProperty(resource, YARN_LOG_INFO_PROPERTY_ID,</span><br><span class="line">                    yarnResponse.getLogInfo(), requestedIds);</span><br><span class="line"></span><br><span class="line">            resources.add(resource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return resources;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取 Yarn 资源信息</span><br><span class="line">     *</span><br><span class="line">     * @param requests requests</span><br><span class="line">     * @return Set&lt;YarnResponse&gt;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Set&lt;YarnResponse&gt; getYarnResources(Set&lt;YarnRequest&gt; requests) throws NoSuchResourceException &#123;</span><br><span class="line">        Set&lt;YarnResponse&gt; responsesSet &#x3D; new HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 获取 resourceManager 所在的节点</span><br><span class="line">        String hostName &#x3D; getHostName();</span><br><span class="line"></span><br><span class="line">        for (YarnRequest request : requests) &#123;</span><br><span class="line">            String applicationId &#x3D; request.getApplicationId();</span><br><span class="line"></span><br><span class="line">            &#x2F;**</span><br><span class="line">             * 如果 applicationId 为空，则返回所有 application 信息</span><br><span class="line">             * 如果 applicationId 不为空，则查询日志</span><br><span class="line">             *&#x2F;</span><br><span class="line">            if (null &#x3D;&#x3D; applicationId) &#123;</span><br><span class="line">                LOG.info(&quot;applicationId is null.&quot;);</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F; 执行语句</span><br><span class="line">                String[] remoteAppListCmdStr &#x3D; new String[]&#123;&quot;ssh&quot;, hostName, &quot;yarn&quot;, &quot;application&quot;, &quot;-list&quot;, &quot;-appStates&quot;, &quot;ALL&quot;&#125;;</span><br><span class="line">                printCmd(remoteAppListCmdStr);</span><br><span class="line"></span><br><span class="line">                String stdout &#x3D; null;</span><br><span class="line">                try &#123;</span><br><span class="line"></span><br><span class="line">                    ShellCommandUtil.Result cmdResult &#x3D; ShellCommandUtil.runCommand(remoteAppListCmdStr);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 判断结果码</span><br><span class="line">                    if (cmdResult.getExitCode() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        stdout &#x3D; cmdResult.getStdout();</span><br><span class="line"></span><br><span class="line">                        if (stdout !&#x3D; null) &#123;</span><br><span class="line"></span><br><span class="line">                            &#x2F;&#x2F; 解析输出结果</span><br><span class="line">                            responsesSet &#x3D; parseApplicationInfo(stdout);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            LOG.error(&quot;Run command stdout is empty!&quot;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        LOG.error(&quot;Run command error,exitCode is:&#123;&#125;.&quot;, cmdResult.getExitCode());</span><br><span class="line">                        throw new SystemException(&quot;Run command error!&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    LOG.error(&quot;Run command error - Executor exception (&#123;&#125;)&quot;, e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                LOG.info(&quot;ApplicationId is:&#123;&#125;.&quot;, applicationId);</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">                    String appLogCmdStr &#x3D; &quot;su hdfs -c \&#39;yarn logs -applicationId &quot; + applicationId + &quot;\&#39;&quot;;</span><br><span class="line">                    String[] remoteAppLogCmdStr &#x3D; new String[]&#123;&quot;ssh&quot;, hostName, appLogCmdStr&#125;;</span><br><span class="line">                    printCmd(remoteAppLogCmdStr);</span><br><span class="line"></span><br><span class="line">                    LOG.info(&quot;Start execute shell cmd.&quot;);</span><br><span class="line">                    ShellCommandUtil.Result cmdResult &#x3D; ShellCommandUtil.runCommand(remoteAppLogCmdStr);</span><br><span class="line">                    LOG.info(&quot;Execute finish.&quot;);</span><br><span class="line"></span><br><span class="line">                    LOG.info(&quot;cmdResult exitCode:&#123;&#125;&quot;, cmdResult.getExitCode());</span><br><span class="line">                    if (cmdResult.getExitCode() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        String stdout &#x3D; cmdResult.getStdout();</span><br><span class="line"></span><br><span class="line">                        YarnResponse yarnResponse &#x3D; new YarnResponse();</span><br><span class="line">                        yarnResponse.setLogInfo(stdout);</span><br><span class="line">                        yarnResponse.setApplicationId(applicationId);</span><br><span class="line">                        responsesSet.add(yarnResponse);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        LOG.error(&quot;Run command error,exitCode is:&#123;&#125;.&quot;, cmdResult.getExitCode());</span><br><span class="line">                        throw new SystemException(&quot;Run command error!&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    LOG.error(&quot;Run command error - Executor exception (&#123;&#125;)&quot;, e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return responsesSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取 resourcemanager 节点</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String getHostName() throws NoSuchResourceException &#123;</span><br><span class="line">        String hostName &#x3D; null;</span><br><span class="line">        String serviceName &#x3D; &quot;YARN&quot;;</span><br><span class="line">        String componentName &#x3D; &quot;RESOURCEMANAGER&quot;;</span><br><span class="line"></span><br><span class="line">        List&lt;HostComponentStateEntity&gt; hostComponentStateEntities &#x3D; hostComponentStateDAO.findByServiceAndComponent(serviceName, componentName);</span><br><span class="line">        HostComponentStateEntity hostComponentStateEntity &#x3D; hostComponentStateEntities.get(0);</span><br><span class="line">        if (hostComponentStateEntity !&#x3D; null) &#123;</span><br><span class="line">            hostName &#x3D; hostComponentStateEntity.getHostName();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            throw new NoSuchResourceException(&quot;Not find resourceManager in this cluster!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return hostName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 解析 application 信息</span><br><span class="line">     *</span><br><span class="line">     * @param stdout 输出信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Set&lt;YarnResponse&gt; parseApplicationInfo(String stdout) &#123;</span><br><span class="line">        Set&lt;YarnResponse&gt; yarnResponseSet &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 将字符串转换为字节流</span><br><span class="line">        ByteArrayInputStream byteArrayInputStream &#x3D; new ByteArrayInputStream(stdout.getBytes(Charset.forName(&quot;utf8&quot;)));</span><br><span class="line">        BufferedReader br &#x3D; new BufferedReader(new InputStreamReader(byteArrayInputStream, Charset.forName(&quot;utf8&quot;)));</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 逐行读取</span><br><span class="line">         * 只解析以“application_”开头的行</span><br><span class="line">         *&#x2F;</span><br><span class="line">        try &#123;</span><br><span class="line">            String line;</span><br><span class="line">            while ((line &#x3D; br.readLine()) !&#x3D; null) &#123;</span><br><span class="line"></span><br><span class="line">                if (line.startsWith(&quot;application_&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">                    String[] property &#x3D; line.split(&quot;\t&quot;);</span><br><span class="line"></span><br><span class="line">                    YarnResponse yarnResponse &#x3D; new YarnResponse();</span><br><span class="line"></span><br><span class="line">                    yarnResponse.setApplicationId(property[0].trim());</span><br><span class="line">                    yarnResponse.setApplicationName(property[1].trim());</span><br><span class="line">                    yarnResponse.setApplicationType(property[2].trim());</span><br><span class="line">                    yarnResponse.setUser(property[3].trim());</span><br><span class="line">                    yarnResponse.setQueue(property[4].trim());</span><br><span class="line">                    yarnResponse.setState(property[5].trim());</span><br><span class="line">                    yarnResponse.setFinalState(property[6].trim());</span><br><span class="line">                    yarnResponse.setProgress(property[7].trim());</span><br><span class="line">                    yarnResponse.setTrackingUrl(property[8].trim());</span><br><span class="line"></span><br><span class="line">                    yarnResponseSet.add(yarnResponse);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            br.close();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return yarnResponseSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 打印执行命令</span><br><span class="line">     *</span><br><span class="line">     * @param cmd 命令字符串</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void printCmd(String[] cmd) &#123;</span><br><span class="line"></span><br><span class="line">        String cmdStr &#x3D; &quot;&quot;;</span><br><span class="line">        for (String str : cmd) &#123;</span><br><span class="line">            cmdStr &#x3D; cmdStr + str + &quot; &quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOG.info(&quot;Cmd str is:&#123;&#125;.&quot;, cmdStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private YarnRequest getRequest(Map&lt;String, Object&gt; properties) &#123;</span><br><span class="line">        YarnRequest yarnRequest &#x3D; new YarnRequest(null);</span><br><span class="line">        if (properties &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return yarnRequest;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object object &#x3D; properties.get(YARN_APPLICATION_ID_PROPERTY_ID);</span><br><span class="line">        if (object !&#x3D; null) &#123;</span><br><span class="line">            String applicationId &#x3D; properties.get(YARN_APPLICATION_ID_PROPERTY_ID).toString();</span><br><span class="line">            LOG.info(&quot;Request:applicationId:&#123;&#125;&quot;, applicationId);</span><br><span class="line"></span><br><span class="line">            yarnRequest &#x3D; new YarnRequest(applicationId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return yarnRequest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h1><p>这里使用 Postman  进行接口调用测试，分别测试查询全部 Yarn任务、模糊查询 Yarn 任务和查询某个 Yarn 任务的日志。</p>
<ul>
<li>获取全部 Yarn 任务</li>
</ul>
<p>查询全部 Yarn 任务，并且分页查询，每页显示 10 个，从第 1 个数据开始，以 applicationId 的倒序查询。</p>
<p><code>http://IP:8080/api/v1/yarn?fields=yarn/*&amp;page_size=10&amp;from=0&amp;sortBy=yarn/applicationId.desc</code></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211160422.png" alt=""></p>
<ul>
<li>模糊查询 Yarn 任务</li>
</ul>
<p>模糊查询符合 applicationId 条件的 Yarn 任务。</p>
<p><code>http://IP:8080/api/v1/yarn?fields=yarn/*&amp;page_size=10&amp;from=0&amp;sortBy=yarn/applicationId.desc</code></p>
<p>Body：<code>{&quot;RequestInfo&quot;:{&quot;query&quot;:&quot;yarn/applicationId.matches(.*002.*)&quot;}}</code><br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211160457.png" alt=""></p>
<ul>
<li>获取单个 Yarn 任务的日志</li>
</ul>
<p>查询某个 applicationId 的日志。</p>
<p><code>http://IP:8080/api/v1/yarn/application_1606871223118_0001?fields=yarn/applicationId,yarn/logInfo</code><br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211160546.png" alt=""></p>
<p>至此，自定义资源类型的查询功能开发完毕，也可以仿照其他资源类型开发增加（POST）、修改（PUT）和删除（DELETE）功能。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>主要介绍了自定义 Ambari 资源的流程，主要分为添加资源类型、新建控制器层、新建资源 Provider、新建资源定义、新建 reqquest 和 response等，涉及到数据库表的时候还要添加数据库的 DAO 层和 Entity 类，具体实现逻辑在资源 Provider 中实现。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 安装详细步骤</title>
    <url>/2020/12/03/ambari-install/</url>
    <content><![CDATA[<p>本文详细的介绍了 Ambari 安装步骤，包括基础环境设置、准备工作、安装Ambari和创建集群。</p>
<a id="more"></a>

<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><p>Windows 10 安装 VMware虚拟机</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.72.131 Server1</span><br><span class="line"></span><br><span class="line">192.168.72.132 Server2</span><br><span class="line"></span><br><span class="line">192.168.72.133 Server3</span><br></pre></td></tr></table></figure>

<h1 id="版本信息"><a href="#版本信息" class="headerlink" title="版本信息"></a>版本信息</h1><ul>
<li><p>Linux:CentOS 7.6（CentOS-7-x86_64-DVD-1810.iso）</p>
</li>
<li><p>Java：1.8.0（jdk-8u131-linux-x64.tar.gz）</p>
</li>
<li><p>Ambari：2.7.1（ambari-2.7.1.0-centos7.tar.gz）</p>
</li>
<li><p>HDP：3.0.1（HDP-3.0.1.0-centos7-rpm.tar.gz.tar）</p>
</li>
</ul>
<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><ul>
<li>Ambari Repositories - Hortonworks Data Platform</li>
</ul>
<p><a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.7.1.0/bk_ambari-installation/content/ambari_repositories.html" target="_blank" rel="noopener">https://docs.hortonworks.com/HDPDocuments/Ambari-2.7.1.0/bk_ambari-installation/content/ambari_repositories.html</a></p>
<ul>
<li>HDP 3.0.1 Repositories - Hortonworks Data Platform</li>
</ul>
<p><a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.7.1.0/bk_ambari-installation/content/hdp_30_repositories.html" target="_blank" rel="noopener">https://docs.hortonworks.com/HDPDocuments/Ambari-2.7.1.0/bk_ambari-installation/content/hdp_30_repositories.html</a></p>
<h1 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h1><h2 id="设置静态-IP"><a href="#设置静态-IP" class="headerlink" title="设置静态 IP"></a>设置静态 IP</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts</span><br><span class="line"></span><br><span class="line">cp ifcfg-ens33 ifcfg-ens33.bak</span><br><span class="line"></span><br><span class="line">vim ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>根据实际情况修改如下信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">TYPE&#x3D;&quot;Ethernet&quot;</span><br><span class="line"></span><br><span class="line">PROXY_METHOD&#x3D;&quot;none&quot;</span><br><span class="line"></span><br><span class="line">BROWSER_ONLY&#x3D;&quot;no&quot;</span><br><span class="line"></span><br><span class="line">BOOTPROTO&#x3D;&quot;static&quot;</span><br><span class="line"></span><br><span class="line">DEFROUTE&#x3D;&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">IPV4_FAILURE_FATAL&#x3D;&quot;no&quot;</span><br><span class="line"></span><br><span class="line">IPV6INIT&#x3D;&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">IPV6_AUTOCONF&#x3D;&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">IPV6_DEFROUTE&#x3D;&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">IPV6_FAILURE_FATAL&#x3D;&quot;no&quot;</span><br><span class="line"></span><br><span class="line">IPV6_ADDR_GEN_MODE&#x3D;&quot;stable-privacy&quot;</span><br><span class="line"></span><br><span class="line">NAME&#x3D;&quot;ens33&quot;</span><br><span class="line"></span><br><span class="line">UUID&#x3D;&quot;7340f7b1-d3e4-4e2b-a9a3-05d71b8ac8b4&quot;</span><br><span class="line"></span><br><span class="line">DEVICE&#x3D;&quot;ens33&quot;</span><br><span class="line"></span><br><span class="line">ONBOOT&#x3D;&quot;yes&quot;</span><br><span class="line"></span><br><span class="line">IPADDR&#x3D;&quot;192.168.72.131&quot;</span><br><span class="line"></span><br><span class="line">GATEWAY&#x3D;&quot;192.168.72.2&quot;</span><br><span class="line"></span><br><span class="line">NETMASK&#x3D;&quot;255.255.255.0&quot;</span><br><span class="line"></span><br><span class="line">DNS1&#x3D;&quot;192.168.72.2&quot;</span><br><span class="line"></span><br><span class="line">NM_CONTROLLED&#x3D;&quot;no&quot;</span><br></pre></td></tr></table></figure>

<p>DNS1需要与GATEWAY一样，虚拟机查看子网掩码和网关的路径为：</p>
<p>VMware —— 编辑 —— 虚拟网络编辑器 —— NAT模式 —— NAT设置</p>
<p>重启网络</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><ul>
<li>查看防火墙状态</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure>

<p>查看开机是否启动防火墙服务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl is-enabled firewalld</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭防火墙</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<p>再次查看防火墙状态和开机防火墙是否启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">systemctl is-enabled firewalld</span><br></pre></td></tr></table></figure>

<ul>
<li>禁用selinux</li>
</ul>
<p>永久性关闭selinux（重启服务器生效）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;selinux</span><br><span class="line"></span><br><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>

<p>重启系统</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure>

<p>查看selinux状态</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getenforce</span><br></pre></td></tr></table></figure>

<p>disabled为永久关闭，permissive为临时关闭，enforcing为开启</p>
<h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install lrzsz -y</span><br></pre></td></tr></table></figure>

<h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><p>jdk 1.8.0_131 版本下载地址：</p>
<p>链接：<a href="https://pan.baidu.com/s/1jsLxPkmH1nRfnICYOGK_ow" target="_blank" rel="noopener">https://pan.baidu.com/s/1jsLxPkmH1nRfnICYOGK_ow</a> </p>
<p>提取码：3l6y </p>
<p>创建存放目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;java</span><br><span class="line"></span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;java&#x2F;</span><br></pre></td></tr></table></figure>

<p>上传 jdk-8u131-linux-x64.tar.gz</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar -xzvf jdk-8u131-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>结尾添加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131</span><br><span class="line"></span><br><span class="line">CLASSPATH&#x3D;.:\$JAVA_HOME&#x2F;lib.tools.jar</span><br><span class="line"></span><br><span class="line">PATH&#x3D;\$JAVA_HOME&#x2F;bin:\$PATH</span><br><span class="line"></span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure>

<p>生效配置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>查看版本信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/ff6af0496bf021398bcc54d5d705f91c.png" alt=""></p>
<p>将jdk文件传输到其它主机</p>
<p>在 Server2 和 Server3 中执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;java</span><br><span class="line"></span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;java&#x2F;</span><br></pre></td></tr></table></figure>

<p>在Server1中执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp -r jdk1.8.0_131&#x2F; root@192.168.72.132:&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131</span><br><span class="line">scp -r &#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131&#x2F; root@192.168.72.132:&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131</span><br><span class="line">scp -r &#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131&#x2F; root@192.168.72.133:&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131</span><br></pre></td></tr></table></figure>

<p>然后配置环境变量。</p>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p>只在Server1上安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;repo.mysql.com&#x2F;mysql57-community-release-el7-8.noarch.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql57-community-release-el7-8.noarch.rpm  --nodeps --force</span><br><span class="line"></span><br><span class="line">yum install mysql-server</span><br><span class="line"></span><br><span class="line">service mysqld status</span><br><span class="line"></span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>

<p>MySQL为root用户生成的随机密码通过mysqld.log文件可以查找到：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep &#39;temporary password&#39; &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; Enter password: （输入刚才查询到的随机密码）</span><br><span class="line">mysql&gt; SET PASSWORD FOR &#39;root&#39;@&#39;localhost&#39;&#x3D; &quot;Root-123&quot;;</span><br><span class="line">mysql&gt; exit</span><br></pre></td></tr></table></figure>


<p>用root新密码登录：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -u root -pRoot-123</span><br></pre></td></tr></table></figure>

<p>配置远程登录</p>
<p>允许使用用户名 root 密码 Root-123456 从任何主机连接到mysql服务器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;Root-123456&#39; WITH GRANT OPTION;</span><br><span class="line">mysql&gt;FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt;exit;</span><br></pre></td></tr></table></figure>

<p>创建ambari数据库及用户，登录root用户执行下面语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create database ambari character set utf8 ;  </span><br><span class="line">CREATE USER &#39;ambari&#39;@&#39;%&#39;IDENTIFIED BY &#39;Ambari-123&#39;;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;ambari&#39;@&#39;%&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>安装mysql jdbc 驱动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install mysql-connector-java</span><br></pre></td></tr></table></figure>

<h2 id="设置host"><a href="#设置host" class="headerlink" title="设置host"></a>设置host</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure>
<p>输入 ip 和 hostname</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.72.131 Server1</span><br><span class="line"></span><br><span class="line">192.168.72.132 Server2</span><br><span class="line"></span><br><span class="line">192.168.72.133 Server3</span><br></pre></td></tr></table></figure>

<p>测试下，分别在三台机器上执行，都能ping通则说明配置成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping Server1</span><br><span class="line"></span><br><span class="line">ping Server2</span><br><span class="line"></span><br><span class="line">ping Server3</span><br></pre></td></tr></table></figure>

<h2 id="SSH免密"><a href="#SSH免密" class="headerlink" title="SSH免密"></a>SSH免密</h2><p>Server1：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p>一路回车</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8e0efce609ee14153491dad64c5a8771.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd ~&#x2F;.ssh&#x2F;</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/fa8158f5ecee7683817eb681a3a7aa40.png" alt=""></p>
<p>Server2：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh Server2</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/b09bb03187164cd8c42eda7071d18176.png" alt=""></p>
<p>Server3：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh Server3</span><br></pre></td></tr></table></figure>

<p>Server1：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scp ~&#x2F;.ssh&#x2F;authorized_keys Server2:~&#x2F;.ssh&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/23943475ac388d33698d91ea8e157f56.png" alt=""></p>
<p>Server2：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/a72b3ddc9c3d6fb52241e0beb728a8e8.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd ~&#x2F;.ssh&#x2F;</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">scp ~&#x2F;.ssh&#x2F;authorized_keys Server3:~&#x2F;.ssh&#x2F;</span><br></pre></td></tr></table></figure>

<p>Server3:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">cd ~&#x2F;.ssh&#x2F;</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">scp ~&#x2F;.ssh&#x2F;authorized_keys Server1:~&#x2F;.ssh&#x2F;</span><br><span class="line">scp ~&#x2F;.ssh&#x2F;authorized_keys Server2:~&#x2F;.ssh&#x2F;</span><br></pre></td></tr></table></figure>

<p>各个节点检查 known_hosts</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat ~&#x2F;.ssh&#x2F;known_hosts</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/38875254e06a54267a85861a73e4a5d3.png" alt=""></p>
<p>如果缺少哪个节点，就ssh 哪个节点</p>
<p>最后在每个节点验证ssh 其它节点可以免密</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="开启NTP服务"><a href="#开启NTP服务" class="headerlink" title="开启NTP服务"></a>开启NTP服务</h2><p>所有节点执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install ntp -y</span><br><span class="line"></span><br><span class="line">systemctl is-enabled ntpd</span><br><span class="line"></span><br><span class="line">systemctl enable ntpd</span><br><span class="line"></span><br><span class="line">systemctl start ntpd</span><br></pre></td></tr></table></figure>

<h2 id="安装HTTP服务"><a href="#安装HTTP服务" class="headerlink" title="安装HTTP服务"></a>安装HTTP服务</h2><p>Server1：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install httpd</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl start httpd.service</span><br><span class="line"></span><br><span class="line">systemctl enable httpd.service</span><br></pre></td></tr></table></figure>

<h2 id="安装本地源制作相关工具"><a href="#安装本地源制作相关工具" class="headerlink" title="安装本地源制作相关工具"></a>安装本地源制作相关工具</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install yum-utils createrepo</span><br></pre></td></tr></table></figure>

<h2 id="配置本地源"><a href="#配置本地源" class="headerlink" title="配置本地源"></a>配置本地源</h2><p>切换目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;etc&#x2F;yum.repos.d&#x2F;</span><br></pre></td></tr></table></figure>

<p>编辑<code>ambari.repo</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ambari]</span><br><span class="line"></span><br><span class="line">name&#x3D;ambari</span><br><span class="line"></span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.72.131&#x2F;ambari&#x2F;ambari&#x2F;centos7&#x2F;2.7.1.0-169</span><br><span class="line"></span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line"></span><br><span class="line">HDP.repo</span><br><span class="line"></span><br><span class="line">[HDP]</span><br><span class="line"></span><br><span class="line">name&#x3D;HDP</span><br><span class="line"></span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.72.131&#x2F;ambari&#x2F;HDP&#x2F;centos7&#x2F;3.0.1.0</span><br><span class="line"></span><br><span class="line">path&#x3D;&#x2F;</span><br><span class="line"></span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">gpgcheck&#x3D;0</span><br></pre></td></tr></table></figure>

<p>编辑<code>HDP-UTILS.repo</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[HDP-UTILS]</span><br><span class="line"></span><br><span class="line">name&#x3D;HDP-UTILS</span><br><span class="line"></span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.72.131&#x2F;ambari&#x2F;HDP-UTILS&#x2F;centos7&#x2F;1.1.0.22</span><br><span class="line"></span><br><span class="line">path&#x3D;&#x2F;</span><br><span class="line"></span><br><span class="line">enabled&#x3D;1</span><br><span class="line"></span><br><span class="line">gpgcheck&#x3D;0</span><br></pre></td></tr></table></figure>

<p>在所有节点都要更新源</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line"></span><br><span class="line">yum list update</span><br><span class="line"></span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>

<h1 id="安装Ambari"><a href="#安装Ambari" class="headerlink" title="安装Ambari"></a>安装Ambari</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install ambari-server</span><br></pre></td></tr></table></figure>

<h2 id="配置Ambari"><a href="#配置Ambari" class="headerlink" title="配置Ambari"></a>配置Ambari</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server setup</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/6c054e178921cc3d0cfb99c73ec245d8.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/1ef4a4dc7ef4595e043159d09211d78a.png" alt=""></p>
<p>数据库密码填写之前设置的密码:Ambari-123</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/57e1f2169f039399e2bda1745c4ed4d1.png" alt=""></p>
<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uambari –pAmbari-123</span><br><span class="line">use ambari;</span><br><span class="line">source &#x2F;var&#x2F;lib&#x2F;ambari-server&#x2F;resources&#x2F;Ambari-DDL-MySQL-CREATE.sql</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

<h2 id="启动ambari"><a href="#启动ambari" class="headerlink" title="启动ambari"></a>启动ambari</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server start</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/6e17924e4a8664119a95dcbfa2cdfec0.png" alt=""></p>
<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>浏览器输入：<a href="http://192.168.72.131:8080" target="_blank" rel="noopener">http://192.168.72.131:8080</a></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5d85538af1e09822dbc715d057c1bddc.png" alt=""></p>
<p>默认用户名/密码：admin/admin</p>
<h1 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h1><ul>
<li>命名集群</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/49b1651e3d26778685931fb9bfd990f3.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/25dfdeebf2055c56686018920075daae.png" alt=""></p>
<ul>
<li>选择版本</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/33d2b0e41f16870004f9107eebf22982.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/b6f3b96d08a3a96e9cc6597ffa65bc9f.png" alt=""></p>
<p>填写刚才配置的repo文件中的地址</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.72.131&#x2F;ambari&#x2F;HDP&#x2F;centos7&#x2F;3.0.1.0</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.72.131&#x2F;ambari&#x2F;HDP-UTILS&#x2F;centos7&#x2F;1.1.0.22</span><br></pre></td></tr></table></figure>

<ul>
<li>注册主机</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/1f5e6cee32f0ee9f2a75cbc523692c96.png" alt=""></p>
<p>通过<code>cat /root/.ssh/id_rsa</code>查看私钥内容。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/54568d977005fa489e52aee8d7d86893.png" alt=""></p>
<ul>
<li>安装服务<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e0d48726e519756a42db6d90408e0d27.png" alt=""></li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/23b56e8cc107766e6f66ea19726cf905.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/ce5c956cdf2099af06fa91c60d9de7c1.png" alt=""></p>
<ul>
<li>参数配置<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/d7c4e11cc89c2c8bcc7b5de0bd90852f.png" alt=""></li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/768537d359e16032c1ea24635bbddcec.png" alt=""></p>
<ul>
<li>检查</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2107e7608ed438037543b93938325e12.png" alt=""></p>
<ul>
<li>安装进度</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/997d98ceb44ba4668aca83c904d2792a.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/0c70c7ff7b100676a7e1ed493ce223e7.png" alt=""></p>
<ul>
<li>安装概要</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/b513b4824fa13bbb9126595cbabd5908.png" alt=""></p>
<ul>
<li>查看仪表盘</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/530119886c1e3915e8be3c898c9c1dfb.png" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>CentOS 7.2 安装 MySQL 5.7.13_数据库技术_Linux公社-Linux系统门户网站<br><a href="https://www.linuxidc.com/Linux/2017-03/141300.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2017-03/141300.htm</a> </p>
</li>
<li><p>centos7设置SSH免密码登录教程 - 简书<br><a href="https://www.jianshu.com/p/991b39c48b0f" target="_blank" rel="noopener">https://www.jianshu.com/p/991b39c48b0f</a> </p>
</li>
<li><p>Ambari2.7.1安装配置 - CREATE_17的博客 - CSDN博客<br><a href="https://blog.csdn.net/CREATE_17/article/details/83692585" target="_blank" rel="noopener">https://blog.csdn.net/CREATE_17/article/details/83692585</a> </p>
</li>
<li><p>CentOS 7.2 安装 Ambari 2.2.2 + HDP 2.4.2 搭建Hadoop集群_服务器应用_Linux公社-Linux系统门户网站<br><a href="https://www.linuxidc.com/Linux/2017-03/141302.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2017-03/141302.htm</a> </p>
</li>
</ul>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 功能列表</title>
    <url>/2020/12/03/ambari-function/</url>
    <content><![CDATA[<p>本文列举了 Ambari 的主要功能，并梳理成思维导图。</p>
<a id="more"></a>

<p>Ambari 主要包含仪表盘、服务、主机、警告、集群管理和管理几个大的功能模块。</p>
<h1 id="仪表盘"><a href="#仪表盘" class="headerlink" title="仪表盘"></a>仪表盘</h1><p>仪表盘主要展示监控数据，有监控、热点图和配置历史三个 table 页。</p>
<h1 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h1><p>服务模块是最重要也是最常操作的，包括已安装服务列表、添加服务、服务概要、参数配置、快速链接、操作等功能。</p>
<h1 id="主机"><a href="#主机" class="headerlink" title="主机"></a>主机</h1><p>主机界面显示主机列表，点击主机名可以进入主机概要页，可以查看已安装的组件，主机操作可以对该主机上的全部组件进行批量启停操作。</p>
<h1 id="警告"><a href="#警告" class="headerlink" title="警告"></a>警告</h1><p>警告界面列出所有的警告信息，可以查看警告级别、定义、所属服务以及状态，可以点击状态将其禁用，这样就不会有这个告警了。</p>
<h1 id="集群管理"><a href="#集群管理" class="headerlink" title="集群管理"></a>集群管理</h1><p>集群管理包括软件栈和版本信息、服务账号、安全认证和服务开机自启，其中安全认证是开启kerberos的入口。</p>
<h1 id="管理-Ambari"><a href="#管理-Ambari" class="headerlink" title="管理 Ambari"></a>管理 Ambari</h1><p>主要包括集群管理、用户管理、视图信息，其中用户管理很重要。</p>
<h1 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h1><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/Ambari-Function.png" alt=""></p>
<p>可以右键复制图片链接到浏览器中查看原图。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 二次开发快速部署测试方法</title>
    <url>/2020/12/13/ambari-dev-by-replace-class/</url>
    <content><![CDATA[<p>本文主要通过替换 class 文件的方法对 Ambari 二次开发，可以达到快速开发测试的目的。</p>
<a id="more"></a>

<p>在二次开发 Ambari 时，需要对开发的内容进行快速测试，如果使用完整的 CI 打包流程部署测试则太庞大笨重，这里介绍通过替换 class 文件的方法进行快速部署测试的方法。</p>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><ul>
<li><p>一套部署好的 Ambari 环境<br>这套环境已经部署好 Ambari，可正常运行，供测试使用。</p>
</li>
<li><p>IDE 开发工具<br>这里使用 IDEA 开发工具。</p>
</li>
<li><p>压缩软件<br>一款压缩软件，这里使用 7-zip。</p>
</li>
<li><p>Postman<br>最好准备一个 Postman 进行接口测试。</p>
</li>
</ul>
<h1 id="二次开发"><a href="#二次开发" class="headerlink" title="二次开发"></a>二次开发</h1><p>比如我们修改一个类，将 <code>org.apache.ambari.server.utils.ShellCommandUtil</code> 类的这段代码的 <code>process.waitFor();</code> 调换下位置，避免在执行大输出量的 shell 语句时造成阻塞，源代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;TODO: not sure whether output buffering will work properly</span><br><span class="line">&#x2F;&#x2F; if command output is too intensive</span><br><span class="line">process.waitFor();</span><br><span class="line">String stdout &#x3D; streamToString(inputStream);</span><br><span class="line">String stderr &#x3D; streamToString(process.getErrorStream());</span><br><span class="line">int exitCode &#x3D; process.exitValue();</span><br><span class="line">return new Result(exitCode, stdout, stderr);</span><br></pre></td></tr></table></figure>

<p>将其修改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String stdout &#x3D; streamToString(inputStream);</span><br><span class="line">String stderr &#x3D; streamToString(process.getErrorStream());</span><br><span class="line">process.waitFor();</span><br><span class="line">int exitCode &#x3D; process.exitValue();</span><br><span class="line">return new Result(exitCode, stdout, stderr);</span><br></pre></td></tr></table></figure>

<p>然后在 IDEA 中运行 <code>AmbariServer</code> 主程序 <code>org.apache.ambari.server.controller.AmbariServer</code>，会报如下找不到日志文件的错误，这个属于正常，而且要的就是这个效果。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211155219.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">log4j:WARN No appenders could be found for logger (org.apache.ambari.server.utils.AmbariPath).</span><br><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http:&#x2F;&#x2F;logging.apache.org&#x2F;log4j&#x2F;1.2&#x2F;faq.html#noconfig for more info.</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.RuntimeException: ambari.properties not found in classpath</span><br><span class="line">	at org.apache.ambari.server.configuration.Configuration.readConfigFile(Configuration.java:2942)</span><br><span class="line">	at org.apache.ambari.server.configuration.Configuration.&lt;init&gt;(Configuration.java:2733)</span><br><span class="line">	at org.apache.ambari.server.controller.ControllerModule.&lt;init&gt;(ControllerModule.java:203)</span><br><span class="line">	at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:1074)</span><br><span class="line"></span><br><span class="line">Process finished with exit code 1</span><br></pre></td></tr></table></figure>

<p>代开 ambari-server 对应的 target 文件夹  <code>\ambari-server\target</code>，可以看到里面有编译好的 class 文件。</p>
<h1 id="替换-class-文件"><a href="#替换-class-文件" class="headerlink" title="替换 class 文件"></a>替换 class 文件</h1><p>将 Ambari 测试环境中的 <code>ambari-server-2.7.1.0.0.jar</code> 发送到本地做修改使用，发送到本地之前最好做备份，以便回退。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;lib&#x2F;ambari-server&#x2F;</span><br><span class="line">cp ambari-server-2.7.1.0.0.jar ambari-server-2.7.1.0.0.jar.bak</span><br></pre></td></tr></table></figure>

<p>找到修改的 class 文件</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211154523.png" alt=""></p>
<p>使用压缩工具直接打开 jar 包，并找到相应的包，将修改的 class 直接拖到这个包内，并同意如下弹框提示。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211154622.png" alt=""></p>
<p>替换好后直接关闭这个压缩软件打开的窗口。</p>
<h1 id="替换-jar-包"><a href="#替换-jar-包" class="headerlink" title="替换 jar 包"></a>替换 jar 包</h1><p>在 Ambari 测试环境中停止 ambari-server，删除原有 <code>ambari-server-2.7.1.0.0.jar</code>，替换上新的 jar 包。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server stop</span><br><span class="line">rm -rf ambari-server-2.7.1.0.0.jar</span><br></pre></td></tr></table></figure>
<p>开启 ambari-server，为了方便测试，这里使用 debug 模式启动，这样方便调试，具体调试方法可以参考文章<a href="http://www.erik-ly.com/2020/11/26/ambari-remote-debug/" target="_blank" rel="noopener">：Ambari 远程 Debug 调试</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server start --debug</span><br></pre></td></tr></table></figure>

<h1 id="测试接口"><a href="#测试接口" class="headerlink" title="测试接口"></a>测试接口</h1><p>这时可以通过在 Ambari 测试环境中找到相应的界面或使用 Postman 调用接口就行调试。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>主要是通过替换 calss 文件修改 jar 包，达到快速开发测试的目的，其实这还是有些繁琐，改动一点儿还要编译、替换 class、替换 jar 包、启停服务等操作，有更方便的方法欢迎告知，<a href="http://www.erik-ly.com/about/" target="_blank" rel="noopener">联系方式</a>。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 中 metainfo.xml 文件解析</title>
    <url>/2020/11/29/ambari-metainfo/</url>
    <content><![CDATA[<p>本文主要解析 Ambari 服务组件的 metainfo.xml 元素信息具体含义，并以 ZooKeeper 的 metainfo.xml 给出具体分析。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Ambari 中服务的 metainfo.xml 信息至关重要，关乎着服务的发现、安装、依赖、配置等信息。Ambari 定义 HDFS、ZooKeeper 等为 服务（service），定义服务中的角色比如 NameNode、DataNode、ZooKeeper Server、ZooKeeper Client等为组件（component）。</p>
<h1 id="metainfo-元素解析"><a href="#metainfo-元素解析" class="headerlink" title="metainfo 元素解析"></a>metainfo 元素解析</h1><h2 id="根元素"><a href="#根元素" class="headerlink" title="根元素"></a>根元素</h2><p>描述服务的根元素。</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>服务名称。在包含该服务的堆栈定义中包含的所有服务中，名称必须是惟一的。</td>
<td>ZOOKEEPER</td>
</tr>
<tr>
<td>displayName</td>
<td>服务的显示名称。“添加服务”时的“服务”列显示信息。</td>
<td>ZooKeeper</td>
</tr>
<tr>
<td>version</td>
<td>服务的版本。名称和版本一起唯一地标识服务。“添加服务”时的“版本”列显示信息。</td>
<td>3.4.6</td>
</tr>
<tr>
<td>components</td>
<td>该服务的组件列表</td>
<td></td>
</tr>
<tr>
<td>osSpecifics</td>
<td>在特定于操作系统中的服务的包信息</td>
<td></td>
</tr>
<tr>
<td><em>commandScript</em></td>
<td>定义服务级别命令。该命令在客户端的组件实例上执行</td>
<td></td>
</tr>
<tr>
<td><em>comment</em></td>
<td>描述服务的简短描述。“添加服务”时的“描述”列显示信息。</td>
<td>提供高可靠分布式协调的统一服务。</td>
</tr>
<tr>
<td><em>requiredServices</em></td>
<td>集群中应该提供的其它服务（依赖组件）</td>
<td></td>
</tr>
<tr>
<td><em>configuration-dependencies</em></td>
<td>配置文件</td>
<td></td>
</tr>
<tr>
<td><em>restartRequiredAfterRackChange</em></td>
<td>更改配置后是否重启服务。当设置为true时，更改配置后，会出现黄色重启提示条。</td>
<td></td>
</tr>
<tr>
<td><em>configuration-dir</em></td>
<td>如果没有“configuration”，则使用此选项指定一个不同的配置目录</td>
<td></td>
</tr>
</tbody></table>
<h2 id="service-components"><a href="#service-components" class="headerlink" title="service/components"></a>service/components</h2><p>服务包含多个组件。与组件相关联的字段有:</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>组件名称</td>
<td>ZOOKEEPER_SERVER</td>
</tr>
<tr>
<td>displayName</td>
<td>组件的显示名称，在“概要”——“组件”中显示的名称。</td>
<td>ZooKeeper Server</td>
</tr>
<tr>
<td>category</td>
<td>组件的类型——Master、SLAVE、CLIENT</td>
<td>MASTER</td>
</tr>
<tr>
<td>commandScript</td>
<td>定义应用程序范围的命令。该命令在客户端的组件实例上执行</td>
<td></td>
</tr>
<tr>
<td><em>cardinality</em></td>
<td>实例数</td>
<td>MASTER:1-2，Slave:1+</td>
</tr>
<tr>
<td><em>reassignAllowed</em></td>
<td>件是否可以被重新分配/移动到不同的主机。</td>
<td>true / false</td>
</tr>
<tr>
<td><em>customCommands</em></td>
<td>除了标准命令外，一组与组件关联的自定义命令。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="service-osSpecifics"><a href="#service-osSpecifics" class="headerlink" title="service/osSpecifics"></a>service/osSpecifics</h2><p>操作系统特定的软件包名称(rpm或deb软件包)</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>osFamily</td>
<td>适用该包的操作系统系列</td>
<td>any</td>
</tr>
<tr>
<td>packages</td>
<td>部署服务所需的包的列表</td>
<td></td>
</tr>
<tr>
<td>package/name</td>
<td>包的名称</td>
<td></td>
</tr>
</tbody></table>
<p>service/commandScript</p>
<p>服务命令脚本</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>script</td>
<td>脚本的相对路径</td>
<td></td>
</tr>
<tr>
<td>scriptType</td>
<td>脚本的类型，目前唯一支持的类型是PYTHON</td>
<td></td>
</tr>
<tr>
<td>timeout</td>
<td>命令的自定义超时——这将取代Ambari默认值</td>
<td></td>
</tr>
</tbody></table>
<h2 id="service-component-dependencies-dependency"><a href="#service-component-dependencies-dependency" class="headerlink" title="service/component/dependencies/dependency"></a>service/component/dependencies/dependency</h2><table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>它所依赖的组件的名称</td>
<td></td>
</tr>
<tr>
<td>scope</td>
<td>集群/主机。指定从属组件是否应该出现在同一集群或同一主机中。</td>
<td></td>
</tr>
<tr>
<td>auto-deploy</td>
<td>命令的自定义超时——这将取代Ambari默认值</td>
<td></td>
</tr>
<tr>
<td>conditions</td>
<td>存在这种依赖关系的条件。例如,存在配置中的属性。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="service-component-logs"><a href="#service-component-logs" class="headerlink" title="service/component/logs"></a>service/component/logs</h2><p>提供日志搜索集成。</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>logId</td>
<td>组件的logid</td>
<td>&lt;log&gt;  &lt;logId&gt;hdfs_namenode&lt;/logId&gt;  &lt;primary&gt;true&lt;/primary&gt; &lt;/log&gt;</td>
</tr>
<tr>
<td>primary</td>
<td>是否有主日志id。</td>
<td></td>
</tr>
</tbody></table>
<h2 id="service-component-customCommand"><a href="#service-component-customCommand" class="headerlink" title="service/component/customCommand"></a>service/component/customCommand</h2><p>可以将自定义命令添加到组件中。</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>描述</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>自定义命令的名称</td>
<td></td>
</tr>
<tr>
<td>commandScript</td>
<td>实现自定义命令的脚本的详细信息</td>
<td></td>
</tr>
<tr>
<td>commandScript/script</td>
<td>脚本的相对路径</td>
<td></td>
</tr>
<tr>
<td><em>commandScript/scriptType</em></td>
<td>脚本的类型，目前唯一支持的类型是PYTHON</td>
<td></td>
</tr>
<tr>
<td><em>commandScript/timeout</em></td>
<td>命令的自定义超时——这将取代Ambari默认值</td>
<td></td>
</tr>
</tbody></table>
<h1 id="ZooKeeper-metainfo-解析"><a href="#ZooKeeper-metainfo-解析" class="headerlink" title="ZooKeeper metainfo 解析"></a>ZooKeeper metainfo 解析</h1><p>下面以 ZooKeeper 的 metainfo.xml 为例进行解析</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;metainfo&gt;</span><br><span class="line">  &lt;schemaVersion&gt;2.0&lt;&#x2F;schemaVersion&gt;</span><br><span class="line">  &lt;services&gt;</span><br><span class="line">    &lt;service&gt;</span><br><span class="line">      &lt;!-- 服务名称。在包含该服务的堆栈定义中包含的所有服务中，名称必须是惟一的。--&gt;</span><br><span class="line">      &lt;name&gt;ZOOKEEPER&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 服务的显示名称。“添加服务”时的“服务”列显示信息。--&gt;</span><br><span class="line">      &lt;displayName&gt;ZooKeeper&lt;&#x2F;displayName&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 描述服务的简短描述。“添加服务”时的“描述”列显示信息。--&gt;</span><br><span class="line">      &lt;comment&gt;提供高可靠分布式协调的统一服务。&lt;&#x2F;comment&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 服务的版本。名称和版本一起唯一地标识服务。“添加服务”时的“版本”列显示信息。--&gt;</span><br><span class="line">      &lt;version&gt;3.4.6&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 该服务包含的组件列表，在 Ambari 中，定义 ZooKeeper 是服务，ZooKeeper Server 和 ZooKeeper Client 是组件。--&gt;</span><br><span class="line">      &lt;components&gt;</span><br><span class="line"></span><br><span class="line">        &lt;component&gt;</span><br><span class="line">          &lt;!-- 组件名称 --&gt;</span><br><span class="line">          &lt;name&gt;ZOOKEEPER_SERVER&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 组件的显示名称，在“概要”——“组件”中显示的名称 --&gt;</span><br><span class="line">          &lt;displayName&gt;ZooKeeper Server&lt;&#x2F;displayName&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 组件的类型——Mster、SLAVE、CLIENT--&gt;</span><br><span class="line">          &lt;category&gt;MASTER&lt;&#x2F;category&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 实例数--&gt;</span><br><span class="line">          &lt;cardinality&gt;1+&lt;&#x2F;cardinality&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 依赖的组件 --&gt;</span><br><span class="line">          &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- ZooKeeper Server 依赖 ZooKeeper 的 ZooKeeper client --&gt;</span><br><span class="line">              &lt;name&gt;ZOOKEEPER&#x2F;ZOOKEEPER_CLIENT&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- 同主机依赖，即在 ZooKeeper Server 所在的主机上必须有 ZooKeeper client。--&gt;</span><br><span class="line">              &lt;!-- 即使在安装 ZooKeeper 时某个节点只勾选 ZooKeeper server 而不勾选 ZooKeeper client，实际安装时也会在该节点安装 zk client--&gt;</span><br><span class="line">              &lt;scope&gt;host&lt;&#x2F;scope&gt;</span><br><span class="line">              &lt;auto-deploy&gt;</span><br><span class="line">                &lt;enable&gt;true&lt;&#x2F;enable&gt;</span><br><span class="line">              &lt;&#x2F;auto-deploy&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">          &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 在滚动升级时使用其他版本 --&gt;</span><br><span class="line">          &lt;versionAdvertised&gt;true&lt;&#x2F;versionAdvertised&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- 支持滚动重启 --&gt;</span><br><span class="line">          &lt;rollingRestartSupported&gt;true&lt;&#x2F;rollingRestartSupported&gt;</span><br><span class="line">          &lt;commandScript&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 脚本相对路径--&gt;</span><br><span class="line">            &lt;script&gt;scripts&#x2F;zookeeper_server.py&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 脚本的类型，目前唯一支持的类型是PYTHON --&gt;</span><br><span class="line">            &lt;scriptType&gt;PYTHON&lt;&#x2F;scriptType&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 命令的自定义超时时间——这将取代Ambari默认值--&gt;</span><br><span class="line">            &lt;timeout&gt;1200&lt;&#x2F;timeout&gt;</span><br><span class="line">          &lt;&#x2F;commandScript&gt;</span><br><span class="line"></span><br><span class="line">          &lt;logs&gt;</span><br><span class="line">            &lt;log&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- 组件的 logid --&gt;</span><br><span class="line">              &lt;logId&gt;zookeeper&lt;&#x2F;logId&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- 是否有主日志id。--&gt;</span><br><span class="line">              &lt;primary&gt;true&lt;&#x2F;primary&gt;</span><br><span class="line">            &lt;&#x2F;log&gt;</span><br><span class="line">          &lt;&#x2F;logs&gt;</span><br><span class="line">        &lt;&#x2F;component&gt;</span><br><span class="line"></span><br><span class="line">        &lt;component&gt;</span><br><span class="line">          &lt;name&gt;ZOOKEEPER_CLIENT&lt;&#x2F;name&gt;</span><br><span class="line">          &lt;displayName&gt;ZooKeeper Client&lt;&#x2F;displayName&gt;</span><br><span class="line">          &lt;category&gt;CLIENT&lt;&#x2F;category&gt;</span><br><span class="line">          &lt;cardinality&gt;1+&lt;&#x2F;cardinality&gt;</span><br><span class="line">          &lt;versionAdvertised&gt;true&lt;&#x2F;versionAdvertised&gt;</span><br><span class="line">          &lt;commandScript&gt;</span><br><span class="line">            &lt;script&gt;scripts&#x2F;zookeeper_client.py&lt;&#x2F;script&gt;</span><br><span class="line">            &lt;scriptType&gt;PYTHON&lt;&#x2F;scriptType&gt;</span><br><span class="line">          &lt;&#x2F;commandScript&gt;</span><br><span class="line">          &lt;configFiles&gt;</span><br><span class="line">            &lt;configFile&gt;</span><br><span class="line">              &lt;!--要生成的文件类型，xml或env sh、yaml等--&gt;</span><br><span class="line">              &lt;type&gt;env&lt;&#x2F;type&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- 生成的文件的名称--&gt;</span><br><span class="line">              &lt;fileName&gt;zookeeper-env.sh&lt;&#x2F;fileName&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- 包含配置属性的数据字典--&gt;</span><br><span class="line">              &lt;dictionaryName&gt;zookeeper-env&lt;&#x2F;dictionaryName&gt;</span><br><span class="line">            &lt;&#x2F;configFile&gt;</span><br><span class="line">            &lt;configFile&gt;</span><br><span class="line">              &lt;type&gt;env&lt;&#x2F;type&gt;</span><br><span class="line">              &lt;fileName&gt;log4j.properties&lt;&#x2F;fileName&gt;</span><br><span class="line">              &lt;dictionaryName&gt;zookeeper-log4j&lt;&#x2F;dictionaryName&gt;</span><br><span class="line">            &lt;&#x2F;configFile&gt;</span><br><span class="line">          &lt;&#x2F;configFiles&gt;</span><br><span class="line">        &lt;&#x2F;component&gt;</span><br><span class="line">      &lt;&#x2F;components&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 适用的系统版本，如果需要适配其他系统，可在此添加，或直接写成 any --&gt;</span><br><span class="line">      &lt;osSpecifics&gt;</span><br><span class="line">        &lt;osSpecific&gt;</span><br><span class="line">          &lt;osFamily&gt;amazonlinux2,redhat6,redhat7,suse11,suse12&lt;&#x2F;osFamily&gt;</span><br><span class="line">          &lt;packages&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 安装包包名，即 yum search 时要找到的包，yum 安装时会根据这里的信息找安装包，如果安装包固定，可以直接写固定值--&gt;</span><br><span class="line">            &lt;package&gt;</span><br><span class="line">              &lt;name&gt;zookeeper_$&#123;stack_version&#125;&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;&#x2F;package&gt;</span><br><span class="line">            &lt;package&gt;</span><br><span class="line">              &lt;name&gt;zookeeper_$&#123;stack_version&#125;-server&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;&#x2F;package&gt;</span><br><span class="line">          &lt;&#x2F;packages&gt;</span><br><span class="line">        &lt;&#x2F;osSpecific&gt;</span><br><span class="line">        &lt;osSpecific&gt;</span><br><span class="line">          &lt;osFamily&gt;debian7,debian9,ubuntu12,ubuntu14,ubuntu16&lt;&#x2F;osFamily&gt;</span><br><span class="line">          &lt;packages&gt;</span><br><span class="line">            &lt;package&gt;</span><br><span class="line">              &lt;name&gt;zookeeper-$&#123;stack_version&#125;&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;&#x2F;package&gt;</span><br><span class="line">            &lt;package&gt;</span><br><span class="line">              &lt;name&gt;zookeeper-$&#123;stack_version&#125;-server&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;&#x2F;package&gt;</span><br><span class="line">          &lt;&#x2F;packages&gt;</span><br><span class="line">        &lt;&#x2F;osSpecific&gt;</span><br><span class="line">      &lt;&#x2F;osSpecifics&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 服务校验脚本 --&gt;</span><br><span class="line">      &lt;commandScript&gt;</span><br><span class="line">        &lt;script&gt;scripts&#x2F;service_check.py&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;scriptType&gt;PYTHON&lt;&#x2F;scriptType&gt;</span><br><span class="line">        &lt;timeout&gt;300&lt;&#x2F;timeout&gt;</span><br><span class="line">      &lt;&#x2F;commandScript&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 依赖的配置文件，所有用到的配置文件都要在这里列出，且文件名需保持一致 --&gt;</span><br><span class="line">      &lt;configuration-dependencies&gt;</span><br><span class="line">        &lt;config-type&gt;zookeeper-log4j&lt;&#x2F;config-type&gt;</span><br><span class="line">        &lt;config-type&gt;zookeeper-env&lt;&#x2F;config-type&gt;</span><br><span class="line">        &lt;config-type&gt;zoo.cfg&lt;&#x2F;config-type&gt;</span><br><span class="line">      &lt;&#x2F;configuration-dependencies&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 更改配置后是否重启服务。当设置为 true 时，更改配置后，会出现黄色重启服务提示条。--&gt;</span><br><span class="line">      &lt;restartRequiredAfterChange&gt;true&lt;&#x2F;restartRequiredAfterChange&gt;</span><br><span class="line"></span><br><span class="line">      &lt;themes&gt;</span><br><span class="line">        &lt;theme&gt;</span><br><span class="line">          &lt;fileName&gt;directories.json&lt;&#x2F;fileName&gt;</span><br><span class="line">          &lt;default&gt;true&lt;&#x2F;default&gt;</span><br><span class="line">        &lt;&#x2F;theme&gt;</span><br><span class="line">      &lt;&#x2F;themes&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;service&gt;</span><br><span class="line">  &lt;&#x2F;services&gt;</span><br><span class="line">&lt;&#x2F;metainfo&gt;</span><br></pre></td></tr></table></figure>

<h1 id="修改-metainfo"><a href="#修改-metainfo" class="headerlink" title="修改 metainfo"></a>修改 metainfo</h1><p>源码中服务的 metainfo 文件类似于<br> <code>ambari-server\src\main\resources\stacks\HDP\3.0\services\ZOOKEEPER\metainfo.xml</code> 这样的路径中，如果存在继承关系，则会放在类似于 <code>ambari-server\src\main\resources\common-services\ZOOKEEPER\3.4.6\metainfo.xml</code> 这样的路径中。</p>
<p>安装后集群后，metainfo 文件在<br> <code>/var/lib/ambari-server/resources/stacks/HDP/3.0/services/ZOOKEEPER/metainfo.xml</code> 或 <code>/var/lib/ambari-server/resources/common-services/ZOOKEEPER/3.4.6/metainfo.xml</code>。</p>
<p><strong>在安装后的集群中修改 metainfo.xml 后必须重启 ambari server 才能生效</strong>，因为只有在 ambari server 启动时才会加载 resources 目录下相关信息。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Writing metainfo.xml - Apache Ambari - Apache Software Foundation<br><a href="https://cwiki.apache.org/confluence/display/AMBARI/Writing+metainfo.xml" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/AMBARI/Writing+metainfo.xml</a> </li>
</ul>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari 远程 Debug 调试</title>
    <url>/2020/11/26/ambari-remote-debug/</url>
    <content><![CDATA[<p>本文主要介绍使用 IDE 分别进行 Ambari server 和 Ambari agent 远程 Debug 调试的方法。</p>
<a id="more"></a>

<h1 id="Ambari-server-远程-debug"><a href="#Ambari-server-远程-debug" class="headerlink" title="Ambari server 远程 debug"></a>Ambari server 远程 debug</h1><h2 id="配置Remote"><a href="#配置Remote" class="headerlink" title="配置Remote"></a>配置Remote</h2><p>点击“Edit Configurations…”，点击“+”号，选择“Remote”，然后配置“Name”和“Host”，“Port”默认为 5005 即可。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image001.png" alt=""></p>
<h2 id="开启-debug-模式"><a href="#开启-debug-模式" class="headerlink" title="开启 debug 模式"></a>开启 debug 模式</h2><p>先停止 ambari server，然后启动时开启 debug 模式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-server stop</span><br><span class="line">ambari-server start --debug</span><br></pre></td></tr></table></figure>

<h2 id="打断点"><a href="#打断点" class="headerlink" title="打断点"></a>打断点</h2><p>示例断点，<br>在 <code>org.apache.ambari.server.controller.internal.ClusterStackVersionResourceProvider</code> 类中打如下断点<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image003.png" alt=""></p>
<h2 id="Debug-调试"><a href="#Debug-调试" class="headerlink" title="Debug 调试"></a>Debug 调试</h2><p>然后在 Idea 中点击 debug 运行，在 Amabri 界面刷新页面，进入断点即可进行 debug 调试。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image005.png" alt=""></p>
<h1 id="Ambari-agent-远程-debug"><a href="#Ambari-agent-远程-debug" class="headerlink" title="Ambari-agent 远程 debug"></a>Ambari-agent 远程 debug</h1><p>首先使用 PyCharm 单独打开 ambari-agent 模块</p>
<h2 id="添加-Python-Interpreter"><a href="#添加-Python-Interpreter" class="headerlink" title="添加 Python Interpreter"></a>添加 Python Interpreter</h2><p>依次点击“File” —— “Settings…”，在“Project：ambari-agent”中点击右侧齿轮，选择“Add…”<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126185827.png" alt=""></p>
<p>在弹出的“Add Pyhton Interpreter”中点击“SSH Interpreter”，然后配置源端 Ambari agent 所在主机的“Host”和“Username”，端口默认为 22。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image007.png" alt=""></p>
<p>点击“Next”后填写主机登录密码<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image009.png" alt=""></p>
<p>然后配置远程 Python Interpreter、代码同步路径（左边是本地代码路径，右边是服务器代码路径），如果勾选“Automatically upload project files to the server”则会将本地代码同步到远程服务器。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126191026.png" alt=""></p>
<p>设置好后的效果<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image013.png" alt=""></p>
<h2 id="添加-configuration"><a href="#添加-configuration" class="headerlink" title="添加 configuration"></a>添加 configuration</h2><p>点击“Add Configuration…”<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/image015.png" alt=""></p>
<p>点击“+”号添加 Python<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126193638.png" alt=""></p>
<p>分别设置如下红框中的内容<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126193952.png" alt=""></p>
<ul>
<li>本地启动脚本路径 Script path：本地 main.py 的路径</li>
<li>环境变量 Environment variables: PYTHONUNBUFFERED=1;PYTHONPATH=/usr/lib/ambari-agent/lib:${PYTHONPATH:~}</li>
<li>Python interpreter:选择刚配置的 Python Interpreter</li>
<li>Working directory: Ambari agent 所在的文件夹目录</li>
</ul>
<h2 id="debug-调试"><a href="#debug-调试" class="headerlink" title="debug 调试"></a>debug 调试</h2><p>在配置远程调试的节点上停止 agent</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ambari-agent stop</span><br></pre></td></tr></table></figure>
<p>打断点，debug 启动即可进行远程调试。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126194916.png" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>IDEA远程调试Ambari Server - 微信-大数据从业者 - 博客园<br><a href="https://www.cnblogs.com/felixzh/p/11132735.html" target="_blank" rel="noopener">https://www.cnblogs.com/felixzh/p/11132735.html</a> </p>
</li>
<li><p>利用pycharm 远程调试ambari agent - 个人文章 - SegmentFault 思否<br><a href="https://segmentfault.com/a/1190000022460732" target="_blank" rel="noopener">https://segmentfault.com/a/1190000022460732</a> </p>
</li>
</ul>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>HDFS 命令行基本操作</title>
    <url>/2020/11/28/hdfs-command-line-operations/</url>
    <content><![CDATA[<p>本文主要介绍 HDFS 常用的命令行基础操作命令，且直接给出操作示例。</p>
<a id="more"></a>

<h1 id="Hadoop-fs-与-hdfs-dfs-的区别"><a href="#Hadoop-fs-与-hdfs-dfs-的区别" class="headerlink" title="Hadoop fs 与 hdfs dfs 的区别"></a><code>Hadoop fs</code> 与 <code>hdfs dfs</code> 的区别</h1><p><code>Hadoop fs</code> 使用范围更广，而 <code>hdfs dfs</code> 只适用于HDFS，因此以下操作均使用 <code>hadoop fs</code> 操作<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201128154658.png" alt=""></p>
<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><p>切换为hdfs用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">su hdfs</span><br></pre></td></tr></table></figure>

<p>查看help信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -help</span><br></pre></td></tr></table></figure>

<p>查看目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls &#x2F;tmp</span><br></pre></td></tr></table></figure>

<p>创建文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir &#x2F;tmp&#x2F;test</span><br></pre></td></tr></table></figure>

<p>创建级联文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir -p &#x2F;tmp&#x2F;test&#x2F;a&#x2F;b&#x2F;c</span><br></pre></td></tr></table></figure>

<p>上传文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -put &#x2F;home&#x2F;test&#x2F;1.txt &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>查看文件内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -cat &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>复制HDFS文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -cp &#x2F;tmp&#x2F;test&#x2F;1.txt &#x2F;tmp&#x2F;test&#x2F;a&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>移动HDFS文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -mv &#x2F;tmp&#x2F;test&#x2F;a&#x2F;1.txt &#x2F;tmp&#x2F;test&#x2F;a&#x2F;b&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>下载HDFS文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -get &#x2F;tmp&#x2F;test&#x2F;1.txt &#x2F;tmp&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>追加文件内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -appendToFile &#x2F;home&#x2F;test&#x2F;2.txt &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -chmod 755 &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br><span class="line">hadoop fs -chown erik:hdfs &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>查看文件夹大小</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -du -h &#x2F;tmp&#x2F;test</span><br></pre></td></tr></table></figure>

<p>查看文件夹中文件/夹大小</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -du -s -h &#x2F;tmp</span><br></pre></td></tr></table></figure>

<p>统计指定文件夹中文件信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -count &#x2F;tmp</span><br><span class="line">[文件夹总数] [文件总数]   [文件总大小] [指定文件夹]</span><br></pre></td></tr></table></figure>

<p>删除文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -rm &#x2F;tmp&#x2F;test&#x2F;1.txt</span><br></pre></td></tr></table></figure>

<p>删除文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hadoop fs -rm -r &#x2F;tmp&#x2F;test</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>HDFS</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 安装设置 Maven</title>
    <url>/2021/05/06/linux-install-maven/</url>
    <content><![CDATA[<p>本文详细介绍在 Linux 中安装设置 Maven 的方法步骤。</p>
<a id="more"></a>

<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>官方下载地址：<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener">https://maven.apache.org/download.cgi</a></p>
<p>本文以 <code>apache-maven-3.6.3-bin.tar.gz</code> 为例做演示，备用下载地址：</p>
<p><a href="https://gitee.com/erik_ly/blog_share_files/raw/master/maven/apache-maven-3.6.3-bin.tar.gz" target="_blank" rel="noopener">https://gitee.com/erik_ly/blog_share_files/raw/master/maven/apache-maven-3.6.3-bin.tar.gz</a></p>
<h1 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h1><p>上传文件到服务器，然后解压</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;maven</span><br><span class="line">tar -xzvf apache-maven-3.6.3-bin.tar.gz -C &#x2F;usr&#x2F;local&#x2F;maven</span><br></pre></td></tr></table></figure>

<h1 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>
<p>在结尾加上</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># maven</span><br><span class="line">MAVEN_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;maven&#x2F;apache-maven-3.6.3</span><br><span class="line">export PATH&#x3D;$&#123;MAVEN_HOME&#125;&#x2F;bin:$&#123;PATH&#125;</span><br></pre></td></tr></table></figure>

<p>生效环境变量</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<h1 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/05/20210506173141.png" alt=""></p>
<h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/05/20210506173245.png" alt=""></p>
<p>可以修改本地库地址，并添加阿里云源。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;localRepository&gt;~&#x2F;.m2&#x2F;repository&lt;&#x2F;localRepository&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;!-- 阿里云 --&gt;</span><br><span class="line">  &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;        </span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 设置 jdk 环境变量</title>
    <url>/2020/11/28/linux-jdk/</url>
    <content><![CDATA[<p>本文介绍在 Linux 中设置 jdk 环境变量方法，适用于 CentOs 和 Ubuntu 等 Linux 版本。</p>
<a id="more"></a>

<ul>
<li>准备 JDK 文件</li>
</ul>
<p>这里准备的 jdk 版本是 1.8.0_131。</p>
<p>链接：<a href="https://pan.baidu.com/s/1jsLxPkmH1nRfnICYOGK_ow" target="_blank" rel="noopener">https://pan.baidu.com/s/1jsLxPkmH1nRfnICYOGK_ow</a> </p>
<p>提取码：3l6y </p>
<ul>
<li>创建 java 存放路径</li>
</ul>
<p>这里将 jdk 存放在 <code>/usr/local/java</code> 目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>

<ul>
<li>解压文件</li>
</ul>
<p>将 jdk 文件上传到 linux 系统中，然后解压到 java 路径中。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar -xzvf jdk-8u131-linux-x64.tar.gz -C &#x2F;usr&#x2F;local&#x2F;java</span><br></pre></td></tr></table></figure>

<ul>
<li>修改配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>在结尾加上以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># jdk environment</span><br><span class="line">JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk1.8.0_131</span><br><span class="line">CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib.tools.jar</span><br><span class="line">PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</span><br><span class="line">export JAVA_HOME CLASSPATH PATH</span><br></pre></td></tr></table></figure>

<ul>
<li>生效配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 java 版本信息</li>
</ul>
<p>使用 <code>java -version</code> 查看 java 版本信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># java -version</span><br><span class="line">java version &quot;1.8.0_131&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure>















]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>飞腾银河麒麟系统安装步骤</title>
    <url>/2020/12/02/feiteng-kylin-install/</url>
    <content><![CDATA[<p>本文主要介绍了在飞腾机器上安装银行麒麟操作系统的方法步骤，重点写了制作 U 盘启动盘的方法和在安装时的一些重要步骤。</p>
<a id="more"></a>

<h1 id="制作-U-盘启动盘"><a href="#制作-U-盘启动盘" class="headerlink" title="制作 U 盘启动盘"></a>制作 U 盘启动盘</h1><p>飞腾麒麟系统的 U 盘启动盘较特殊，首先需要准备一个空的 U 盘，然后插入物理机上。<br><code>fdisk -l</code> 查看 U 盘是哪个设备。这里假设为/dev/sdb。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;卸载u盘(可能显示没有挂载，不影响之后操作)</span><br><span class="line">umount &#x2F;dev&#x2F;sdb*</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;清空u盘分区</span><br><span class="line">dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;sdb bs&#x3D;1M count&#x3D;10</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;写入磁盘</span><br><span class="line">partprobe &#x2F;dev&#x2F;sdb</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;挂载iso</span><br><span class="line">mount -o loop xxx.iso &#x2F;mnt</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;格式化u盘</span><br><span class="line">mkfs.ext4 &#x2F;dev&#x2F;sdb</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;挂载u盘</span><br><span class="line">mkdir -p &#x2F;mnt2</span><br><span class="line">mount &#x2F;dev&#x2F;sdb &#x2F;mnt2</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;将iso中的内容同步到u盘中。</span><br><span class="line">rsync -a &#x2F;mnt&#x2F; &#x2F;mnt2&#x2F;</span><br><span class="line">&#x2F;&#x2F;注意&#x2F;mnt&#x2F; 最后是有斜杠的</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;卸载设备(必须等待卸载设备完成才能制作成功，大约20分钟)</span><br><span class="line">umount &#x2F;mnt2</span><br><span class="line">umount &#x2F;mnt</span><br></pre></td></tr></table></figure>

<h1 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h1><p>系统启动过程中<strong>按 del 键进入 BIOS界面</strong>，修改第一启动项为优盘启动，保存退出</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202191906.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192049.png" alt=""></p>
<p>以下是安装过程中的重要步骤截图</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192128.png" alt=""><br>选择第一项图形安装界面</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192251.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192349.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192413.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192506.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192530.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192554.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192642.png" alt=""><br>磁盘分区可以选择“向导”或“手动”，选择向导则按提示做即可，如果选择“手动”可以按以下内容分配</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202192953.png" alt=""><br>每个分区都要设置“用于”、“格式化分区”、“挂载点”，设置好一个后按“Esc”返回设置其他的。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202193011.png" alt=""><br>最终效果是这样的。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202193206.png" alt=""></p>
<p>安装好后，会提示确保光盘已拔出，这时需要把优盘直接拔掉，然后继续，重启机器。</p>
<h1 id="设置-IP"><a href="#设置-IP" class="headerlink" title="设置 IP"></a>设置 IP</h1><p>查看网线连接的的哪个网卡</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202193305.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202193340.png" alt=""></p>
<p>选择对应的网卡点击“编辑”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201202193439.png" alt=""></p>
<p>点击“保存”即可。</p>
<p>也可以通过修改配置文件设置 IP 和 DNS</p>
<p>设置IP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;network&#x2F;interfaces</span><br></pre></td></tr></table></figure>

<p>设置 DNS</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;resolv.conf</span><br></pre></td></tr></table></figure>

<p>重启网络</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;network-manager restart</span><br></pre></td></tr></table></figure>

<h1 id="设置root密码"><a href="#设置root密码" class="headerlink" title="设置root密码"></a>设置root密码</h1><p>使用 <code>Ctrl + Alt + T</code> 调出终端，执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>
<p>先输入当前用户密码，然后输入要设置的 root 用户密码。</p>
<p>使用 <code>su root</code> 切换 root 用户测试密码，平时可以直接使用 <code>sudo -i</code> 切换到 root 用户。</p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
  </entry>
  <entry>
    <title>rpm2rpm 打包步骤</title>
    <url>/2020/11/25/rpm2rpm/</url>
    <content><![CDATA[<p>本文主要介绍将 rpm 包解压后，修改里面的文件，然后重新打包成 rpm 的过程。</p>
<a id="more"></a>

<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><ul>
<li>安装rpm-build包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install rpm-build -y</span><br></pre></td></tr></table></figure>

<ul>
<li>安装rpmdevtools</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install rpmdevtools -y</span><br></pre></td></tr></table></figure>

<ul>
<li>创建工作空间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpmdev-setuptree</span><br></pre></td></tr></table></figure>

<p>查看工作目录</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125192721.png" alt=""></p>
<ul>
<li>创建 BUILDROOT目录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir &#x2F;root&#x2F;rpmbuild&#x2F;BUILDROOT</span><br></pre></td></tr></table></figure>

<p>完整目录结构</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125194201.png" alt=""></p>
<h1 id="解压-rpm-包"><a href="#解压-rpm-包" class="headerlink" title="解压 rpm 包"></a>解压 rpm 包</h1><ul>
<li>复制文件</li>
</ul>
<p>复制需要修改的 rpm 包至 <code>/root/rpmbuild/BUILDROOT/</code> 目录，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125195851.png" alt=""></p>
<ul>
<li>解压 rpm 包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;BUILDROOT</span><br><span class="line">rpm2cpio zookeeper_3_0_1_0_187-3.4.6.3.0.1.0-187.noarch.rpm | cpio -idv</span><br></pre></td></tr></table></figure>

<ul>
<li>提取 spec 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpmrebuild --package --notest-install --spec-only&#x3D;zookeeper.spec zookeeper_3_0_1_0_187-3.4.6.3.0.1.0-187.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>注：这里用到了<code>rpmrebuild</code>工具，具体可查看：<a href="http://www.erik-ly.com/2019/12/29/Rpm-extract-spec/" target="_blank" rel="noopener">使用rpmrebuild从rpm包中提取spec文件</a>，有下载链接和使用方法。</p>
<ul>
<li>移动 SPEC 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mv zookeeper.spec &#x2F;root&#x2F;rpmbuild&#x2F;SPECS&#x2F;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除原 rpm 包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm -rf zookeeper_3_0_1_0_187-3.4.6.3.0.1.0-187.noarch.rpm</span><br></pre></td></tr></table></figure>

<h1 id="修改内容"><a href="#修改内容" class="headerlink" title="修改内容"></a>修改内容</h1><p>查看解压后的文件内容，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125202732.png" alt=""></p>
<p>按自己需要进行修改，</p>
<ul>
<li>如果只是需要替换同名文件，则直接进行替换即可；</li>
<li>如果需要增加文件或文件夹，则需要在 <code>zookeeper.spec</code> 中按原有格式添加文件或文件夹；</li>
<li>如果需要删除文件或文件夹，也需要在 <code>zookeeper.spec</code> 中删除相应的文件或文件夹。</li>
<li>如果修改的文件较多，也可以将原有的 <code>%files</code> 内容改为<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%files</span><br><span class="line">%defattr(-,root,root,-)</span><br><span class="line">&#x2F;usr&#x2F;hdp&#x2F;3.0.1.0-187</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="重新打-rpm-包"><a href="#重新打-rpm-包" class="headerlink" title="重新打 rpm 包"></a>重新打 rpm 包</h1><p>修改好文件后，重新打包成 rpm 文件，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;rpmbuild&#x2F;SPECS</span><br><span class="line">rpmbuild -ba --buildroot &#x2F;root&#x2F;rpmbuild&#x2F;BUILDROOT&#x2F; zookeeper.spec</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125203721.png" alt=""></p>
<p>执行完成后在 <code>/root/rpmbuild/RPMS</code> 目录中查看新的 rpm 包</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201125203843.png" alt=""></p>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
      </tags>
  </entry>
  <entry>
    <title>Ambari Log Search 介绍</title>
    <url>/2020/12/05/log-search/</url>
    <content><![CDATA[<p>本文主要介绍了 Log Search 的特点和安装使用方法。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Log Search 是 Ambari 平台的日志聚合、分析与可视化工具。</p>
<h1 id="GitHub地址"><a href="#GitHub地址" class="headerlink" title="GitHub地址"></a>GitHub地址</h1><p>apache/ambari-logsearch: Apache Ambari subproject - Logsearch<br><a href="https://github.com/apache/ambari-logsearch" target="_blank" rel="noopener">https://github.com/apache/ambari-logsearch</a> </p>
<h1 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h1><ul>
<li>提供可视化日志展示</li>
</ul>
<p>支持以数据表格和文件方式展示日志信息。</p>
<ul>
<li>支持按条件查询日志</li>
</ul>
<p>可根据时间、节点、信息关键词等查询需要的日志。</p>
<ul>
<li>提供审计用户及审计资源统计</li>
</ul>
<p>提供审计日志单独统计，给出资源及用户排行榜。</p>
<ul>
<li>提供日志级别统计</li>
</ul>
<p>Log Search会在界面上给出各服务各组件每种日志级别的统计数，对日志情况一目了然。</p>
<ul>
<li>支持高可靠</li>
</ul>
<p>Log Search 利用 Solr 建立索引，由于 Solr 的副本策略，确保了日志索引的可靠性。</p>
<ul>
<li>支持分别配置各组件的日志等级</li>
</ul>
<p>默认情况下，会采集 WARN 级别及以上的日志，用户也可以分别配置各组件的日志等级。</p>
<h1 id="架构原理"><a href="#架构原理" class="headerlink" title="架构原理"></a>架构原理</h1><p>Log Search 主要由两类组件组成：Log Feeder 和 Log Search Server。Log Feeder 任务是监控解析节点上每个服务的日志，并将日志发送到索引模块 Log Index。Log Search Server 运行 Log Search UI 程序。Log Search 的整体架构见下图：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/a5b504671664105edb04c200d611d535.jpeg" alt=""></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul>
<li>选择服务</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/77f339239a5527169bb193349e3fb487.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/4b33b4c37b369e7616ea291de279f4d8.png" alt=""></p>
<ul>
<li>参数配置</li>
</ul>
<p>配置登录名和密码，webUI 登录需要用到。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2d79775ce6c00a5dece629c78ab2154a.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7ed21019a3f16ee09ffbcd4481d8a9cd.png" alt=""></p>
<h1 id="安装目录"><a href="#安装目录" class="headerlink" title="安装目录"></a>安装目录</h1><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/05/20210513172725.png" alt=""></p>
<h1 id="WebUI-界面"><a href="#WebUI-界面" class="headerlink" title="WebUI 界面"></a>WebUI 界面</h1><p><a href="http://IP:61888/#/login" target="_blank" rel="noopener">http://IP:61888/#/login</a><br>输入刚才设置的用户名和密码。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e3ed409eec1552d67ec51020692d787c.png" alt=""></p>
<ul>
<li>服务日志</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/0fc21778b48c27e7dfb58ceb88cedbfd.png" alt=""></p>
<p>可以根据主机、组件、级别等筛选。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/d0bb3d3bd79d288a1046b82a25207e40.png" alt=""></p>
<p>也可以通过筛选列查看更多列信息。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201205112513.png" alt=""></p>
<ul>
<li>审计日志</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/08cd0857c61bbfa7d5568544a32bf216.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/79f8f8040903e778732c244b655aacb0.png" alt=""></p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>MinDoc 安装使用介绍</title>
    <url>/2020/11/28/mindoc-install-and-use/</url>
    <content><![CDATA[<p>本文主要介绍在 CentOS 系统中安装使用在线文档管理工具 MinDoc 的安装使用方法，MinDoc使用 markdown 语法写作，简捷方便。</p>
<a id="more"></a>

<h1 id="安装-MinDoc"><a href="#安装-MinDoc" class="headerlink" title="安装 MinDoc"></a>安装 MinDoc</h1><h2 id="GitHub项目地址"><a href="#GitHub项目地址" class="headerlink" title="GitHub项目地址"></a>GitHub项目地址</h2><ul>
<li>源码地址</li>
</ul>
<p>lifei6671/mindoc: Golang实现的基于beego框架的接口在线文档管理系统</p>
<p><a href="https://github.com/lifei6671/mindoc" target="_blank" rel="noopener">https://github.com/lifei6671/mindoc</a></p>
<ul>
<li>下载地址</li>
</ul>
<p>Releases · lifei6671/mindoc</p>
<p><a href="https://github.com/lifei6671/mindoc/releases" target="_blank" rel="noopener">https://github.com/lifei6671/mindoc/releases</a></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7bbd70f8d751bb2adb5ca7faf3f92c0c.png" alt=""></p>
<ul>
<li>官方文档</li>
</ul>
<p>Linux 下安装和配置 MinDoc - Powered by MinDoc</p>
<p><a href="https://www.iminho.me/wiki/docs/mindoc/mindoc-linux.md" target="_blank" rel="noopener">https://www.iminho.me/wiki/docs/mindoc/mindoc-linux.md</a></p>
<h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p>Linux：CentOS 7</p>
<p>安装目录：/home/app/mindoc</p>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unzip mindoc_linux_amd64.zip</span><br></pre></td></tr></table></figure>

<h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mysql -u root -ppassword</span><br><span class="line"></span><br><span class="line">&gt; CREATE DATABASE mindoc_db DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/4fc7902ace696cbaff47a3c71b7844bf.png" alt=""></p>
<p>然后在配置文件中设置数据库信息</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/cf44f3b5482e85bb8d00ef54933897ff.png" alt=""></p>
<p>这里为配置数据库信息内容<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8f26715c888e9d377718a6b28fe24e26.png" alt=""></p>
<p>根据实际情况填写<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201128173812.png" alt=""></p>
<p>初始化数据库</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8212a43f3d66a42ac64d214085a5118b.png" alt=""></p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>修改可执行权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod +x mindoc_linux_amd64</span><br></pre></td></tr></table></figure>

<p>启动程序</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;mindoc_linux_amd64</span><br></pre></td></tr></table></figure>

<p>设置后台启动</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/c9935922505bbd928b6636441a48e8ee.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;mindoc_linux_amd64 \&gt; &#x2F;home&#x2F;app&#x2F;mindoc&#x2F;mindoc.log &amp;</span><br></pre></td></tr></table></figure>

<p>以后执行这个后台启动脚本即可。</p>
<h2 id="web页面"><a href="#web页面" class="headerlink" title="web页面"></a>web页面</h2><p>在浏览器中打开网址：<a href="http://IP:8181" target="_blank" rel="noopener">http://IP:8181</a></p>
<p>默认用户名：admin 密码：123456</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e49fda866fdff17afb4cc4e7ed5992d4.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/ac899db1349bb1be480a510f88b9b0bd.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/b2951075fb80f1835ac44ec3ece2ab78.png" alt=""></p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><p>点击用户名，在下拉框中选择“我的项目”  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/f3bc71fe8c9d8f768ad701301ba3a18f.png" alt=""></p>
<p>跳转后点击右上角的“添加项目”  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/eb21b40dd5061bd89ba39210639ce418.png" alt=""></p>
<p>在“添加项目”对话框中设置“项目标题”和“项目标识”，“项目标识”是之后项目网页链接标识  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/775b413481868e6738a7061f90cd8a6c.png" alt=""></p>
<p>可根据文档保密程度选择“公开”或“私有”，“保存”成功后会在“我的项目”中看到刚创建的项目<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/90a67462c390c7b984b880840960368a.png" alt=""></p>
<p>点击项目，在“设置”中开启“自动发布”（如果不开启此项，每次编辑后需要手动点击发布按钮才能更新文档页面）和“自动保存”（开启后每30秒自动保存，可使用快捷键Ctrl + S 保存）两个选项。  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/44775600cefcc6bfac21a05a8a4ee36c.png" alt=""></p>
<h2 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h2><ul>
<li>添加同级文档</li>
</ul>
<p>在编辑页面，可以点击“＋”添加同级别的文档  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/caad0323f8a1b6c2c3a90673b4799100.png" alt=""></p>
<p>添加完成后  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5177793ed08c39047539c6a8069e38e3.png" alt=""></p>
<ul>
<li>添加子文档</li>
</ul>
<p>右键文档后，点击“添加文档”  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/79851e928babc651dc9dcf10d51471c8.png" alt=""></p>
<p>创建完成后  </p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/aaba9d2c3768c8b05fde002e36253692.png" alt=""></p>
<h1 id="导出功能"><a href="#导出功能" class="headerlink" title="导出功能"></a>导出功能</h1><h2 id="安装calibre"><a href="#安装calibre" class="headerlink" title="安装calibre"></a>安装calibre</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo -v &amp;&amp; wget -nv -O- https:&#x2F;&#x2F;download.calibre-ebook.com&#x2F;linux-installer.sh | sudo sh &#x2F;dev&#x2F;stdin</span><br><span class="line"></span><br><span class="line">ebook-convert --version</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/adc826527d0f2b6a0bb42986e80cb7c5.png" alt=""></p>
<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>修改如下配置<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7bd7104f714f5c6ff7e00c892a976f61.png" alt=""></p>
<p>根据自己情况设置<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/c5ab7cfac2eb39257cb0eaf06aa199c1.png" alt=""></p>
<p>然后在项目设置中开启导出功能</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/cfaeb559039258a98bf523e424a23c21.png" alt=""></p>
<p>这样文档右上角就有下载按钮了<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/fd839c856421e36147829f8197a93216.png" alt=""></p>
<h1 id="数据信息"><a href="#数据信息" class="headerlink" title="数据信息"></a>数据信息</h1><p>文档信息在表<code>md_documents</code>中的 <code>markdown</code>列，上传的图片和附件在<code>mindoc/uploads</code>目录中。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>Linux 下安装和配置 MinDoc - Powered by MinDoc<br><a href="https://www.iminho.me/wiki/docs/mindoc/mindoc-linux.md" target="_blank" rel="noopener">https://www.iminho.me/wiki/docs/mindoc/mindoc-linux.md</a></p>
</li>
<li><p>MinDoc 的导出功能 - Powered by MinDoc<br><a href="https://www.iminho.me/wiki/docs/mindoc/mindoc-export.md" target="_blank" rel="noopener">https://www.iminho.me/wiki/docs/mindoc/mindoc-export.md</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>MinDoc</tag>
      </tags>
  </entry>
  <entry>
    <title>解决 process information unavailable 问题</title>
    <url>/2020/12/13/solve-process-information-unavailable/</url>
    <content><![CDATA[<p>本文主要介绍处理进程为 <code>process information unavailable</code> 的方法。</p>
<a id="more"></a>

<p>当主机断点或非正常关机后重启电脑，使用 <code>jps</code> 查看进程时，会出现一些进程为 <code>process information unavailable</code> 的现象，有的过一段时间就会好。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master ~]# jps</span><br><span class="line">6432 -- process information unavailable</span><br><span class="line">25025 -- process information unavailable</span><br><span class="line">31075 -- process information unavailable</span><br><span class="line">25636 -- process information unavailable</span><br><span class="line">8868 -- process information unavailable</span><br><span class="line">21957 -- process information unavailable</span><br><span class="line">8102 Jps</span><br><span class="line">19176 -- process information unavailable</span><br><span class="line">29033 -- process information unavailable</span><br><span class="line">15115 -- process information unavailable</span><br><span class="line">9259 -- process information unavailable</span><br><span class="line">17772 -- process information unavailable</span><br><span class="line">10796 -- process information unavailable</span><br><span class="line">23343 -- process information unavailable</span><br><span class="line">5401 -- process information unavailable</span><br><span class="line">1882 AmbariServer</span><br></pre></td></tr></table></figure>

<p>可以到 <code>/tmp/</code> 目录中查看有 <code>hsperfdata_*</code> 缓存。<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201211092407.png" alt=""></p>
<p>将这些缓存删除即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm -rf &#x2F;tmp&#x2F;hsperfdata_*</span><br></pre></td></tr></table></figure>

<p>重新查看进程。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master ~]# jps</span><br><span class="line">10749 Jps</span><br></pre></td></tr></table></figure>

<p>如果存在正常进程较多，异常进程较少，可以找到对应的进程删除。</p>
]]></content>
      <categories>
        <category>Ambari</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows 10 系统安装详细图文教程</title>
    <url>/2021/08/09/win10-install-and-setup/</url>
    <content><![CDATA[<p>本文详细介绍了制作启动盘、安装 Win10 的步骤，以及一些常用的配置和软件。</p>
<a id="more"></a>

<h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><h2 id="Windows-10-版本选择"><a href="#Windows-10-版本选择" class="headerlink" title="Windows 10 版本选择"></a>Windows 10 版本选择</h2><p>Windows 10分为家庭版、专业版、企业版和教育版，综合不同版本提供的服务、体验、管理和安全性方面考虑，企业版和教育版最为强大（Windows各版本功能详细对比可参见：<a href="http://www.iplaysoft.com/news/2674）。" target="_blank" rel="noopener">http://www.iplaysoft.com/news/2674）。</a></p>
<p>本教程选择企业版为例，其它版本安装过程几乎完全一致，个人推荐使用Windows 10 企业版。</p>
<h2 id="Windows-10-下载"><a href="#Windows-10-下载" class="headerlink" title="Windows 10 下载"></a>Windows 10 下载</h2><p>个人推荐在<a href="http://www.msdn.hk/6/719/" target="_blank" rel="noopener">http://www.msdn.hk/6/719/</a> 下载Windows 镜像文件，系统纯净。</p>
<p>Windows 10 企业版 64位下载地址：<a href="http://www.msdn.hk/html/2015/1551.html" target="_blank" rel="noopener">http://www.msdn.hk/html/2015/1551.html</a> ，复制下载链接到迅雷即可。</p>
<h1 id="制作U盘启动盘"><a href="#制作U盘启动盘" class="headerlink" title="制作U盘启动盘"></a>制作U盘启动盘</h1><p>推荐使用UltraISO来制作U盘启动盘，UltraISO下载地址：<a href="https://gitee.com/erik_ly/blog_share_files/raw/master/UltraISO/UltraISO.zip" target="_blank" rel="noopener">https://gitee.com/erik_ly/blog_share_files/raw/master/UltraISO/UltraISO.zip</a></p>
<h2 id="安装UltraISO"><a href="#安装UltraISO" class="headerlink" title="安装UltraISO"></a>安装UltraISO</h2><p>UItraISO安装较为简单，安装时与普通软件差别不大，安装完成后在弹出的对话框中点击“输入注册码”，然后打开“注册码sn.txt”文件，将第一个注册名和注册码填入即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093205.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093251.png" alt=""></p>
<p>安装路径可以默认或点击“浏览”存放在习惯存放的软件文件夹中</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093342.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093405.png" alt=""></p>
<p>第二个和第三个的勾可以去掉</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093424.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093449.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809093518.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102431.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102452.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102507.png" alt=""></p>
<h2 id="制作U盘启动盘-1"><a href="#制作U盘启动盘-1" class="headerlink" title="制作U盘启动盘"></a>制作U盘启动盘</h2><p>首先插入U盘，然后打开UltraISO，点击“文件”，选择“打开”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102521.png" alt=""></p>
<p>在对话框中选择刚下载的系统镜像文件，点击“打开”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102537.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102549.png" alt=""></p>
<p>点击“启动”，选择“写入硬盘映像”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102602.png" alt=""></p>
<p>在弹出的对话框中查看“硬盘驱动器”所选盘符，默认会选择刚插入的U盘，如果不是可手动选择，其余选项默认即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102614.png" alt=""></p>
<p>点击“格式化”进行格式化U盘（U盘内资料需提前备份），“文件系统”选择“FAT32（默认）”，然后点击“开始”，点击后系统会弹出确认信息，点击“确定”即可。格式化完成后点击“确定”并关闭格式化界面。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102626.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102639.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102651.png" alt=""></p>
<p>点击“写入”，系统会弹出警告信息，由于U盘文件已经备份并格式化，所以点击“是”即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809102706.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809104921.png" alt=""></p>
<p>这时会将系统文件写入U盘，根据U盘读写速度快慢差异，所用时间有所不同。当看到消息界面内出现“刻录成功！”信息后说明U盘启动盘已经制作完成，点击“返回”退出界面即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809104935.png" alt=""></p>
<h1 id="安装Windows-10-系统"><a href="#安装Windows-10-系统" class="headerlink" title="安装Windows 10 系统"></a>安装Windows 10 系统</h1><p>将刚制作好的U盘启动盘插入需要安装系统的电脑上，本教程以联想笔记本为例，重启电脑，在出现Lenovo界面时按F12进入bios（重启时可以一直快速按着F12），使用“↓”选择“USB HDD”，按“Enter”进入。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809104948.png" alt=""></p>
<p>出现系统加载界面，然后会出现系统安装对话框，点击“下一步”继续</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105001.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105020.png" alt=""></p>
<p>点击“现在安装”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105035.png" alt=""></p>
<p>在“我接受许可条款”前打勾，点击“下一步”继续</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105049.png" alt=""></p>
<p>点击“自定义”选项</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105100.png" alt=""></p>
<p>选中“驱动器 0 分区2”，然后点击“格式化”进行格式化，这是需要安装操作系统的盘，也就是安装好系统后的C盘，若之前电脑内其它盘有文件，不要动，只需将这一个盘格式化即可，安装好系统后其它盘的文件还存在。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105118.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105130.png" alt=""></p>
<p>点击“下一步”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105147.png" alt=""></p>
<p>此时系统会自动安装Windows</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105159.png" alt=""></p>
<p>完成后会出现重启界面，此时直接拔掉U盘，让其自动重启即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105212.png" alt=""></p>
<p>重启后会进入“快速上手”设置界面，选择“自定义”选项</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105225.png" alt=""></p>
<p>个人建议将以下选项都设置为“关”，然后点击进入“下一步”，同样设置为“关”，如果感觉自己需要也可以保持默认开启</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105344.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105400.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105440.png" alt=""></p>
<p>当出现以下界面时选择“加入本地Active Directory域”，然后点击“下一步”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105453.png" alt=""></p>
<p>设置用户名和密码，建议用户名为英文，密码如果不填就默认为没有密码，个人强烈建议使用密码，并可加入数字或特殊符号等，但自己要牢记密码。密码提示会在输入密码错误时出现，所填信息最好是能让自己想起密码，但又与密码不同，且别人不会猜到密码。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105506.png" alt=""></p>
<p>小娜语音助手可以开启，可进行语音操作等，点击“启用Cortana（小娜）”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105517.png" alt=""></p>
<p>设置生效过程中会出现一些诗句</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105530.png" alt=""></p>
<p>现在就安装完成了。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105542.png" alt=""></p>
<h1 id="Windows-系统设置"><a href="#Windows-系统设置" class="headerlink" title="Windows 系统设置"></a>Windows 系统设置</h1><p>安装激活系统后需要对系统进行一些设置以方便自己使用，下面就个人一些使用习惯进行设置，仅供参考。</p>
<h2 id="更新驱动"><a href="#更新驱动" class="headerlink" title="更新驱动"></a>更新驱动</h2><p>Windows 10 默认在联网状态下会自动更新驱动，无需下载第三方软件，个人推荐让系统自动更新，更新驱动时会出现闪屏或需要重启现象，系统也推荐更新，可以提升功能体验和安全性。</p>
<p>具体方式可以点击左下角的Windows图标，选择设置，然后选择“更新与安全”，再点击“检查更新”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105558.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105611.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105627.png" alt=""></p>
<h2 id="在桌面显示“此电脑”"><a href="#在桌面显示“此电脑”" class="headerlink" title="在桌面显示“此电脑”"></a>在桌面显示“此电脑”</h2><p>在桌面单机右键，选择“个性化”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105641.png" alt=""></p>
<p>选择“主题”，然后选择“桌面图标设置”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105655.png" alt=""></p>
<p>勾选“计算机”后点击“确定”即可。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105710.png" alt=""></p>
<h2 id="任务栏设置"><a href="#任务栏设置" class="headerlink" title="任务栏设置"></a>任务栏设置</h2><p>将浏览器和应用商店解除任务栏固定，虽然Windows 10的Edge浏览器做了很大提升，但个人依然不太习惯，属于使用频率极低的应用，这样的应用就不要占用任务栏这么宝贵的地方了。应用商店我个人几乎不使用（有兴趣的可以试下，里面一些应用或游戏还是非常精良的），所以右键应用图标，选择“从任务栏取消固定”。这里保留下图中第一个“任务视图”和第三个“文件资源管理器”图标，这两个会常用，尤其第一个“任务视图”后面会单独做介绍。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105729.png" alt=""></p>
<p>个人感觉windows 10的任务栏较宽，比较占屏幕空间，尤其是对于笔记本而言，所以进行如下设置。</p>
<p>在任务栏上单击右键，选择“设置”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105755.png" alt=""></p>
<p>在弹出的任务栏选设置对话框中将选项“使用小任务栏按钮”设置为“开”，这样可以降低任务栏高度，节省屏幕空间；在“合并任务栏按钮”中选择“从不”，这样任务栏中会显示当前打开应用的名称，方便快速切换工作任务。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105808.png" alt=""></p>
<p>在“通知区域”中点击“选择哪些图标显示在任务栏上”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105820.png" alt=""></p>
<p>在这里可以选择哪些图标在任务栏中显示，比如QQ默认是不在任务栏中显示的，可以在此打开，方便查看QQ信息。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105832.png" alt=""></p>
<h2 id="“开始”屏幕设置"><a href="#“开始”屏幕设置" class="headerlink" title="“开始”屏幕设置"></a>“开始”屏幕设置</h2><p>点击左下角的Windows图标，会出现“生活动态”和“播放和浏览”等图标，感觉对许多国内的用户而言很多使用频率极低，所以可以换成常用应用，或不常用但又不想放在桌面上的应用图标，放这里方便启动。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105844.png" alt=""></p>
<p>在图标上右键单击，选择“从’开始’屏幕取消固定”，也可以通过“调整大小”改变图标大小。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105856.png" alt=""></p>
<p>既然将不常用的应用图标去掉了，那么就添加自己需要的图标吧，常用的方法有：可以右键点击桌面应用图标，选择“固定到’开始’屏幕”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105909.png" alt=""></p>
<p>还可以在“开始”屏幕的应用列表中添加</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105924.png" alt=""></p>
<p>或者在小娜语音助手中搜索应用，然后右键添加</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105936.png" alt=""></p>
<h2 id="文件资源管理器设置"><a href="#文件资源管理器设置" class="headerlink" title="文件资源管理器设置"></a>文件资源管理器设置</h2><p>文件资源管理器中主要在“查看”选项卡中将“文件扩展名”前打勾，这样方便查看文件后缀名，从而知道文件类型，如：exe，docx，txt等。当然其它的图标大小也可以根据自己习惯进行设置。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809105950.png" alt=""></p>
<h2 id="任务视图设置"><a href="#任务视图设置" class="headerlink" title="任务视图设置"></a>任务视图设置</h2><p>任务视图相当于虚拟桌面，当开启任务比较多而且从属不同类型的应用时可以放到不同的界面，比如工作，娱乐就可以分别放在两个不同的界面。</p>
<p>点击“任务视图”图标，然后点击右侧的“新建桌面”，个人喜欢建立三个桌面，快捷键是Ctrl+Win+←或Ctrl+Win+→。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110003.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110016.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110027.png" alt=""></p>
<h2 id="语音助手小娜设置"><a href="#语音助手小娜设置" class="headerlink" title="语音助手小娜设置"></a>语音助手小娜设置</h2><p>语音助手可以进行语音操作，我常用的是其搜索功能，比如想要打开控制面板时可以直接在此搜索快速打开</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110040.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110052.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/08/20210809110108.png" alt=""></p>
<h1 id="Windows常用软件推荐"><a href="#Windows常用软件推荐" class="headerlink" title="Windows常用软件推荐"></a>Windows常用软件推荐</h1><p>浏览器：<a href="https://www.google.com/chrome/browser/desktop/index.html" target="_blank" rel="noopener">Google Chrome浏览器</a>、<a href="http://chrome.360.cn/" target="_blank" rel="noopener">360极速浏览器</a></p>
<p>音乐播放器：<a href="http://music.163.com/#/download" target="_blank" rel="noopener">网易云音乐</a></p>
<p>视频播放器：<a href="https://potplayer.daum.net/" target="_blank" rel="noopener">potplayer</a></p>
<p>压缩软件：<a href="http://www.7-zip.org/" target="_blank" rel="noopener">7 zip</a></p>
<p>PDF阅读器：<a href="https://www.foxitsoftware.cn/downloads/" target="_blank" rel="noopener">福昕阅读器</a></p>
<p>文档编辑器：<a href="https://notepad-plus-plus.org/download/v7.3.1.html" target="_blank" rel="noopener">Notepad ++</a></p>
<p>文件同步软件：<a href="https://www.jianguoyun.com/" target="_blank" rel="noopener">坚果云</a>、<a href="http://pan.baidu.com/download" target="_blank" rel="noopener">百度云</a></p>
<p>思维导图软件：<a href="http://www.xmindchina.net/xiazai.html" target="_blank" rel="noopener">XMind</a></p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>win10</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows 10 安装 Maven</title>
    <url>/2021/05/06/window-install-maven/</url>
    <content><![CDATA[<p>本文详细介绍了 Windows 10 中安装设置 Maven 的具体步骤。</p>
<a id="more"></a>

<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>官方下载地址：<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener">https://maven.apache.org/download.cgi</a></p>
<p>历史版本：<a href="https://ftp.kddi-research.jp/infosystems/apache/maven/maven-3/" target="_blank" rel="noopener">https://ftp.kddi-research.jp/infosystems/apache/maven/maven-3/</a></p>
<p>本文以 <code>apache-maven-3.6.3-bin.zip</code> 为例做演示，备用下载地址：<a href="https://gitee.com/erik_ly/blog_share_files/raw/master/maven/apache-maven-3.6.3-bin.zip" target="_blank" rel="noopener">https://gitee.com/erik_ly/blog_share_files/raw/master/maven/apache-maven-3.6.3-bin.zip</a></p>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><p>将下载的 <code>zip</code> 包解压，例如：<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506162919.png" alt=""></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><p>在<code>此电脑</code> 右键 —— 属性 —— 高级系统设置 —— 环境变量 —— 系统变量，然后点击“新建”，流程如下：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506163547.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506163628.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506163741.png" alt=""></p>
<p>新建系统变量</p>
<p>变量名：<code>MAVEN_HOME</code></p>
<p>变量值：<code>C:\Software\apache-maven-3.6.3</code></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506163902.png" alt=""></p>
<p>编辑 <code>path</code> 环境变量<br><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/05/20210506170027.png" alt=""></p>
<p>新增 <code>%MAVEN_HOME%\bin</code></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506164026.png" alt=""></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p><code>Win</code> + R 调出运行 <code>cmd</code>，然后执行 <code>mvn -v</code> 查看 Maven 信息</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506164053.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2021/04/20210506164207.png" alt=""></p>
<p>能正常输出 Maven 信息即为安装设置成功。</p>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>Zabbix 离线安装及使用方法</title>
    <url>/2020/12/01/zabbix-offline-install-and-use/</url>
    <content><![CDATA[<p>本文主要介绍 Zabbix 的离线安装方法，并且提供一键安装脚本，方便内网安装部署。介绍常用的监控配置包括主机自动发现及磁盘 IO 监控等。</p>
<a id="more"></a>

<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><p>Linux系统：CentOS 7.6</p>
<h1 id="源文件"><a href="#源文件" class="headerlink" title="源文件"></a>源文件</h1><p>安装包及脚本已上传 GitHub，可前往下载源文件</p>
<p>Erik-ly/install-zabbix-offline: 离线安装zabbix</p>
<p><a href="https://github.com/Erik-ly/install-zabbix-offline" target="_blank" rel="noopener">https://github.com/Erik-ly/install-zabbix-offline</a></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装zabbix-server"><a href="#安装zabbix-server" class="headerlink" title="安装zabbix server"></a>安装zabbix server</h2><p>如果安装主机是干净的系统，没有MySQL或mariadb，则使用zabbix，执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh autosetup.sh</span><br></pre></td></tr></table></figure>

<p>如果安装主机中已经安装MySQL数据库，则使用zabbix_exist_mysql，执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh autosetup.sh dbpwd</span><br></pre></td></tr></table></figure>

<p>dbpwd为MySQL数据库密码</p>
<p><strong>登录webUI</strong></p>
<p><a href="http://serverIP/zabbix/" target="_blank" rel="noopener">http://serverIP/zabbix/</a></p>
<p>用户名/密码：Admin/zabbix</p>
<p>如果出现如下提示</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/96f536c46163c45460879377d851871f.png" alt=""></p>
<p>需要设置php的时区</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;php.ini</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e836d46e324c554099da149bb6b75b39.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">date.timezone &#x3D; &quot;Asia&#x2F;Shanghai&quot;</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service</span><br></pre></td></tr></table></figure>

<p><strong>修改时区</strong></p>
<p>如果监控显示的时间不正确，可以查看zabbix<br>server主机的时区是否正确，中国用户可执行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Export TZ&#x3D;’Asia&#x2F;Shanghai’</span><br><span class="line"></span><br><span class="line">date</span><br><span class="line"></span><br><span class="line">Fri Sep 20 09:07:00 CST 2019</span><br><span class="line"></span><br><span class="line">date –s 09:07:00</span><br></pre></td></tr></table></figure>

<p><strong>设置中文</strong></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/41ca56b17eb33703199227c8c33bd2d4.png" alt=""></p>
<h2 id="安装zabbix-agent"><a href="#安装zabbix-agent" class="headerlink" title="安装zabbix agent"></a>安装zabbix agent</h2><p>使用batch_setup_zabbix_agent可以批量安装zabbix agent，</p>
<p>修改ipList.txt，修改为需要安装zabbix agent的真实IP，中间以空格分隔。</p>
<p>修改 zabbix_agent/setup_zabbix_agent.sh 中的 ServerIP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ServerIP&#x3D;&quot;10.180.100.100&quot;</span><br></pre></td></tr></table></figure>

<p>修改为真是的zabbix server IP</p>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh batch_setup_zabbix_agent.sh rootpwd</span><br></pre></td></tr></table></figure>

<p>rootpwd 为这些主机的root密码</p>
<p><strong>默认使用root权限，并且配置磁盘io数据，可根据实际情况修改。</strong></p>
<h1 id="配置监控"><a href="#配置监控" class="headerlink" title="配置监控"></a>配置监控</h1><h2 id="自动发现"><a href="#自动发现" class="headerlink" title="自动发现"></a>自动发现</h2><p>首先配置“发现规则”，依次点击“配置”——“自动发现”——“创建发现规则”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/eea7e94de6db5d3afcf114af4179ff1a.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7cbd27b40b7c959c997b092855983ecc.png" alt=""></p>
<p>一定要点“添加”，否则无效</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/3de81e069f42d8622fbbbf571ed534cc.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8d3dbbd5b6698350d8dbeff59cc41c6a.png" alt=""></p>
<p>创建动作，依次选择“配置”——“动作”，在“事件源”处选择“自动发现”，然后点击“创建动作”</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/575b9bfc4e1788e2dc889548de3c0608.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/3a43df402e40aa5ff966804aaf44f8e4.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/477184a70606a99254a54832cf6942de.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/38f31dddd9a7637f07feea67e7d7bee9.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2517493bfe40f87402f8c8cf826c824d.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5ade38658a86c0af86b881666558a116.png" alt=""></p>
<p>查看自动发现的主机</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/a17041da0d35e36af187d68d9351769d.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5fd403f9437d0f713e68ee9e0a17a41f.png" alt=""></p>
<p>在主页可以添加自动发现组件</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/4493404fd8eeccf136181f80fa3b0851.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/782c935c807839648d01d76d4bb53596.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/72554966cb565ea853e4fc4f7ccdde4d.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/a8ef29f53da28922b74835974853dd6b.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8a3274faa5d0387340aaf60132646032.png" alt=""></p>
<h2 id="磁盘IO"><a href="#磁盘IO" class="headerlink" title="磁盘IO"></a>磁盘IO</h2><p>批量安装zabbix agent时，默认已经配置了磁盘IO，只需在zabbix<br>界面配置显示即可，步骤为：</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/c5970c6aa6f535731cfa7ee5db64cff4.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/329ed7e07257d5eee19e75b12b1e2721.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/bf4e011e1da51cf4b0807c09d9c4ee2a.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7b7812535a15bde5a22c242406ff5b69.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/72dc9247e4d79957968df854ff78d7ea.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/603d3c4996853c45a6693e08bb92a2d1.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/ea772d137ed0ef556374b9c18c282ee5.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2c019ea809a3020b9f4a51c93aa54917.png" alt=""></p>
<p>io.scandisk</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/681fc5d39ce2eb50f62624373ade7128.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/dba10aacb57f20ad1f826a663d0674b7.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/f9f07909e862f21a4b1c799264251f8d.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/97b7125509b44be9d9c7a38173a38095.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">io avgqu-sz on &#123;\#DISKNAME&#125; io.avgqu-sz[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io avgrq-sz on &#123;\#DISKNAME&#125; io.avgrq-sz[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io await on &#123;\#DISKNAME&#125; io.await[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io rMBps on &#123;\#DISKNAME&#125; io.rMBps[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io rps on &#123;\#DISKNAME&#125; io.rps[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io r_await on &#123;\#DISKNAME&#125; io.r_await[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io svctm on &#123;\#DISKNAME&#125; io.svctm[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io utils on &#123;\#DISKNAME&#125; io.util[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io wMBps on &#123;\#DISKNAME&#125; io.wMBps[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io wps on &#123;\#DISKNAME&#125; io.wps[&#123;\#DISKNAME&#125;]</span><br><span class="line"></span><br><span class="line">io w_await on &#123;\#DISKNAME&#125; io.w_await[&#123;\#DISKNAME&#125;]</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/afd81f1d640ec8dd4099c26ac4043fe3.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/bf6d0726d05ad1d550027f94c3a60d34.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/908a4fbc813a996745e87f6f62415bcc.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/7b7cfd3de0eb6ab97f6c15b2c7b6149c.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/031e2126e581ad543c6ef557b462dc57.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/aeb5f2117bdaa14627edc16965305b5f.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e6c49e1aff1e7b91cab4b5cf938879eb.png" alt="C:\\Users\\Erik\\Downloads\\Google Chrome\\0a8ebb2d-571e-4cb0-bf10-f7d0dac7c32b.png"></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/755bdc5c9a84e15bbbd3ac924ae9a007.png" alt=""></p>
<p>图形原型</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8021e3210e985b8e2c90c04309096f38.png" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>linux zabbix 安装 支持离线安装 支持批量添加主机 - fantasywith的博客 - CSDN博客<br><a href="https://blog.csdn.net/fantasywith/article/details/84193071" target="_blank" rel="noopener">https://blog.csdn.net/fantasywith/article/details/84193071</a> </p>
</li>
<li><p>Zabbix自动发现主机并批量添加监控 - 友人A的博客 - CSDN博客<br><a href="https://blog.csdn.net/tladagio/article/details/79185093" target="_blank" rel="noopener">https://blog.csdn.net/tladagio/article/details/79185093</a> </p>
</li>
<li><p>zabbix4.0 自动发现监控磁盘IO - 忆网 - CSDN博客<br><a href="https://blog.csdn.net/qq_24027457/article/details/83587826" target="_blank" rel="noopener">https://blog.csdn.net/qq_24027457/article/details/83587826</a> </p>
</li>
<li><p>linux系统修改系统时间与时区-百度经验<br><a href="https://jingyan.baidu.com/article/fa4125acb7328628ac70920e.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/fa4125acb7328628ac70920e.html</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>软件工具</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeper 常用命令</title>
    <url>/2022/04/03/zookeeper-common-commands/</url>
    <content><![CDATA[<p>本文主要介绍 ZooKeeper 的常用命令，包括常用命令行命令、ACL 访问控制、四字命令、解析日志和快照等命令。</p>
<a id="more"></a>

<h1 id="ZooKeeper-命令行"><a href="#ZooKeeper-命令行" class="headerlink" title="ZooKeeper 命令行"></a>ZooKeeper 命令行</h1><h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><ul>
<li>全局变量连接当前节点</li>
</ul>
<p>当集群中的节点已安装 ZooKeeper Client，且 <code>zookeeper-client</code> 为全局环境变量时，可以直接在任意位置使用 <code>zookeeper-client</code> 命令连接当前节点的 ZooKeeper，进入命令行界面。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# zookeeper-client</span><br><span class="line">Connecting to localhost:2181</span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0]</span><br></pre></td></tr></table></figure>



<ul>
<li>shell 脚本连接</li>
</ul>
<p>使用 <code>zkCli.sh</code> 进行连接当前节点 ZooKeeper。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager bin]# pwd</span><br><span class="line">/usr/hdp/3.0.1.0-187/zookeeper/bin</span><br><span class="line">[root@manager bin]# ll</span><br><span class="line">total 40</span><br><span class="line">-rwxr-xr-x. 1 root root 2155 Nov 23  2019 zkCleanup.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 1709 Nov 23  2019 zkCli.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 2840 Nov 23  2019 zkEnv.sh</span><br><span class="line">-rwxr-xr-x. 1 root root   12 Nov 23  2019 zkServer-initialize.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 6822 Nov 23  2019 zkServer.sh</span><br><span class="line">-rwxr-xr-x. 1 root root  304 Nov 23  2019 zookeeper-client</span><br><span class="line">-rwxr-xr-x. 1 root root  649 Nov 23  2019 zookeeper-server</span><br><span class="line">-rwxr-xr-x. 1 root root  650 Nov 23  2019 zookeeper-server-cleanup</span><br><span class="line">-rwxr-xr-x. 1 root root  660 Nov 23  2019 zookeeper-server-initialize</span><br><span class="line">[root@manager bin]# ./zkCli.sh </span><br><span class="line">Connecting to localhost:2181</span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0]</span><br></pre></td></tr></table></figure>



<ul>
<li>连接某个节点的 ZooKeeper</li>
</ul>
<p>无论是全局变量或 shell 脚本，都可以使用 <code>-server ip:port</code> 的方法连接到某个节点的 ZooKeeper。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# zookeeper-client -server master.bigdata:2181</span><br><span class="line">Connecting to master.bigdata:2181</span><br><span class="line">…………</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager bin]# pwd</span><br><span class="line">/usr/hdp/3.0.1.0-187/zookeeper/bin</span><br><span class="line">[root@manager bin]# ll</span><br><span class="line">total 40</span><br><span class="line">-rwxr-xr-x. 1 root root 2155 Nov 23  2019 zkCleanup.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 1709 Nov 23  2019 zkCli.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 2840 Nov 23  2019 zkEnv.sh</span><br><span class="line">-rwxr-xr-x. 1 root root   12 Nov 23  2019 zkServer-initialize.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 6822 Nov 23  2019 zkServer.sh</span><br><span class="line">-rwxr-xr-x. 1 root root  304 Nov 23  2019 zookeeper-client</span><br><span class="line">-rwxr-xr-x. 1 root root  649 Nov 23  2019 zookeeper-server</span><br><span class="line">-rwxr-xr-x. 1 root root  650 Nov 23  2019 zookeeper-server-cleanup</span><br><span class="line">-rwxr-xr-x. 1 root root  660 Nov 23  2019 zookeeper-server-initialize</span><br><span class="line">[root@manager bin]# ./zkCli.sh -server master.bigdata:2181</span><br><span class="line">Connecting to master.bigdata:2181</span><br><span class="line">…………</span><br></pre></td></tr></table></figure>



<h2 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h2><p>在 ZooKeeper Client 命令行交互窗口输入 <code>quit</code>，退出命令行界面。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] quit</span><br><span class="line">Quitting...</span><br><span class="line">2022-01-03 13:51:57,780 - INFO  [main:ZooKeeper@692] - Session: 0x17e03c37bbc0010 closed</span><br><span class="line">2022-01-03 13:51:57,782 - INFO  [main-EventThread:ClientCnxn$EventThread@517] - EventThread shut down</span><br><span class="line">[root@manager ~]#</span><br></pre></td></tr></table></figure>



<h2 id="Znode-基本操作"><a href="#Znode-基本操作" class="headerlink" title="Znode 基本操作"></a>Znode 基本操作</h2><h3 id="help-命令"><a href="#help-命令" class="headerlink" title="help 命令"></a>help 命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] help</span><br><span class="line">ZooKeeper -server host:port cmd args</span><br><span class="line">	stat path [watch]</span><br><span class="line">	set path data [version]</span><br><span class="line">	ls path [watch]</span><br><span class="line">	delquota [-n|-b] path</span><br><span class="line">	ls2 path [watch]</span><br><span class="line">	setAcl path acl</span><br><span class="line">	setquota -n|-b val path</span><br><span class="line">	history </span><br><span class="line">	redo cmdno</span><br><span class="line">	printwatches on|off</span><br><span class="line">	delete path [version]</span><br><span class="line">	sync path</span><br><span class="line">	listquota path</span><br><span class="line">	rmr path</span><br><span class="line">	get path [watch]</span><br><span class="line">	create [-s] [-e] path data acl</span><br><span class="line">	addauth scheme auth</span><br><span class="line">	quit </span><br><span class="line">	getAcl path</span><br><span class="line">	close </span><br><span class="line">	connect host:port</span><br></pre></td></tr></table></figure>



<h3 id="列出当前节点的子节点"><a href="#列出当前节点的子节点" class="headerlink" title="列出当前节点的子节点"></a>列出当前节点的子节点</h3><p>使用 <code>ls path</code> 查看 znode 节点的子节点</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls /</span><br><span class="line">[cluster, controller, brokers, zookeeper, hbase-unsecure, dolphinscheduler, admin, isr_change_notification, log_dir_event_notification, hiveserver2, controller_epoch, hiveserver2-leader, kafka-manager, rmstore, atsv2-hbase-unsecure, ambari-metrics-cluster, consumers, latest_producer_id_block, config]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls /brokers</span><br><span class="line">[ids, topics, seqid]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] ls /brokers/ids</span><br><span class="line">[1003, 1002, 1001]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3]</span><br></pre></td></tr></table></figure>



<h3 id="获取节点存储内容"><a href="#获取节点存储内容" class="headerlink" title="获取节点存储内容"></a>获取节点存储内容</h3><p>使用 <code>get path</code> 获取该节点的存储内容。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] get &#x2F;brokers&#x2F;ids&#x2F;1001</span><br><span class="line">&#123;&quot;listener_security_protocol_map&quot;:&#123;&quot;PLAINTEXT&quot;:&quot;PLAINTEXT&quot;&#125;,&quot;endpoints&quot;:[&quot;PLAINTEXT:&#x2F;&#x2F;master.bigdata:6667&quot;],&quot;jmx_port&quot;:-1,&quot;host&quot;:&quot;master.bigdata&quot;,&quot;timestamp&quot;:&quot;1640751404064&quot;,&quot;port&quot;:6667,&quot;version&quot;:4&#125;</span><br><span class="line">cZxid &#x3D; 0x60000014a</span><br><span class="line">ctime &#x3D; Wed Dec 29 12:16:44 CST 2021</span><br><span class="line">mZxid &#x3D; 0x60000014a</span><br><span class="line">mtime &#x3D; Wed Dec 29 12:16:44 CST 2021</span><br><span class="line">pZxid &#x3D; 0x60000014a</span><br><span class="line">cversion &#x3D; 0</span><br><span class="line">dataVersion &#x3D; 0</span><br><span class="line">aclVersion &#x3D; 0</span><br><span class="line">ephemeralOwner &#x3D; 0x17e03c37bbc0001</span><br><span class="line">dataLength &#x3D; 198</span><br><span class="line">numChildren &#x3D; 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4]</span><br></pre></td></tr></table></figure>



<h3 id="获取节点状态"><a href="#获取节点状态" class="headerlink" title="获取节点状态"></a>获取节点状态</h3><p>使用 <code>stat path</code> 获取该节点的状态。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] stat /brokers/ids/1001</span><br><span class="line">cZxid = 0x60000014a</span><br><span class="line">ctime = Wed Dec 29 12:16:44 CST 2021</span><br><span class="line">mZxid = 0x60000014a</span><br><span class="line">mtime = Wed Dec 29 12:16:44 CST 2021</span><br><span class="line">pZxid = 0x60000014a</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x17e03c37bbc0001</span><br><span class="line">dataLength = 198</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5]</span><br></pre></td></tr></table></figure>



<h3 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h3><p>使用 <code>create path data</code> 创建节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 8] create /t1 test1</span><br><span class="line">Created /t1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] ls /</span><br><span class="line">[cluster, controller, brokers, zookeeper, hbase-unsecure, dolphinscheduler, admin, isr_change_notification, log_dir_event_notification, hiveserver2, controller_epoch, hiveserver2-leader, kafka-manager, rmstore, atsv2-hbase-unsecure, ambari-metrics-cluster, consumers, latest_producer_id_block, config, t1]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] get /t1</span><br><span class="line">test1</span><br><span class="line">cZxid = 0x600001e24</span><br><span class="line">ctime = Mon Jan 03 14:30:20 CST 2022</span><br><span class="line">mZxid = 0x600001e24</span><br><span class="line">mtime = Mon Jan 03 14:30:20 CST 2022</span><br><span class="line">pZxid = 0x600001e24</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 5</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11]</span><br></pre></td></tr></table></figure>



<h3 id="创建临时节点"><a href="#创建临时节点" class="headerlink" title="创建临时节点"></a>创建临时节点</h3><p>使用 <code>create -e path data</code> 创建临时节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] create -e /t1/e1 ephemeral_1</span><br><span class="line">Created /t1/e1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 17] get /t1/e1                  </span><br><span class="line">ephemeral_1</span><br><span class="line">cZxid = 0x600001e2b</span><br><span class="line">ctime = Mon Jan 03 14:35:17 CST 2022</span><br><span class="line">mZxid = 0x600001e2b</span><br><span class="line">mtime = Mon Jan 03 14:35:17 CST 2022</span><br><span class="line">pZxid = 0x600001e2b</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x17e03c37bbc0014</span><br><span class="line">dataLength = 11</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] quit</span><br><span class="line">Quitting...</span><br><span class="line">2022-01-03 14:35:45,076 - INFO  [main:ZooKeeper@692] - Session: 0x17e03c37bbc0014 closed</span><br><span class="line">2022-01-03 14:35:45,077 - INFO  [main-EventThread:ClientCnxn$EventThread@517] - EventThread shut down</span><br></pre></td></tr></table></figure>



<p>重新登录后 <code>e1</code> 节点消失。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls &#x2F;t1</span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 1]</span><br></pre></td></tr></table></figure>



<h3 id="创建顺序节点"><a href="#创建顺序节点" class="headerlink" title="创建顺序节点"></a>创建顺序节点</h3><p>使用 <code>create -s path data</code> 创建顺序节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] create -s /t1/s1 123</span><br><span class="line">Created /t1/s10000000002</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create -s /t1/s1 123</span><br><span class="line">Created /t1/s10000000003</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] ls /t1</span><br><span class="line">[s10000000002, s10000000003]</span><br></pre></td></tr></table></figure>



<h3 id="修改节点"><a href="#修改节点" class="headerlink" title="修改节点"></a>修改节点</h3><p>使用 <code>set path data</code> 进行修改节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] create /t2 test2</span><br><span class="line">Created /t2</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] get /t2</span><br><span class="line">test2</span><br><span class="line">cZxid = 0x600001e99</span><br><span class="line">ctime = Mon Jan 03 16:19:33 CST 2022</span><br><span class="line">mZxid = 0x600001e99</span><br><span class="line">mtime = Mon Jan 03 16:19:33 CST 2022</span><br><span class="line">pZxid = 0x600001e99</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 5</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] set /t2 test</span><br><span class="line">cZxid = 0x600001e99</span><br><span class="line">ctime = Mon Jan 03 16:19:33 CST 2022</span><br><span class="line">mZxid = 0x600001e9d</span><br><span class="line">mtime = Mon Jan 03 16:20:48 CST 2022</span><br><span class="line">pZxid = 0x600001e99</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] get /t2</span><br><span class="line">test</span><br><span class="line">cZxid = 0x600001e99</span><br><span class="line">ctime = Mon Jan 03 16:19:33 CST 2022</span><br><span class="line">mZxid = 0x600001e9d</span><br><span class="line">mtime = Mon Jan 03 16:20:48 CST 2022</span><br><span class="line">pZxid = 0x600001e99</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 6]</span><br></pre></td></tr></table></figure>



<h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><p>使用 <code>delete path</code> 删除指定路径的节点；</p>
<p>使用 <code>rmr path</code> 可循环删除路径下的节点。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 8] ls /t2</span><br><span class="line">[]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] create /t2/a1 a1</span><br><span class="line">Created /t2/a1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] create /t2/a2 a2</span><br><span class="line">Created /t2/a2</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] create /t2/a3 a3</span><br><span class="line">Created /t2/a3</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] ls /t2</span><br><span class="line">[a1, a2, a3]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] delete /t2/a1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] ls /t2</span><br><span class="line">[a2, a3]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15] rmr /t2</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] ls /</span><br><span class="line">[cluster, controller, brokers, zookeeper, hbase-unsecure, dolphinscheduler, admin, isr_change_notification, log_dir_event_notification, hiveserver2, controller_epoch, hiveserver2-leader, kafka-manager, rmstore, atsv2-hbase-unsecure, ambari-metrics-cluster, consumers, latest_producer_id_block, config, t1]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 17]</span><br></pre></td></tr></table></figure>



<h3 id="设置节点配额"><a href="#设置节点配额" class="headerlink" title="设置节点配额"></a>设置节点配额</h3><p>使用 <code>setquota -n|-b val path</code> 可限制节点的值的长度或其子节点的个数。</p>
<p>- -n 限制节点(包含当前节点)的个数为 val</p>
<p>- -b 限制节点值的长度为 val</p>
<p>- path 要限制的节点路径</p>
<p>限制节点数：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] create /t3 test3</span><br><span class="line">Created /t3</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] setquota -n 2 /t3</span><br><span class="line">Comment: the parts are option -n val 2 path /t3</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] create /t3/a1 a1</span><br><span class="line">Created /t3/a1</span><br><span class="line">[zk: localhost:2181(CONNECTED) 4] create /t3/a2 a2</span><br><span class="line">Created /t3/a2</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] create /t3/a3 a3</span><br><span class="line">Created /t3/a3</span><br><span class="line"> [zk: localhost:2181(CONNECTED) 6] ls /t3</span><br><span class="line">[a1, a2, a3]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 7]</span><br></pre></td></tr></table></figure>

<p>超额，不会抛出异常，只是在日志中出现警告信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2022-01-03 16:38:33,532 - WARN  [CommitProcessor:1:DataTree@302] - Quota exceeded: &#x2F;t3 count&#x3D;3 limit&#x3D;2</span><br><span class="line">2022-01-03 16:38:40,136 - WARN  [CommitProcessor:1:DataTree@302] - Quota exceeded: &#x2F;t3 count&#x3D;4 limit&#x3D;2</span><br></pre></td></tr></table></figure>



<p>限制节点长度：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 9] create /t5 test5</span><br><span class="line">Created /t5</span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] setquota -b 5 /t5</span><br><span class="line">Comment: the parts are option -b val 5 path /t5</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] create /t5/abc abc</span><br><span class="line">Created /t5/abc</span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] create /t5/abcdef abcdef</span><br><span class="line">Created /t5/abcdef</span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] ls /t5</span><br><span class="line">[abcdef, abc]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 14]</span><br></pre></td></tr></table></figure>

<p>同样，超出显示也不会报错，只是在日志中出现警告信息。</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">2022-01-03 16:59:33,229 - WARN  [CommitProcessor:1:DataTree@348] - Quota exceeded: /t5 bytes=8 limit=5</span><br><span class="line">2022-01-03 16:59:45,076 - WARN  [CommitProcessor:1:DataTree@348] - Quota exceeded: /t5 bytes=14 limit=5</span><br></pre></td></tr></table></figure>



<h3 id="查看节点配额"><a href="#查看节点配额" class="headerlink" title="查看节点配额"></a>查看节点配额</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 7] listquota /t3</span><br><span class="line">absolute path is /zookeeper/quota/t3/zookeeper_limits</span><br><span class="line">Output quota for /t3 count=2,bytes=-1</span><br><span class="line">Output stat for /t3 count=4,bytes=11</span><br><span class="line">[zk: localhost:2181(CONNECTED) 8] </span><br><span class="line"></span><br><span class="line">[zk: localhost:2181(CONNECTED) 14] listquota /t5</span><br><span class="line">absolute path is /zookeeper/quota/t5/zookeeper_limits</span><br><span class="line">Output quota for /t5 count=-1,bytes=5</span><br><span class="line">Output stat for /t5 count=3,bytes=14</span><br><span class="line">[zk: localhost:2181(CONNECTED) 15]</span><br></pre></td></tr></table></figure>



<h3 id="删除节点配额"><a href="#删除节点配额" class="headerlink" title="删除节点配额"></a>删除节点配额</h3><p>使用 <code>delquota [-n|-b] path</code> 删除配额信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 15] delquota -n /t3</span><br><span class="line"> </span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] delquota -b /t5</span><br></pre></td></tr></table></figure>



<h3 id="列出历史操作命令"><a href="#列出历史操作命令" class="headerlink" title="列出历史操作命令"></a>列出历史操作命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 22] history</span><br><span class="line">12 - create /t5/abcdef abcdef</span><br><span class="line">13 - ls /t5</span><br><span class="line">14 - listquota /t5</span><br><span class="line">15 - delquota -n /t3</span><br><span class="line">16 - listquota /t3</span><br><span class="line">17 - delquota -b4 /t5</span><br><span class="line">18 - delquota -b /t5</span><br><span class="line">19 - listquota /t5</span><br><span class="line">20 - ls /t3</span><br><span class="line">21 - create /t3/a4 a4</span><br><span class="line">22 - history</span><br><span class="line">[zk: localhost:2181(CONNECTED) 23]</span><br></pre></td></tr></table></figure>



<h3 id="重新执行-history-中的命令"><a href="#重新执行-history-中的命令" class="headerlink" title="重新执行 history 中的命令"></a>重新执行 history 中的命令</h3><p>使用 <code>redo cmdno</code> 可以重新执行history中的命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 23] redo 20</span><br><span class="line">[a1, a2, a3, a4]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 24]</span><br></pre></td></tr></table></figure>



<h3 id="连接其他服务器"><a href="#连接其他服务器" class="headerlink" title="连接其他服务器"></a>连接其他服务器</h3><p>使用 <code>connect host:port</code> 可以连接其他服务器。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] connect master.bigdata:2181</span><br><span class="line">2022-01-03 17:15:37,507 - INFO  [main:ZooKeeper@692] - Session: 0x17e03c37bbc001a closed</span><br><span class="line">2022-01-03 17:15:37,507 - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=master.bigdata:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@1c655221</span><br><span class="line">…………</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line"></span><br><span class="line">[zk: master.bigdata:2181(CONNECTED) 1] ls /</span><br><span class="line">[cluster, t5, controller, brokers, zookeeper, hbase-unsecure, dolphinscheduler, admin, isr_change_notification, log_dir_event_notification, hiveserver2, controller_epoch, hiveserver2-leader, kafka-manager, rmstore, atsv2-hbase-unsecure, ambari-metrics-cluster, consumers, latest_producer_id_block, config, t1, t3]</span><br><span class="line">[zk: master.bigdata:2181(CONNECTED) 2] close</span><br><span class="line">2022-01-03 17:16:08,866 - INFO  [main:ZooKeeper@692] - Session: 0x27e03c37a4f000c closed</span><br><span class="line">[zk: master.bigdata:2181(CLOSED) 3] 2022-01-03 17:16:08,867 - INFO  [main-EventThread:ClientCnxn$EventThread@517] - EventThread shut down</span><br><span class="line"></span><br><span class="line">[zk: master.bigdata:2181(CLOSED) 3] quit</span><br><span class="line">Quitting...</span><br><span class="line">[root@manager bin]#</span><br></pre></td></tr></table></figure>



<h1 id="ACL-访问控制"><a href="#ACL-访问控制" class="headerlink" title="ACL 访问控制"></a>ACL 访问控制</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Zookeeper类似于unix文件系统，节点类比文件，客户端可以删除节点，创建节点，修改节点。Zookeeper可以使用ACL（access control list）访问控制列表来对节点的权限进行控制。</p>
<p>acl 权限控制使用：scheme id permission 来标志，主要涵盖三个方面：</p>
<ul>
<li>权限模式（scheme）：授权的策略。</li>
<li>权限对象（id）：授权的对象。</li>
<li>权限（permission）：授予的权限。</li>
</ul>
<h2 id="权限模式种类"><a href="#权限模式种类" class="headerlink" title="权限模式种类"></a>权限模式种类</h2><table>
<thead>
<tr>
<th align="center">模式</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">world</td>
<td align="center">这种模式方法的授权对象只有一个anyone，代表登录到服务器的所有客户端都能对该节点执行某种权限</td>
</tr>
<tr>
<td align="center">ip</td>
<td align="center">对连接的客户端使用IP地址认证方式进行认证</td>
</tr>
<tr>
<td align="center">auth</td>
<td align="center">使用以添加认证的用户进行认证</td>
</tr>
<tr>
<td align="center">digest</td>
<td align="center">使用 用户:密码方式验证</td>
</tr>
</tbody></table>
<h2 id="权限的类型"><a href="#权限的类型" class="headerlink" title="权限的类型"></a>权限的类型</h2><table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">ACL简写</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">read</td>
<td align="center">r</td>
<td align="center">读取节点及显示子节点列表的权限</td>
</tr>
<tr>
<td align="center">write</td>
<td align="center">w</td>
<td align="center">设置节点数据的权限</td>
</tr>
<tr>
<td align="center">create</td>
<td align="center">c</td>
<td align="center">创建子节点的权限</td>
</tr>
<tr>
<td align="center">delete</td>
<td align="center">d</td>
<td align="center">删除子节点的权限</td>
</tr>
<tr>
<td align="center">admin</td>
<td align="center">a</td>
<td align="center">设置该节点ACL权限的权限</td>
</tr>
</tbody></table>
<h2 id="关于授权的命令"><a href="#关于授权的命令" class="headerlink" title="关于授权的命令"></a>关于授权的命令</h2><table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">用法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">getAcl</td>
<td align="center">getAcl path</td>
<td align="center">读取节点的 ACL</td>
</tr>
<tr>
<td align="center">setAcl</td>
<td align="center">setAcl path acl</td>
<td align="center">设置节点的 ACL</td>
</tr>
<tr>
<td align="center">create</td>
<td align="center">create path data acl</td>
<td align="center">创建节点时设置 ACL</td>
</tr>
<tr>
<td align="center">addAuth</td>
<td align="center">addAuth scheme auth</td>
<td align="center">添加认证用户，类似于登录操作</td>
</tr>
</tbody></table>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] create /test/ta t1</span><br><span class="line">Created /test/ta</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] getAcl /test/ta</span><br><span class="line">'world,'anyone</span><br><span class="line">: cdrwa</span><br><span class="line">[zk: localhost:2181(CONNECTED) 6]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 6] setAcl /test/ta world:anyone:cdwa</span><br><span class="line">cZxid = 0x800000093</span><br><span class="line">ctime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">mZxid = 0x800000093</span><br><span class="line">mtime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">pZxid = 0x800000093</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 1</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 2</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 7] getAcl /test/ta</span><br><span class="line">'world,'anyone</span><br><span class="line">: cdwa</span><br><span class="line">[zk: localhost:2181(CONNECTED) 8] get /test/ta</span><br><span class="line">Authentication is not valid : /test/ta</span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] </span><br><span class="line">[zk: localhost:2181(CONNECTED) 9] setAcl /test/ta world:anyone:cdrwa</span><br><span class="line">cZxid = 0x800000093</span><br><span class="line">ctime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">mZxid = 0x800000093</span><br><span class="line">mtime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">pZxid = 0x800000093</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 2</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 2</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] get /test/ta                      </span><br><span class="line">t1</span><br><span class="line">cZxid = 0x800000093</span><br><span class="line">ctime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">mZxid = 0x800000093</span><br><span class="line">mtime = Tue Mar 22 15:38:03 CST 2022</span><br><span class="line">pZxid = 0x800000093</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 2</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 2</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 11]</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] create /test2 t2</span><br><span class="line">Created /test2</span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] </span><br><span class="line">[zk: localhost:2181(CONNECTED) 18] addauth digest hdfs:123456   </span><br><span class="line">[zk: localhost:2181(CONNECTED) 19] setAcl /test2 auth:hdfs:cdrwa</span><br><span class="line">cZxid = 0x800000099</span><br><span class="line">ctime = Tue Mar 22 15:46:58 CST 2022</span><br><span class="line">mZxid = 0x800000099</span><br><span class="line">mtime = Tue Mar 22 15:46:58 CST 2022</span><br><span class="line">pZxid = 0x800000099</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 1</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 2</span><br><span class="line">numChildren = 0</span><br><span class="line">[zk: localhost:2181(CONNECTED) 20] </span><br><span class="line">[zk: localhost:2181(CONNECTED) 20] getAcl /test2</span><br><span class="line">'digest,'hdfs:w071ZtmzC5+0fMHyY6QQSDnW3YY=</span><br><span class="line">: cdrwa</span><br><span class="line">[zk: localhost:2181(CONNECTED) 21]</span><br></pre></td></tr></table></figure>



<h1 id="四字命令"><a href="#四字命令" class="headerlink" title="四字命令"></a>四字命令</h1><ul>
<li>启用四字命令</li>
</ul>
<p>在配置文件 <code>zoo.cfg</code> 添加如下配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4lw.commands.whitelist&#x3D;*</span><br></pre></td></tr></table></figure>



<ul>
<li>conf</li>
</ul>
<p>打印服务配置详细信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# echo conf | nc 127.0.0.1 2181</span><br><span class="line">clientPort=2181</span><br><span class="line">dataDir=/hadoop/zookeeper/version-2</span><br><span class="line">dataLogDir=/hadoop/zookeeper/version-2</span><br><span class="line">tickTime=3000</span><br><span class="line">maxClientCnxns=60</span><br><span class="line">minSessionTimeout=6000</span><br><span class="line">maxSessionTimeout=60000</span><br><span class="line">serverId=1</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">electionAlg=3</span><br><span class="line">electionPort=3888</span><br><span class="line">quorumPort=2888</span><br><span class="line">peerType=0</span><br><span class="line">[root@manager ~]#</span><br></pre></td></tr></table></figure>



<ul>
<li>cons</li>
</ul>
<p>列出连接到此服务器的所有客户端的完整连接/会话详细信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# echo cons | nc 127.0.0.1 2181</span><br><span class="line"> /127.0.0.1:56412[0](queued=0,recved=1,sent=0)</span><br><span class="line"> /10.180.249.80:36610[1](queued=0,recved=11248,sent=11248,sid=0x200000487520016,lop=PING,est=1648707979813,to=60000,lcxid=0x941,lzxid=0xffffffffffffffff,lresp=180432277,llat=0,minlat=0,avglat=0,maxlat=4)</span><br><span class="line"> /10.180.249.81:57640[1](queued=0,recved=8882,sent=8884,sid=0x100002b03ce0000,lop=PING,est=1648707956970,to=60000,lcxid=0x7,lzxid=0xffffffffffffffff,lresp=180429864,llat=0,minlat=0,avglat=0,maxlat=10)</span><br><span class="line"> /10.180.249.81:57642[1](queued=0,recved=9023,sent=9036,sid=0x30000047001000a,lop=PING,est=1648707956983,to=60000,lcxid=0x5a0,lzxid=0xffffffffffffffff,lresp=180440871,llat=0,minlat=0,avglat=0,maxlat=18)</span><br><span class="line"> /10.180.249.80:36612[1]</span><br></pre></td></tr></table></figure>



<ul>
<li>envi</li>
</ul>
<p>打印有关服务环境的详细信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# echo envi |nc 127.0.0.1 2181</span><br><span class="line">Environment:</span><br><span class="line">zookeeper.version=3.4.14--1, built on 01/20/2021 05:51 GMT</span><br><span class="line">host.name=manager80.bigdata</span><br><span class="line">java.version=1.8.0_121</span><br><span class="line">java.vendor=Oracle Corporation</span><br><span class="line">java.home=/usr/jdk64/java/jre</span><br><span class="line">java.class.path=/usr/hdp/current/zookeeper-server/bin/../build/classes:/usr/hdp/current/zookeeper-server/bin/../build/lib/*.jar:/usr/hdp/current/zookeeper-server/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/hdp/current/zookeeper-server/bin/../lib/slf4j-api-1.7.25.jar:/usr/hdp/current/zookeeper-server/bin/../lib/netty-3.10.6.Final.jar:/usr/hdp/current/zookeeper-server/bin/../lib/log4j-1.2.17.jar:/usr/hdp/current/zookeeper-server/bin/../lib/jline-0.9.94.jar:/usr/hdp/current/zookeeper-server/bin/../lib/audience-annotations-0.5.0.jar:/usr/hdp/current/zookeeper-server/bin/../zookeeper-3.4.14.jar:/usr/hdp/current/zookeeper-server/bin/../src/java/lib/*.jar:/usr/hdp/current/zookeeper-server/conf:/usr/jdk64/java/lib:/usr/share/zookeeper/*:/usr/share/zookeeper/*</span><br><span class="line">java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">java.io.tmpdir=/tmp</span><br><span class="line">java.compiler=&lt;NA&gt;</span><br><span class="line">os.name=Linux</span><br><span class="line">os.arch=amd64</span><br><span class="line">os.version=3.10.0-693.el7.x86_64</span><br><span class="line">user.name=zookeeper</span><br><span class="line">user.home=/home/zookeeper</span><br><span class="line">user.dir=/home/zookeeper</span><br><span class="line">[root@manager ~]#</span><br></pre></td></tr></table></figure>



<ul>
<li>srvr</li>
</ul>
<p>列出服务器的完整详细信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# echo srvr |nc 127.0.0.1 2181</span><br><span class="line">Zookeeper version: 3.4.14--1, built on 01/20/2021 05:51 GMT</span><br><span class="line">Latency min/avg/max: 0/0/2558</span><br><span class="line">Received: 141894</span><br><span class="line">Sent: 141978</span><br><span class="line">Connections: 10</span><br><span class="line">Outstanding: 0</span><br><span class="line">Zxid: 0x200000513</span><br><span class="line">Mode: follower</span><br><span class="line">Node count: 83</span><br><span class="line">[root@manager ~]#</span><br></pre></td></tr></table></figure>



<ul>
<li>stat</li>
</ul>
<p>列出服务器和连接的客户端的简要详细信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager ~]# echo stat | nc 127.0.0.1 2181</span><br><span class="line">Zookeeper version: 3.4.14--1, built on 01/20/2021 05:51 GMT</span><br><span class="line">Clients:</span><br><span class="line"> /10.180.249.61:33984[1](queued=0,recved=597,sent=597)</span><br><span class="line"> /127.0.0.1:50258[0](queued=0,recved=1,sent=0)</span><br><span class="line"> /10.180.249.61:33988[1](queued=0,recved=595,sent=595)</span><br><span class="line"> /10.180.249.61:33950[1](queued=0,recved=599,sent=599)</span><br><span class="line"> /10.180.249.61:33976[1](queued=0,recved=595,sent=595)</span><br><span class="line"> /10.180.249.61:33966[1](queued=0,recved=593,sent=593)</span><br><span class="line"> /10.180.249.61:33954[1](queued=0,recved=590,sent=590)</span><br><span class="line"> /10.180.249.61:33982[1](queued=0,recved=590,sent=590)</span><br><span class="line"> /10.180.249.61:33978[1](queued=0,recved=589,sent=589)</span><br><span class="line"> /10.180.249.61:33944[1](queued=0,recved=1695,sent=1695)</span><br><span class="line"> /10.180.249.61:33962[1](queued=0,recved=597,sent=597)</span><br><span class="line"> /10.180.249.61:33952[1](queued=0,recved=597,sent=597)</span><br><span class="line"></span><br><span class="line">Latency min/avg/max: 0/0/4945</span><br><span class="line">Received: 7843</span><br><span class="line">Sent: 7842</span><br><span class="line">Connections: 12</span><br><span class="line">Outstanding: 0</span><br><span class="line">Zxid: 0x200021901</span><br><span class="line">Mode: follower</span><br><span class="line">Node count: 378</span><br><span class="line">[root@manager ~]#</span><br></pre></td></tr></table></figure>



<ul>
<li>wchs</li>
</ul>
<p>列出服务器监视的简要信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 ~]# echo wchs | nc 127.0.0.1 2181</span><br><span class="line">6 connections watching 15 paths</span><br><span class="line">Total watches:43</span><br><span class="line">[root@manager80 ~]#</span><br></pre></td></tr></table></figure>





<h1 id="解析日志和快照"><a href="#解析日志和快照" class="headerlink" title="解析日志和快照"></a>解析日志和快照</h1><ul>
<li>解析日志</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@manager80 zookeeper]# cd /usr/hdp/3.0.1.0-187/zookeeper</span><br><span class="line">[root@manager80 zookeeper]# ll</span><br><span class="line">total 1484</span><br><span class="line">drwxr-xr-x 2 root root     255 Feb 25 16:17 bin</span><br><span class="line">lrwxrwxrwx 1 root root      28 Feb 25 16:17 conf -&gt; /etc/zookeeper/3.0.1.0-187/0</span><br><span class="line">drwxr-xr-x 6 root root    4096 Feb 25 16:16 doc</span><br><span class="line">drwxr-xr-x 3 root root      18 Feb 25 16:16 etc</span><br><span class="line">drwxr-xr-x 2 root root     182 Feb 25 16:16 lib</span><br><span class="line">drwxr-xr-x 3 root root      18 Feb 25 16:16 man</span><br><span class="line">-rw-r--r-- 1 root root 1515059 Jan 21  2021 zookeeper-3.4.14.jar</span><br><span class="line">lrwxrwxrwx 1 root root      20 Feb 25 16:16 zookeeper.jar -&gt; zookeeper-3.4.14.jar</span><br><span class="line">[root@manager80 zookeeper]# java -cp zookeeper.jar:lib/* org.apache.zookeeper.server.LogFormatter /hadoop/zookeeper/version-2/log.100000001</span><br></pre></td></tr></table></figure>



<ul>
<li>解析快照</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/hdp/3.0.1.0-187/zookeeper</span><br><span class="line">java -cp zookeeper.jar:lib/* org.apache.zookeeper.server.SnapshotFormatter /hadoop/zookeeper/version-2/snapshot.400000044</span><br><span class="line"></span><br><span class="line">java -cp zookeeper.jar:lib/* org.apache.zookeeper.server.SnapshotFormatter /hadoop/zookeeper/version-2/snapshot.400000044 | grep count</span><br><span class="line"></span><br><span class="line">java -cp zookeeper.jar:lib/* org.apache.zookeeper.server.SnapshotFormatter /hadoop/zookeeper/version-2/snapshot.400000044 | grep /rmstore | wc -l</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>ZooKeeper: Because Coordinating Distributed Systems is a Zoo<br><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html" target="_blank" rel="noopener">https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html</a></li>
</ul>
<ul>
<li>zookeeper常用命令 - 掘金<br><a href="https://juejin.cn/post/6844903876123066376" target="_blank" rel="noopener">https://juejin.cn/post/6844903876123066376</a></li>
</ul>
<ul>
<li>Zookeeper权限控制ACL详解_我会努力变强的的博客-CSDN博客_zookeeper的acl<br><a href="https://blog.csdn.net/qq_40837310/article/details/106826963" target="_blank" rel="noopener">https://blog.csdn.net/qq_40837310/article/details/106826963</a></li>
</ul>
<ul>
<li>zookeeper ACL 权限控制 - 云+社区 - 腾讯云<br><a href="https://cloud.tencent.com/developer/article/1414462" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1414462</a></li>
</ul>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
        <tag>ZooKeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>ZooKeeper deb 打包方法</title>
    <url>/2020/11/28/zookeeper-deb/</url>
    <content><![CDATA[<p>本文主要以 ZooKeeper 为例，介绍了source2deb、deb2deb、rpm2deb、tar2deb四种打包 deb 的方法，具有好的通用性。</p>
<a id="more"></a>

<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>主要测试了四种zookeeper打包成deb的方式，分别为从源码直接打成deb包（source2deb）、逆向打包（deb2deb）、从rpm包转成deb包（rpm2deb）和使用源码编译成tar包，再将编译好的tar包打成deb包（tar2deb），推荐使用最后一种方式。</p>
<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><p>以下操作均为在 Ubuntu 19 中使用 root 用户操作。</p>
<h1 id="Source2deb"><a href="#Source2deb" class="headerlink" title="Source2deb"></a>Source2deb</h1><p>有些组件官方提供直接从源码打包成 deb 的方式，比如 ZooKeeper</p>
<h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2><p>zookeeper-release-HDP-2.6.5.148-3-tag.tar.gz：<a href="https://github.com/hortonworks/zookeeper-release/releases/tag/HDP-2.6.5.148-3-tag" target="_blank" rel="noopener">https://github.com/hortonworks/zookeeper-release/releases/tag/HDP-2.6.5.148-3-tag</a></p>
<h2 id="打成deb包"><a href="#打成deb包" class="headerlink" title="打成deb包"></a>打成deb包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd zookeeper-release-HDP-2.6.5.148-3-tag&#x2F;</span><br><span class="line">ant deb</span><br></pre></td></tr></table></figure>

<h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd build</span><br></pre></td></tr></table></figure>

<h1 id="Deb2deb"><a href="#Deb2deb" class="headerlink" title="Deb2deb"></a>Deb2deb</h1><p>这种属于逆向打包过程。</p>
<h2 id="创建工作环境"><a href="#创建工作环境" class="headerlink" title="创建工作环境"></a>创建工作环境</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir zkdeb</span><br><span class="line">cd zkdeb&#x2F;</span><br><span class="line">mkdir zookeeper</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126201740.png" alt=""></p>
<h2 id="解包"><a href="#解包" class="headerlink" title="解包"></a>解包</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -X zookeeper_3.4.6-1_amd64.deb zookeeper&#x2F;</span><br><span class="line">cd zookeeper&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/20201126201810.png" alt=""></p>
<h2 id="提取DEBIAN信息"><a href="#提取DEBIAN信息" class="headerlink" title="提取DEBIAN信息"></a>提取DEBIAN信息</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir DEBIAN</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/02543c81016507b725aadef93014e47d.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;Downloads&#x2F;zkdeb</span><br><span class="line"></span><br><span class="line">dpkg -e zookeeper_3.4.6-1_amd64.deb .&#x2F;zookeeper&#x2F;DEBIAN&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/bfe621e1462baaf97c984e8c9f376bfc.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/f512a1a3def7fa3df6623a5cf6be12fa.png" alt=""></p>
<h2 id="重新打包deb"><a href="#重新打包deb" class="headerlink" title="重新打包deb"></a>重新打包deb</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir build</span><br><span class="line"></span><br><span class="line">cd &#x2F;home&#x2F;erik&#x2F;Downloads&#x2F;zkdeb</span><br><span class="line"></span><br><span class="line">dpkg-deb -b zookeeper&#x2F; build&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/0906697f47d90b97061928d01339ab9b.png" alt=""></p>
<h2 id="查看deb文件"><a href="#查看deb文件" class="headerlink" title="查看deb文件"></a>查看deb文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd build&#x2F;</span><br></pre></td></tr></table></figure>


<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/c2e6b1a8cda4cc60a0632f70202d21b1.png" alt=""></p>
<h1 id="DEBIAN文件解析"><a href="#DEBIAN文件解析" class="headerlink" title="DEBIAN文件解析"></a>DEBIAN文件解析</h1><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/537accb1519754e7b60b52545103b9d2.png" alt=""></p>
<h2 id="control"><a href="#control" class="headerlink" title="control"></a>control</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/f7fc545130db2b64f98ffdc14c0dd069.png" alt=""></p>
<h2 id="Preinst"><a href="#Preinst" class="headerlink" title="Preinst"></a>Preinst</h2><p>在Deb包文件解包之前，将会运行该脚本。许多“preinst”脚本的任务是停止作用于待升级软件包的服务，直到软件包安装或升级完成。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/b2d2d56fdf0713795f589f54e8443585.png" alt=""></p>
<h2 id="Postinst"><a href="#Postinst" class="headerlink" title="Postinst"></a>Postinst</h2><p>该脚本的主要任务是完成安装包时的配置工作。许多“postinst”脚本负责执行有关命令为新安装或升级的软件重启服务。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/e74613be4fef44923cd2555c6e88c9ab.png" alt=""></p>
<h2 id="prerm"><a href="#prerm" class="headerlink" title="prerm"></a>prerm</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/096ef884dba387c5b8330d01cbe2d7a3.png" alt=""></p>
<h2 id="Postrm"><a href="#Postrm" class="headerlink" title="Postrm"></a>Postrm</h2><p>该脚本负责修改软件包链接或文件关联，或删除由它创建的文件。</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/6d8b434d38464f2632d7d46fe3ff96d0.png" alt=""></p>
<h2 id="md5sums"><a href="#md5sums" class="headerlink" title="md5sums"></a>md5sums</h2><p>各文件的md5值</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2763daa6e3397aa0a31c851f903d92a1.png" alt=""></p>
<h2 id="conffile"><a href="#conffile" class="headerlink" title="conffile"></a>conffile</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/6b302ae1c043e51fdc99918efa2bf4b8.png" alt=""></p>
<h1 id="Rpm2deb"><a href="#Rpm2deb" class="headerlink" title="Rpm2deb"></a>Rpm2deb</h1><p>打包好的rpm包可以直接使用“alien”工具转换为deb包。</p>
<p>实验环境：Ubuntu 19</p>
<p>工具：alien</p>
<h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install alien</span><br></pre></td></tr></table></figure>

<p>因为zookeeper的来源可以是source2rpm和source2tar2rpm，所以现分别使用这两个rpm包进行测试</p>
<h2 id="Source2rpm2deb"><a href="#Source2rpm2deb" class="headerlink" title="Source2rpm2deb"></a>Source2rpm2deb</h2><p>准备好之前打包好的rpm包</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/3ee6b8e467e0ea501d25d4e2b69bbd69.png" alt=""></p>
<p>执行命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alien zookeeper-3.4.6-1.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/be8787b5f4af83a2ee5b082458ca8a8b.png" alt=""></p>
<h2 id="Source2tar2rpm2deb"><a href="#Source2tar2rpm2deb" class="headerlink" title="Source2tar2rpm2deb"></a>Source2tar2rpm2deb</h2><p>与之前方法类似，执行步骤如下图所示</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5a1912bd8b5388027d5e8c6d9d151e9e.png" alt=""></p>
<h1 id="Tar2deb"><a href="#Tar2deb" class="headerlink" title="Tar2deb"></a>Tar2deb</h1><p>推荐使用这种方式，先使用源码编译成tar包，再使用tar包打成deb包，由于之前打rpm包时已经介绍过zookeeper打成tar包的流程，并且使用ant打包方法，不具有代表性，这里不再赘述，只介绍从tar包到deb包的步骤。</p>
<p>实验环境：Ubuntu 19</p>
<h2 id="创建工作目录"><a href="#创建工作目录" class="headerlink" title="创建工作目录"></a>创建工作目录</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir zookeeper</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/eaa198f04d67e9187295c1639c6866bd.png" alt=""></p>
<p>创建DEBIAN 目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd zookeeper&#x2F;</span><br><span class="line"></span><br><span class="line">mkdir DEBIAN</span><br><span class="line"></span><br><span class="line">cd DEBIAN&#x2F;</span><br><span class="line"></span><br><span class="line">vim control</span><br></pre></td></tr></table></figure>

<h2 id="准备安装文件"><a href="#准备安装文件" class="headerlink" title="准备安装文件"></a>准备安装文件</h2><p>将<strong>编译好的</strong>zookeeper tar 包解压到DEBIAN的同级目录下,<br>也就是说我们把当前的目录当成根目录, 制作完成后安装时,<br>当前目录下除DEBIAN目录的其他目录都会被默认安装到系统的/目录下，比如之后要将zookeeper安装到/opt/zookeeper/这个目录下，那么就将编译好的zookeeper解压到/opt/zookeeper/目录下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;zookeeper&#x2F;tar2deb&#x2F;zookeeper</span><br><span class="line"></span><br><span class="line">mkdir opt</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/73250e9b1f48cac2d40213915b2f06b6.png" alt=""></p>
<p>cd opt</p>
<p>将编译好的tar包上传到这个文件夹</p>
<p>解压</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar –xvf zookeeper-3.4.6.tar.gz</span><br><span class="line"></span><br><span class="line">mv zookeeper-3.4.6 zookeeper</span><br><span class="line"></span><br><span class="line">rm –rf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/bfbece7b8af4381f10eff7580c3ebce6.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/05e344b8cde7d5676106fc92ed7e0751.png" alt=""></p>
<h2 id="打包deb"><a href="#打包deb" class="headerlink" title="打包deb"></a>打包deb</h2><p>创建存放deb包目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;erik&#x2F;zookeeper&#x2F;tar2deb</span><br><span class="line"></span><br><span class="line">mkdir build</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/82c063bfa381ae968fc16e4243b6ad11.png" alt=""></p>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg-deb -b zookeeper&#x2F; build&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/08edbf394ea0d549c80d264cd9800ee4.png" alt=""></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>安装环境为另一台Ubuntu 19 虚拟机，模拟安装环境。</p>
<h2 id="Deb2deb-1"><a href="#Deb2deb-1" class="headerlink" title="Deb2deb"></a>Deb2deb</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dpkg -i zookeeper_3.4.6_all.deb</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/c8dcaaeb70ba8c3e2d4e0eac60fd0de4.png" alt=""></p>
<p>修改打包时的依赖</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/dbb093811dc9ce5cfa4c4b14a45c44ad.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/f1f6a464c30aaa4ec14e026600da7581.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/73cf99ba14c0cc0ff7326859e8e19d5f.png" alt=""></p>
<p>寻找安装目录</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2e207b14c69a51508678e5158467e385.png" alt=""></p>
<p>配置文件</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/1af2be1da931f3a675d6654a6d51f2d6.png" alt=""></p>
<p>启动脚本</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/5e42b2f08eacf00ed8c40e1fecfec1ca.png" alt=""></p>
<p>启动</p>
<p>在安装的主机上，</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/8cc988e70b158827184a910455a09d6e.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/2c9ef4a9335604647677f37220d63605.png" alt=""></p>
<h2 id="Source2tar2deb"><a href="#Source2tar2deb" class="headerlink" title="Source2tar2deb"></a>Source2tar2deb</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/284f15a3d23db1ed675173f8231d4c2a.png" alt=""></p>
<p>找到安装目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;zookeeper&#x2F;</span><br></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd conf&#x2F;</span><br><span class="line"></span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/4f096d036ad74fc91b3ad3fb4509ee63.png" alt=""></p>
<p>启动</p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/6317963ffa9a4eeda718e9a3c169b649.png" alt=""></p>
<h2 id="Source2tar2rpm2deb-1"><a href="#Source2tar2rpm2deb-1" class="headerlink" title="Source2tar2rpm2deb"></a>Source2tar2rpm2deb</h2><p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/dbb8ec55d14f7bca140133cd124c9014.png" alt=""></p>
<p><img src="https://fastly.jsdelivr.net/gh/Erik-ly/images@master/img/2020/a08d643763c16f8e4f43ef5ae86f1a59.png" alt=""></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><p>Ubuntu下制作deb包的方法详解 - AderStep - CSDN博客<br><a href="https://blog.csdn.net/gatieme/article/details/52829907" target="_blank" rel="noopener">https://blog.csdn.net/gatieme/article/details/52829907</a> </p>
</li>
<li><p>Deb包介绍 - 简书<br><a href="https://www.jianshu.com/p/67094ffe9578" target="_blank" rel="noopener">https://www.jianshu.com/p/67094ffe9578</a> </p>
</li>
<li><p>deb和rpm包相互转换 - chenyulancn的专栏 - CSDN博客<br><a href="https://blog.csdn.net/chenyulancn/article/details/62216190" target="_blank" rel="noopener">https://blog.csdn.net/chenyulancn/article/details/62216190</a> </p>
</li>
</ul>
]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>BigData</tag>
        <tag>ZooKeeper</tag>
      </tags>
  </entry>
</search>
